const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/GraphDialog-DOSMenmW.js","assets/mui-vendor-C85vPdgr.js","assets/react-vendor-QLNaZ7XN.js","assets/index-CvPj5UcW.js","assets/motion-vendor-CXcnLVtk.js","assets/index-DZWGvWwf.css","assets/chart-vendor-DVL1rbVz.js"])))=>i.map(i=>d[i]);
import{u as Sn,e as Jn,R as On,k as de,c as zn,f as $n,g as Zn,i as es,j as kn,D as ns,h as rn,d as on,a as Fn,A as ss,r as fn,o as ts,_ as as}from"./index-CvPj5UcW.js";import{j as e,E as dn,G as cn,X as Ie,F as be,K as ve,S as Te,M as U,W as un,C as ce,r as ae,A as ls,f as Un,B as g,ac as _n,I as Xe,g as Wn,h as Bn,k as $e,l as I,m as Hn,H as pn,i as xn,a as rs,b as is,y as Mn,ad as ln,U as Rn,a2 as os,a3 as ds,a5 as cs,a0 as us,a1 as ps,Y as Re,d as En,e as Ve,D as hs}from"./mui-vendor-C85vPdgr.js";import{r}from"./react-vendor-QLNaZ7XN.js";import{D as Ln,C as An,P as Pn,u as fs,d as xs,a as gs}from"./useLongPress-BJgmop5a.js";import{d as ms}from"./SpaceDashboardOutlined-DKfN7wmn.js";import{m as js,A as ys}from"./motion-vendor-CXcnLVtk.js";import"./chart-vendor-DVL1rbVz.js";function bs({open:L,playCategories:f,playDetails:m,rallyCategoryTags:b,rallyDetailTags:v,initialData:p,onCancel:k,onSave:P}){const[d,w]=r.useState(""),[j,J]=r.useState(""),[V,B]=r.useState([]),[C,H]=r.useState([]),[A,G]=r.useState(""),[D,De]=r.useState(""),[O,ue]=r.useState(""),[l,we]=r.useState("合算"),[Y,ee]=r.useState([]),[re,pe]=r.useState({open:!1,message:"",severity:"success"}),he=Sn("md"),fe=Sn("sm"),{handleTouchEnd:Qe,setSwiperRef:Se,getSwiperRef:Fe}=Jn(),[xe,Ue]=r.useState(""),We=()=>{pe(s=>({...s,open:!1}))},Be=s=>{if(xe){const y=Fe(xe);y&&(y.allowTouchMove=!0),Ue("")}if(!s.destination)return;const a=Array.from(Y),[c]=a.splice(s.source.index,1);a.splice(s.destination.index,0,c),ee(a)};r.useEffect(()=>{L&&(w((p==null?void 0:p.name)||""),ee((p==null?void 0:p.items)||[]),J(""),B([]),H([]),G(""),De(""),ue(""),we("合算"))},[L,p]);const ke=j!=="",He=V.length>0,ge=A!=="",z=C.length>0,N=D!=="",X=O!=="",me=ke?He||z?!1:ge?!N&&!X:!0:He||z?!(ke||ge):ge?!1:!!(N||X),Ge=()=>{if(!l||!me)return;const s={id:crypto.randomUUID(),method:l};j?s.playCategoryId=j:V.length>0&&(s.playCategoryTags=V),A&&(s.playDetailId=A),C.length>0&&(s.playDetailTags=C),D&&(s.pointType=D),O&&(s.pointUnitType=O),ee(a=>[...a,s]),J(""),B([]),G(""),H([]),De(""),ue("")},ie=s=>{ee(a=>{const c=a.findIndex(S=>S.id===s);if(c===-1)return a;const y=[...a],[T]=y.splice(c,1);return pe({open:!0,message:"項目を削除しました",severity:"success",actionLabel:"元に戻す",onAction:()=>{ee(S=>{const _=[...S];return _.splice(c,0,T),_})},autoHideDuration:5e3}),y})},Ee=()=>{if(!d||Y.length===0)return;const s={id:(p==null?void 0:p.id)||crypto.randomUUID(),name:d,items:Y};P(s)},je=j?m.filter(s=>s.playCategoryId===j&&s.visible!==!1):[],Le=s=>m.filter(a=>{var y,T;const c=f.find(S=>S.id===a.playCategoryId);return!(a.visible===!1||(c==null?void 0:c.visible)===!1||s.playCategoryId&&a.playCategoryId!==s.playCategoryId||s.playCategoryTags&&s.playCategoryTags.length>0&&!((y=c==null?void 0:c.tags)!=null&&y.some(S=>{var _;return(_=s.playCategoryTags)==null?void 0:_.includes(S)}))||s.playDetailId&&a.id!==s.playDetailId||s.playDetailTags&&s.playDetailTags.length>0&&!((T=a.tags)!=null&&T.some(S=>{var _;return(_=s.playDetailTags)==null?void 0:_.includes(S)}))||s.pointType&&a.pointType!==s.pointType||s.pointUnitType&&a.pointUnitType!==s.pointUnitType)}),Ne=s=>{var a;return s.playCategoryTags&&s.playCategoryTags.length>0?s.playCategoryTags.map(c=>{var y;return((y=b.find(T=>T.id===c))==null?void 0:y.name)||c}).join(","):((a=f.find(c=>c.id===s.playCategoryId))==null?void 0:a.name)||""},ye=s=>{var a;return s.playDetailTags&&s.playDetailTags.length>0?s.playDetailTags.map(c=>{var y;return((y=v.find(T=>T.id===c))==null?void 0:y.name)||c}).join(","):s.playDetailId&&((a=m.find(c=>c.id===s.playDetailId))==null?void 0:a.name)||""},Ae=s=>[Ne(s),ye(s),s.pointType||"",s.pointUnitType||"",s.method].join(","),_e=s=>Le(s).length===0,qe=Y.some(_e);return e.jsxs(e.Fragment,{children:[e.jsxs(On,{open:L,onClose:k,children:[e.jsx(dn,{children:"カスタム分析追加"}),e.jsxs(cn,{children:[e.jsx(Ie,{label:"カスタム分析名",margin:"dense",value:d,onChange:s=>w(s.target.value),fullWidth:!0}),e.jsxs(be,{fullWidth:!0,margin:"dense",disabled:V.length>0||C.length>0,children:[e.jsx(ve,{id:"category",children:"プレー区分"}),e.jsxs(Te,{labelId:"category",value:j,label:"プレー区分",onChange:s=>{const a=s.target.value;J(a),G(""),H([]),a&&B([])},children:[e.jsx(U,{value:"",children:"指定なし"}),f.filter(s=>s.visible!==!1).map(s=>e.jsx(U,{value:s.id,children:s.name},s.id))]})]}),e.jsxs(be,{fullWidth:!0,margin:"dense",disabled:!!D||!!O||V.length>0||C.length>0,children:[e.jsx(ve,{id:"detail",children:"プレー詳細"}),e.jsxs(Te,{labelId:"detail",value:A,label:"プレー詳細",onChange:s=>{G(s.target.value),s.target.value&&(De(""),ue(""),B([]),H([]))},children:[e.jsx(U,{value:"",children:"指定なし"}),je.map(s=>e.jsx(U,{value:s.id,children:s.name},s.id))]})]}),e.jsx(un,{multiple:!0,options:b,getOptionLabel:s=>s.name,value:b.filter(s=>V.includes(s.id)),onChange:(s,a)=>{B(a.map(c=>c.id)),a.length>0&&(J(""),G(""))},renderTags:(s,a)=>s.map((c,y)=>{const{key:T,...S}=a({index:y});return e.jsx(ce,{...S,label:c.name,size:"small",sx:{backgroundColor:c.color||de,color:"#fff"}},T)}),renderInput:s=>e.jsx(Ie,{...s,label:"プレー区分タグ",margin:"dense"}),disabled:!!j||!!A,fullWidth:!0}),e.jsx(un,{multiple:!0,options:v,getOptionLabel:s=>s.name,value:v.filter(s=>C.includes(s.id)),onChange:(s,a)=>{H(a.map(c=>c.id)),a.length>0&&(J(""),G(""))},renderTags:(s,a)=>s.map((c,y)=>{const{key:T,...S}=a({index:y});return e.jsx(ce,{...S,label:c.name,size:"small",sx:{backgroundColor:c.color||de,color:"#fff"}},T)}),renderInput:s=>e.jsx(Ie,{...s,label:"プレー詳細タグ",margin:"dense"}),disabled:!!j||!!A,fullWidth:!0}),e.jsxs(be,{fullWidth:!0,disabled:!!A,margin:"dense",children:[e.jsx(ve,{id:"ptype",children:"得失点区分"}),e.jsxs(Te,{labelId:"ptype",value:D,label:"得失点区分",onChange:s=>{De(s.target.value),s.target.value&&G("")},children:[e.jsx(U,{value:"",children:"指定なし"}),e.jsx(U,{value:"得点",children:"得点"}),e.jsx(U,{value:"失点",children:"失点"})]})]}),e.jsxs(be,{fullWidth:!0,disabled:!!A,margin:"dense",children:[e.jsx(ve,{id:"punittype",children:"得失点単位区分"}),e.jsxs(Te,{labelId:"punittype",value:O,label:"得失点単位区分",onChange:s=>{ue(s.target.value),s.target.value&&G("")},children:[e.jsx(U,{value:"",children:"指定なし"}),e.jsx(U,{value:"メンバー",children:"メンバー"}),e.jsx(U,{value:"チーム",children:"チーム"})]})]}),e.jsxs(be,{fullWidth:!0,margin:"dense",children:[e.jsx(ve,{id:"method",children:"集計方法"}),e.jsxs(Te,{labelId:"method",value:l,label:"集計方法",onChange:s=>we(s.target.value),children:[e.jsx(U,{value:"合算",children:"合算"}),e.jsx(U,{value:"試合平均",children:"試合平均"}),e.jsx(U,{value:"セット平均",children:"セット平均"})]})]}),e.jsx(ae,{variant:"contained",onClick:Ge,size:"medium",disabled:!me,fullWidth:!0,startIcon:e.jsx(zn,{}),sx:{mt:1},children:"追加"}),Y.length>0&&e.jsxs(e.Fragment,{children:[qe&&e.jsx(ls,{severity:"error",sx:{mb:1},children:"分析条件に合致するプレー区分、または、プレー詳細が存在しません（赤背景行）"}),e.jsx($n,{component:Un,storageKey:"custom-analysis-dialog",children:he?e.jsx(Ln,{onDragEnd:Be,children:e.jsx(An,{droppableId:"custom-analysis-items",children:s=>e.jsxs(g,{ref:s.innerRef,...s.droppableProps,children:[e.jsx(g,{sx:{display:"grid",gridTemplateColumns:fe?"1fr":"150px 1fr 110px 130px 110px",alignItems:"center",height:50,px:1,borderBottom:1,borderColor:"divider",...Zn,lineHeight:1},children:fe?e.jsx(g,{children:"分析項目"}):e.jsxs(e.Fragment,{children:[e.jsx(g,{children:"プレー区分"}),e.jsx(g,{children:"プレー詳細"}),e.jsx(g,{children:"得点区分"}),e.jsx(g,{children:"得失点単位区分"}),e.jsx(g,{children:"集計方法"})]})}),Y.map((a,c)=>{const y=_e(a);return e.jsx(Pn,{draggableId:a.id,index:c,children:T=>{const S=T.dragHandleProps,{onPointerDown:_,...M}=S||{},R=fs($=>{_==null||_($);const Z=Fe(a.id);Z&&(Z.allowTouchMove=!1),Ue(a.id)});return e.jsx(g,{ref:T.innerRef,...T.draggableProps,style:T.draggableProps.style,children:e.jsxs(es,{onSwiper:$=>Se(a.id,$),threshold:20,slidesPerView:"auto",style:{overflow:"hidden"},onTouchStart:($,Z)=>Z.stopPropagation(),onTouchEnd:$=>Qe(a.id,$),children:[e.jsx(kn,{style:{width:"100%",flex:"0 0 auto"},children:e.jsx(g,{...M,...R,sx:{display:"grid",gridTemplateColumns:fe?"1fr":"150px 1fr 110px 130px 110px",alignItems:"center",height:50,px:1,borderBottom:1,borderColor:"divider",bgcolor:$=>y?_n($.palette.error.main,.1):$.palette.background.paper,lineHeight:1,touchAction:xe===a.id?"none":"pan-y",cursor:"grab"},children:fe?e.jsx(g,{children:Ae(a)}):e.jsxs(e.Fragment,{children:[e.jsx(g,{sx:{pr:1},children:Ne(a)}),e.jsx(g,{sx:{pr:1},children:ye(a)}),e.jsx(g,{sx:{pr:1},children:a.pointType||""}),e.jsx(g,{sx:{pr:1},children:a.pointUnitType||""}),e.jsx(g,{children:a.method})]})})}),e.jsx(kn,{style:{width:ns,flex:"0 0 auto"},children:e.jsx(g,{sx:{height:50,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"error.main"},children:e.jsx(Xe,{size:"small",onClick:()=>ie(a.id),children:e.jsx(rn,{fontSize:"small",sx:{color:"common.white"}})})})})]})})}},a.id)}),s.placeholder]})})}):e.jsxs(Wn,{size:"small",sx:{"& .MuiTableRow-root":{height:50}},children:[e.jsx(Bn,{children:e.jsxs($e,{sx:{backgroundColor:s=>s.palette.mode==="dark"?"#343A42":"#f5f5f5"},children:[e.jsx(I,{}),e.jsx(I,{children:"プレー区分"}),e.jsx(I,{children:"プレー詳細"}),e.jsx(I,{children:"得失点区分"}),e.jsx(I,{children:"得失点単位区分"}),e.jsx(I,{children:"集計方法"}),e.jsx(I,{})]})}),e.jsx(Ln,{onDragEnd:Be,children:e.jsx(An,{droppableId:"custom-analysis-items",children:s=>e.jsxs(Hn,{ref:s.innerRef,...s.droppableProps,children:[Y.map((a,c)=>{const y=_e(a);return e.jsx(Pn,{draggableId:a.id,index:c,children:T=>{var S,_;return e.jsxs($e,{ref:T.innerRef,...T.draggableProps,sx:{backgroundColor:y?M=>_n(M.palette.error.main,.1):void 0},children:[e.jsx(I,{padding:"checkbox",children:e.jsx(g,{...T.dragHandleProps,sx:{cursor:"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:e.jsx(xs,{fontSize:"small"})})}),e.jsx(I,{children:a.playCategoryTags&&a.playCategoryTags.length>0?a.playCategoryTags.map(M=>{const R=b.find(Z=>Z.id===M),$=(R==null?void 0:R.color)||de;return e.jsx(ce,{label:(R==null?void 0:R.name)||M,size:"small",sx:{mr:.5,mb:.5,backgroundColor:$,color:"#fff"}},M)}):(S=f.find(M=>M.id===a.playCategoryId))==null?void 0:S.name}),e.jsx(I,{children:a.playDetailTags&&a.playDetailTags.length>0?a.playDetailTags.map(M=>{const R=v.find(Z=>Z.id===M),$=(R==null?void 0:R.color)||de;return e.jsx(ce,{label:(R==null?void 0:R.name)||M,size:"small",sx:{mr:.5,mb:.5,backgroundColor:$,color:"#fff"}},M)}):a.playDetailId?(_=m.find(M=>M.id===a.playDetailId))==null?void 0:_.name:""}),e.jsx(I,{children:a.pointType||""}),e.jsx(I,{children:a.pointUnitType||""}),e.jsx(I,{children:a.method}),e.jsx(I,{children:e.jsx(Xe,{size:"small",onClick:()=>ie(a.id),children:e.jsx(rn,{fontSize:"small",color:"error"})})})]})}},a.id)}),s.placeholder]})})})]})})]})]}),e.jsxs(pn,{children:[e.jsx(ae,{onClick:k,startIcon:e.jsx(on,{}),color:"inherit",children:"キャンセル"}),e.jsx(ae,{onClick:Ee,disabled:!d||Y.length===0,startIcon:e.jsx(Fn,{}),children:"OK"})]})]}),e.jsx(ss,{open:re.open,message:re.message,severity:re.severity,actionLabel:re.actionLabel,onAction:re.onAction,autoHideDuration:re.autoHideDuration,onClose:We})]})}var gn={},vs=xn;Object.defineProperty(gn,"__esModule",{value:!0});var hn=gn.default=void 0,Ts=vs(fn()),Cs=e;hn=gn.default=(0,Ts.default)((0,Cs.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search");var mn={},Is=xn;Object.defineProperty(mn,"__esModule",{value:!0});var Gn=mn.default=void 0,Ds=Is(fn()),ws=e;Gn=mn.default=(0,Ds.default)((0,ws.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Clear");var jn={},Ss=xn;Object.defineProperty(jn,"__esModule",{value:!0});var Nn=jn.default=void 0,ks=Ss(fn()),_s=e;Nn=jn.default=(0,ks.default)((0,_s.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM5.92 19H5v-.92l9.06-9.06.92.92zM20.71 5.63l-2.34-2.34c-.2-.2-.45-.29-.71-.29s-.51.1-.7.29l-1.83 1.83 3.75 3.75 1.83-1.83c.39-.39.39-1.02 0-1.41"}),"CreateOutlined");const Ms=r.lazy(()=>as(()=>import("./GraphDialog-DOSMenmW.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),Ce="__TEAM__",Rs=js.create(g);function Es(L,f){let m=0,b=0,v=0,p=0;return L.sets.forEach(k=>{const P=f==="teamA"?k.my:k.opponent,d=f==="teamA"?k.opponent:k.my;v+=P,p+=d,P>d?m+=1:P<d&&(b+=1)}),m>b?"win":m<b?"lose":v>p?"win":v<p?"lose":"draw"}function Ls(L,f,m,b,v,p,k,P){return L.filter(d=>{if(f!=="ALL"){if(!(d.teamA===f||d.teamB===f)||m&&!(d.teamA===f&&d.teamB===m||d.teamA===m&&d.teamB===f))return!1;if(k){const j=d.teamA===f?"teamA":"teamB";if(Es(d,j)!==k)return!1}}else if(m&&d.teamA!==m&&d.teamB!==m)return!1;return!(b&&d.date<b||v&&d.date>v||p&&!d.matchName.includes(p)||P&&P.length>0&&!P.every(w=>d.tags.includes(w)))})}function As(L,f){const m=f==="teamA"?L.my:L.opponent,b=f==="teamA"?L.opponent:L.my;return m>b?"win":m<b?"lose":"draw"}function Ps(L,f,m,b,v){const p={},k=(d,w,j)=>{p[d]||(p[d]={}),p[d][w]||(p[d][w]={}),p[d][w][j]=(p[d][w][j]||0)+1},P=(d,w)=>!!w&&(b[d]||[]).some(j=>j.id===w&&j.visible!==!1);return L.forEach(d=>{const w=(j,J)=>{d.sets.forEach(V=>{v&&As(V,J)!==v||V.rallies.forEach(B=>{const C=J==="teamA"?B.teamAPlayDetail:B.teamBPlayDetail,H=J==="teamA"?B.teamAMember:B.teamBMember;if(!C)return;const A=m.get(C);(A==null?void 0:A.pointUnitType)==="チーム"?k(j,Ce,C):(A==null?void 0:A.pointUnitType)==="メンバー"&&(P(j,H)?k(j,H,C):k(j,Ce,C))})})};f==="ALL"?(d.teamA&&w(d.teamA,"teamA"),d.teamB&&w(d.teamB,"teamB")):d.teamA===f?w(f,"teamA"):d.teamB===f&&w(f,"teamB")}),p}function Hs({matches:L,teams:f,teamMembers:m,playCategories:b,playDetails:v,customAnalyses:p,onCustomAnalysesChange:k,tags:P,rallyCategoryTags:d,rallyDetailTags:w,themeSetting:j,showSnackbar:J,setAppBarAction:V,setAppBarLeftAction:B}){var wn;const C=((wn=f[0])==null?void 0:wn.id)||"",[H,A]=r.useState(0),G=n=>{A(n)},[D,De]=r.useState("member"),[O,ue]=r.useState("asc"),[l,we]=r.useState({left:C,right:"",dateFrom:"",dateTo:"",name:"",tags:[]}),[Y,ee]=r.useState(!1),[re,pe]=r.useState(!1),[he,fe]=r.useState(null),[Qe,Se]=r.useState(!1),[Fe,xe]=r.useState(!1),[Ue,We]=r.useState(""),[Be,ke]=r.useState([]),[He,ge]=r.useState(""),z=rs(),N=is(z.breakpoints.up("sm")),[X,me]=r.useState(!1),[Ge,ie]=r.useState(!1),Ee=56,je=200,Le=r.useCallback(()=>{X?(ie(!1),me(!1)):(me(!0),N||ie(!0))},[X,N]),Ne=r.useCallback(n=>{n.target===n.currentTarget&&(X?ie(!0):(me(!1),ie(!1)))},[X]),[ye,Ae]=r.useState(f.length>0?f[0].id:""),[_e,qe]=r.useState(""),[s,a]=r.useState(""),[c,y]=r.useState(""),[T,S]=r.useState(""),[_,M]=r.useState(""),[R,$]=r.useState(""),[Z,yn]=r.useState([]),bn=r.useMemo(()=>new Map(v.map(n=>[n.id,n])),[v]),qn=r.useCallback(()=>{we({left:C,right:"",dateFrom:"",dateTo:"",name:"",tags:[],matchResult:void 0,setResult:void 0})},[C]),Kn=r.useMemo(()=>l.left===C&&l.right===""&&l.dateFrom===""&&l.dateTo===""&&l.name===""&&l.tags.length===0&&l.matchResult===void 0&&l.setResult===void 0,[l,C]);r.useEffect(()=>{!l.left&&C&&we(n=>({...n,left:C})),!ye&&C&&Ae(C)},[C,l.left,ye]),r.useEffect(()=>{Y&&(Ae(l.left),qe(l.right),a(l.dateFrom),y(l.dateTo),S(l.name),M(l.matchResult||""),$(l.setResult||""),yn(l.tags))},[Y,l]),r.useEffect(()=>(V(e.jsx(ae,{color:"inherit",startIcon:e.jsx(hn,{}),onClick:()=>ee(!0),children:"詳細検索"})),()=>V(null)),[V]),r.useEffect(()=>(B(e.jsx(Xe,{color:"inherit",onClick:Le,children:e.jsx(ms,{})})),()=>B(null)),[B,Le]);const Ke=r.useMemo(()=>Ls(L,l.left,l.right,l.dateFrom,l.dateTo,l.name,l.matchResult,l.tags),[L,l]),ne=r.useMemo(()=>{const n=l.setResult;return Ps(Ke,l.left,bn,m,n)},[Ke,l,bn,m]),Ye=Ke.length,Je=Ke.reduce((n,t)=>n+t.sets.length,0),W=l.left,vn=r.useMemo(()=>W==="ALL"?f.map(n=>n.id):[W],[W,f]),le=r.useMemo(()=>b.filter(n=>n.visible!==!1),[b]),Q=H>=le.length,Ze=Q?H-le.length:-1,q=Q?p[Ze]:null,Pe=Q?void 0:le[H],Me=Q?[]:v.filter(n=>n.playCategoryId===(Pe==null?void 0:Pe.id)&&n.visible!==!1),Vn=!Q&&Me.length>0&&Me.every(n=>n.pointUnitType==="チーム"),en=r.useMemo(()=>[...le.map(n=>({key:n.id,label:n.name})),...p.map(n=>({key:n.id,label:n.name})),{key:"add",label:"分析追加"}],[le,p]),nn=r.useCallback(n=>{var t;return((t=f.find(i=>i.id===n))==null?void 0:t.name)||""},[f]),Oe=r.useCallback(n=>v.filter(t=>{var u,o;const i=b.find(h=>h.id===t.playCategoryId);return!(t.visible===!1||(i==null?void 0:i.visible)===!1||n.playCategoryId&&t.playCategoryId!==n.playCategoryId||n.playCategoryTags&&n.playCategoryTags.length>0&&!((u=i==null?void 0:i.tags)!=null&&u.some(h=>{var x;return(x=n.playCategoryTags)==null?void 0:x.includes(h)}))||n.playDetailId&&t.id!==n.playDetailId||n.playDetailTags&&n.playDetailTags.length>0&&!((o=t.tags)!=null&&o.some(h=>{var x;return(x=n.playDetailTags)==null?void 0:x.includes(h)}))||n.pointType&&t.pointType!==n.pointType||n.pointUnitType&&t.pointUnitType!==n.pointUnitType)}),[v,b]),oe=r.useCallback((n,t,i)=>{let u=0;return Oe(i).forEach(h=>{var x,K;u+=((K=(x=ne[n])==null?void 0:x[t])==null?void 0:K[h.id])||0}),i.method==="試合平均"?u=Ye?u/Ye:0:i.method==="セット平均"&&(u=Je?u/Je:0),u},[ne,Ye,Je,Oe]),Tn=n=>{const t=Oe(n);return t.length>0&&t.every(i=>i.pointUnitType==="チーム")},Cn=n=>{var u,o;const t=[];n.playCategoryId?t.push(((u=b.find(h=>h.id===n.playCategoryId))==null?void 0:u.name)||""):n.playCategoryTags&&n.playCategoryTags.length>0&&t.push(n.playCategoryTags.join(",")),n.playDetailId?t.push(((o=v.find(h=>h.id===n.playDetailId))==null?void 0:o.name)||""):n.playDetailTags&&n.playDetailTags.length>0&&t.push(n.playDetailTags.join(","));const i=[n.pointType,n.pointUnitType].filter(Boolean).join(",");return i&&t.push(i),t.length>0?`${t.join(" / ")} (${n.method})`:`(${n.method})`},In=r.useMemo(()=>vn.flatMap(n=>(m[n]||[]).filter(t=>t.visible!==!1).map(t=>({teamId:n,member:t}))),[vn,m]),Xn=r.useMemo(()=>{const n=[],t=l.left==="ALL"?"全チーム":nn(l.left);n.push(`分析対象チーム：${t}`),l.left!=="ALL"&&l.right&&l.right!==""&&n.push(`対戦相手チーム：${nn(l.right)}`),l.dateFrom&&l.dateTo?n.push(`試合日付：${l.dateFrom}〜${l.dateTo}`):l.dateFrom?n.push(`試合日付：${l.dateFrom}以降`):l.dateTo&&n.push(`試合日付：${l.dateTo}以前`),l.name&&n.push(`試合名：${l.name}`),l.matchResult==="win"?n.push("勝ち試合"):l.matchResult==="lose"&&n.push("負け試合"),l.setResult==="win"?n.push("勝ちセット"):l.setResult==="lose"&&n.push("負けセット");const i=n.join("、");return l.tags.length>0?e.jsxs(e.Fragment,{children:[i,"、タグ：",l.tags.map(u=>{const o=P.find(x=>x.id===u),h=(o==null?void 0:o.color)||de;return e.jsx(ce,{label:(o==null?void 0:o.name)||u,size:"small",sx:{ml:.5,backgroundColor:h,color:"#fff"}},u)})]}):i},[l,P,nn]),ze=r.useMemo(()=>{const n=new Map;return p.forEach(t=>{t.items.forEach(i=>{Oe(i).length>0&&n.set(i.id,i)})}),n},[p,Oe]),se=r.useMemo(()=>q?q.items.filter(n=>ze.has(n.id)):[],[q,ze]),Qn=r.useMemo(()=>{const n=[...In];return n.sort((t,i)=>{var h,x,K,E;let u="",o="";if(D==="member")u=t.member.name,o=i.member.name;else if(ze.has(D)){const F=ze.get(D);u=oe(t.teamId,t.member.id,F),o=oe(i.teamId,i.member.id,F)}else u=((x=(h=ne[t.teamId])==null?void 0:h[t.member.id])==null?void 0:x[D])||0,o=((E=(K=ne[i.teamId])==null?void 0:K[i.member.id])==null?void 0:E[D])||0;return u<o?O==="asc"?-1:1:u>o?O==="asc"?1:-1:0}),n},[In,D,O,ne,ze,oe]),te=r.useMemo(()=>{var u;if(W==="ALL")return null;if(Q&&q){const o={};return se.forEach(x=>{o[x.id]=0}),(m[W]||[]).filter(x=>x.visible!==!1).forEach(x=>{se.forEach(K=>{o[K.id]+=oe(W,x.id,K)})}),se.forEach(x=>{o[x.id]+=oe(W,Ce,x)}),o}const n={};(m[W]||[]).filter(o=>o.visible!==!1).forEach(o=>{var x;const h=((x=ne[W])==null?void 0:x[o.id])||{};Object.entries(h).forEach(([K,E])=>{n[K]=(n[K]||0)+E})});const i=((u=ne[W])==null?void 0:u[Ce])||{};return Object.entries(i).forEach(([o,h])=>{n[o]=(n[o]||0)+h}),n},[W,m,ne,Q,q,se,oe]),sn=n=>{D===n?ue(O==="asc"?"desc":"asc"):(De(n),ue("asc"))},Dn=(n,t,i)=>{var u;if(Q&&q){let o=[];t===Ce&&n===W&&te?o=se.map(h=>({label:Cn(h),value:te[h.id]||0})):o=se.map(h=>({label:Cn(h),value:oe(n,t,h)})),We(i),ge(q.name),ke(o),xe(!0)}else if(Pe){let o={};t===Ce&&n===W&&te?o=te:o=((u=ne[n])==null?void 0:u[t])||{};const h=Me.map(x=>({label:x.name,value:o[x.id]||0}));We(i),ge(Pe.name),ke(h),xe(!0)}},Yn=e.jsxs(Rs,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},sx:{display:"flex",flexDirection:"column",flexGrow:1},children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(g,{sx:{display:"flex",alignItems:"center",gap:1,flexGrow:1,minWidth:0,overflow:"hidden"},children:e.jsx(Mn,{component:"div",variant:"body2",noWrap:!0,sx:{overflow:"hidden",textOverflow:"ellipsis"},children:Xn})}),e.jsx(Xe,{size:"small",onClick:qn,disabled:Kn,children:e.jsx(Gn,{})})]}),Q&&e.jsxs(g,{sx:{display:"flex",alignItems:"center",mb:1,gap:1},children:[e.jsx(Mn,{sx:{flexGrow:1,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:q==null?void 0:q.name}),e.jsx(ae,{variant:"contained",size:"medium",onClick:()=>{fe(Ze),pe(!0)},startIcon:e.jsx(gs,{}),children:"編集"}),e.jsx(ae,{variant:"contained",size:"medium",color:"error",onClick:()=>Se(!0),startIcon:e.jsx(rn,{}),children:"削除"})]}),e.jsx($n,{component:Un,storageKey:"analysis-list",sx:{flexGrow:1},children:e.jsxs(Wn,{size:"small",sx:{"& th, & td":{textAlign:"center",verticalAlign:"middle"},"& .MuiTableRow-root":{height:50}},children:[e.jsx(Bn,{children:e.jsxs($e,{sx:{backgroundColor:n=>n.palette.mode==="dark"?"#343A42":"#f5f5f5"},children:[e.jsx(I,{align:"center",sortDirection:D==="member"?O:!1,children:e.jsx(ln,{active:D==="member",direction:D==="member"?O:"asc",onClick:()=>sn("member"),children:"メンバー"})}),Q&&q?se.map(n=>{var h,x,K;const t=n.playCategoryId&&((h=b.find(E=>E.id===n.playCategoryId))==null?void 0:h.name)||"",i=n.playDetailId&&((x=v.find(E=>E.id===n.playDetailId))==null?void 0:x.name)||"",u=n.playDetailId?(K=v.find(E=>E.id===n.playDetailId))==null?void 0:K.pointType:void 0,o=[n.pointType,n.pointUnitType].filter(Boolean).join(",");return e.jsx(I,{align:"center",sortDirection:D===n.id?O:!1,children:e.jsx(ln,{active:D===n.id,direction:D===n.id?O:"asc",onClick:()=>sn(n.id),children:e.jsxs(g,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[n.playCategoryTags&&n.playCategoryTags.length>0?e.jsx(g,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center"},children:n.playCategoryTags.map(E=>{const F=d.find(an=>an.id===E),tn=(F==null?void 0:F.color)||de;return e.jsx(ce,{label:(F==null?void 0:F.name)||E,size:"small",sx:{mr:.5,mb:.5,backgroundColor:tn,color:"#fff"}},E)})}):t&&e.jsx("span",{children:t}),n.playDetailTags&&n.playDetailTags.length>0?e.jsx(g,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center"},children:n.playDetailTags.map(E=>{const F=w.find(an=>an.id===E),tn=(F==null?void 0:F.color)||de;return e.jsx(ce,{label:(F==null?void 0:F.name)||E,size:"small",sx:{mr:.5,mb:.5,backgroundColor:tn,color:"#fff"}},E)})}):i&&e.jsx(g,{component:"span",sx:{color:u==="得点"?j.scoreColor:u==="失点"?j.lossColor:void 0},children:i}),o&&e.jsx("span",{children:o}),e.jsxs("span",{children:["(",n.method,")"]})]})})},n.id)}):Me.map(n=>e.jsx(I,{align:"center",sortDirection:D===n.id?O:!1,sx:{color:n.pointType==="得点"?j.scoreColor:n.pointType==="失点"?j.lossColor:"inherit"},children:e.jsx(ln,{active:D===n.id,direction:D===n.id?O:"asc",onClick:()=>sn(n.id),children:n.name})},n.id))]})}),e.jsxs(Hn,{children:[W!=="ALL"&&e.jsxs($e,{children:[e.jsx(I,{align:"center",children:e.jsx(Rn,{component:"button",underline:"hover",onClick:()=>Dn(W,Ce,"チーム集計"),children:"チーム集計"})}),Q&&q?se.map(n=>e.jsx(I,{align:"center",children:(te==null?void 0:te[n.id])||0},n.id)):Me.map(n=>e.jsx(I,{align:"center",children:(te==null?void 0:te[n.id])||0},n.id))]}),(Q&&q?se.some(n=>!Tn(n)):!Vn)&&Qn.map(({teamId:n,member:t})=>e.jsxs($e,{children:[e.jsx(I,{align:"center",children:e.jsx(Rn,{component:"button",underline:"hover",onClick:()=>Dn(n,t.id,t.name),children:t.name})}),Q&&q?se.map(i=>e.jsx(I,{align:"center",children:Tn(i)?"－":oe(n,t.id,i)},i.id)):Me.map(i=>{var u,o;return e.jsx(I,{align:"center",children:i.pointUnitType==="チーム"?"－":((o=(u=ne[n])==null?void 0:u[t.id])==null?void 0:o[i.id])||0},i.id)})]},`${n}-${t.id}`))]})]})})]},H);return e.jsxs(g,{sx:{display:"flex",height:"100%"},children:[e.jsx(os,{variant:N?"permanent":"temporary",open:N?!0:X,onClose:()=>{ie(!1),me(!1)},PaperProps:{onTransitionEnd:Ne},ModalProps:{keepMounted:!0,BackdropProps:{sx:{backgroundColor:"rgba(0, 0, 0, 0.5)"}}},sx:{width:N?X?je:Ee:je,flexShrink:0,transition:z.transitions.create("width",{easing:z.transitions.easing.sharp,duration:z.transitions.duration.standard}),...N?{zIndex:z.zIndex.appBar-1}:{},"& .MuiDrawer-paper":{width:N?X?je:Ee:je,boxSizing:"border-box",overflowX:"hidden",transition:z.transitions.create("width",{easing:z.transitions.easing.sharp,duration:z.transitions.duration.standard}),...N?{top:z.mixins.toolbar.minHeight,height:`calc(100% - ${z.mixins.toolbar.minHeight}px)`,zIndex:z.zIndex.appBar-1}:{}}},children:e.jsx(ds,{children:en.map((n,t)=>e.jsxs(cs,{selected:t===H,onClick:()=>{t===en.length-1?(fe(null),pe(!0)):G(t),N||Le()},sx:{minHeight:48,justifyContent:X?"initial":"center",px:2.5},children:[e.jsx(us,{sx:{minWidth:0,mr:X?3:0,justifyContent:"center"},children:t===en.length-1?e.jsx(zn,{}):t>=le.length?e.jsx(Nn,{}):e.jsx(ts,{})}),e.jsx(ps,{primary:n.label,sx:{opacity:Ge?1:0,display:Ge?"block":"none",whiteSpace:"nowrap"}})]},n.key))})}),e.jsxs(g,{sx:{flexGrow:1,display:"flex",flexDirection:"column",width:N?`calc(100% - ${X?je:Ee}px)`:"100%",transition:N?z.transitions.create("width",{duration:z.transitions.duration.standard}):void 0},children:[e.jsx(ys,{mode:"wait",children:Yn}),e.jsxs(On,{open:Y,onClose:()=>ee(!1),children:[e.jsx(dn,{children:"詳細検索"}),e.jsxs(cn,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(Re,{container:!0,spacing:2,children:[e.jsx(Re,{item:!0,xs:12,md:6,children:e.jsxs(be,{fullWidth:!0,margin:"dense",children:[e.jsx(ve,{id:"dlg-left",children:"分析チーム"}),e.jsx(Te,{labelId:"dlg-left",value:ye,label:"分析チーム",onChange:n=>{const t=n.target.value;Ae(t)},children:f.map(n=>e.jsx(U,{value:n.id,children:n.name},n.id))})]})}),e.jsx(Re,{item:!0,xs:12,md:6,children:e.jsxs(be,{fullWidth:!0,margin:"dense",children:[e.jsx(ve,{id:"dlg-right",children:"対戦相手"}),e.jsxs(Te,{labelId:"dlg-right",value:_e,label:"対戦相手",onChange:n=>qe(n.target.value),children:[e.jsx(U,{value:"",children:"指定なし"}),f.map(n=>e.jsx(U,{value:n.id,children:n.name},n.id))]})]})}),e.jsx(Re,{item:!0,xs:12,md:3,children:e.jsx(Ie,{type:"date",label:"From",margin:"dense",value:s,onChange:n=>{const t=n.target.value;a(t),c&&t&&c<t&&y(t)},InputLabelProps:{shrink:!0},fullWidth:!0,inputProps:{max:c||void 0},sx:{"& .MuiOutlinedInput-root":{height:56},"& .MuiOutlinedInput-input":{padding:"0 14px",height:"100%",lineHeight:"56px",fontSize:"1rem",textAlign:"left"},'& input[type="date"]':{WebkitAppearance:"none"}}})}),e.jsx(Re,{item:!0,xs:12,md:3,children:e.jsx(Ie,{type:"date",label:"To",margin:"dense",value:c,onChange:n=>y(n.target.value),InputLabelProps:{shrink:!0},fullWidth:!0,inputProps:{min:s||void 0},sx:{"& .MuiOutlinedInput-root":{height:56},"& .MuiOutlinedInput-input":{padding:"0 14px",height:"100%",lineHeight:"56px",fontSize:"1rem",textAlign:"left"},'& input[type="date"]':{WebkitAppearance:"none"}}})}),e.jsx(Re,{item:!0,xs:12,md:6,children:e.jsx(Ie,{label:"試合名",margin:"dense",value:T,onChange:n=>S(n.target.value),fullWidth:!0})})]}),e.jsxs(g,{sx:{display:"flex",gap:2,flexDirection:"column"},children:[e.jsxs(En,{exclusive:!0,value:_,onChange:(n,t)=>M(t),fullWidth:!0,sx:{width:"100%"},children:[e.jsx(Ve,{value:"win",sx:{whiteSpace:"nowrap"},children:"勝ち試合"}),e.jsx(Ve,{value:"lose",sx:{whiteSpace:"nowrap"},children:"負け試合"})]}),e.jsxs(En,{exclusive:!0,value:R,onChange:(n,t)=>$(t),fullWidth:!0,sx:{width:"100%"},children:[e.jsx(Ve,{value:"win",sx:{whiteSpace:"nowrap"},children:"勝ちセット"}),e.jsx(Ve,{value:"lose",sx:{whiteSpace:"nowrap"},children:"負けセット"})]})]}),e.jsx(g,{sx:{display:"flex",gap:2},children:e.jsx(un,{multiple:!0,options:P,getOptionLabel:n=>n.name,value:P.filter(n=>Z.includes(n.id)),onChange:(n,t)=>yn(t.map(i=>i.id)),renderTags:(n,t)=>n.map((i,u)=>{const{key:o,...h}=t({index:u});return e.jsx(ce,{...h,label:i.name,size:"small",sx:{backgroundColor:i.color||de,color:"#fff"}},o)}),renderInput:n=>e.jsx(Ie,{...n,label:"タグ",margin:"dense"}),fullWidth:!0})})]}),e.jsxs(pn,{children:[e.jsx(ae,{onClick:()=>ee(!1),color:"inherit",startIcon:e.jsx(on,{}),children:"キャンセル"}),e.jsx(ae,{onClick:()=>{we({left:ye,right:_e,dateFrom:s,dateTo:c,name:T,tags:Z,matchResult:_||void 0,setResult:R||void 0}),ee(!1)},startIcon:e.jsx(hn,{}),children:"検索"})]})]}),e.jsxs(hs,{open:Qe,onClose:()=>Se(!1),children:[e.jsx(dn,{children:"削除確認"}),e.jsx(cn,{sx:{mt:2},children:"このカスタム分析を削除しますか？"}),e.jsxs(pn,{children:[e.jsx(ae,{onClick:()=>Se(!1),color:"inherit",startIcon:e.jsx(on,{}),children:"キャンセル"}),e.jsx(ae,{onClick:()=>{const n=Ze,t=p[n];k(p.filter((i,u)=>u!==n)),G(0),Se(!1),J("カスタム分析を削除しました","success",{actionLabel:"元に戻す",onAction:()=>{k(i=>{const u=[...i];return u.splice(n,0,t),u}),G(le.length+n)},autoHideDuration:5e3})},color:"error",startIcon:e.jsx(Fn,{}),children:"OK"})]})]}),e.jsx(bs,{open:re,playCategories:b,playDetails:v,rallyCategoryTags:d,rallyDetailTags:w,initialData:he!==null?p[he]:void 0,onCancel:()=>pe(!1),onSave:n=>{he!==null?(k(p.map((t,i)=>i===he?n:t)),G(le.length+he)):(k([...p,n]),G(le.length+p.length)),pe(!1)}}),e.jsx(r.Suspense,{fallback:null,children:e.jsx(Ms,{open:Fe,onClose:()=>xe(!1),memberName:Ue,tabName:He,data:Be})})]})]})}export{Hs as default};
