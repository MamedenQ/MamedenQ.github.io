import{i as Ae,j as e,E as it,G as rt,d as Xe,e as Ue,B as s,F as _e,K as Re,S as ze,M as ce,H as lt,r as xe,J as vs,I as De,L as Js,N as ps,a as Mt,O as Cs,n as Wt,Q as Pt,R as Le,Z as Ee,y as Fe,U as Qe,V as Ns,f as et,g as Ct,h as St,k as qe,l as $,m as Tt,C as Ye,W as qt,X as Se,A as Ss,Y as wt,_ as Gs,b as fs,$ as Xs,a0 as ft,a1 as gt,a2 as Ys,a3 as Qs,a4 as Zs,a5 as Ut,D as Vt}from"./mui-vendor-C85vPdgr.js";import{r as o,f as en,u as tn}from"./react-vendor-QLNaZ7XN.js";import{r as Ie,u as dt,R as At,d as tt,a as Je,A as Ts,B as zt,b as ws,S as As,c as Lt,e as Gt,f as xt,g as Ve,h as st,i as Ft,j as We,D as ut,k as Ke}from"./index-b7DHn1oB.js";import{t as Ze,P as gs,d as sn,a as nn}from"./PlayDetailChip-gOxUN-j2.js";import{d as js}from"./SpaceDashboardOutlined-Bq6YjCz7.js";import{D as It,C as at,P as ot,d as Ot,u as Ht,a as Kt}from"./useLongPress-BEVNQkt3.js";import{m as rn,A as ln}from"./motion-vendor-CXcnLVtk.js";import"./chart-vendor-DVL1rbVz.js";var Xt={},an=Ae;Object.defineProperty(Xt,"__esModule",{value:!0});var Is=Xt.default=void 0,on=an(Ie()),dn=e;Is=Xt.default=(0,on.default)((0,dn.jsx)("path",{d:"M12 5.9c1.16 0 2.1.94 2.1 2.1s-.94 2.1-2.1 2.1S9.9 9.16 9.9 8s.94-2.1 2.1-2.1m0 9c2.97 0 6.1 1.46 6.1 2.1v1.1H5.9V17c0-.64 3.13-2.1 6.1-2.1M12 4C9.79 4 8 5.79 8 8s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4m0 9c-2.67 0-8 1.34-8 4v3h16v-3c0-2.66-5.33-4-8-4"}),"PersonOutlineOutlined");var Yt={},cn=Ae;Object.defineProperty(Yt,"__esModule",{value:!0});var Ms=Yt.default=void 0,un=cn(Ie()),xn=e;Ms=Yt.default=(0,un.default)((0,xn.jsx)("path",{d:"M2 17h2v.5H3v1h1v.5H2v1h3v-4H2zm1-9h1V4H2v1h1zm-1 3h1.8L2 13.1v.9h3v-1H3.2L5 10.9V10H2zm5-6v2h14V5zm0 14h14v-2H7zm0-6h14v-2H7z"}),"FormatListNumberedOutlined");var Qt={},hn=Ae;Object.defineProperty(Qt,"__esModule",{value:!0});var Ds=Qt.default=void 0,mn=hn(Ie()),pn=e;Ds=Qt.default=(0,mn.default)((0,pn.jsx)("path",{d:"M9 13.75c-2.34 0-7 1.17-7 3.5V19h14v-1.75c0-2.33-4.66-3.5-7-3.5M4.34 17c.84-.58 2.87-1.25 4.66-1.25s3.82.67 4.66 1.25zM9 12c1.93 0 3.5-1.57 3.5-3.5S10.93 5 9 5 5.5 6.57 5.5 8.5 7.07 12 9 12m0-5c.83 0 1.5.67 1.5 1.5S9.83 10 9 10s-1.5-.67-1.5-1.5S8.17 7 9 7m7.04 6.81c1.16.84 1.96 1.96 1.96 3.44V19h4v-1.75c0-2.02-3.5-3.17-5.96-3.44M15 12c1.93 0 3.5-1.57 3.5-3.5S16.93 5 15 5c-.54 0-1.04.13-1.5.35.63.89 1 1.98 1 3.15s-.37 2.26-1 3.15c.46.22.96.35 1.5.35"}),"GroupOutlined");var Zt={},fn=Ae;Object.defineProperty(Zt,"__esModule",{value:!0});var Bs=Zt.default=void 0,gn=fn(Ie()),jn=e;Bs=Zt.default=(0,gn.default)((0,jn.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V5h14zm-7-2h2V7h-4v2h2z"}),"LooksOneOutlined");var es={},bn=Ae;Object.defineProperty(es,"__esModule",{value:!0});var $s=es.default=void 0,yn=bn(Ie()),vn=e;$s=es.default=(0,yn.default)((0,vn.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V5h14zm-4-4h-4v-2h2c1.1 0 2-.89 2-2V9c0-1.11-.9-2-2-2H9v2h4v2h-2c-1.1 0-2 .89-2 2v4h6z"}),"LooksTwoOutlined");var ts={},Cn=Ae;Object.defineProperty(ts,"__esModule",{value:!0});var Ps=ts.default=void 0,Sn=Cn(Ie()),Tn=e;Ps=ts.default=(0,Sn.default)((0,Tn.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V5h14zm-4-4v-1.5c0-.83-.67-1.5-1.5-1.5.83 0 1.5-.67 1.5-1.5V9c0-1.11-.9-2-2-2H9v2h4v2h-2v2h2v2H9v2h4c1.1 0 2-.89 2-2"}),"Looks3Outlined");var ss={},wn=Ae;Object.defineProperty(ss,"__esModule",{value:!0});var ks=ss.default=void 0,An=wn(Ie()),In=e;ks=ss.default=(0,An.default)((0,In.jsx)("path",{d:"M19.04 3h-14c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16h-14V5h14zm-6-2h2V7h-2v4h-2V7h-2v6h4z"}),"Looks4Outlined");var ns={},Mn=Ae;Object.defineProperty(ns,"__esModule",{value:!0});var _s=ns.default=void 0,Dn=Mn(Ie()),Bn=e;_s=ns.default=(0,Dn.default)((0,Bn.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V5h14zm-4-4v-2c0-1.11-.9-2-2-2h-2V9h4V7H9v6h4v2H9v2h4c1.1 0 2-.89 2-2"}),"Looks5Outlined");var is={},$n=Ae;Object.defineProperty(is,"__esModule",{value:!0});var kt=is.default=void 0,Pn=$n(Ie()),kn=e;kt=is.default=(0,Pn.default)((0,kn.jsx)("path",{d:"M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8"}),"UndoOutlined");var rs={},_n=Ae;Object.defineProperty(rs,"__esModule",{value:!0});var _t=rs.default=void 0,Rn=_n(Ie()),zn=e;_t=rs.default=(0,Rn.default)((0,zn.jsx)("path",{d:"M18.4 10.6C16.55 8.99 14.15 8 11.5 8c-4.65 0-8.58 3.03-9.96 7.22L3.9 16c1.05-3.19 4.05-5.5 7.6-5.5 1.95 0 3.73.72 5.12 1.88L13 16h9V7z"}),"RedoOutlined");var ls={},Fn=Ae;Object.defineProperty(ls,"__esModule",{value:!0});var Rs=ls.default=void 0,On=Fn(Ie()),Hn=e;Rs=ls.default=(0,On.default)((0,Hn.jsx)("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreVert");function Ln(t,b,h){const v=o.useCallback(i=>{let M=0,y=0;i.rallies.forEach(p=>{if(p.timeoutTeam||p.substitutionTeam)return;const A=b.find(R=>R.id===p.teamAPlayDetail),L=b.find(R=>R.id===p.teamBPlayDetail);(A==null?void 0:A.pointType)==="得点"||(L==null?void 0:L.pointType)==="失点"?M+=1:((L==null?void 0:L.pointType)==="得点"||(A==null?void 0:A.pointType)==="失点")&&(y+=1)}),i.my=M,i.opponent=y},[b]),u=o.useCallback(i=>{const M=[...t.rallies,i],y={...t,rallies:M};v(y),h(y)},[t,v,h]),r=o.useCallback(i=>{const M=t.rallies.filter((p,A)=>A!==i),y={...t,rallies:M};v(y),h(y)},[t,v,h]);return{addRally:u,deleteRally:r,calculateScores:v}}const En=o.forwardRef(function({setScore:b,playDetails:h,playCategories:v,teamAMembers:u,teamBMembers:r,teamAName:i,teamBName:M,scoreInputSetting:y,themeSetting:p,locked:A=!1,onAdd:L,onEdit:R},B){var E,F,_,me,fe,he,C,D;const O=dt("sm"),[X,U]=o.useState(!1),[ee,te]=o.useState("teamA"),[T,le]=o.useState(""),[ne,ae]=o.useState(""),[j,se]=o.useState(""),[N,pe]=o.useState(""),[m,I]=o.useState(""),[K,Y]=o.useState(""),[z,Q]=o.useState(""),[Z,oe]=o.useState(""),[ye,we]=o.useState(null),c=o.useRef(!1),[S,P]=o.useState(!1),V=o.useMemo(()=>{const n=y.playCombinationSetting;return n.enabled?new Set(n.pairs.filter(x=>x.enabled).map(x=>x.sourceDetailId)):new Set},[y.playCombinationSetting]),H=()=>{if(A)return;we(null);const n=[...b.rallies].reverse().find(G=>!G.timeoutTeam&&!G.substitutionTeam);let x="teamA";if(n){const G=h.find(g=>g.id===n.teamAPlayDetail),f=h.find(g=>g.id===n.teamBPlayDetail);(G==null?void 0:G.pointType)==="得点"||(f==null?void 0:f.pointType)==="失点"?x="teamA":((f==null?void 0:f.pointType)==="得点"||(G==null?void 0:G.pointType)==="失点")&&(x="teamB")}te(x),le(""),ae(""),se(""),pe(""),I(""),Y(""),Q(""),oe(""),U(!0)},Me=n=>{var G,f;if(A)return;const x=b.rallies[n];we(n),te(x.serverTeam||"teamA"),le(x.server&&(x.serverTeam==="teamA"?u.some(g=>g.id===x.server):r.some(g=>g.id===x.server))?x.server:""),ae(((G=h.find(g=>g.id===x.teamAPlayDetail))==null?void 0:G.playCategoryId)||""),pe(x.teamAPlayDetail||""),Y(u.some(g=>g.id===x.teamAMember)&&x.teamAMember||""),se(((f=h.find(g=>g.id===x.teamBPlayDetail))==null?void 0:f.playCategoryId)||""),I(x.teamBPlayDetail||""),Q(r.some(g=>g.id===x.teamBMember)&&x.teamBMember||""),oe(x.timeoutTeam||""),U(!0)};o.useImperativeHandle(B,()=>({openAddDialog:H,openEditDialog:Me})),o.useEffect(()=>{if(c.current){c.current=!1;return}const n=y.playCombinationSetting;if(!n.enabled)return;const x=n.pairs.find(G=>G.enabled&&G.sourceDetailId===N);if(x&&!m){const G=h.find(f=>f.id===x.targetDetailId);G&&(c.current=!0,se(G.playCategoryId),I(x.targetDetailId),P(!0))}},[N]),o.useEffect(()=>{if(c.current){c.current=!1;return}const n=y.playCombinationSetting;if(!n.enabled)return;const x=n.pairs.find(G=>G.enabled&&G.sourceDetailId===m);if(x&&!N){const G=h.find(f=>f.id===x.targetDetailId);G&&(c.current=!0,ae(G.playCategoryId),pe(x.targetDetailId),P(!0))}},[m]);const a=()=>{var g,W;if(Z)return!0;if(y.rallyMemberRequired&&!T||ne&&!N||j&&!m||!!!(ne&&N)&&!!!(j&&m))return!1;const G=(g=h.find(ie=>ie.id===N))==null?void 0:g.pointUnitType;if(y.rallyMemberRequired&&N&&G==="メンバー"&&!K)return!1;const f=(W=h.find(ie=>ie.id===m))==null?void 0:W.pointUnitType;return!(y.rallyMemberRequired&&m&&f==="メンバー"&&!z)},l=n=>Z?{id:n??crypto.randomUUID(),timeoutTeam:Z}:{id:n??crypto.randomUUID(),serverTeam:ee,server:T||void 0,teamAPlayDetail:N||void 0,teamAMember:K||void 0,teamBPlayDetail:m||void 0,teamBMember:z||void 0},w=()=>{if(ye===null)L(l());else{const n=b.rallies[ye].id;R(ye,l(n))}U(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs(At,{open:X,onClose:()=>U(!1),children:[e.jsx(it,{children:ye===null?"ラリー追加":"ラリー編集"}),e.jsxs(rt,{sx:{display:"flex",flexDirection:"column"},children:[e.jsxs(Xe,{exclusive:!0,value:ee,onChange:(n,x)=>x&&te(x),fullWidth:!0,disabled:!!Z,sx:{mb:1},children:[e.jsx(Ue,{value:"teamA",sx:{flex:1},children:e.jsx(s,{sx:{whiteSpace:"pre-line",textAlign:"center"},children:`${i||"チームA"}
サーブ`})}),e.jsx(Ue,{value:"teamB",sx:{flex:1},children:e.jsx(s,{sx:{whiteSpace:"pre-line",textAlign:"center"},children:`${M||"チームB"}
サーブ`})})]}),e.jsxs(_e,{fullWidth:!0,margin:"dense",required:y.rallyMemberRequired,disabled:!!Z,children:[e.jsx(Re,{id:"server",children:"サーバー"}),e.jsx(ze,{labelId:"server",value:T,label:"サーバー",onChange:n=>le(n.target.value),children:(ee==="teamA"?u:r).map(n=>e.jsx(ce,{value:n.id,children:n.name},n.id))})]}),O?e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(s,{sx:{flex:1,display:"flex",flexDirection:"column",gap:1},children:[e.jsxs(s,{sx:{display:"flex",gap:1,mt:2},children:[e.jsx(Xe,{sx:{flex:1},orientation:"vertical",exclusive:!0,value:ne,onChange:(n,x)=>{ne===x||x===null?(ae(""),pe("")):(ae(x),pe(""))},disabled:!!Z,children:v.filter(n=>n.visible!==!1).map(n=>e.jsx(Ue,{value:n.id,sx:{whiteSpace:"nowrap"},children:n.name},n.id))}),e.jsx(Xe,{sx:{flex:1},orientation:"vertical",exclusive:!0,value:N,onChange:(n,x)=>{pe(N===x||x===null?"":x)},disabled:!!Z,children:h.filter(n=>n.playCategoryId===ne&&n.visible!==!1).map(n=>{const x=n.pointType==="得点"?p.scoreColor:p.lossColor;return e.jsx(Ue,{value:n.id,sx:{whiteSpace:"nowrap",color:x,"&.Mui-selected":{color:x}},children:V.has(n.id)?`${n.name}*`:n.name},n.id)})})]}),e.jsxs(_e,{fullWidth:!0,margin:"dense",required:y.rallyMemberRequired&&((E=h.find(n=>n.id===N))==null?void 0:E.pointUnitType)==="メンバー",disabled:!!Z,children:[e.jsx(Re,{id:"amem",children:`${i||"チームA"}メンバー`}),e.jsxs(ze,{labelId:"amem",value:K,label:`${i||"チームA"}メンバー`,onChange:n=>Y(n.target.value),disabled:((F=h.find(n=>n.id===N))==null?void 0:F.pointUnitType)!=="メンバー",children:[e.jsx(ce,{value:"",children:e.jsx("em",{children:"なし"})}),u.map(n=>e.jsx(ce,{value:n.id,children:n.name},n.id))]})]})]}),e.jsxs(s,{sx:{flex:1,display:"flex",flexDirection:"column",gap:1},children:[e.jsxs(s,{sx:{display:"flex",gap:1,mt:2},children:[e.jsx(Xe,{sx:{flex:1},orientation:"vertical",exclusive:!0,value:j,onChange:(n,x)=>{j===x||x===null?(se(""),I("")):(se(x),I(""))},disabled:!!Z,children:v.filter(n=>n.visible!==!1).map(n=>e.jsx(Ue,{value:n.id,sx:{whiteSpace:"nowrap"},children:n.name},n.id))}),e.jsx(Xe,{sx:{flex:1},orientation:"vertical",exclusive:!0,value:m,onChange:(n,x)=>{I(m===x||x===null?"":x)},disabled:!!Z,children:h.filter(n=>n.playCategoryId===j&&n.visible!==!1).map(n=>{const x=n.pointType==="得点"?p.scoreColor:p.lossColor;return e.jsx(Ue,{value:n.id,sx:{whiteSpace:"nowrap",color:x,"&.Mui-selected":{color:x}},children:V.has(n.id)?`${n.name}*`:n.name},n.id)})})]}),e.jsxs(_e,{fullWidth:!0,margin:"dense",required:y.rallyMemberRequired&&((_=h.find(n=>n.id===m))==null?void 0:_.pointUnitType)==="メンバー",disabled:!!Z,children:[e.jsx(Re,{id:"bmem",children:`${M||"チームB"}メンバー`}),e.jsxs(ze,{labelId:"bmem",value:z,label:`${M||"チームB"}メンバー`,onChange:n=>Q(n.target.value),disabled:((me=h.find(n=>n.id===m))==null?void 0:me.pointUnitType)!=="メンバー",children:[e.jsx(ce,{value:"",children:e.jsx("em",{children:"なし"})}),r.map(n=>e.jsx(ce,{value:n.id,children:n.name},n.id))]})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(s,{sx:{display:"flex",gap:2,mt:1},children:[e.jsx(Xe,{orientation:"vertical",exclusive:!0,value:ne,onChange:(n,x)=>{ne===x||x===null?(ae(""),pe("")):(ae(x),pe(""))},disabled:!!Z,sx:{flex:"1 1 25%"},children:v.filter(n=>n.visible!==!1).map(n=>e.jsx(Ue,{value:n.id,sx:{whiteSpace:"nowrap"},children:n.name},n.id))}),e.jsx(Xe,{orientation:"vertical",exclusive:!0,value:N,onChange:(n,x)=>{pe(N===x||x===null?"":x)},disabled:!!Z,sx:{flex:"1 1 25%"},children:h.filter(n=>n.playCategoryId===ne&&n.visible!==!1).map(n=>{const x=n.pointType==="得点"?p.scoreColor:p.lossColor;return e.jsx(Ue,{value:n.id,sx:{whiteSpace:"nowrap",color:x,"&.Mui-selected":{color:x}},children:V.has(n.id)?`${n.name}*`:n.name},n.id)})}),e.jsx(Xe,{orientation:"vertical",exclusive:!0,value:j,onChange:(n,x)=>{j===x||x===null?(se(""),I("")):(se(x),I(""))},disabled:!!Z,sx:{flex:"1 1 25%"},children:v.filter(n=>n.visible!==!1).map(n=>e.jsx(Ue,{value:n.id,sx:{whiteSpace:"nowrap"},children:n.name},n.id))}),e.jsx(Xe,{orientation:"vertical",exclusive:!0,value:m,onChange:(n,x)=>{I(m===x||x===null?"":x)},disabled:!!Z,sx:{flex:"1 1 25%"},children:h.filter(n=>n.playCategoryId===j&&n.visible!==!1).map(n=>{const x=n.pointType==="得点"?p.scoreColor:p.lossColor;return e.jsx(Ue,{value:n.id,sx:{whiteSpace:"nowrap",color:x,"&.Mui-selected":{color:x}},children:V.has(n.id)?`${n.name}*`:n.name},n.id)})})]}),e.jsxs(s,{sx:{display:"flex",gap:2,mt:1},children:[e.jsxs(_e,{fullWidth:!0,margin:"dense",required:y.rallyMemberRequired&&((fe=h.find(n=>n.id===N))==null?void 0:fe.pointUnitType)==="メンバー",disabled:!!Z,sx:{flex:1},children:[e.jsx(Re,{id:"amem",children:`${i||"チームA"}メンバー`}),e.jsxs(ze,{labelId:"amem",value:K,label:`${i||"チームA"}メンバー`,onChange:n=>Y(n.target.value),disabled:((he=h.find(n=>n.id===N))==null?void 0:he.pointUnitType)!=="メンバー",children:[e.jsx(ce,{value:"",children:e.jsx("em",{children:"なし"})}),u.map(n=>e.jsx(ce,{value:n.id,children:n.name},n.id))]})]}),e.jsxs(_e,{fullWidth:!0,margin:"dense",required:y.rallyMemberRequired&&((C=h.find(n=>n.id===m))==null?void 0:C.pointUnitType)==="メンバー",disabled:!!Z,sx:{flex:1},children:[e.jsx(Re,{id:"bmem",children:`${M||"チームB"}メンバー`}),e.jsxs(ze,{labelId:"bmem",value:z,label:`${M||"チームB"}メンバー`,onChange:n=>Q(n.target.value),disabled:((D=h.find(n=>n.id===m))==null?void 0:D.pointUnitType)!=="メンバー",children:[e.jsx(ce,{value:"",children:e.jsx("em",{children:"なし"})}),r.map(n=>e.jsx(ce,{value:n.id,children:n.name},n.id))]})]})]})]})]}),e.jsxs(lt,{children:[e.jsx(xe,{onClick:()=>U(!1),color:"inherit",startIcon:e.jsx(tt,{}),children:"キャンセル"}),e.jsx(xe,{onClick:w,disabled:!a(),startIcon:e.jsx(Je,{}),children:"OK"})]})]}),e.jsx(Ts,{open:S,message:"相手側のプレーを自動反映しました",onClose:()=>P(!1)})]})});var as={},Wn=Ae;Object.defineProperty(as,"__esModule",{value:!0});var zs=as.default=void 0,Un=Wn(Ie()),Vn=e;zs=as.default=(0,Un.default)((0,Vn.jsx)("path",{d:"M16 17.01V10h-2v7.01h-3L15 21l4-3.99zM9 3 5 6.99h3V14h2V6.99h3zm7 14.01V10h-2v7.01h-3L15 21l4-3.99zM9 3 5 6.99h3V14h2V6.99h3z"}),"SwapVertOutlined");const qn=o.forwardRef(function({teamAMembers:b,teamBMembers:h,onSave:v},u){const[r,i]=o.useState(!1),[M,y]=o.useState("teamA"),[p,A]=o.useState(""),[L,R]=o.useState(""),[B,O]=o.useState(null),X=T=>{y(T),A(""),R(""),O(null),i(!0)},U=(T,le,ne,ae)=>{y(le),A(ne),R(ae),O(T),i(!0)};o.useImperativeHandle(u,()=>({openAddDialog:X,openEditDialog:U}));const ee=()=>{i(!1),O(null)},te=()=>{v(M,p,L,B),i(!1),O(null)};return e.jsxs(At,{open:r,onClose:ee,children:[e.jsx(it,{children:"選手交代"}),e.jsx(rt,{children:e.jsxs(s,{component:"form",sx:{mt:2},children:[e.jsxs(_e,{fullWidth:!0,sx:{mb:2},children:[e.jsx(Re,{id:"out-member",children:"OUT"}),e.jsx(ze,{labelId:"out-member",value:p,label:"OUT",onChange:T=>A(T.target.value),children:(M==="teamA"?b:h).map(T=>e.jsx(ce,{value:T.id,children:`${T.no}:${T.name}`},T.id))})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mb:2},children:e.jsx(zs,{sx:{width:32,height:32}})}),e.jsxs(_e,{fullWidth:!0,children:[e.jsx(Re,{id:"in-member",children:"IN"}),e.jsx(ze,{labelId:"in-member",value:L,label:"IN",onChange:T=>R(T.target.value),children:(M==="teamA"?b:h).map(T=>e.jsx(ce,{value:T.id,children:`${T.no}:${T.name}`},T.id))})]})]})}),e.jsxs(lt,{children:[e.jsx(xe,{onClick:ee,color:"inherit",startIcon:e.jsx(tt,{}),children:"キャンセル"}),e.jsx(xe,{onClick:te,disabled:!p||!L,startIcon:e.jsx(Je,{}),children:"OK"})]})]})});function Kn({open:t,onClose:b,scores:h,consecutive:v,connections:u,rowHeight:r}){const i=h.length*r,M=()=>{ws(),b()};return e.jsx(vs,{anchor:"bottom",open:t,onClose:M,onOpen:()=>{},disableSwipeToOpen:!0,sx:{zIndex:y=>y.zIndex.drawer+3},ModalProps:{disableEnforceFocus:!0},PaperProps:{sx:{height:"60vh",borderTopLeftRadius:zt,borderTopRightRadius:zt}},children:e.jsxs(s,{sx:{position:"relative",height:"100%"},children:[e.jsx(s,{sx:{width:40,height:4,bgcolor:"text.secondary",borderRadius:2,position:"absolute",top:8,left:"50%",transform:"translateX(-50%)"}}),e.jsx(De,{onClick:M,sx:{position:"absolute",top:4,right:4},children:e.jsx(tt,{})}),e.jsx(s,{sx:{mt:4,height:"100%",overflowY:"auto"},children:e.jsxs(s,{sx:{flex:"0 0 100%",overflowY:"auto",height:"100%",position:"relative"},children:[h.map((y,p)=>{const A=p===0?{a:0,b:0}:h[p-1],L=y.a!==A.a&&y.a!==0,R=y.b!==A.b&&y.b!==0,B=L&&v[p],O=R&&v[p];return e.jsxs(s,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr 1fr",alignItems:"center",py:.5,height:`${r}px`,position:"relative",zIndex:1},children:[e.jsx(s,{}),e.jsxs(e.Fragment,{children:[e.jsx(s,{sx:{display:"flex",justifyContent:"center"},children:L?e.jsx(s,{sx:{width:32,height:32,border:"1px solid",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:24,borderColor:B?"red":"currentColor",backgroundColor:B?"#ffebee":"#fff",color:"black"},children:y.a}):null}),e.jsx(s,{}),e.jsx(s,{sx:{display:"flex",justifyContent:"center"},children:R?e.jsx(s,{sx:{width:32,height:32,border:"1px solid",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:24,borderColor:O?"red":"currentColor",backgroundColor:O?"#ffebee":"#fff",color:"black"},children:y.b}):null})]}),e.jsx(s,{})]},p)}),e.jsx("svg",{viewBox:`0 0 100 ${i}`,style:{position:"absolute",left:0,top:0,width:"100%",height:i,zIndex:0},preserveAspectRatio:"none",pointerEvents:"none",children:u.map(y=>{const p=y.index*r+r/2,A=(y.index+1)*r+r/2,L=y.from==="A"?30:70,R=y.from==="A"?70:30;return e.jsx("line",{x1:L,y1:p,x2:R,y2:A,stroke:"currentColor",strokeWidth:1},y.index)})})]})})]})})}var os={},Jn=Ae;Object.defineProperty(os,"__esModule",{value:!0});var Fs=os.default=void 0,Nn=Jn(Ie()),Gn=e;Fs=os.default=(0,Nn.default)((0,Gn.jsx)("path",{d:"M3 18h18v-2H3zm0-5h18v-2H3zm0-7v2h18V6z"}),"Menu");function Xn({open:t,onClose:b,teamAName:h,teamBName:v,disableTimeoutA:u,disableTimeoutB:r,showScoreProgressButton:i,onShowScoreProgress:M,onSubstitution:y,onTimeout:p,onAddRally:A,locked:L}){const R=()=>{ws(),b()},B=U=>()=>{U(),R()},X=dt("sm")?"vertical":"horizontal";return e.jsx(vs,{anchor:"bottom",open:t,onClose:R,onOpen:()=>{},sx:{zIndex:U=>U.zIndex.drawer+2},ModalProps:{disableEnforceFocus:!0},disableSwipeToOpen:L,PaperProps:{sx:{height:"auto",maxHeight:"80vh",borderTopLeftRadius:zt,borderTopRightRadius:zt}},children:e.jsx(s,{sx:{p:2},children:e.jsxs(Js,{spacing:2,children:[i&&e.jsx(xe,{fullWidth:!0,size:"large",variant:"outlined",onClick:B(M),children:"得点推移表示"}),e.jsxs(ps,{fullWidth:!0,orientation:X,children:[e.jsx(xe,{size:"large",onClick:B(()=>y("teamA")),children:(h||"チームA")+" メンバー交代"}),e.jsx(xe,{size:"large",onClick:B(()=>y("teamB")),children:(v||"チームB")+" メンバー交代"})]}),e.jsxs(ps,{fullWidth:!0,orientation:X,children:[e.jsx(xe,{disabled:u,size:"large",onClick:B(()=>p("teamA")),children:(h||"チームA")+" タイムアウト"}),e.jsx(xe,{disabled:r,size:"large",onClick:B(()=>p("teamB")),children:(v||"チームB")+" タイムアウト"})]}),e.jsx(xe,{fullWidth:!0,variant:"contained",size:"large",onClick:B(A),children:"ラリー結果追加"})]})})})}var ds={},Yn=Ae;Object.defineProperty(ds,"__esModule",{value:!0});var Os=ds.default=void 0,Qn=Yn(Ie()),Zn=e;Os=ds.default=(0,Qn.default)((0,Zn.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8m.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"}),"AccessTimeOutlined");var cs={},ei=Ae;Object.defineProperty(cs,"__esModule",{value:!0});var Hs=cs.default=void 0,ti=ei(Ie()),si=e;Hs=cs.default=(0,ti.default)((0,si.jsx)("path",{d:"M6.99 11 3 15l3.99 4v-3H14v-2H6.99zM21 9l-3.99-4v3H10v2h7.01v3z"}),"SwapHorizOutlined");function ni({teamAName:t,teamBName:b,locked:h,disableTimeoutA:v,disableTimeoutB:u,onTimeout:r,onSubstitution:i,onAddRally:M}){const y=Mt(),[p,A]=o.useState(!1),[L,R]=o.useState(!1),B=As,[O,X]=o.useState(()=>!localStorage.getItem(B));return h?null:e.jsxs(Cs,{children:[e.jsxs(Wt,{ariaLabel:"substitution actions",direction:"left",icon:e.jsx(Hs,{}),onOpen:()=>R(!0),onClose:()=>R(!1),open:L,FabProps:{size:"large"},sx:{position:"fixed",right:35,bottom:200,zIndex:U=>U.zIndex.drawer-1},children:[e.jsx(Pt,{icon:e.jsx(e.Fragment,{children:b||"チームB"}),tooltipTitle:"",FabProps:{variant:"extended",size:"small"},onClick:()=>{i("teamB"),R(!1)}}),e.jsx(Pt,{icon:e.jsx(e.Fragment,{children:t||"チームA"}),tooltipTitle:"",FabProps:{variant:"extended",size:"small"},onClick:()=>{i("teamA"),R(!1)}})]}),e.jsxs(Wt,{ariaLabel:"timeout actions",direction:"left",icon:e.jsx(Os,{}),onOpen:()=>A(!0),onClose:()=>A(!1),open:p,FabProps:{size:"large"},sx:{position:"fixed",right:35,bottom:140,zIndex:U=>U.zIndex.drawer-1},children:[e.jsx(Pt,{icon:e.jsx(e.Fragment,{children:b||"チームB"}),tooltipTitle:"",FabProps:{variant:"extended",size:"small",disabled:u},onClick:()=>{r("teamB"),A(!1)}}),e.jsx(Pt,{icon:e.jsx(e.Fragment,{children:t||"チームA"}),tooltipTitle:"",FabProps:{variant:"extended",size:"small",disabled:v},onClick:()=>{r("teamA"),A(!1)}})]}),e.jsx(Le,{open:O,onClose:()=>X(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"left",TransitionComponent:Ee,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${y.palette.text.secondary}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${y.palette.text.secondary}`}}}},title:e.jsxs(s,{sx:{p:1,maxWidth:260},children:[e.jsx(Fe,{variant:"body2",sx:{whiteSpace:"pre-line"},children:Ze.addRally.text}),e.jsx(s,{sx:{textAlign:"right",mt:1},children:e.jsx(Qe,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem(B,"1"),X(!1)},children:"了解した"})})]}),children:e.jsx(Wt,{ariaLabel:"rally actions",direction:"left",icon:e.jsx(Lt,{}),FabProps:{size:"large",onClick:M},sx:{position:"fixed",right:35,bottom:80,zIndex:U=>U.zIndex.drawer-1}})})]})}function ii({isMobile:t,openActionMenu:b,onOpenActionMenu:h,onCloseActionMenu:v,teamAName:u,teamBName:r,disableTimeoutA:i,disableTimeoutB:M,showScoreProgressButton:y,onShowScoreProgress:p,onSubstitution:A,onTimeout:L,onAddRally:R,locked:B}){const O=Mt(),X=As,[U,ee]=o.useState(()=>t&&!localStorage.getItem(X));return e.jsxs(e.Fragment,{children:[!B&&t&&e.jsx(Cs,{children:e.jsx(Le,{open:U,onClose:()=>ee(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"top-start",TransitionComponent:Ee,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${O.palette.text.secondary}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${O.palette.text.secondary}`}}}},title:e.jsxs(s,{sx:{p:1,maxWidth:260},children:[e.jsx(Fe,{variant:"body2",sx:{whiteSpace:"pre-line"},children:Ze.addRally.text}),e.jsx(s,{sx:{textAlign:"right",mt:1},children:e.jsx(Qe,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem(X,"1"),ee(!1)},children:"了解した"})})]}),children:e.jsx(Ns,{color:"primary",onClick:h,sx:{position:"fixed",right:35,bottom:te=>`calc(${te.spacing(7)} + env(safe-area-inset-bottom) + 16px)`,zIndex:te=>te.zIndex.drawer+2},children:e.jsx(Fs,{})})})}),t?e.jsx(Xn,{open:b,onClose:v,teamAName:u,teamBName:r,disableTimeoutA:i,disableTimeoutB:M,showScoreProgressButton:y,onShowScoreProgress:p,onSubstitution:A,onTimeout:L,onAddRally:R,locked:B}):e.jsx(ni,{teamAName:u,teamBName:r,locked:B,disableTimeoutA:i,disableTimeoutB:M,onSubstitution:A,onTimeout:L,onAddRally:R})]})}var us={},ri=Ae;Object.defineProperty(us,"__esModule",{value:!0});var Rt=us.default=void 0,li=ri(Ie()),ai=e;Rt=us.default=(0,li.default)((0,ai.jsx)("path",{d:"M16.01 11H4v2h12.01v3L20 12l-3.99-4z"}),"ArrowRightAlt");var xs={},oi=Ae;Object.defineProperty(xs,"__esModule",{value:!0});var Jt=xs.default=void 0,di=oi(Ie()),ci=e;Jt=xs.default=(0,di.default)((0,ci.jsx)("path",{d:"m12 4-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"}),"ArrowForward");function ui(t){if(typeof window>"u")return t;try{const h=new DOMParser().parseFromString(t,"image/svg+xml"),v=new Set(["svg","g","path","circle","rect","line","polygon","polyline","text","defs","use"]),u=r=>{[...r.children].forEach(i=>{if(v.has(i.tagName))[...i.attributes].forEach(M=>{M.name.startsWith("on")&&i.removeAttribute(M.name)}),u(i);else{const M=document.createTextNode(i.outerHTML);i.replaceWith(M)}})};return u(h.documentElement),h.documentElement.outerHTML}catch{return""}}function xi({name:t}){const b=o.useRef(null),[h,v]=o.useState(1);return o.useEffect(()=>{const u=b.current;if(!u)return;const r=u.getBBox().width;v(r>64?64/r:1)},[t]),e.jsx("svg",{width:64,height:64,children:e.jsx("g",{transform:`scale(${h})`,children:e.jsx("text",{ref:b,x:32/h,y:32/h,textAnchor:"middle",dominantBaseline:"central",fontSize:8,children:t})})})}function hi({category:t,borderColor:b}){const h=b?{border:"1px solid",borderColor:b,boxSizing:"border-box"}:{};return t.iconType==="svg"&&t.svg?e.jsx(s,{sx:{width:64,height:64,...h},dangerouslySetInnerHTML:{__html:ui(t.svg)}}):t.iconType==="image"&&t.image?e.jsx(s,{component:"img",src:t.image,sx:{width:64,height:64,objectFit:"none",objectPosition:`-${t.cropX||0}px -${t.cropY||0}px`,...h}}):e.jsx(s,{sx:{width:64,height:64,display:"flex",...h},children:e.jsx(xi,{name:t.name})})}function mi({rallies:t,playDetails:b,playCategories:h,teamAMembers:v,teamBMembers:u,teamAName:r,teamBName:i,serveCategory:M,showRallyIcons:y,locked:p,isMobile:A,isPhone:L,scores:R,scoredTeam:B,showRallyHint:O,onCloseRallyHint:X,onEditRally:U,onEditSubstitution:ee,onDelete:te,onDragEnd:T}){const le=Mt(),{handleTouchEnd:ne,setSwiperRef:ae,getSwiperRef:j}=Gt(2),se=o.useRef({}),[N,pe]=o.useState({}),[m,I]=o.useState("");o.useLayoutEffect(()=>{const c={};t.forEach(S=>{const P=se.current[S.id];P&&(c[S.id]=P.offsetHeight)}),pe(c)},[t]),o.useEffect(()=>{t.forEach(c=>{const S=j(c.id);S&&(S.allowTouchMove=!p,p&&S.slideTo(0))})},[p,t,j]);const K=c=>{if(!c)return;const S=b.find(P=>P.id===c);return h.find(P=>P.id===(S==null?void 0:S.playCategoryId))},Y=(c,S)=>{if(!S)return"－";const V=(c==="teamA"?v:u).find(H=>H.id===S);return V?`${V.no}:${V.name}`:"－"},z=c=>{const S=R[c]||{a:0,b:0},P=B[c],V=le.palette.text.primary,H=le.palette.mode==="dark"?"#343A42":"#D3D3D3";return e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{color:P==="A"?V:H},children:String(S.a).padStart(2,"0")}),e.jsx("span",{style:{color:H},children:" - "}),e.jsx("span",{style:{color:P==="B"?V:H},children:String(S.b).padStart(2,"0")})]})},Q=(c,S,P)=>{var l;if(!c)return e.jsx(e.Fragment,{});const V=K(c),H=b.find(w=>w.id===c),Me=P==="A"?v:u,a=(H==null?void 0:H.pointType)==="得点"?le.palette.success.main:(H==null?void 0:H.pointType)==="失点"?le.palette.error.main:void 0;return e.jsxs(s,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[V?e.jsx(gs,{label:V.name,variant:"outlined",sx:{bgcolor:"transparent",color:V.color,borderColor:V.color,mb:.5}}):null,H?e.jsx(gs,{label:H.name,sx:{bgcolor:a,color:"common.white",mb:.5}}):null,!L&&e.jsx(Fe,{variant:"caption",noWrap:!0,sx:{width:"100%",textAlign:"center"},children:(H==null?void 0:H.pointUnitType)==="メンバー"&&((l=Me.find(w=>w.id===S))==null?void 0:l.name)||"－"})]})},Z=(c,S,P)=>e.jsx(s,{ref:P.innerRef,...P.draggableProps,"data-index":S,sx:{mb:.5},children:e.jsxs(Ft,{onSwiper:V=>ae(c.id,V),threshold:20,slidesPerView:"auto",style:{overflow:"hidden",height:N[c.id]},onTouchStart:(V,H)=>H.stopPropagation(),onTouchEnd:V=>ne(c.id,V),children:[e.jsx(We,{style:{width:"100%",flex:"0 0 auto"},children:(()=>{const V=P.dragHandleProps,{onPointerDown:H,...Me}=V||{},a=Ht(l=>{if(H==null||H(l),!H)return;const w=j(c.id);w&&(w.allowTouchMove=!1),I(c.id)});return e.jsx(s,{ref:l=>{se.current[c.id]=l},...Me,...a,sx:{display:"grid",gridTemplateColumns:"38% 24% 38%",alignItems:"center",cursor:p?"default":"grab",touchAction:m===c.id?"none":"pan-y",backgroundColor:l=>c.timeoutTeam||c.substitutionTeam?l.palette.mode==="dark"?"#343A42":"#f5f5f5":void 0},children:c.timeoutTeam?e.jsxs(s,{gridColumn:"1 / 4",sx:{...Ve,display:"flex",justifyContent:"center",alignItems:"center",height:"100%",minHeight:44},children:[c.timeoutTeam==="teamA"?r||"チームA":i||"チームB","タイムアウト"]}):c.substitutionTeam?e.jsxs(s,{gridColumn:"1 / 4",sx:{...Ve,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100%"},children:[e.jsxs("span",{children:[c.substitutionTeam==="teamA"?r||"チームA":i||"チームB","選手交代"]}),e.jsxs(s,{sx:{display:"flex",alignItems:"center",mt:.5},children:[e.jsx("span",{children:Y(c.substitutionTeam,c.outMember)}),e.jsx(Rt,{fontSize:"small",sx:{mx:1}}),e.jsx("span",{children:Y(c.substitutionTeam,c.inMember)})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(s,{children:Q(c.teamAPlayDetail,c.teamAMember,"A")}),e.jsxs(s,{sx:{fontSize:"2em",display:"flex",justifyContent:"center",flexDirection:"column",alignItems:"center"},children:[e.jsx(s,{sx:{whiteSpace:"nowrap"},children:z(S)}),c.serverTeam&&e.jsx(Jt,{sx:{width:"calc(100% - 8px)",height:20,mx:"4px",transform:c.serverTeam==="teamB"?"scaleX(-1)":void 0}})]}),e.jsx(s,{children:Q(c.teamBPlayDetail,c.teamBMember,"B")})]})})})()}),e.jsx(We,{style:{width:ut,flex:"0 0 auto"},children:e.jsx(s,{sx:{height:N[c.id],display:"flex",alignItems:"center",justifyContent:"center",bgcolor:p?"grey.500":"primary.main"},children:e.jsx(De,{size:"small",disabled:p||!!c.timeoutTeam,onClick:p||c.timeoutTeam?void 0:()=>c.substitutionTeam?ee(S):U(S),children:e.jsx(Kt,{fontSize:"small",sx:{color:"common.white"}})})})}),e.jsx(We,{style:{width:ut,flex:"0 0 auto"},children:e.jsx(s,{sx:{height:N[c.id],display:"flex",alignItems:"center",justifyContent:"center",bgcolor:p?"grey.500":"error.main"},children:e.jsx(De,{size:"small",disabled:p,onClick:p?void 0:()=>te(S),children:e.jsx(st,{fontSize:"small",sx:{color:"common.white"}})})})})]})}),oe=(c,S)=>{var P;return e.jsxs(s,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[y&&(M?e.jsx(hi,{category:M}):e.jsxs("svg",{width:64,height:64,children:[e.jsx("rect",{width:64,height:64,fill:"none",stroke:"currentColor"}),e.jsx("text",{x:"50%",y:"50%",textAnchor:"middle",dominantBaseline:"central",fontSize:"12",children:"サーブ"})]})),e.jsx(Fe,{variant:"caption",noWrap:!0,sx:{width:"100%",textAlign:"center"},children:((P=(c==="teamA"?v:u).find(V=>V.id===S))==null?void 0:P.name)||"－"})]})},ye=(c,S,P)=>e.jsx(s,{ref:P.innerRef,...P.draggableProps,"data-index":S,sx:{mb:.5},children:e.jsxs(Ft,{onSwiper:V=>ae(c.id,V),threshold:20,slidesPerView:"auto",style:{overflow:"hidden",height:N[c.id]},onTouchStart:(V,H)=>H.stopPropagation(),onTouchEnd:V=>ne(c.id,V),children:[e.jsx(We,{style:{width:"100%",flex:"0 0 auto"},children:(()=>{const V=P.dragHandleProps,{onPointerDown:H,...Me}=V||{},a=Ht(l=>{if(H==null||H(l),!H)return;const w=j(c.id);w&&(w.allowTouchMove=!1),I(c.id)});return e.jsx(s,{ref:l=>{se.current[c.id]=l},...Me,...a,sx:{display:"grid",gridTemplateColumns:"16% 22% 24% 22% 16%",alignItems:"center",cursor:p?"default":"grab",touchAction:m===c.id?"none":"pan-y",backgroundColor:l=>c.timeoutTeam||c.substitutionTeam?l.palette.mode==="dark"?"#343A42":"#f5f5f5":void 0},children:c.timeoutTeam?e.jsxs(s,{gridColumn:"1 / 6",sx:{...Ve,display:"flex",justifyContent:"center",alignItems:"center",height:"100%",minHeight:44},children:[c.timeoutTeam==="teamA"?r||"チームA":i||"チームB","タイムアウト"]}):c.substitutionTeam?e.jsxs(s,{gridColumn:"1 / 6",sx:{...Ve,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100%"},children:[e.jsxs("span",{children:[c.substitutionTeam==="teamA"?r||"チームA":i||"チームB","選手交代"]}),e.jsxs(s,{sx:{display:"flex",alignItems:"center",mt:.5},children:[e.jsx("span",{children:Y(c.substitutionTeam,c.outMember)}),e.jsx(Rt,{fontSize:"small",sx:{mx:1}}),e.jsx("span",{children:Y(c.substitutionTeam,c.inMember)})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(s,{children:c.serverTeam==="teamA"?oe("teamA",c.server):null}),e.jsx(s,{children:Q(c.teamAPlayDetail,c.teamAMember,"A")}),e.jsxs(s,{sx:{fontSize:"2em",display:"flex",justifyContent:"center",flexDirection:"column",alignItems:"center"},children:[e.jsx(s,{sx:{whiteSpace:"nowrap"},children:z(S)}),c.serverTeam&&e.jsx(Jt,{sx:{width:"calc(100% - 8px)",height:20,mx:"4px",transform:c.serverTeam==="teamB"?"scaleX(-1)":void 0}})]}),e.jsx(s,{children:Q(c.teamBPlayDetail,c.teamBMember,"B")}),e.jsx(s,{children:c.serverTeam==="teamB"?oe("teamB",c.server):null})]})})})()}),e.jsx(We,{style:{width:ut,flex:"0 0 auto"},children:e.jsx(s,{sx:{height:N[c.id],display:"flex",alignItems:"center",justifyContent:"center",bgcolor:p?"grey.500":"primary.main"},children:e.jsx(De,{size:"small",disabled:p||!!c.timeoutTeam,onClick:p||c.timeoutTeam?void 0:()=>c.substitutionTeam?ee(S):U(S),children:e.jsx(Kt,{fontSize:"small",sx:{color:"common.white"}})})})}),e.jsx(We,{style:{width:ut,flex:"0 0 auto"},children:e.jsx(s,{sx:{height:N[c.id],display:"flex",alignItems:"center",justifyContent:"center",bgcolor:p?"grey.500":"error.main"},children:e.jsx(De,{size:"small",disabled:p,onClick:p?void 0:()=>te(S),children:e.jsx(st,{fontSize:"small",sx:{color:"common.white"}})})})})]})}),we=c=>{if(m){const S=j(m);S&&(S.allowTouchMove=!0),I("")}T(c)};return e.jsx(Le,{open:O&&A,onClose:X,disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:Ee,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${le.palette.text.secondary}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${le.palette.text.secondary}`}}}},title:e.jsxs(s,{sx:{p:1,maxWidth:260},children:[e.jsx(Fe,{variant:"body2",sx:{whiteSpace:"pre-line"},children:Ze.rallyListRow.text}),e.jsx(s,{sx:{textAlign:"right",mt:1},children:e.jsx(Qe,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem("tutorial-rally-row","1"),X()},children:"了解した"})})]}),children:e.jsx(s,{children:e.jsxs(It,{onDragEnd:we,children:[A&&e.jsx(xt,{component:et,storageKey:"set-tab",children:e.jsxs(s,{children:[e.jsx(s,{sx:{display:"grid",gridTemplateColumns:L?"38% 24% 38%":"16% 22% 24% 22% 16%",textAlign:"center",alignItems:"center",...Ve},children:L?e.jsxs(e.Fragment,{children:[e.jsx(s,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:44},children:e.jsx("span",{children:r||"チームA"})}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:"得点"}),e.jsx(s,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:44},children:e.jsx("span",{children:i||"チームB"})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(s,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("span",{children:r||"チームA"}),e.jsx("span",{children:"サーブ"})]}),e.jsxs(s,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("span",{children:r||"チームA"}),e.jsx("span",{children:"ラリー結果"})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:"得点"}),e.jsxs(s,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("span",{children:i||"チームB"}),e.jsx("span",{children:"ラリー結果"})]}),e.jsxs(s,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("span",{children:i||"チームB"}),e.jsx("span",{children:"サーブ"})]})]})}),e.jsx(at,{droppableId:"rallies",children:c=>e.jsxs(s,{ref:c.innerRef,...c.droppableProps,children:[t.map((S,P)=>e.jsx(ot,{draggableId:S.id,index:P,isDragDisabled:p,children:V=>(L?Z:ye)(S,P,V)},S.id)),c.placeholder]})})]})}),!A&&e.jsx(xt,{component:et,storageKey:"set-tab",children:e.jsxs(Ct,{size:"small",sx:{tableLayout:"fixed","& th, & td":{textAlign:"center",verticalAlign:"middle"}},children:[e.jsx(St,{children:e.jsxs(qe,{sx:{...Ve},children:[e.jsx($,{sx:{width:"6%"}}),e.jsx($,{sx:{width:"16%"},children:e.jsxs(s,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{children:r||"チームA"}),e.jsx("span",{children:"サーブ"})]})}),e.jsx($,{sx:{width:"18%"},children:e.jsxs(s,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{children:r||"チームA"}),e.jsx("span",{children:"ラリー結果"})]})}),e.jsx($,{sx:{width:"20%",display:"flex",justifyContent:"center",alignItems:"center"},children:"得点"}),e.jsx($,{sx:{width:"18%"},children:e.jsxs(s,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{children:i||"チームB"}),e.jsx("span",{children:"ラリー結果"})]})}),e.jsx($,{sx:{width:"16%"},children:e.jsxs(s,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{children:i||"チームB"}),e.jsx("span",{children:"サーブ"})]})}),e.jsx($,{sx:{width:"6%"}})]})}),e.jsx(at,{droppableId:"rallies",children:c=>e.jsxs(Tt,{ref:c.innerRef,...c.droppableProps,children:[t.map((S,P)=>e.jsx(ot,{draggableId:S.id,index:P,isDragDisabled:p,children:V=>e.jsxs(qe,{ref:V.innerRef,...V.draggableProps,"data-index":P,onClick:()=>{p||(S.substitutionTeam?ee(P):S.timeoutTeam||U(P))},sx:{cursor:p||S.timeoutTeam?"default":"pointer",backgroundColor:H=>S.timeoutTeam||S.substitutionTeam?H.palette.mode==="dark"?"#343A42":"#f5f5f5":void 0},children:[e.jsx($,{padding:"checkbox",sx:{width:"6%"},children:e.jsx(s,{onClick:H=>H.stopPropagation(),...V.dragHandleProps,sx:{cursor:p?"default":"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:e.jsx(Ot,{fontSize:"small"})})}),S.timeoutTeam?e.jsx($,{colSpan:5,sx:{width:"88%"},children:e.jsxs(s,{sx:{...Ve,display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:[S.timeoutTeam==="teamA"?r||"チームA":i||"チームB","タイムアウト"]})}):S.substitutionTeam?e.jsx($,{colSpan:5,sx:{width:"88%"},children:e.jsxs(s,{sx:{...Ve,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100%"},children:[e.jsxs("span",{children:[S.substitutionTeam==="teamA"?r||"チームA":i||"チームB","選手交代"]}),e.jsxs(s,{sx:{display:"flex",alignItems:"center",mt:.5},children:[e.jsx("span",{children:Y(S.substitutionTeam,S.outMember)}),e.jsx(Rt,{fontSize:"small",sx:{mx:1}}),e.jsx("span",{children:Y(S.substitutionTeam,S.inMember)})]})]})}):e.jsxs(e.Fragment,{children:[e.jsx($,{sx:{width:"16%"},children:S.serverTeam==="teamA"?oe("teamA",S.server):null}),e.jsx($,{sx:{width:"18%"},children:Q(S.teamAPlayDetail,S.teamAMember,"A")}),e.jsx($,{sx:{width:"20%",fontSize:"2em",textAlign:"center"},children:z(P)}),e.jsx($,{sx:{width:"18%"},children:Q(S.teamBPlayDetail,S.teamBMember,"B")}),e.jsx($,{sx:{width:"16%"},children:S.serverTeam==="teamB"?oe("teamB",S.server):null})]}),e.jsx($,{padding:"checkbox",sx:{width:"6%"},children:e.jsx(s,{onClick:H=>H.stopPropagation(),sx:{width:32,height:32,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:e.jsx(De,{size:"small",onClick:p?void 0:()=>te(P),disabled:p,sx:{width:24,height:24},children:e.jsx(st,{fontSize:"small",color:p?"disabled":"error"})})})})]})},S.id)),c.placeholder]})})]})})]})})})}function pi({scores:t,consecutive:b,connections:h,rowHeight:v}){const u=t.length*v;return e.jsxs(s,{sx:{flex:"0 0 20%",overflowY:"auto",height:"100%",position:"relative"},children:[t.map((r,i)=>{const M=i===0?{a:0,b:0}:t[i-1],y=r.a!==M.a&&r.a!==0,p=r.b!==M.b&&r.b!==0,A=y&&b[i],L=p&&b[i];return e.jsxs(s,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr 1fr",alignItems:"center",py:.5,height:`${v}px`,position:"relative",zIndex:1},children:[e.jsx(s,{}),e.jsxs(e.Fragment,{children:[e.jsx(s,{sx:{display:"flex",justifyContent:"center"},children:y?e.jsx(s,{sx:{width:32,height:32,border:"1px solid",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:24,borderColor:A?"red":"currentColor",backgroundColor:A?"#ffebee":"#fff",color:"black"},children:r.a}):null}),e.jsx(s,{}),e.jsx(s,{sx:{display:"flex",justifyContent:"center"},children:p?e.jsx(s,{sx:{width:32,height:32,border:"1px solid",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:24,borderColor:L?"red":"currentColor",backgroundColor:L?"#ffebee":"#fff",color:"black"},children:r.b}):null})]}),e.jsx(s,{})]},i)}),e.jsx("svg",{viewBox:`0 0 100 ${u}`,style:{position:"absolute",left:0,top:0,width:"100%",height:u,zIndex:0},preserveAspectRatio:"none",pointerEvents:"none",children:h.map(r=>{const i=r.index*v+v/2,M=(r.index+1)*v+v/2,y=r.from==="A"?30:70,p=r.from==="A"?70:30;return e.jsx("line",{x1:y,y1:i,x2:p,y2:M,stroke:"currentColor",strokeWidth:1},r.index)})})]})}function fi({setScore:t,playDetails:b,playCategories:h,teamAMembers:v,teamBMembers:u,teamAName:r,teamBName:i,onChange:M,locked:y=!1,scoreInputSetting:p,themeSetting:A,showSnackbar:L}){const[R,B]=o.useState(!1),[O,X]=o.useState(!1),{addRally:U,deleteRally:ee,calculateScores:te}=Ln(t,b,M),T=o.useRef(null),le=o.useRef(null),ne=dt("md"),ae=dt("sm"),j=!ae&&p.showRallyIcons,se=!ne&&p.showScoreProgressArea,N=ne&&p.showScoreProgressArea,[pe,m]=o.useState(!1),I=h.find(C=>C.id==="init-serve"),K=t.rallies.filter(C=>C.timeoutTeam==="teamA").length,Y=t.rallies.filter(C=>C.timeoutTeam==="teamB").length,z=K>=2,Q=Y>=2,Z=C=>{if(!C.destination||y)return;const D=Array.from(t.rallies),[n]=D.splice(C.source.index,1);D.splice(C.destination.index,0,n);const x={...t,rallies:D};te(x),M(x)},oe=C=>{if(y)return;const D={...t,rallies:[...t.rallies]};ee(C),L("ラリーを削除しました","success",{actionLabel:"元に戻す",onAction:()=>{const n={...D,rallies:[...D.rallies]};te(n),M(n)},autoHideDuration:5e3})},ye=C=>{const D=!localStorage.getItem("tutorial-rally-row");U(C),ne&&D&&B(!0)},we=(C,D)=>{const n=[...t.rallies];n[C]=D;const x={...t,rallies:n};te(x),M(x)},c=C=>{if(y||C==="teamA"&&z||C==="teamB"&&Q)return;const D=!localStorage.getItem("tutorial-rally-row");U({id:crypto.randomUUID(),timeoutTeam:C}),ne&&D&&B(!0)},S=C=>{var D;y||(D=T.current)==null||D.openAddDialog(C)},P=C=>{var n;if(y)return;const D=t.rallies[C];D.substitutionTeam&&((n=T.current)==null||n.openEditDialog(C,D.substitutionTeam,D.outMember||"",D.inMember||""))},V=(C,D,n,x)=>{const G=!localStorage.getItem("tutorial-rally-row"),f=[...t.rallies];x!==null?f[x]={...f[x],substitutionTeam:C,outMember:D,inMember:n}:f.push({id:crypto.randomUUID(),substitutionTeam:C,outMember:D,inMember:n});const g={...t,rallies:f};te(g),M(g),ne&&G&&B(!0)},H=[],Me=[],a=[],l=[];let w=0,E=0,F=0,_=0;t.rallies.forEach(C=>{const D=b.find(G=>G.id===C.teamAPlayDetail),n=b.find(G=>G.id===C.teamBPlayDetail);let x=null;(D==null?void 0:D.pointType)==="得点"||(n==null?void 0:n.pointType)==="失点"?(w+=1,F+=1,x="A"):((n==null?void 0:n.pointType)==="得点"||(D==null?void 0:D.pointType)==="失点")&&(E+=1,_+=1,x="B"),!C.timeoutTeam&&!C.substitutionTeam&&(l.push(x),a.push({a:F,b:_})),Me.push(C.timeoutTeam||C.substitutionTeam?null:x),H.push({a:w,b:E})});const me=40,fe=[];for(let C=0;C<l.length-1;C++){const D=l[C],n=l[C+1];D&&n&&D!==n&&fe.push({from:D,index:C})}const he=l.map((C,D)=>C!==null&&D>0&&C===l[D-1]);return e.jsxs(s,{sx:{position:"relative",display:"flex",flexDirection:"column",height:"100%"},children:[e.jsxs(s,{sx:{display:"flex",gap:2,flex:1,minHeight:0},children:[se&&e.jsx(pi,{scores:a,consecutive:he,connections:fe,rowHeight:me}),e.jsx(s,{sx:{flex:1,overflowY:"auto",height:"100%",maxWidth:1024,width:"100%",mx:"auto",mb:2},children:e.jsx(mi,{rallies:t.rallies,playDetails:b,playCategories:h,teamAMembers:v,teamBMembers:u,teamAName:r,teamBName:i,serveCategory:I,showRallyIcons:j,locked:y,isMobile:ne,isPhone:ae,scores:H,scoredTeam:Me,showRallyHint:R,onCloseRallyHint:()=>B(!1),onEditRally:C=>{var D;return(D=le.current)==null?void 0:D.openEditDialog(C)},onEditSubstitution:P,onDelete:oe,onDragEnd:Z})})]}),N&&e.jsx(Kn,{open:pe,onClose:()=>m(!1),scores:a,consecutive:he,connections:fe,rowHeight:me}),e.jsx(ii,{isMobile:ne,openActionMenu:O,onOpenActionMenu:()=>X(!0),onCloseActionMenu:()=>X(!1),teamAName:r,teamBName:i,disableTimeoutA:z,disableTimeoutB:Q,showScoreProgressButton:p.showScoreProgressArea,onShowScoreProgress:()=>m(!0),onSubstitution:S,onTimeout:c,onAddRally:()=>{var C;return(C=le.current)==null?void 0:C.openAddDialog()},locked:y}),e.jsx(En,{ref:le,setScore:t,playDetails:b,playCategories:h,teamAMembers:v,teamBMembers:u,teamAName:r,teamBName:i,scoreInputSetting:p,themeSetting:A,locked:y,onAdd:ye,onEdit:we}),e.jsx(qn,{ref:T,teamAMembers:v,teamBMembers:u,onSave:V})]})}const gi=()=>typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():Math.random().toString(36).slice(2)+Date.now().toString(36);function ji({statsSettings:t,onChange:b,playCategories:h,playDetails:v,rallyCategoryTags:u,rallyDetailTags:r,disabled:i,showSnackbar:M}){const y=a=>{if(ye){const E=oe(ye);E&&(E.allowTouchMove=!0),we("")}if(!a.destination)return;const l=Array.from(t),[w]=l.splice(a.source.index,1);l.splice(a.destination.index,0,w),b(l)},p=a=>{var l;return((l=h.find(w=>w.id===a))==null?void 0:l.name)||""},A=a=>{var l;return((l=v.find(w=>w.id===a))==null?void 0:l.name)||""},L=a=>{const l=a.playCategoryId?p(a.playCategoryId):a.playCategoryTags?a.playCategoryTags.map(me=>{var fe;return((fe=u.find(he=>he.id===me))==null?void 0:fe.name)||me}).join(", "):"",w=a.playDetailId?A(a.playDetailId):a.playDetailTags?a.playDetailTags.map(me=>{var fe;return((fe=r.find(he=>he.id===me))==null?void 0:fe.name)||me}).join(", "):"",E=a.pointType||"",F=a.pointUnitType||"",_=a.aggregateType||"合算";return[l,w,E,F,_].filter(me=>me).join(", ")},[R,B]=o.useState(!1),[O,X]=o.useState(null),[U,ee]=o.useState(""),[te,T]=o.useState(""),[le,ne]=o.useState([]),[ae,j]=o.useState([]),[se,N]=o.useState(""),[pe,m]=o.useState(""),[I,K]=o.useState("合算"),Y=dt("md"),z=dt("sm"),{handleTouchEnd:Q,setSwiperRef:Z,getSwiperRef:oe}=Gt(2),[ye,we]=o.useState(""),c=()=>{i||(X(-1),ee(""),T(""),ne([]),j([]),N(""),m(""),K("合算"),B(!0))},S=a=>{if(i)return;const l=t[a];X(a),ee(l.playCategoryId||""),T(l.playDetailId||""),ne(l.playCategoryTags||[]),j(l.playDetailTags||[]),N(l.pointType||""),m(l.pointUnitType||""),K(l.aggregateType||"合算"),B(!0)},P=()=>{const a=U!=="",l=te!=="",w=le.length>0,E=ae.length>0,F=se!=="",_=pe!=="";return a&&!l&&!w&&!E&&!F&&!_||a&&l&&!w&&!E&&!F&&!_||a&&!l&&!w&&!E&&F&&!_||a&&!l&&!w&&!E&&!F&&_||a&&!l&&!w&&!E&&F&&_||!a&&!l&&!w&&!E&&F&&!_||!a&&!l&&!w&&!E&&F&&_||!a&&!l&&!w&&!E&&!F&&_||w&&!a&&!l&&!E&&!F&&!_||w&&E&&!a&&!l&&!F&&!_||w&&E&&!a&&!l&&F&&!_||w&&E&&!a&&!l&&!F&&_||w&&E&&!a&&!l&&F&&_||w&&!a&&!l&&F&&!_||w&&!a&&!l&&!F&&_||w&&!a&&!l&&F&&_||E&&!a&&!l&&!w&&!F&&!_||E&&!a&&!l&&!w&&F&&!_||E&&!a&&!l&&!w&&!F&&_||E&&!a&&!l&&!w&&F&&_},V=()=>{const a={id:O===-1?gi():t[O].id,playCategoryId:U||void 0,playDetailId:te||void 0,playCategoryTags:U===""&&le.length>0?le:void 0,playDetailTags:te===""&&ae.length>0?ae:void 0,pointType:te?void 0:se||void 0,pointUnitType:te?void 0:pe||void 0,aggregateType:I};O===-1?b([...t,a]):O!==null&&b(t.map((l,w)=>w===O?a:l)),B(!1)},H=()=>{B(!1)},Me=a=>{if(i)return;const l=[...t];b(t.filter((w,E)=>E!==a)),M("スタッツ設定を削除しました","success",{actionLabel:"元に戻す",onAction:()=>b(l),autoHideDuration:5e3})};return e.jsxs(s,{children:[e.jsxs(s,{sx:{maxWidth:1024,mx:"auto",display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(s,{sx:{fontWeight:"bold"},children:"スタッツ設定"}),e.jsx(xe,{onClick:c,variant:"contained",size:"medium",startIcon:e.jsx(Lt,{}),disabled:i,children:"追加"})]}),e.jsx(xt,{component:et,storageKey:"match-stats-grid",sx:{maxWidth:1024,mx:"auto",overflowX:"hidden"},children:Y?e.jsx(It,{onDragEnd:y,children:e.jsx(at,{droppableId:"stats-settings",children:a=>e.jsxs(s,{ref:a.innerRef,...a.droppableProps,children:[e.jsx(s,{sx:{display:"grid",gridTemplateColumns:z?"1fr":"repeat(5, 1fr)",alignItems:"center",height:50,px:1,borderBottom:1,borderColor:"divider",...Ve},children:z?e.jsx(s,{children:"分析項目"}):e.jsxs(e.Fragment,{children:[e.jsx(s,{children:"プレー区分"}),e.jsx(s,{children:"プレー詳細"}),e.jsx(s,{children:"得点区分"}),e.jsx(s,{children:"得失点単位区分"}),e.jsx(s,{children:"集計方法"})]})}),t.map((l,w)=>e.jsx(ot,{draggableId:l.id,index:w,isDragDisabled:i,children:E=>{const F=E.dragHandleProps,{onPointerDown:_,...me}=F||{},fe=Ht(he=>{_==null||_(he);const C=oe(l.id);C&&(C.allowTouchMove=!1),we(l.id)});return e.jsx(s,{ref:E.innerRef,...E.draggableProps,style:E.draggableProps.style,children:e.jsxs(Ft,{onSwiper:he=>Z(l.id,he),threshold:20,slidesPerView:"auto",style:{overflow:"hidden"},onTouchStart:(he,C)=>C.stopPropagation(),onTouchEnd:he=>Q(l.id,he),children:[e.jsx(We,{style:{width:"100%",flex:"0 0 auto"},children:e.jsx(s,{...me,...fe,sx:{display:"grid",gridTemplateColumns:z?"1fr":"repeat(5, 1fr)",alignItems:"center",height:50,px:1,borderBottom:1,borderColor:"divider",bgcolor:"background.paper",cursor:i?"default":"grab",touchAction:ye===l.id?"none":"pan-y"},children:z?e.jsx(s,{children:L(l)}):e.jsxs(e.Fragment,{children:[e.jsx(s,{sx:{pr:1},children:l.playCategoryId?p(l.playCategoryId):l.playCategoryTags&&l.playCategoryTags.length>0?e.jsx(s,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:l.playCategoryTags.map(he=>{const C=u.find(D=>D.id===he);return e.jsx(Ye,{label:(C==null?void 0:C.name)||he,size:"small",sx:{backgroundColor:(C==null?void 0:C.color)||Ke,color:"#fff"}},he)})}):""}),e.jsx(s,{sx:{pr:1},children:l.playDetailId?A(l.playDetailId):l.playDetailTags&&l.playDetailTags.length>0?e.jsx(s,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:l.playDetailTags.map(he=>{const C=r.find(D=>D.id===he);return e.jsx(Ye,{label:(C==null?void 0:C.name)||he,size:"small",sx:{backgroundColor:(C==null?void 0:C.color)||Ke,color:"#fff"}},he)})}):""}),e.jsx(s,{sx:{pr:1},children:l.pointType||""}),e.jsx(s,{sx:{pr:1},children:l.pointUnitType||""}),e.jsx(s,{children:l.aggregateType||"合算"})]})})}),e.jsx(We,{style:{width:ut,flex:"0 0 auto"},children:e.jsx(s,{sx:{height:50,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"primary.main"},children:e.jsx(De,{size:"small",onClick:()=>S(w),disabled:i,children:e.jsx(Kt,{fontSize:"small",sx:{color:"common.white"}})})})}),e.jsx(We,{style:{width:ut,flex:"0 0 auto"},children:e.jsx(s,{sx:{height:50,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"error.main"},children:e.jsx(De,{size:"small",onClick:()=>Me(w),disabled:i,children:e.jsx(st,{fontSize:"small",sx:{color:"common.white"}})})})})]})})}},l.id)),a.placeholder]})})}):e.jsxs(Ct,{size:"small",children:[e.jsx(St,{children:e.jsxs(qe,{sx:{backgroundColor:a=>a.palette.mode==="dark"?"#343A42":"#f5f5f5",height:50},children:[e.jsx($,{}),e.jsx($,{children:"プレー区分"}),e.jsx($,{children:"プレー詳細"}),e.jsx($,{children:"得点区分"}),e.jsx($,{children:"得失点単位区分"}),e.jsx($,{children:"集計方法"}),e.jsx($,{})]})}),e.jsx(It,{onDragEnd:y,children:e.jsx(at,{droppableId:"stats-settings",children:a=>e.jsxs(Tt,{ref:a.innerRef,...a.droppableProps,children:[t.map((l,w)=>e.jsx(ot,{draggableId:l.id,index:w,isDragDisabled:i,children:E=>e.jsxs(qe,{ref:E.innerRef,...E.draggableProps,onClick:()=>S(w),sx:{cursor:i?"default":"pointer",height:50},children:[e.jsx($,{padding:"checkbox",sx:{width:48},children:e.jsx(s,{...E.dragHandleProps,onClick:F=>F.stopPropagation(),sx:{cursor:i?"default":"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:e.jsx(Ot,{})})}),e.jsx($,{children:l.playCategoryId?p(l.playCategoryId):l.playCategoryTags&&l.playCategoryTags.length>0?e.jsx(s,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:l.playCategoryTags.map(F=>{const _=u.find(me=>me.id===F);return e.jsx(Ye,{label:(_==null?void 0:_.name)||F,size:"small",sx:{backgroundColor:(_==null?void 0:_.color)||Ke,color:"#fff"}},F)})}):""}),e.jsx($,{children:l.playDetailId?A(l.playDetailId):l.playDetailTags&&l.playDetailTags.length>0?e.jsx(s,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:l.playDetailTags.map(F=>{const _=r.find(me=>me.id===F);return e.jsx(Ye,{label:(_==null?void 0:_.name)||F,size:"small",sx:{backgroundColor:(_==null?void 0:_.color)||Ke,color:"#fff"}},F)})}):""}),e.jsx($,{children:l.pointType||""}),e.jsx($,{children:l.pointUnitType||""}),e.jsx($,{children:l.aggregateType||"合算"}),e.jsx($,{padding:"checkbox",children:e.jsx(De,{size:"small",onClick:F=>{F.stopPropagation(),Me(w)},disabled:i,children:e.jsx(st,{fontSize:"small",color:"error"})})})]})},l.id)),a.placeholder]})})})]})}),e.jsxs(At,{open:R,onClose:H,children:[e.jsxs(it,{children:["スタッツ設定",O===-1?"追加":"編集"]}),e.jsxs(rt,{children:[e.jsxs(_e,{fullWidth:!0,margin:"dense",children:[e.jsx(Re,{id:"stat-category-label",children:"プレー区分"}),e.jsxs(ze,{labelId:"stat-category-label",value:U,label:"プレー区分",onChange:a=>{ee(a.target.value),T(""),ne([]),j([])},disabled:le.length>0||ae.length>0,children:[e.jsx(ce,{value:"",children:"なし"}),h.map(a=>e.jsx(ce,{value:a.id,children:a.name},a.id))]})]}),e.jsxs(_e,{fullWidth:!0,margin:"dense",children:[e.jsx(Re,{id:"stat-detail-label",children:"プレー詳細"}),e.jsxs(ze,{labelId:"stat-detail-label",value:te,label:"プレー詳細",onChange:a=>{T(a.target.value),N(""),m(""),ne([]),j([])},disabled:se!==""||pe!==""||le.length>0||ae.length>0,children:[e.jsx(ce,{value:"",children:"なし"}),v.filter(a=>a.playCategoryId===U).map(a=>e.jsx(ce,{value:a.id,children:a.name},a.id))]})]}),e.jsx(qt,{multiple:!0,options:u,getOptionLabel:a=>a.name,value:u.filter(a=>le.includes(a.id)),onChange:(a,l)=>{ne(l.map(w=>w.id)),l.length>0&&(ee(""),T(""))},disabled:U!==""||te!=="",renderTags:(a,l)=>a.map((w,E)=>{const{key:F,..._}=l({index:E});return e.jsx(Ye,{..._,label:w.name,size:"small",sx:{backgroundColor:w.color||Ke,color:"#fff"}},F)}),renderInput:a=>e.jsx(Se,{...a,label:"プレー区分タグ",margin:"dense"}),fullWidth:!0}),e.jsx(qt,{multiple:!0,options:r,getOptionLabel:a=>a.name,value:r.filter(a=>ae.includes(a.id)),onChange:(a,l)=>{j(l.map(w=>w.id)),l.length>0&&(ee(""),T(""))},disabled:U!==""||te!=="",renderTags:(a,l)=>a.map((w,E)=>{const{key:F,..._}=l({index:E});return e.jsx(Ye,{..._,label:w.name,size:"small",sx:{backgroundColor:w.color||Ke,color:"#fff"}},F)}),renderInput:a=>e.jsx(Se,{...a,label:"プレー詳細タグ",margin:"dense"}),fullWidth:!0}),e.jsxs(s,{children:[e.jsxs(_e,{fullWidth:!0,margin:"dense",children:[e.jsx(Re,{id:"stat-point-label",children:"得点区分"}),e.jsxs(ze,{labelId:"stat-point-label",value:se,label:"得点区分",onChange:a=>{N(a.target.value),a.target.value!==""&&T("")},disabled:te!=="",children:[e.jsx(ce,{value:"",children:"なし"}),e.jsx(ce,{value:"得点",children:"得点"}),e.jsx(ce,{value:"失点",children:"失点"})]})]}),e.jsxs(_e,{fullWidth:!0,margin:"dense",children:[e.jsx(Re,{id:"stat-unit-label",children:"得失点単位区分"}),e.jsxs(ze,{labelId:"stat-unit-label",value:pe,label:"得失点単位区分",onChange:a=>{m(a.target.value),a.target.value!==""&&T("")},disabled:te!=="",children:[e.jsx(ce,{value:"",children:"なし"}),e.jsx(ce,{value:"メンバー",children:"メンバー"}),e.jsx(ce,{value:"チーム",children:"チーム"})]})]})]}),e.jsxs(_e,{fullWidth:!0,margin:"dense",children:[e.jsx(Re,{id:"stat-aggregate-label",children:"集計方法"}),e.jsxs(ze,{labelId:"stat-aggregate-label",value:I,label:"集計方法",onChange:a=>K(a.target.value),children:[e.jsx(ce,{value:"合算",children:"合算"}),e.jsx(ce,{value:"セット平均",children:"セット平均"})]})]})]}),e.jsxs(lt,{children:[e.jsx(xe,{onClick:H,color:"inherit",startIcon:e.jsx(tt,{}),children:"キャンセル"}),e.jsx(xe,{onClick:V,disabled:!P(),startIcon:e.jsx(Je,{}),children:"OK"})]})]})]})}function bs(t,b,h){var u,r;if(!t)return!1;const v=b.get(t.playCategoryId);return!(h.playDetailId&&t.id!==h.playDetailId||h.playCategoryId&&t.playCategoryId!==h.playCategoryId||h.playCategoryTags&&h.playCategoryTags.length>0&&!((u=v==null?void 0:v.tags)!=null&&u.some(i=>h.playCategoryTags.includes(i)))||h.playDetailTags&&h.playDetailTags.length>0&&!((r=t.tags)!=null&&r.some(i=>h.playDetailTags.includes(i)))||h.pointType&&t.pointType!==h.pointType||h.pointUnitType&&t.pointUnitType!==h.pointUnitType)}function ys(t,b,h,v){const u=v.map(()=>({teamA:0,teamB:0}));return t.forEach(r=>{r.rallies.forEach(i=>{v.forEach((M,y)=>{const p=i.teamAPlayDetail?b.get(i.teamAPlayDetail):void 0;bs(p,h,M)&&(u[y].teamA+=1);const A=i.teamBPlayDetail?b.get(i.teamBPlayDetail):void 0;bs(A,h,M)&&(u[y].teamB+=1)})})}),u}function bi(t,b){const h=[];let v=0,u=0,r=0,i=0;return t.forEach(y=>{let p=0,A=0,L=0,R=0;y.rallies.forEach(B=>{if(B.timeoutTeam||B.substitutionTeam||!B.serverTeam)return;const O=B.teamAPlayDetail?b.get(B.teamAPlayDetail):void 0,X=B.teamBPlayDetail?b.get(B.teamBPlayDetail):void 0;B.serverTeam==="teamA"?(A+=1,(O&&O.pointType==="得点"||X&&X.pointType==="失点")&&(p+=1)):(R+=1,(X&&X.pointType==="得点"||O&&O.pointType==="失点")&&(L+=1))}),v+=p,u+=A,r+=L,i+=R,h.push({teamA:A?`${Math.round(p/A*100)}%`:"-",teamB:R?`${Math.round(L/R*100)}%`:"-"})}),{overall:{teamA:u?`${Math.round(v/u*100)}%`:"-",teamB:i?`${Math.round(r/i*100)}%`:"-"},perSet:h}}function yi(t,b){const h=[];let v=0,u=0,r=0,i=0;return t.forEach(y=>{let p=0,A=0,L=0,R=0;y.rallies.forEach(B=>{if(B.timeoutTeam||B.substitutionTeam||!B.serverTeam)return;const O=B.teamAPlayDetail?b.get(B.teamAPlayDetail):void 0,X=B.teamBPlayDetail?b.get(B.teamBPlayDetail):void 0;B.serverTeam==="teamB"?(A+=1,(O&&O.pointType==="得点"||X&&X.pointType==="失点")&&(p+=1)):(R+=1,(X&&X.pointType==="得点"||O&&O.pointType==="失点")&&(L+=1))}),v+=p,u+=A,r+=L,i+=R,h.push({teamA:A?`${Math.round(p/A*100)}%`:"-",teamB:R?`${Math.round(L/R*100)}%`:"-"})}),{overall:{teamA:u?`${Math.round(v/u*100)}%`:"-",teamB:i?`${Math.round(r/i*100)}%`:"-"},perSet:h}}function vi({sets:t,playDetails:b,playCategories:h,statsSettings:v,matchStatsSettings:u,onMatchStatsSettingsChange:r,rallyCategoryTags:i,rallyDetailTags:M,teamAName:y,teamBName:p,locked:A,showSnackbar:L}){const R=new Map(b.map(m=>[m.id,m])),B=new Map(h.map(m=>[m.id,m])),O=m=>{var I;return((I=h.find(K=>K.id===m))==null?void 0:I.name)||""},X=m=>{var I;return((I=b.find(K=>K.id===m))==null?void 0:I.name)||""},U=[...v,...u],ee=ys(t,R,B,U),te=t.map(m=>ys([m],R,B,U)),T=ee.map((m,I)=>{if(U[I].aggregateType==="セット平均"){const Y=t.length||1;return{teamA:(m.teamA/Y).toFixed(1),teamB:(m.teamB/Y).toFixed(1)}}return m}),le=te.map(m=>U.reduce((I,K,Y)=>(K.aggregateType!=="セット平均"&&I.push(m[Y]),I),[])),ne=U.filter(m=>m.aggregateType!=="セット平均"),ae=bi(t,R),j=yi(t,R),se=m=>{const I=[];m.playCategoryId?I.push(e.jsx("span",{children:O(m.playCategoryId)},"cat")):m.playCategoryTags&&m.playCategoryTags.length>0&&I.push(e.jsx(s,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center",mt:.5},children:m.playCategoryTags.map(Y=>{const z=i.find(Q=>Q.id===Y);return e.jsx(Ye,{label:(z==null?void 0:z.name)||Y,size:"small",sx:{mr:.5,mb:.5,backgroundColor:(z==null?void 0:z.color)||Ke,color:"#fff"}},Y)})},"catTags")),m.playDetailId?I.push(e.jsx("span",{children:X(m.playDetailId)},"detail")):m.playDetailTags&&m.playDetailTags.length>0&&I.push(e.jsx(s,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center",mt:.5},children:m.playDetailTags.map(Y=>{const z=M.find(Q=>Q.id===Y);return e.jsx(Ye,{label:(z==null?void 0:z.name)||Y,size:"small",sx:{mr:.5,mb:.5,backgroundColor:(z==null?void 0:z.color)||Ke,color:"#fff"}},Y)})},"detailTags"));const K=[];return m.pointType&&K.push(m.pointType),m.pointUnitType&&K.push(m.pointUnitType),K.length>0&&I.push(e.jsx("span",{children:K.join(",")},"point")),I.push(e.jsxs("span",{children:["(",m.aggregateType||"合算",")"]},"agg")),e.jsx(s,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:I.map((Y,z)=>e.jsx(s,{sx:{display:"flex",justifyContent:"center"},children:Y},z))})},N={flex:1,display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",whiteSpace:"nowrap"},pe=(m,I,K,Y,z)=>e.jsx(xt,{component:et,storageKey:z,sx:{mb:2},children:e.jsxs(s,{sx:{display:"flex",flexDirection:"column","& > *":{minHeight:50}},children:[e.jsxs(s,{sx:{display:"flex",backgroundColor:Q=>Q.palette.mode==="dark"?"#343A42":"#f5f5f5"},children:[e.jsx(s,{sx:{...N,fontWeight:"bold"},children:y||"チームA"}),e.jsx(s,{sx:{...N,fontWeight:"bold"},children:"項目"}),e.jsx(s,{sx:{...N,fontWeight:"bold"},children:p||"チームB"})]}),[{key:"break-rate",a:I.teamA,i:"ブレイク率",b:I.teamB,isSetting:!1},{key:"sideout-rate",a:K.teamA,i:"サイドアウト率",b:K.teamB,isSetting:!1},...Y.map((Z,oe)=>({key:Z.id,a:m[oe].teamA,i:se(Z),b:m[oe].teamB,isSetting:!0}))].map((Q,Z,oe)=>e.jsxs(s,{sx:ye=>({display:"flex",borderBottom:Z===oe.length-1?"none":`1px solid ${ye.palette.mode==="dark"?"#343A42":"#f5f5f5"}`}),children:[e.jsx(s,{sx:N,children:Q.a}),e.jsx(s,{sx:{...N,whiteSpace:Q.isSetting?"normal":"nowrap"},children:Q.i}),e.jsx(s,{sx:N,children:Q.b})]},Q.key))]})});return e.jsxs(s,{sx:{display:"grid",gap:2,gridTemplateColumns:{xs:"1fr",md:"repeat(2, 1fr)"},maxWidth:1024,width:"100%",mx:"auto"},children:[e.jsxs(s,{children:[e.jsx(Fe,{variant:"h6",sx:{mb:1},children:"試合全体のスタッツ"}),pe(T,ae.overall,j.overall,U,"stats-overall")]}),t.map((m,I)=>e.jsxs(s,{children:[e.jsx(Fe,{variant:"h6",sx:{mb:1},children:`${I+1}セット目(${m.my}-${m.opponent})のスタッツ`}),pe(le[I],ae.perSet[I],j.perSet[I],ne,`stats-set-${I}`)]},m.id)),e.jsxs(s,{sx:{gridColumn:"1 / -1"},children:[e.jsx(ji,{statsSettings:u,onChange:r,playCategories:h,playDetails:b,rallyCategoryTags:i,rallyDetailTags:M,disabled:A,showSnackbar:L}),e.jsxs(Ss,{severity:"info",sx:{mt:1},children:["本設定は試合内のみでの設定となります",e.jsx("br",{}),"各試合共通でのスタッツ項目の設定は設定＞スタッツメニューから設定してください"]})]})]})}var hs={},Ci=Ae;Object.defineProperty(hs,"__esModule",{value:!0});var Nt=hs.default=void 0,Si=Ci(Ie()),Ti=e;Nt=hs.default=(0,Si.default)((0,Ti.jsx)("path",{d:"M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m-9-2V7H4v3H1v2h3v3h2v-3h3v-2zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"PersonAdd");const wi=()=>typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():Math.random().toString(36).slice(2)+Date.now().toString(36);function Ai({match:t,setMatch:b,teamAName:h,teamBName:v,teamMembers:u,onAddMember:r,locked:i,showSnackbar:M}){const y=Mt(),p=dt("md"),A=dt("sm"),{handleTouchEnd:L,setSwiperRef:R,getSwiperRef:B}=Gt(),O={tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${y.palette.text.secondary}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${y.palette.text.secondary}`}}}},X=(f,g,W)=>e.jsxs(s,{sx:{p:1,maxWidth:260},children:[e.jsx(Fe,{variant:"body2",sx:{whiteSpace:"pre-line"},children:Ze[f].text}),e.jsx(s,{sx:{textAlign:"right",mt:1},children:e.jsx(Qe,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem(g,"1"),W()},children:"了解した"})})]}),[U,ee]=o.useState(""),te="tutorial-member-select",[T,le]=o.useState(()=>!localStorage.getItem(te)),ne="tutorial-member-row",[ae,j]=o.useState(null),[se,N]=o.useState(!1),[pe,m]=o.useState(!1),[I,K]=o.useState(""),[Y,z]=o.useState(""),[Q,Z]=o.useState([]),[oe,ye]=o.useState("teamA"),[we,c]=o.useState([]),S="tutorial-member-select-add",P="tutorial-member-select-list",[V,H]=o.useState(!1),[Me,a]=o.useState(!1);o.useEffect(()=>{if(se){const f=window.setTimeout(()=>{H(!localStorage.getItem(S)),a(!localStorage.getItem(P))},300);return()=>window.clearTimeout(f)}H(!1),a(!1)},[se]);const l=f=>{if(U){const de=B(U);de&&(de.allowTouchMove=!0),ee("")}if(!f.destination||f.source.droppableId!==f.destination.droppableId||i)return;const g=f.source.droppableId==="teamA"?"teamAMembers":"teamBMembers",W=Array.from(t[g]),[ie]=W.splice(f.source.index,1);W.splice(f.destination.index,0,ie),b(de=>({...de,[g]:W}))},w=o.useMemo(()=>{const f=oe==="teamA"?t.teamA:t.teamB,g=u[f]||[],W=oe==="teamA"?t.teamAMembers:t.teamBMembers;return g.filter(ie=>ie.visible!==!1&&!W.some(de=>de.id===ie.id))},[oe,t,u]);o.useEffect(()=>{[...t.teamAMembers.map(g=>`teamA-${g.id}`),...t.teamBMembers.map(g=>`teamB-${g.id}`)].forEach(g=>{const W=B(g);W&&(W.allowTouchMove=!i,i&&W.slideTo(0))})},[i,t.teamAMembers,t.teamBMembers,B]);const E=f=>{ye(f),c([]),N(!0)},F=f=>{c(g=>g.some(ie=>ie.id===f.id)?g.filter(ie=>ie.id!==f.id):[...g,f])},_=()=>{const f=!localStorage.getItem(ne);b(oe==="teamA"?g=>({...g,teamAMembers:[...g.teamAMembers,...we.map(W=>({...W,statuses:Array(g.sets.length).fill("")}))]}):g=>({...g,teamBMembers:[...g.teamBMembers,...we.map(W=>({...W,statuses:Array(g.sets.length).fill("")}))]})),N(!1),f&&j(oe)},me=()=>{N(!1)},fe=(f,g)=>{if(i)return;let W;const ie=f==="teamA"?"teamAMembers":"teamBMembers";b(de=>{const J=[...de[ie]];W=J[g];const ge=J.filter((Te,ve)=>ve!==g);return{...de,[ie]:ge}}),M("メンバーを削除しました","success",{actionLabel:"元に戻す",onAction:()=>{W&&b(de=>{const J=[...de[ie]];return J.splice(g,0,W),{...de,[ie]:J}})},autoHideDuration:5e3})},he=()=>{i||(K(""),z(""),Z([]),m(!0))},C=()=>{const f=oe==="teamA"?t.teamA:t.teamB;f&&r(f,{id:wi(),no:Number(I),name:Y,positions:Q}),m(!1)},D=()=>{m(!1)},n=(f,g,W)=>{i||b(ie=>{const de=f==="teamA"?"teamAMembers":"teamBMembers",J=[...ie[de]],ge={...J[g]},Te=[...ge.statuses||Array(ie.sets.length).fill("")],ve=Te[W]||"";let Be="";return ve===""?Be="starter":ve==="starter"?Be="libero":Be="",Te[W]=Be,ge.statuses=Te,J[g]=ge,{...ie,[de]:J}})},x=()=>X(p?"matchMembersRowMobile":"matchMembersRowDesktop",ne,()=>j(null)),G=f=>{const g=f==="teamA"?t.teamAMembers:t.teamBMembers,W=f,ie=A?"50px 1fr":`40px 1fr ${t.sets.map(()=>"70px").join(" ")}`;return e.jsxs(s,{sx:{maxWidth:1024,mx:"auto",overflowX:"auto"},children:[e.jsxs(s,{sx:{display:"grid",gridTemplateColumns:ie,alignItems:"center",height:50,px:1,borderBottom:1,borderColor:"divider",...Ve},children:[e.jsx(s,{children:"番号"}),e.jsx(s,{children:"名前"}),!A&&t.sets.map((de,J)=>e.jsx(s,{textAlign:"center",children:J+1},J))]}),e.jsx(at,{droppableId:W,children:de=>e.jsxs(s,{ref:de.innerRef,...de.droppableProps,children:[g.map((J,ge)=>e.jsx(ot,{draggableId:`${W}-${J.id}`,index:ge,isDragDisabled:i,children:Te=>{const ve=`${W}-${J.id}`,Be=Te.dragHandleProps,{onPointerDown:Oe,...Ne}=Be||{},nt=Ht($e=>{Oe==null||Oe($e);const ke=B(ve);ke&&(ke.allowTouchMove=!1),ee(ve)});return e.jsx(s,{ref:Te.innerRef,...Te.draggableProps,children:e.jsxs(Ft,{onSwiper:$e=>R(ve,$e),threshold:20,slidesPerView:"auto",style:{overflow:"hidden"},onTouchStart:($e,ke)=>ke.stopPropagation(),onTouchEnd:$e=>L(ve,$e),children:[e.jsx(We,{style:{width:"100%",flex:"0 0 auto"},children:e.jsxs(s,{...Ne,...nt,sx:{display:"grid",gridTemplateColumns:ie,alignItems:"center",height:50,px:1,borderBottom:1,borderColor:"divider",backgroundColor:"background.paper",cursor:i?"default":"grab",touchAction:U===ve?"none":"pan-y"},children:[e.jsx(s,{children:J.no}),e.jsx(s,{children:J.name}),!A&&t.sets.map(($e,ke)=>{var Dt,Bt,jt,ht,$t,bt;return e.jsx(s,{sx:{textAlign:"center"},children:e.jsx(xe,{size:"small",variant:(Dt=J.statuses)!=null&&Dt[ke]?"contained":"outlined",color:((Bt=J.statuses)==null?void 0:Bt[ke])==="starter"?"primary":void 0,sx:{minWidth:32,width:32,p:0,...((jt=J.statuses)==null?void 0:jt[ke])==="starter"?{backgroundColor:"primary.main",color:"#fff","&:hover":{backgroundColor:"primary.main"}}:((ht=J.statuses)==null?void 0:ht[ke])==="libero"?{backgroundColor:"#FF9933",color:"#fff","&:hover":{backgroundColor:"#FF9933"},"&.Mui-focusVisible":{outline:"2px solid #FF9933"}}:{}},onClick:()=>n(f,ge,ke),disabled:i,children:(($t=J.statuses)==null?void 0:$t[ke])==="starter"?"出":((bt=J.statuses)==null?void 0:bt[ke])==="libero"?"リ":"不"})},ke)})]})}),e.jsx(We,{style:{width:ut,flex:"0 0 auto"},children:e.jsx(s,{sx:{height:50,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:i?"grey.500":"error.main"},children:e.jsx(De,{size:"small",disabled:i,onClick:i?void 0:()=>fe(f,ge),children:e.jsx(st,{fontSize:"small",sx:{color:"common.white"}})})})})]})})}},J.id)),de.placeholder]})})]})};return e.jsxs(It,{onDragEnd:l,children:[e.jsxs(wt,{container:!0,spacing:2,children:[e.jsxs(wt,{item:!0,xs:12,children:[e.jsxs(s,{sx:{maxWidth:1024,mx:"auto"},children:[e.jsx(Fe,{variant:"h6",sx:{mb:1},children:h}),e.jsx(xe,{variant:"contained",size:"medium",sx:{mb:1},onClick:()=>E("teamA"),disabled:i,startIcon:e.jsx(Nt,{}),children:"メンバー登録"})]}),e.jsx(Le,{open:T,onClose:()=>le(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:Ee,slotProps:O,title:X("matchMembersSelect",te,()=>le(!1)),children:e.jsx(s,{children:e.jsx(Le,{open:ae==="teamA",onClose:()=>j(null),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:Ee,slotProps:O,title:x(),children:e.jsx(s,{children:p?G("teamA"):e.jsx(xt,{component:et,storageKey:"members-teamA",sx:{maxWidth:1024,mx:"auto"},children:e.jsxs(Ct,{size:"small",children:[e.jsx(St,{children:e.jsxs(qe,{sx:{backgroundColor:f=>f.palette.mode==="dark"?"#343A42":"#f5f5f5",height:50},children:[e.jsx($,{}),e.jsx($,{children:"番号"}),e.jsx($,{children:"名前"}),e.jsx($,{children:"ポジション"}),t.sets.map((f,g)=>e.jsx($,{align:"center",children:g+1},g)),e.jsx($,{})]})}),e.jsx(at,{droppableId:"teamA",children:f=>e.jsxs(Tt,{ref:f.innerRef,...f.droppableProps,children:[t.teamAMembers.map((g,W)=>e.jsx(ot,{draggableId:`teamA-${g.id}`,index:W,isDragDisabled:i,children:ie=>e.jsxs(qe,{ref:ie.innerRef,...ie.draggableProps,"data-index":W,sx:{cursor:i?"default":"pointer",height:50},children:[e.jsx($,{padding:"checkbox",children:e.jsx(s,{onClick:de=>de.stopPropagation(),...ie.dragHandleProps,sx:{cursor:i?"default":"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:e.jsx(Ot,{})})}),e.jsx($,{children:g.no}),e.jsx($,{children:g.name}),e.jsx($,{children:(g.positions||[]).join(", ")}),t.sets.map((de,J)=>{var ge,Te,ve,Be,Oe,Ne;return e.jsx($,{padding:"checkbox",align:"center",children:e.jsx(xe,{size:"small",variant:(ge=g.statuses)!=null&&ge[J]?"contained":"outlined",color:((Te=g.statuses)==null?void 0:Te[J])==="starter"?"primary":void 0,sx:{minWidth:32,width:32,p:0,...((ve=g.statuses)==null?void 0:ve[J])==="starter"?{backgroundColor:"primary.main",color:"#fff","&:hover":{backgroundColor:"primary.main"}}:((Be=g.statuses)==null?void 0:Be[J])==="libero"?{backgroundColor:"#FF9933",color:"#fff","&:hover":{backgroundColor:"#FF9933"},"&.Mui-focusVisible":{outline:"2px solid #FF9933"}}:{}},onClick:()=>n("teamA",W,J),disabled:i,children:((Oe=g.statuses)==null?void 0:Oe[J])==="starter"?"出":((Ne=g.statuses)==null?void 0:Ne[J])==="libero"?"リ":"不"})},J)}),e.jsx($,{padding:"checkbox",children:e.jsx(s,{onClick:de=>de.stopPropagation(),sx:{width:32,height:32,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:e.jsx(De,{size:"small",onClick:i?void 0:()=>fe("teamA",W),disabled:i,sx:{width:24,height:24},children:e.jsx(st,{fontSize:"small",color:i?"disabled":"error"})})})})]})},g.id)),f.placeholder]})})]})})})})})})]}),e.jsxs(wt,{item:!0,xs:12,children:[e.jsxs(s,{sx:{maxWidth:1024,mx:"auto"},children:[e.jsx(Fe,{variant:"h6",sx:{mb:1},children:v}),e.jsx(xe,{variant:"contained",size:"medium",sx:{mb:1},onClick:()=>E("teamB"),disabled:i,startIcon:e.jsx(Nt,{}),children:"メンバー登録"})]}),e.jsx(Le,{open:ae==="teamB",onClose:()=>j(null),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:Ee,slotProps:O,title:x(),children:e.jsx(s,{children:p?G("teamB"):e.jsx(xt,{component:et,storageKey:"members-teamB",sx:{maxWidth:1024,mx:"auto"},children:e.jsxs(Ct,{size:"small",children:[e.jsx(St,{children:e.jsxs(qe,{sx:{backgroundColor:f=>f.palette.mode==="dark"?"#343A42":"#f5f5f5",height:50},children:[e.jsx($,{}),e.jsx($,{children:"番号"}),e.jsx($,{children:"名前"}),e.jsx($,{children:"ポジション"}),t.sets.map((f,g)=>e.jsx($,{align:"center",children:g+1},g)),e.jsx($,{})]})}),e.jsx(at,{droppableId:"teamB",children:f=>e.jsxs(Tt,{ref:f.innerRef,...f.droppableProps,children:[t.teamBMembers.map((g,W)=>e.jsx(ot,{draggableId:`teamB-${g.id}`,index:W,isDragDisabled:i,children:ie=>e.jsxs(qe,{ref:ie.innerRef,...ie.draggableProps,"data-index":W,sx:{cursor:i?"default":"pointer",height:50},children:[e.jsx($,{padding:"checkbox",children:e.jsx(s,{onClick:de=>de.stopPropagation(),...ie.dragHandleProps,sx:{cursor:i?"default":"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:e.jsx(Ot,{})})}),e.jsx($,{children:g.no}),e.jsx($,{children:g.name}),e.jsx($,{children:(g.positions||[]).join(", ")}),t.sets.map((de,J)=>{var ge,Te,ve,Be,Oe,Ne;return e.jsx($,{padding:"checkbox",align:"center",children:e.jsx(xe,{size:"small",variant:(ge=g.statuses)!=null&&ge[J]?"contained":"outlined",color:((Te=g.statuses)==null?void 0:Te[J])==="starter"?"primary":void 0,sx:{minWidth:32,width:32,p:0,...((ve=g.statuses)==null?void 0:ve[J])==="starter"?{backgroundColor:"primary.main",color:"#fff","&:hover":{backgroundColor:"primary.main"}}:((Be=g.statuses)==null?void 0:Be[J])==="libero"?{backgroundColor:"#FF9933",color:"#fff","&:hover":{backgroundColor:"#FF9933"},"&.Mui-focusVisible":{outline:"2px solid #FF9933"}}:{}},onClick:()=>n("teamB",W,J),disabled:i,children:((Oe=g.statuses)==null?void 0:Oe[J])==="starter"?"出":((Ne=g.statuses)==null?void 0:Ne[J])==="libero"?"リ":"不"})},J)}),e.jsx($,{padding:"checkbox",children:e.jsx(s,{onClick:de=>de.stopPropagation(),sx:{width:32,height:32,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:e.jsx(De,{size:"small",onClick:i?void 0:()=>fe("teamB",W),disabled:i,sx:{width:24,height:24},children:e.jsx(st,{fontSize:"small",color:i?"disabled":"error"})})})})]})},g.id)),f.placeholder]})})]})})})})]})]}),e.jsxs(At,{open:se,onClose:me,children:[e.jsx(it,{children:"メンバー選択"}),e.jsxs(rt,{children:[e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end",mb:1},children:e.jsx(Le,{open:V,onClose:()=>H(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom-start",TransitionComponent:Ee,slotProps:{...O,popper:{disablePortal:!0,sx:{zIndex:f=>f.zIndex.tooltip}}},title:X("memberSelectAdd",S,()=>H(!1)),children:e.jsx("span",{children:e.jsx(xe,{onClick:he,variant:"contained",startIcon:e.jsx(Lt,{}),disabled:i||!(oe==="teamA"?t.teamA:t.teamB),children:"追加"})})})}),e.jsx(Le,{open:Me,onClose:()=>a(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:Ee,slotProps:{...O,popper:{disablePortal:!0,sx:{zIndex:f=>f.zIndex.tooltip}}},title:X("memberSelectList",P,()=>a(!1)),children:e.jsx(xt,{component:et,storageKey:`members-select-${oe}`,children:e.jsxs(Ct,{size:"small",children:[e.jsx(St,{children:e.jsxs(qe,{sx:{backgroundColor:f=>f.palette.mode==="dark"?"#343A42":"#f5f5f5",height:50},children:[e.jsx($,{padding:"checkbox"}),!A&&e.jsx($,{children:"番号"}),e.jsx($,{children:"名前"}),!A&&e.jsx($,{children:"ポジション"})]})}),e.jsx(Tt,{children:w.map(f=>{const g=we.some(W=>W.id===f.id);return e.jsxs(qe,{sx:{cursor:"pointer",height:50},onClick:()=>F(f),children:[e.jsx($,{padding:"checkbox",onClick:W=>W.stopPropagation(),children:e.jsx(Gs,{checked:g,onChange:()=>F(f)})}),!A&&e.jsx($,{children:f.no}),e.jsx($,{children:f.name}),!A&&e.jsx($,{children:(f.positions||[]).join(", ")})]},f.id)})})]})})})]}),e.jsxs(lt,{children:[e.jsx(xe,{onClick:me,startIcon:e.jsx(tt,{}),color:"inherit",children:"キャンセル"}),e.jsx(xe,{onClick:_,disabled:we.length===0,startIcon:e.jsx(Je,{}),children:"OK"})]})]}),e.jsxs(At,{open:pe,onClose:D,children:[e.jsx(it,{children:"メンバー追加"}),e.jsxs(rt,{children:[e.jsx(Se,{label:"番号",type:"number",value:I,onChange:f=>K(f.target.value),fullWidth:!0,margin:"dense"}),e.jsx(Se,{label:"名前",value:Y,onChange:f=>z(f.target.value),fullWidth:!0,margin:"dense"}),e.jsxs(_e,{fullWidth:!0,margin:"dense",children:[e.jsx(Re,{id:"md-positions-label",children:"ポジション"}),e.jsxs(ze,{labelId:"md-positions-label",multiple:!0,value:Q,label:"ポジション",onChange:f=>Z(typeof f.target.value=="string"?f.target.value.split(","):f.target.value),renderValue:f=>f.join(", "),children:[e.jsx(ce,{value:"レフト",children:"レフト"}),e.jsx(ce,{value:"センター",children:"センター"}),e.jsx(ce,{value:"ライト",children:"ライト"}),e.jsx(ce,{value:"セッター",children:"セッター"}),e.jsx(ce,{value:"リベロ",children:"リベロ"})]})]})]}),e.jsxs(lt,{children:[e.jsx(xe,{onClick:D,startIcon:e.jsx(tt,{}),color:"inherit",children:"キャンセル"}),e.jsx(xe,{onClick:C,disabled:I==="",startIcon:e.jsx(Je,{}),children:"OK"})]})]})]})}function Ii({match:t,setMatch:b,tags:h,onAddTag:v,locked:u}){return e.jsx(s,{sx:{maxWidth:1024,mx:"auto"},children:e.jsx(wt,{container:!0,spacing:2,children:e.jsx(wt,{item:!0,xs:12,children:e.jsxs(et,{elevation:0,sx:{},children:[e.jsx(Se,{label:"試合日付",type:"date",InputLabelProps:{shrink:!0},value:t.date,onChange:r=>b(i=>({...i,date:r.target.value})),fullWidth:!0,margin:"dense",disabled:u,sx:{"& .MuiOutlinedInput-root":{height:56},"& .MuiOutlinedInput-input":{padding:"0 14px",height:"100%",lineHeight:"56px",fontSize:"1rem",textAlign:"left"},'& input[type="date"]':{WebkitAppearance:"none"}}}),e.jsx(Se,{label:"試合名",value:t.matchName,onChange:r=>b(i=>({...i,matchName:r.target.value})),fullWidth:!0,margin:"dense",disabled:u}),e.jsx(qt,{multiple:!0,freeSolo:!0,options:h,getOptionLabel:r=>typeof r=="string"?r:r.name,value:t.tags.map(r=>h.find(i=>i.id===r)).filter(Boolean),onChange:(r,i)=>{const M=[];i.forEach(y=>{if(typeof y=="string"){const p={id:crypto.randomUUID(),name:y,color:Ke};v(p),M.push(p.id)}else M.push(y.id)}),b(y=>({...y,tags:M}))},renderTags:(r,i)=>r.map((M,y)=>{const{key:p,...A}=i({index:y});return e.jsx(Ye,{...A,label:M.name,sx:{backgroundColor:M.color||Ke,color:"#fff",mr:.5,mb:.5}},p)}),renderInput:r=>e.jsx(Se,{...r,label:"タグ",margin:"dense"}),fullWidth:!0,disabled:u}),e.jsxs(Ss,{severity:"info",sx:{mt:1},children:["試合タグは上記項目にて直接入力するか、設定＞タグメニューにて追加できます",e.jsx("br",{}),"試合にタグを設定することにより、試合を横串で集計することが可能となります"]}),e.jsx(Se,{label:"場所",value:t.location,onChange:r=>b(i=>({...i,location:r.target.value})),fullWidth:!0,margin:"dense",disabled:u}),e.jsx(Se,{label:"主審",value:t.mainReferee,onChange:r=>b(i=>({...i,mainReferee:r.target.value})),fullWidth:!0,margin:"dense",disabled:u}),e.jsx(Se,{label:"副審",value:t.subReferee,onChange:r=>b(i=>({...i,subReferee:r.target.value})),fullWidth:!0,margin:"dense",disabled:u}),e.jsx(Se,{label:"動画URL",value:t.videoUrl,onChange:r=>b(i=>({...i,videoUrl:r.target.value})),multiline:!0,rows:3,fullWidth:!0,margin:"dense",disabled:u}),e.jsx(Se,{label:"メモ",value:t.memo,onChange:r=>b(i=>({...i,memo:r.target.value})),multiline:!0,rows:3,fullWidth:!0,margin:"dense",disabled:u})]})})})})}function Mi({match:t,setMatch:b,teams:h,locked:v}){return e.jsxs(et,{elevation:0,sx:{},children:[e.jsxs(_e,{fullWidth:!0,margin:"dense",disabled:v,children:[e.jsx(Re,{id:"teamA-label",children:"チームA"}),e.jsx(ze,{labelId:"teamA-label",value:t.teamA,label:"チームA",onChange:u=>b(r=>({...r,teamA:u.target.value,teamAMembers:[]})),disabled:v,children:h.map(u=>e.jsx(ce,{value:u.id,children:u.name},u.id))})]}),e.jsx(Se,{label:"チームA監督",value:t.teamAHeadCoach,onChange:u=>b(r=>({...r,teamAHeadCoach:u.target.value})),fullWidth:!0,margin:"dense",disabled:v}),e.jsx(Se,{label:"チームAコーチ",value:t.teamACoach,onChange:u=>b(r=>({...r,teamACoach:u.target.value})),fullWidth:!0,margin:"dense",disabled:v}),e.jsx(Se,{label:"チームAマネージャー",value:t.teamAManager,onChange:u=>b(r=>({...r,teamAManager:u.target.value})),fullWidth:!0,margin:"dense",disabled:v}),e.jsx(Se,{label:"チームAキャプテン",value:t.teamACaptain,onChange:u=>b(r=>({...r,teamACaptain:u.target.value})),fullWidth:!0,margin:"dense",disabled:v}),e.jsxs(_e,{fullWidth:!0,margin:"dense",disabled:v,children:[e.jsx(Re,{id:"teamB-label",children:"チームB"}),e.jsx(ze,{labelId:"teamB-label",value:t.teamB,label:"チームB",onChange:u=>b(r=>({...r,teamB:u.target.value,teamBMembers:[]})),disabled:v,children:h.map(u=>e.jsx(ce,{value:u.id,children:u.name},u.id))})]}),e.jsx(Se,{label:"チームB監督",value:t.teamBHeadCoach,onChange:u=>b(r=>({...r,teamBHeadCoach:u.target.value})),fullWidth:!0,margin:"dense",disabled:v}),e.jsx(Se,{label:"チームBコーチ",value:t.teamBCoach,onChange:u=>b(r=>({...r,teamBCoach:u.target.value})),fullWidth:!0,margin:"dense",disabled:v}),e.jsx(Se,{label:"チームBマネージャー",value:t.teamBManager,onChange:u=>b(r=>({...r,teamBManager:u.target.value})),fullWidth:!0,margin:"dense",disabled:v}),e.jsx(Se,{label:"チームBキャプテン",value:t.teamBCaptain,onChange:u=>b(r=>({...r,teamBCaptain:u.target.value})),fullWidth:!0,margin:"dense",disabled:v})]})}const Di=rn.create(s),Bi=()=>typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():Math.random().toString(36).slice(2)+Date.now().toString(36);function Ei({match:t,onSave:b,teams:h,teamMembers:v,playDetails:u,playCategories:r,statsSettings:i,rallyCategoryTags:M,rallyDetailTags:y,themeSetting:p,scoreInputSetting:A,onAddMember:L,setAppBarAction:R,setAppBarLeftAction:B,onDirtyChange:O,tags:X,onAddTag:U}){const ee=en(),te=tn(),[T,le]=o.useState("info"),ne=!1;o.useEffect(()=>{const d=te.pathname.split("/").filter(Boolean);if(d[0]!=="matches"||d[1]!==t.id)return;const k=d[2]??"info";k==="setinfo"?(le("info"),ee(`/matches/${t.id}/info`,{replace:!0})):(le(k),d[2]||ee(`/matches/${t.id}/info`,{replace:!0}))},[te.pathname,ee,t.id,ne]);const ae=o.useCallback(d=>{const k=d.teamA,q=d.teamB,re=(Ce,be)=>!!be&&(v[Ce]||[]).some(ue=>ue.id===be&&ue.visible!==!1),je=(Ce,be)=>be.filter(ue=>re(Ce,ue.id)).map(ue=>{const He=(v[Ce]||[]).find(ct=>ct.id===ue.id);return He?{...ue,no:He.no,name:He.name,positions:He.positions}:ue});return{...d,teamAMembers:je(k,d.teamAMembers),teamBMembers:je(q,d.teamBMembers),sets:d.sets.map(Ce=>({...Ce,rallies:Ce.rallies.map(be=>({...be,server:re(be.serverTeam==="teamA"?k:q,be.server)?be.server:void 0,teamAMember:re(k,be.teamAMember)?be.teamAMember:void 0,teamBMember:re(q,be.teamBMember)?be.teamBMember:void 0}))}))}},[v]),[j,se]=o.useState(()=>ae({...t,tags:t.tags||[],matchStatsSettings:t.matchStatsSettings||[],teamAMembers:t.teamAMembers.map(d=>({...d,statuses:d.statuses??Array(t.sets.length).fill("")})),teamBMembers:t.teamBMembers.map(d=>({...d,statuses:d.statuses??Array(t.sets.length).fill("")}))})),N=5,pe=[Bs,$s,Ps,ks,_s],m=!!t.locked,I=Mt(),K=fs(I.breakpoints.up("sm")),Y=fs(I.breakpoints.down("sm")),[z,Q]=o.useState(!1),[Z,oe]=o.useState(!1),ye=200,we=56,[c,S]=o.useState(!1),P=I.palette.text.secondary,V=o.useCallback(()=>{z?(oe(!1),Q(!1)):(Q(!0),K||oe(!0))},[z,K]),H=o.useCallback(d=>{d.propertyName==="width"&&K&&z&&oe(!0)},[K,z]);o.useEffect(()=>{K||(Q(!1),oe(!1))},[K]),o.useEffect(()=>(B(e.jsx(Le,{open:c,onClose:()=>S(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom-end",TransitionComponent:Ee,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${P}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${P}`}}}},title:e.jsxs(s,{sx:{p:1,maxWidth:260},children:[e.jsxs(Fe,{variant:"body2",sx:{whiteSpace:"pre-line"},children:[e.jsx(js,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),Ze.setReorder.text]}),e.jsx(s,{sx:{textAlign:"right",mt:1},children:e.jsx(Qe,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem("tutorial-set-reorder","1"),S(!1)},children:"了解した"})})]}),children:e.jsx(De,{color:"inherit",onClick:V,children:e.jsx(js,{})})})),()=>B(null)),[B,V,c,P]);const[Me,a]=o.useState(!1),[l,w]=o.useState(!1),[E,F]=o.useState(null),[_,me]=o.useState(!1),[fe,he]=o.useState({open:!1,message:"",severity:"success"}),C=(d,k,q)=>{he({open:!0,message:d,severity:k,...q})},D=`matchDraft-${t.id}`,n=o.useRef(!1),[x,G]=o.useState(!1),[f,g]=o.useState(!1),[W,ie]=o.useState(null),de=o.useCallback(d=>{ie(d.currentTarget)},[]),J=o.useCallback(()=>{ie(null)},[]),[ge,Te]=o.useState({}),ve=o.useCallback((d,k,q=!0)=>{se(re=>{const je=[...re.sets],Ce=je.findIndex(ue=>ue.id===d);if(Ce===-1)return re;const be=je[Ce];return q&&Te(ue=>{const He=ue[d]||{undo:[]};return{...ue,[d]:{undo:[...He.undo,be],redo:[]}}}),je[Ce]=k,{...re,sets:je}})},[]),Be=o.useCallback(()=>{if(!/^[0-9]+$/.test(T))return;const d=Number(T)-1,k=j.sets[d],q=ge[k.id];if(!q||q.undo.length===0)return;const re=q.undo[q.undo.length-1];Te(je=>({...je,[k.id]:{undo:q.undo.slice(0,-1),redo:[...q.redo,k]}})),ve(k.id,re,!1)},[T,j.sets,ge,ve]),Oe=o.useCallback(()=>{if(!/^[0-9]+$/.test(T))return;const d=Number(T)-1,k=j.sets[d],q=ge[k.id];if(!q||q.redo.length===0)return;const re=q.redo[q.redo.length-1];Te(je=>({...je,[k.id]:{undo:[...q.undo,k],redo:q.redo.slice(0,-1)}})),ve(k.id,re,!1)},[T,j.sets,ge,ve]),Ne=d=>{if(!d.destination||m)return;const k=d.source.index,q=d.destination.index;if(k===q)return;const re=Array.from(j.sets),[je]=re.splice(k,1);re.splice(q,0,je);const Ce=He=>He.map(ct=>{const Pe=Array.from(ct.statuses||[]),[pt]=Pe.splice(k,1);return Pe.splice(q,0,pt),{...ct,statuses:Pe}}),be=Ce(j.teamAMembers),ue=Ce(j.teamBMembers);se(He=>({...He,sets:re,teamAMembers:be,teamBMembers:ue}))};o.useEffect(()=>{Te(d=>{const k={...d};return Object.keys(k).forEach(q=>{j.sets.some(re=>re.id===q)||delete k[q]}),k})},[j.sets]),o.useEffect(()=>{se(d=>ae(d))},[ae]);const nt=d=>{var k;return((k=h.find(q=>q.id===d))==null?void 0:k.name)||""},$e=o.useMemo(()=>j.date!==t.date||j.matchName!==t.matchName||j.location!==t.location||j.mainReferee!==t.mainReferee||j.subReferee!==t.subReferee||j.videoUrl!==t.videoUrl||j.memo!==t.memo||j.teamA!==t.teamA||j.teamAHeadCoach!==t.teamAHeadCoach||j.teamACoach!==t.teamACoach||j.teamAManager!==t.teamAManager||j.teamACaptain!==t.teamACaptain||j.teamB!==t.teamB||j.teamBHeadCoach!==t.teamBHeadCoach||j.teamBCoach!==t.teamBCoach||j.teamBManager!==t.teamBManager||j.teamBCaptain!==t.teamBCaptain||JSON.stringify(j.tags)!==JSON.stringify(t.tags)||JSON.stringify(j.teamAMembers)!==JSON.stringify(t.teamAMembers)||JSON.stringify(j.teamBMembers)!==JSON.stringify(t.teamBMembers)||JSON.stringify(j.matchStatsSettings||[])!==JSON.stringify(t.matchStatsSettings||[])||JSON.stringify(j.sets)!==JSON.stringify(t.sets),[j,t]);o.useEffect(()=>{const d=localStorage.getItem(D);if(m){d&&localStorage.removeItem(D),me(!1);return}d&&me(!0)},[D,m]),o.useEffect(()=>{if(!n.current){n.current=!0,m&&localStorage.removeItem(D);return}if(m){localStorage.removeItem(D);return}$e?localStorage.setItem(D,JSON.stringify(j)):localStorage.removeItem(D)},[j,$e,D,m]);const ke=()=>{if(m||j.sets.length>=N)return;j.sets.length===1&&!localStorage.getItem("tutorial-set-reorder")&&S(!0);const d={id:Bi(),my:0,opponent:0,rallies:[]},k=j.sets.length+1;se(q=>({...q,sets:[...q.sets,d],teamAMembers:q.teamAMembers.map(re=>({...re,statuses:[...re.statuses||[],""]})),teamBMembers:q.teamBMembers.map(re=>({...re,statuses:[...re.statuses||[],""]}))})),le(String(k)),ee(`/matches/${t.id}/${k}`)},Dt=d=>{m||(F(d),w(!0))},Bt=()=>{if(E===null)return;const d=E,k=j.sets.length;let q=[],re=[],je=[];const Ce=T;let be=T;if(T!=="info"&&T!=="members"&&T!=="stats"&&T!=="setinfo"){const ue=Number(T)-1;ue===d?d>0?(be=String(d),ee(`/matches/${t.id}/${d}`)):k>1?(be="1",ee(`/matches/${t.id}/1`)):(be="info",ee(`/matches/${t.id}/info`)):ue>d&&(be=String(ue),ee(`/matches/${t.id}/${ue}`))}le(be),se(ue=>{q=ue.sets.map(Pe=>({...Pe})),re=ue.teamAMembers.map(Pe=>({...Pe,statuses:Pe.statuses?[...Pe.statuses]:[]})),je=ue.teamBMembers.map(Pe=>({...Pe,statuses:Pe.statuses?[...Pe.statuses]:[]}));const He=ue.sets.filter((Pe,pt)=>pt!==d),ct=Pe=>Pe.map(pt=>({...pt,statuses:(pt.statuses||[]).filter((Pi,Ks)=>Ks!==d)}));return{...ue,sets:He,teamAMembers:ct(ue.teamAMembers),teamBMembers:ct(ue.teamBMembers)}}),F(null),w(!1),C("セットを削除しました","success",{actionLabel:"元に戻す",onAction:()=>{se(ue=>({...ue,sets:q,teamAMembers:re,teamBMembers:je})),Ce!=="info"&&Ce!=="members"&&Ce!=="stats"&&Ce!=="setinfo"&&ee(`/matches/${t.id}/${Ce}`)},autoHideDuration:5e3})},jt=()=>{F(null),w(!1)},ht=o.useCallback(()=>{a(!0)},[]),$t=async()=>{const d=ae(j);se(d);try{await Promise.resolve(b(d)),localStorage.removeItem(D),C("保存しました","success")}catch{C("保存に失敗しました","error")}a(!1)},bt=()=>{a(!1)},Ls=()=>{he(d=>({...d,open:!1}))},Es=()=>{const d=localStorage.getItem(D);if(!d){me(!1);return}try{const k=JSON.parse(d),q={...k,tags:k.tags||[],matchStatsSettings:k.matchStatsSettings||[],teamAMembers:k.teamAMembers.map(je=>({...je,statuses:je.statuses??Array(k.sets.length).fill("")})),teamBMembers:k.teamBMembers.map(je=>({...je,statuses:je.statuses??Array(k.sets.length).fill("")}))},re=ae(q);se(re),b(re)}catch{}localStorage.removeItem(D),me(!1)},ms=()=>{localStorage.removeItem(D),me(!1)},Ge=o.useMemo(()=>/^[0-9]+$/.test(T),[T]),mt=o.useMemo(()=>Ge?j.sets[Number(T)-1]:null,[Ge,T,j.sets]),yt=o.useMemo(()=>{var d;return!Ge||m||!mt||!((d=ge[mt.id])!=null&&d.undo.length)},[Ge,m,mt,ge]),vt=o.useMemo(()=>{var d;return!Ge||m||!mt||!((d=ge[mt.id])!=null&&d.redo.length)},[Ge,m,mt,ge]);o.useEffect(()=>{yt?G(!1):localStorage.getItem("tutorial-undo")||G(!0)},[yt]),o.useEffect(()=>{vt?g(!1):localStorage.getItem("tutorial-redo")||g(!0)},[vt]),o.useEffect(()=>{if(Y){const d=x?"undo":f?"redo":null;R(e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Le,{open:!!d,onClose:()=>{d==="undo"?G(!1):d==="redo"&&g(!1)},disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:Ee,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${P}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${P}`}}}},title:e.jsx(s,{sx:{p:1,maxWidth:260},children:d==="undo"?e.jsxs(e.Fragment,{children:[e.jsxs(Fe,{variant:"body2",sx:{whiteSpace:"pre-line"},children:["メニューから",e.jsx(kt,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),Ze.undoMobile.text]}),e.jsx(s,{sx:{textAlign:"right",mt:1},children:e.jsx(Qe,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem("tutorial-undo","1"),G(!1)},children:"了解した"})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(Fe,{variant:"body2",sx:{whiteSpace:"pre-line"},children:["メニューから",e.jsx(_t,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),Ze.redoMobile.text]}),e.jsx(s,{sx:{textAlign:"right",mt:1},children:e.jsx(Qe,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem("tutorial-redo","1"),g(!1)},children:"了解した"})})]})}),children:e.jsx(De,{color:"inherit",onClick:de,children:e.jsx(Rs,{})})}),e.jsxs(Xs,{anchorEl:W,open:!!W,onClose:J,MenuListProps:{onClick:J},children:[Ge&&e.jsxs(e.Fragment,{children:[e.jsxs(ce,{onClick:Be,disabled:yt,children:[e.jsx(ft,{children:e.jsx(kt,{fontSize:"small"})}),e.jsx(gt,{children:"元に戻す"})]}),e.jsxs(ce,{onClick:Oe,disabled:vt,children:[e.jsx(ft,{children:e.jsx(_t,{fontSize:"small"})}),e.jsx(gt,{children:"やり直す"})]})]}),e.jsxs(ce,{onClick:ht,disabled:!$e||m,children:[e.jsx(ft,{children:e.jsx(Je,{fontSize:"small"})}),e.jsx(gt,{children:"保存"})]})]})]}))}else R(e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[Ge&&e.jsxs(e.Fragment,{children:[e.jsx(Le,{open:x,onClose:()=>G(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:Ee,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${P}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${P}`}}}},title:e.jsxs(s,{sx:{p:1,maxWidth:260},children:[e.jsx(Fe,{variant:"body2",sx:{whiteSpace:"pre-line"},children:Ze.undoDesktop.text}),e.jsx(s,{sx:{textAlign:"right",mt:1},children:e.jsx(Qe,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem("tutorial-undo","1"),G(!1)},children:"了解した"})})]}),children:e.jsx(De,{onClick:Be,disabled:yt,color:"inherit",sx:{ml:1},children:e.jsx(kt,{})})}),e.jsx(Le,{open:f,onClose:()=>g(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:Ee,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${P}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${P}`}}}},title:e.jsxs(s,{sx:{p:1,maxWidth:260},children:[e.jsx(Fe,{variant:"body2",sx:{whiteSpace:"pre-line"},children:Ze.redoDesktop.text}),e.jsx(s,{sx:{textAlign:"right",mt:1},children:e.jsx(Qe,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem("tutorial-redo","1"),g(!1)},children:"了解した"})})]}),children:e.jsx(De,{onClick:Oe,disabled:vt,color:"inherit",sx:{ml:1},children:e.jsx(_t,{})})})]}),e.jsx(xe,{onClick:ht,variant:"contained",disabled:!$e||m,startIcon:e.jsx(Je,{}),sx:{ml:1},children:"保存"})]}));return()=>R(null)},[R,Y,W,de,J,Ge,Be,Oe,ht,$e,m,yt,vt,x,f,P]),o.useEffect(()=>(O==null||O($e),()=>O==null?void 0:O(!1)),[$e,O]);const Ws=[{key:"info",label:"試合概要",icon:e.jsx(sn,{})},{key:"team",label:"チーム",icon:e.jsx(Ds,{})},{key:"members",label:"メンバー登録",icon:e.jsx(Is,{})},{key:"sep1",divider:!0},{key:"stats",label:"スタッツ",icon:e.jsx(nn,{})},{key:"sep2",divider:!0},{key:"setinfo",label:"セット情報",icon:e.jsx(Ms,{})}].filter(d=>d.key!=="setinfo"),Us=j.sets.map((d,k)=>{const q=pe[k];return{key:`${k+1}`,icon:e.jsx(q,{}),label:`${d.my}-${d.opponent}`}}),Vs=!m&&j.sets.length<N?[{key:"add",label:"セット追加",icon:e.jsx(Lt,{})}]:[],Et=d=>{d==="add"?ke():(le(d),ee(`/matches/${t.id}/${d}`)),K||(oe(!1),Q(!1))},qs=e.jsxs(Di,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},sx:{flexGrow:1,overflowY:"auto",display:"flex",flexDirection:"column"},children:[T==="info"&&e.jsx(Ii,{match:j,setMatch:se,tags:X,onAddTag:U,locked:m}),T==="members"&&e.jsx(Ai,{match:j,setMatch:se,teamAName:nt(j.teamA)||"チームA",teamBName:nt(j.teamB)||"チームB",teamMembers:v,onAddMember:L,locked:m,showSnackbar:C}),T==="stats"&&e.jsx(vi,{sets:j.sets,playDetails:u,playCategories:r,statsSettings:i,matchStatsSettings:j.matchStatsSettings||[],onMatchStatsSettingsChange:d=>se(k=>({...k,matchStatsSettings:d})),rallyCategoryTags:M,rallyDetailTags:y,teamAName:nt(j.teamA),teamBName:nt(j.teamB),locked:m,showSnackbar:C}),T==="team"&&e.jsx(s,{sx:{maxWidth:1024,mx:"auto"},children:e.jsx(Mi,{match:j,setMatch:se,teams:h,locked:m})}),ne,T!=="info"&&T!=="members"&&T!=="stats"&&T!=="setinfo"&&T!=="team"&&e.jsx(fi,{setScore:j.sets[Number(T)-1],playDetails:u,playCategories:r,teamAMembers:j.teamAMembers,teamBMembers:j.teamBMembers,teamAName:nt(j.teamA),teamBName:nt(j.teamB),locked:m,scoreInputSetting:A,themeSetting:p,onChange:d=>ve(d.id,d),showSnackbar:C})]},T);return e.jsxs(s,{sx:{display:"flex",height:"100%"},children:[e.jsx(Ys,{variant:K?"permanent":"temporary",open:K?!0:z,onClose:()=>{oe(!1),Q(!1)},PaperProps:{onTransitionEnd:H},ModalProps:{keepMounted:!0,BackdropProps:{sx:{backgroundColor:"rgba(0, 0, 0, 0.5)"}}},sx:{width:K?z?ye:we:ye,flexShrink:0,transition:I.transitions.create("width",{easing:I.transitions.easing.sharp,duration:I.transitions.duration.standard}),...K?{zIndex:I.zIndex.appBar-1}:{},"& .MuiDrawer-paper":{width:K?z?ye:we:ye,boxSizing:"border-box",overflowX:"hidden",transition:I.transitions.create("width",{easing:I.transitions.easing.sharp,duration:I.transitions.duration.standard}),...K?{top:I.mixins.toolbar.minHeight,height:`calc(100% - ${I.mixins.toolbar.minHeight}px)`,zIndex:I.zIndex.appBar-1}:{}}},children:e.jsxs(Qs,{children:[Ws.map(d=>d.divider?e.jsx(Zs,{component:"li"},d.key):e.jsxs(Ut,{selected:T===d.key,onClick:()=>Et(d.key),sx:{minHeight:48,justifyContent:z?"initial":"center",px:2.5},children:[e.jsx(ft,{sx:{minWidth:0,mr:z?3:0,justifyContent:"center"},children:d.icon}),e.jsx(gt,{primary:d.label??`セット${d.key}`,sx:{opacity:Z?1:0,display:Z?"block":"none",whiteSpace:"nowrap"}})]},d.key)),e.jsx(It,{onDragEnd:Ne,children:e.jsx(at,{droppableId:"drawer-sets",children:d=>e.jsxs(s,{ref:d.innerRef,...d.droppableProps,children:[Us.map((k,q)=>e.jsx(ot,{draggableId:j.sets[q].id,index:q,children:re=>e.jsxs(Ut,{ref:re.innerRef,...re.draggableProps,...re.dragHandleProps,style:re.draggableProps.style,selected:T===k.key,onClick:()=>Et(k.key),sx:{minHeight:48,justifyContent:z?"initial":"center",px:2.5},children:[e.jsx(ft,{sx:{minWidth:0,mr:z?3:0,justifyContent:"center"},children:k.icon}),e.jsx(gt,{primary:k.label??`セット${k.key}`,sx:{opacity:Z?1:0,display:Z?"block":"none",whiteSpace:"nowrap"}}),!m&&z&&e.jsx(De,{edge:"end",onClick:je=>{je.stopPropagation(),Dt(q)},children:e.jsx(st,{})})]})},j.sets[q].id)),d.placeholder]})})}),Vs.map(d=>e.jsxs(Ut,{selected:T===d.key,onClick:()=>Et(d.key),sx:{minHeight:48,justifyContent:z?"initial":"center",px:2.5},children:[e.jsx(ft,{sx:{minWidth:0,mr:z?3:0,justifyContent:"center"},children:d.icon}),e.jsx(gt,{primary:d.label??`セット${d.key}`,sx:{opacity:Z?1:0,display:Z?"block":"none",whiteSpace:"nowrap"}})]},d.key))]})}),e.jsxs(s,{sx:{flexGrow:1,display:"flex",flexDirection:"column",width:K?`calc(100% - ${z?ye:we}px)`:"100%",transition:K?I.transitions.create("width",{duration:I.transitions.duration.standard}):void 0},children:[e.jsx(s,{sx:{flexGrow:1,position:"relative",overflowY:"hidden",display:"flex",width:"100%"},children:e.jsx(ln,{mode:"wait",children:qs})}),e.jsxs(Vt,{open:l,onClose:jt,children:[e.jsx(it,{children:"削除確認"}),e.jsx(rt,{sx:{mt:2},children:"このセットを削除しますか？"}),e.jsxs(lt,{children:[e.jsx(xe,{onClick:jt,startIcon:e.jsx(tt,{}),color:"inherit",children:"キャンセル"}),e.jsx(xe,{onClick:Bt,color:"error",startIcon:e.jsx(Je,{}),children:"OK"})]})]}),e.jsxs(Vt,{open:_,onClose:ms,children:[e.jsx(it,{children:"復元確認"}),e.jsx(rt,{sx:{mt:2},children:"入力途中のデータが存在します。復元しますか？"}),e.jsxs(lt,{children:[e.jsx(xe,{onClick:ms,startIcon:e.jsx(tt,{}),color:"inherit",children:"いいえ"}),e.jsx(xe,{onClick:Es,startIcon:e.jsx(Je,{}),children:"はい"})]})]}),e.jsxs(Vt,{open:Me,onClose:bt,children:[e.jsx(it,{children:"保存確認"}),e.jsx(rt,{sx:{mt:2},children:"入力内容を保存しますか？"}),e.jsxs(lt,{children:[e.jsx(xe,{onClick:bt,startIcon:e.jsx(tt,{}),color:"inherit",children:"キャンセル"}),e.jsx(xe,{onClick:$t,disabled:!$e||m,startIcon:e.jsx(Je,{}),children:"OK"})]})]}),e.jsx(Ts,{open:fe.open,message:fe.message,severity:fe.severity,onClose:Ls,actionLabel:fe.actionLabel,onAction:fe.onAction,autoHideDuration:fe.autoHideDuration})]})]})}export{Ei as default};
