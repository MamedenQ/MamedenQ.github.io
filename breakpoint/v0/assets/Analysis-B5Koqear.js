const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/GraphDialog-CiVzr97s.js","assets/mui-vendor-DBE-HG4E.js","assets/react-vendor-QLNaZ7XN.js","assets/index-Cw67aUCJ.js","assets/motion-vendor-ArpBbMV7.js","assets/index-DZWGvWwf.css","assets/chart-vendor-OsQvonB5.js"])))=>i.map(i=>d[i]);
import{u as Cs,c as Vs,R as Es,i as de,b as Ls,S as As,e as Xs,g as Qs,h as Is,D as Js,f as as,d as rs,a as Ps,A as Ys,r as fs,m as Zs,_ as en}from"./index-Cw67aUCJ.js";import{j as e,E as is,G as os,X as Me,F as be,K as ve,S as Te,M as $,W as ds,C as ce,r as le,A as sn,f as Os,B as p,ac as Ds,I as Ve,g as zs,h as Us,k as ze,l as I,m as Bs,H as cs,i as hs,a as nn,b as tn,y as ws,ad as ls,U as Ss,a2 as ln,a3 as an,a5 as rn,a0 as on,a1 as dn,d as ks,e as Ke,D as cn}from"./mui-vendor-DBE-HG4E.js";import{r as a}from"./react-vendor-QLNaZ7XN.js";import{D as _s,C as Ms,P as Rs,u as un,d as fn,a as hn}from"./useLongPress-DU9mAExN.js";import{d as pn}from"./SpaceDashboardOutlined-zB6gU8LF.js";import{m as xn,A as gn}from"./motion-vendor-ArpBbMV7.js";import"./chart-vendor-OsQvonB5.js";function mn({open:L,playCategories:f,playDetails:m,rallyCategoryTags:b,rallyDetailTags:v,initialData:u,onCancel:S,onSave:j}){const[x,w]=a.useState(""),[T,Y]=a.useState(""),[V,H]=a.useState([]),[C,F]=a.useState([]),[A,G]=a.useState(""),[D,Ie]=a.useState(""),[O,ue]=a.useState(""),[i,De]=a.useState("合算"),[J,ee]=a.useState([]),[re,fe]=a.useState({open:!1,message:"",severity:"success"}),he=Cs("md"),pe=Cs("sm"),{handleTouchEnd:Xe,setSwiperRef:we,getSwiperRef:Ue}=Vs(),[xe,Be]=a.useState(""),$e=()=>{fe(n=>({...n,open:!1}))},We=n=>{if(xe){const y=Ue(xe);y&&(y.allowTouchMove=!0),Be("")}if(!n.destination)return;const l=Array.from(J),[d]=l.splice(n.source.index,1);l.splice(n.destination.index,0,d),ee(l)};a.useEffect(()=>{L&&(w((u==null?void 0:u.name)||""),ee((u==null?void 0:u.items)||[]),Y(""),H([]),F([]),G(""),Ie(""),ue(""),De("合算"))},[L,u]);const Se=T!=="",He=V.length>0,ge=A!=="",z=C.length>0,N=D!=="",X=O!=="",me=Se?He||z?!1:ge?!N&&!X:!0:He||z?!(Se||ge):ge?!1:!!(N||X),Fe=()=>{if(!i||!me)return;const n={id:crypto.randomUUID(),method:i};T?n.playCategoryId=T:V.length>0&&(n.playCategoryTags=V),A&&(n.playDetailId=A),C.length>0&&(n.playDetailTags=C),D&&(n.pointType=D),O&&(n.pointUnitType=O),ee(l=>[...l,n]),Y(""),H([]),G(""),F([]),Ie(""),ue("")},ie=n=>{ee(l=>{const d=l.findIndex(P=>P.id===n);if(d===-1)return l;const y=[...l],[k]=y.splice(d,1);return fe({open:!0,message:"項目を削除しました",severity:"success",actionLabel:"元に戻す",onAction:()=>{ee(P=>{const _=[...P];return _.splice(d,0,k),_})},autoHideDuration:5e3}),y})},Re=()=>{if(!x||J.length===0)return;const n={id:(u==null?void 0:u.id)||crypto.randomUUID(),name:x,items:J};j(n)},je=T?m.filter(n=>n.playCategoryId===T&&n.visible!==!1):[],Ee=n=>m.filter(l=>{var y,k;const d=f.find(P=>P.id===l.playCategoryId);return!(l.visible===!1||(d==null?void 0:d.visible)===!1||n.playCategoryId&&l.playCategoryId!==n.playCategoryId||n.playCategoryTags&&n.playCategoryTags.length>0&&!((y=d==null?void 0:d.tags)!=null&&y.some(P=>{var _;return(_=n.playCategoryTags)==null?void 0:_.includes(P)}))||n.playDetailId&&l.id!==n.playDetailId||n.playDetailTags&&n.playDetailTags.length>0&&!((k=l.tags)!=null&&k.some(P=>{var _;return(_=n.playDetailTags)==null?void 0:_.includes(P)}))||n.pointType&&l.pointType!==n.pointType||n.pointUnitType&&l.pointUnitType!==n.pointUnitType)}),Ge=n=>{var l;return n.playCategoryTags&&n.playCategoryTags.length>0?n.playCategoryTags.map(d=>{var y;return((y=b.find(k=>k.id===d))==null?void 0:y.name)||d}).join(","):((l=f.find(d=>d.id===n.playCategoryId))==null?void 0:l.name)||""},ye=n=>{var l;return n.playDetailTags&&n.playDetailTags.length>0?n.playDetailTags.map(d=>{var y;return((y=v.find(k=>k.id===d))==null?void 0:y.name)||d}).join(","):n.playDetailId&&((l=m.find(d=>d.id===n.playDetailId))==null?void 0:l.name)||""},Le=n=>[Ge(n),ye(n),n.pointType||"",n.pointUnitType||"",n.method].join(","),ke=n=>Ee(n).length===0,Ne=J.some(ke);return e.jsxs(e.Fragment,{children:[e.jsxs(Es,{open:L,onClose:S,children:[e.jsx(is,{children:"カスタム分析追加"}),e.jsxs(os,{children:[e.jsx(Me,{label:"カスタム分析名",margin:"dense",value:x,onChange:n=>w(n.target.value),fullWidth:!0}),e.jsxs(be,{fullWidth:!0,margin:"dense",disabled:V.length>0||C.length>0,children:[e.jsx(ve,{id:"category",children:"プレー区分"}),e.jsxs(Te,{labelId:"category",value:T,label:"プレー区分",onChange:n=>{const l=n.target.value;Y(l),G(""),F([]),l&&H([])},children:[e.jsx($,{value:"",children:"指定なし"}),f.filter(n=>n.visible!==!1).map(n=>e.jsx($,{value:n.id,children:n.name},n.id))]})]}),e.jsxs(be,{fullWidth:!0,margin:"dense",disabled:!!D||!!O||V.length>0||C.length>0,children:[e.jsx(ve,{id:"detail",children:"プレー詳細"}),e.jsxs(Te,{labelId:"detail",value:A,label:"プレー詳細",onChange:n=>{G(n.target.value),n.target.value&&(Ie(""),ue(""),H([]),F([]))},children:[e.jsx($,{value:"",children:"指定なし"}),je.map(n=>e.jsx($,{value:n.id,children:n.name},n.id))]})]}),e.jsx(ds,{multiple:!0,options:b,getOptionLabel:n=>n.name,value:b.filter(n=>V.includes(n.id)),onChange:(n,l)=>{H(l.map(d=>d.id)),l.length>0&&(Y(""),G(""))},renderTags:(n,l)=>n.map((d,y)=>a.createElement(ce,{...l({index:y}),key:d.id,label:d.name,size:"small",sx:{backgroundColor:d.color||de,color:"#fff"}})),renderInput:n=>e.jsx(Me,{...n,label:"プレー区分タグ",margin:"dense"}),disabled:!!T||!!A,fullWidth:!0}),e.jsx(ds,{multiple:!0,options:v,getOptionLabel:n=>n.name,value:v.filter(n=>C.includes(n.id)),onChange:(n,l)=>{F(l.map(d=>d.id)),l.length>0&&(Y(""),G(""))},renderTags:(n,l)=>n.map((d,y)=>a.createElement(ce,{...l({index:y}),key:d.id,label:d.name,size:"small",sx:{backgroundColor:d.color||de,color:"#fff"}})),renderInput:n=>e.jsx(Me,{...n,label:"プレー詳細タグ",margin:"dense"}),disabled:!!T||!!A,fullWidth:!0}),e.jsxs(be,{fullWidth:!0,disabled:!!A,margin:"dense",children:[e.jsx(ve,{id:"ptype",children:"得失点区分"}),e.jsxs(Te,{labelId:"ptype",value:D,label:"得失点区分",onChange:n=>{Ie(n.target.value),n.target.value&&G("")},children:[e.jsx($,{value:"",children:"指定なし"}),e.jsx($,{value:"得点",children:"得点"}),e.jsx($,{value:"失点",children:"失点"})]})]}),e.jsxs(be,{fullWidth:!0,disabled:!!A,margin:"dense",children:[e.jsx(ve,{id:"punittype",children:"得失点単位区分"}),e.jsxs(Te,{labelId:"punittype",value:O,label:"得失点単位区分",onChange:n=>{ue(n.target.value),n.target.value&&G("")},children:[e.jsx($,{value:"",children:"指定なし"}),e.jsx($,{value:"メンバー",children:"メンバー"}),e.jsx($,{value:"チーム",children:"チーム"})]})]}),e.jsxs(be,{fullWidth:!0,margin:"dense",children:[e.jsx(ve,{id:"method",children:"集計方法"}),e.jsxs(Te,{labelId:"method",value:i,label:"集計方法",onChange:n=>De(n.target.value),children:[e.jsx($,{value:"合算",children:"合算"}),e.jsx($,{value:"試合平均",children:"試合平均"}),e.jsx($,{value:"セット平均",children:"セット平均"})]})]}),e.jsx(le,{variant:"contained",onClick:Fe,size:"medium",disabled:!me,fullWidth:!0,startIcon:e.jsx(Ls,{}),sx:{mt:1},children:"追加"}),J.length>0&&e.jsxs(e.Fragment,{children:[Ne&&e.jsx(sn,{severity:"error",sx:{mb:1},children:"分析条件に合致するプレー区分、または、プレー詳細が存在しません（赤背景行）"}),e.jsx(As,{component:Os,storageKey:"custom-analysis-dialog",children:he?e.jsx(_s,{onDragEnd:We,children:e.jsx(Ms,{droppableId:"custom-analysis-items",children:n=>e.jsxs(p,{ref:n.innerRef,...n.droppableProps,children:[e.jsx(p,{sx:{display:"grid",gridTemplateColumns:pe?"1fr":"150px 1fr 110px 130px 110px",alignItems:"center",height:50,px:1,borderBottom:1,borderColor:"divider",...Xs,lineHeight:1},children:pe?e.jsx(p,{children:"分析項目"}):e.jsxs(e.Fragment,{children:[e.jsx(p,{children:"プレー区分"}),e.jsx(p,{children:"プレー詳細"}),e.jsx(p,{children:"得点区分"}),e.jsx(p,{children:"得失点単位区分"}),e.jsx(p,{children:"集計方法"})]})}),J.map((l,d)=>{const y=ke(l);return e.jsx(Rs,{draggableId:l.id,index:d,children:k=>{const P=k.dragHandleProps,{onPointerDown:_,...M}=P||{},R=un(U=>{_==null||_(U);const Z=Ue(l.id);Z&&(Z.allowTouchMove=!1),Be(l.id)});return e.jsx(p,{ref:k.innerRef,...k.draggableProps,style:k.draggableProps.style,children:e.jsxs(Qs,{onSwiper:U=>we(l.id,U),threshold:20,slidesPerView:"auto",style:{overflow:"hidden"},onTouchStart:(U,Z)=>Z.stopPropagation(),onTouchEnd:U=>Xe(l.id,U),children:[e.jsx(Is,{style:{width:"100%",flex:"0 0 auto"},children:e.jsx(p,{...M,...R,sx:{display:"grid",gridTemplateColumns:pe?"1fr":"150px 1fr 110px 130px 110px",alignItems:"center",height:50,px:1,borderBottom:1,borderColor:"divider",bgcolor:U=>y?Ds(U.palette.error.main,.1):U.palette.background.paper,lineHeight:1,touchAction:xe===l.id?"none":"pan-y",cursor:"grab"},children:pe?e.jsx(p,{children:Le(l)}):e.jsxs(e.Fragment,{children:[e.jsx(p,{sx:{pr:1},children:Ge(l)}),e.jsx(p,{sx:{pr:1},children:ye(l)}),e.jsx(p,{sx:{pr:1},children:l.pointType||""}),e.jsx(p,{sx:{pr:1},children:l.pointUnitType||""}),e.jsx(p,{children:l.method})]})})}),e.jsx(Is,{style:{width:Js,flex:"0 0 auto"},children:e.jsx(p,{sx:{height:50,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"error.main"},children:e.jsx(Ve,{size:"small",onClick:()=>ie(l.id),children:e.jsx(as,{fontSize:"small",sx:{color:"common.white"}})})})})]})})}},l.id)}),n.placeholder]})})}):e.jsxs(zs,{size:"small",sx:{"& .MuiTableRow-root":{height:50}},children:[e.jsx(Us,{children:e.jsxs(ze,{sx:{backgroundColor:n=>n.palette.mode==="dark"?"#343A42":"#f5f5f5"},children:[e.jsx(I,{}),e.jsx(I,{children:"プレー区分"}),e.jsx(I,{children:"プレー詳細"}),e.jsx(I,{children:"得失点区分"}),e.jsx(I,{children:"得失点単位区分"}),e.jsx(I,{children:"集計方法"}),e.jsx(I,{})]})}),e.jsx(_s,{onDragEnd:We,children:e.jsx(Ms,{droppableId:"custom-analysis-items",children:n=>e.jsxs(Bs,{ref:n.innerRef,...n.droppableProps,children:[J.map((l,d)=>{const y=ke(l);return e.jsx(Rs,{draggableId:l.id,index:d,children:k=>{var P,_;return e.jsxs(ze,{ref:k.innerRef,...k.draggableProps,sx:{backgroundColor:y?M=>Ds(M.palette.error.main,.1):void 0},children:[e.jsx(I,{padding:"checkbox",children:e.jsx(p,{...k.dragHandleProps,sx:{cursor:"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:e.jsx(fn,{fontSize:"small"})})}),e.jsx(I,{children:l.playCategoryTags&&l.playCategoryTags.length>0?l.playCategoryTags.map(M=>{const R=b.find(Z=>Z.id===M),U=(R==null?void 0:R.color)||de;return e.jsx(ce,{label:(R==null?void 0:R.name)||M,size:"small",sx:{mr:.5,mb:.5,backgroundColor:U,color:"#fff"}},M)}):(P=f.find(M=>M.id===l.playCategoryId))==null?void 0:P.name}),e.jsx(I,{children:l.playDetailTags&&l.playDetailTags.length>0?l.playDetailTags.map(M=>{const R=v.find(Z=>Z.id===M),U=(R==null?void 0:R.color)||de;return e.jsx(ce,{label:(R==null?void 0:R.name)||M,size:"small",sx:{mr:.5,mb:.5,backgroundColor:U,color:"#fff"}},M)}):l.playDetailId?(_=m.find(M=>M.id===l.playDetailId))==null?void 0:_.name:""}),e.jsx(I,{children:l.pointType||""}),e.jsx(I,{children:l.pointUnitType||""}),e.jsx(I,{children:l.method}),e.jsx(I,{children:e.jsx(Ve,{size:"small",onClick:()=>ie(l.id),children:e.jsx(as,{fontSize:"small",color:"error"})})})]})}},l.id)}),n.placeholder]})})})]})})]})]}),e.jsxs(cs,{children:[e.jsx(le,{onClick:S,startIcon:e.jsx(rs,{}),color:"inherit",children:"キャンセル"}),e.jsx(le,{onClick:Re,disabled:!x||J.length===0,startIcon:e.jsx(Ps,{}),children:"OK"})]})]}),e.jsx(Ys,{open:re.open,message:re.message,severity:re.severity,actionLabel:re.actionLabel,onAction:re.onAction,autoHideDuration:re.autoHideDuration,onClose:$e})]})}var ps={},jn=hs;Object.defineProperty(ps,"__esModule",{value:!0});var us=ps.default=void 0,yn=jn(fs()),bn=e;us=ps.default=(0,yn.default)((0,bn.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search");var xs={},vn=hs;Object.defineProperty(xs,"__esModule",{value:!0});var $s=xs.default=void 0,Tn=vn(fs()),Cn=e;$s=xs.default=(0,Tn.default)((0,Cn.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Clear");var gs={},In=hs;Object.defineProperty(gs,"__esModule",{value:!0});var Ws=gs.default=void 0,Dn=In(fs()),wn=e;Ws=gs.default=(0,Dn.default)((0,wn.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM5.92 19H5v-.92l9.06-9.06.92.92zM20.71 5.63l-2.34-2.34c-.2-.2-.45-.29-.71-.29s-.51.1-.7.29l-1.83 1.83 3.75 3.75 1.83-1.83c.39-.39.39-1.02 0-1.41"}),"CreateOutlined");const Sn=a.lazy(()=>en(()=>import("./GraphDialog-CiVzr97s.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),Ce="__TEAM__",kn=xn.create(p);function _n(L,f){let m=0,b=0,v=0,u=0;return L.sets.forEach(S=>{const j=f==="teamA"?S.my:S.opponent,x=f==="teamA"?S.opponent:S.my;v+=j,u+=x,j>x?m+=1:j<x&&(b+=1)}),m>b?"win":m<b?"lose":v>u?"win":v<u?"lose":"draw"}function Mn(L,f,m,b,v,u,S){return L.filter(j=>{if(f!=="ALL"){if(!(j.teamA===f||j.teamB===f)||m&&!(j.teamA===f&&j.teamB===m||j.teamA===m&&j.teamB===f))return!1;if(u){const w=j.teamA===f?"teamA":"teamB";if(_n(j,w)!==u)return!1}}else if(m&&j.teamA!==m&&j.teamB!==m)return!1;return!(b&&j.date!==b||v&&!j.matchName.includes(v)||S&&S.length>0&&!S.every(x=>j.tags.includes(x)))})}function Rn(L,f){const m=f==="teamA"?L.my:L.opponent,b=f==="teamA"?L.opponent:L.my;return m>b?"win":m<b?"lose":"draw"}function En(L,f,m,b,v){const u={},S=(x,w,T)=>{u[x]||(u[x]={}),u[x][w]||(u[x][w]={}),u[x][w][T]=(u[x][w][T]||0)+1},j=(x,w)=>!!w&&(b[x]||[]).some(T=>T.id===w&&T.visible!==!1);return L.forEach(x=>{const w=(T,Y)=>{x.sets.forEach(V=>{v&&Rn(V,Y)!==v||V.rallies.forEach(H=>{const C=Y==="teamA"?H.teamAPlayDetail:H.teamBPlayDetail,F=Y==="teamA"?H.teamAMember:H.teamBMember;if(!C)return;const A=m.get(C);(A==null?void 0:A.pointUnitType)==="チーム"?S(T,Ce,C):(A==null?void 0:A.pointUnitType)==="メンバー"&&(j(T,F)?S(T,F,C):S(T,Ce,C))})})};f==="ALL"?(x.teamA&&w(x.teamA,"teamA"),x.teamB&&w(x.teamB,"teamB")):x.teamA===f?w(f,"teamA"):x.teamB===f&&w(f,"teamB")}),u}function $n({matches:L,teams:f,teamMembers:m,playCategories:b,playDetails:v,customAnalyses:u,onCustomAnalysesChange:S,tags:j,rallyCategoryTags:x,rallyDetailTags:w,themeSetting:T,showSnackbar:Y,setAppBarAction:V,setAppBarLeftAction:H}){var Ts;const C=((Ts=f[0])==null?void 0:Ts.id)||"",[F,A]=a.useState(0),G=s=>{A(s)},[D,Ie]=a.useState("member"),[O,ue]=a.useState("asc"),[i,De]=a.useState({left:C,right:"",date:"",name:"",tags:[]}),[J,ee]=a.useState(!1),[re,fe]=a.useState(!1),[he,pe]=a.useState(null),[Xe,we]=a.useState(!1),[Ue,xe]=a.useState(!1),[Be,$e]=a.useState(""),[We,Se]=a.useState([]),[He,ge]=a.useState(""),z=nn(),N=tn(z.breakpoints.up("sm")),[X,me]=a.useState(!1),[Fe,ie]=a.useState(!1),Re=56,je=200,Ee=a.useCallback(()=>{X?(ie(!1),me(!1)):(me(!0),N||ie(!0))},[X,N]),Ge=a.useCallback(s=>{s.target===s.currentTarget&&(X?ie(!0):(me(!1),ie(!1)))},[X]),[ye,Le]=a.useState(f.length>0?f[0].id:""),[ke,Ne]=a.useState(""),[n,l]=a.useState(""),[d,y]=a.useState(""),[k,P]=a.useState(""),[_,M]=a.useState(""),[R,U]=a.useState([]),Z=a.useMemo(()=>new Map(v.map(s=>[s.id,s])),[v]),Hs=a.useCallback(()=>{De({left:C,right:"",date:"",name:"",tags:[],matchResult:void 0,setResult:void 0})},[C]),Fs=a.useMemo(()=>i.left===C&&i.right===""&&i.date===""&&i.name===""&&i.tags.length===0&&i.matchResult===void 0&&i.setResult===void 0,[i,C]);a.useEffect(()=>{!i.left&&C&&De(s=>({...s,left:C})),!ye&&C&&Le(C)},[C,i.left,ye]),a.useEffect(()=>{J&&(Le(i.left),Ne(i.right),l(i.date),y(i.name),P(i.matchResult||""),M(i.setResult||""),U(i.tags))},[J,i]),a.useEffect(()=>(V(e.jsx(le,{color:"inherit",startIcon:e.jsx(us,{}),onClick:()=>ee(!0),children:"詳細検索"})),()=>V(null)),[V]),a.useEffect(()=>(H(e.jsx(Ve,{color:"inherit",onClick:Ee,children:e.jsx(pn,{})})),()=>H(null)),[H,Ee]);const qe=a.useMemo(()=>Mn(L,i.left,i.right,i.date,i.name,i.matchResult,i.tags),[L,i]),se=a.useMemo(()=>{const s=i.setResult;return En(qe,i.left,Z,m,s)},[qe,i,Z,m]),Qe=qe.length,Je=qe.reduce((s,t)=>s+t.sets.length,0),W=i.left,ms=a.useMemo(()=>W==="ALL"?f.map(s=>s.id):[W],[W,f]),ae=a.useMemo(()=>b.filter(s=>s.visible!==!1),[b]),Q=F>=ae.length,Ye=Q?F-ae.length:-1,q=Q?u[Ye]:null,Ae=Q?void 0:ae[F],_e=Q?[]:v.filter(s=>s.playCategoryId===(Ae==null?void 0:Ae.id)&&s.visible!==!1),Gs=!Q&&_e.length>0&&_e.every(s=>s.pointUnitType==="チーム"),Ze=a.useMemo(()=>[...ae.map(s=>({key:s.id,label:s.name})),...u.map(s=>({key:s.id,label:s.name})),{key:"add",label:"分析追加"}],[ae,u]),es=a.useCallback(s=>{var t;return((t=f.find(r=>r.id===s))==null?void 0:t.name)||""},[f]),Pe=a.useCallback(s=>v.filter(t=>{var c,o;const r=b.find(h=>h.id===t.playCategoryId);return!(t.visible===!1||(r==null?void 0:r.visible)===!1||s.playCategoryId&&t.playCategoryId!==s.playCategoryId||s.playCategoryTags&&s.playCategoryTags.length>0&&!((c=r==null?void 0:r.tags)!=null&&c.some(h=>{var g;return(g=s.playCategoryTags)==null?void 0:g.includes(h)}))||s.playDetailId&&t.id!==s.playDetailId||s.playDetailTags&&s.playDetailTags.length>0&&!((o=t.tags)!=null&&o.some(h=>{var g;return(g=s.playDetailTags)==null?void 0:g.includes(h)}))||s.pointType&&t.pointType!==s.pointType||s.pointUnitType&&t.pointUnitType!==s.pointUnitType)}),[v,b]),oe=a.useCallback((s,t,r)=>{let c=0;return Pe(r).forEach(h=>{var g,K;c+=((K=(g=se[s])==null?void 0:g[t])==null?void 0:K[h.id])||0}),r.method==="試合平均"?c=Qe?c/Qe:0:r.method==="セット平均"&&(c=Je?c/Je:0),c},[se,Qe,Je,Pe]),js=s=>{const t=Pe(s);return t.length>0&&t.every(r=>r.pointUnitType==="チーム")},ys=s=>{var c,o;const t=[];s.playCategoryId?t.push(((c=b.find(h=>h.id===s.playCategoryId))==null?void 0:c.name)||""):s.playCategoryTags&&s.playCategoryTags.length>0&&t.push(s.playCategoryTags.join(",")),s.playDetailId?t.push(((o=v.find(h=>h.id===s.playDetailId))==null?void 0:o.name)||""):s.playDetailTags&&s.playDetailTags.length>0&&t.push(s.playDetailTags.join(","));const r=[s.pointType,s.pointUnitType].filter(Boolean).join(",");return r&&t.push(r),t.length>0?`${t.join(" / ")} (${s.method})`:`(${s.method})`},bs=a.useMemo(()=>ms.flatMap(s=>(m[s]||[]).filter(t=>t.visible!==!1).map(t=>({teamId:s,member:t}))),[ms,m]),Ns=a.useMemo(()=>{const s=[],t=i.left==="ALL"?"全チーム":es(i.left);s.push(`分析対象チーム：${t}`),i.left!=="ALL"&&i.right&&i.right!==""&&s.push(`対戦相手チーム：${es(i.right)}`),i.date&&s.push(`試合日付：${i.date}`),i.name&&s.push(`試合名：${i.name}`),i.matchResult==="win"?s.push("勝ち試合"):i.matchResult==="lose"&&s.push("負け試合"),i.setResult==="win"?s.push("勝ちセット"):i.setResult==="lose"&&s.push("負けセット");const r=s.join("、");return i.tags.length>0?e.jsxs(e.Fragment,{children:[r,"、タグ：",i.tags.map(c=>{const o=j.find(g=>g.id===c),h=(o==null?void 0:o.color)||de;return e.jsx(ce,{label:(o==null?void 0:o.name)||c,size:"small",sx:{ml:.5,backgroundColor:h,color:"#fff"}},c)})]}):r},[i,j,es]),Oe=a.useMemo(()=>{const s=new Map;return u.forEach(t=>{t.items.forEach(r=>{Pe(r).length>0&&s.set(r.id,r)})}),s},[u,Pe]),ne=a.useMemo(()=>q?q.items.filter(s=>Oe.has(s.id)):[],[q,Oe]),qs=a.useMemo(()=>{const s=[...bs];return s.sort((t,r)=>{var h,g,K,E;let c="",o="";if(D==="member")c=t.member.name,o=r.member.name;else if(Oe.has(D)){const B=Oe.get(D);c=oe(t.teamId,t.member.id,B),o=oe(r.teamId,r.member.id,B)}else c=((g=(h=se[t.teamId])==null?void 0:h[t.member.id])==null?void 0:g[D])||0,o=((E=(K=se[r.teamId])==null?void 0:K[r.member.id])==null?void 0:E[D])||0;return c<o?O==="asc"?-1:1:c>o?O==="asc"?1:-1:0}),s},[bs,D,O,se,Oe,oe]),te=a.useMemo(()=>{var c;if(W==="ALL")return null;if(Q&&q){const o={};return ne.forEach(g=>{o[g.id]=0}),(m[W]||[]).filter(g=>g.visible!==!1).forEach(g=>{ne.forEach(K=>{o[K.id]+=oe(W,g.id,K)})}),ne.forEach(g=>{o[g.id]+=oe(W,Ce,g)}),o}const s={};(m[W]||[]).filter(o=>o.visible!==!1).forEach(o=>{var g;const h=((g=se[W])==null?void 0:g[o.id])||{};Object.entries(h).forEach(([K,E])=>{s[K]=(s[K]||0)+E})});const r=((c=se[W])==null?void 0:c[Ce])||{};return Object.entries(r).forEach(([o,h])=>{s[o]=(s[o]||0)+h}),s},[W,m,se,Q,q,ne,oe]),ss=s=>{D===s?ue(O==="asc"?"desc":"asc"):(Ie(s),ue("asc"))},vs=(s,t,r)=>{var c;if(Q&&q){let o=[];t===Ce&&s===W&&te?o=ne.map(h=>({label:ys(h),value:te[h.id]||0})):o=ne.map(h=>({label:ys(h),value:oe(s,t,h)})),$e(r),ge(q.name),Se(o),xe(!0)}else if(Ae){let o={};t===Ce&&s===W&&te?o=te:o=((c=se[s])==null?void 0:c[t])||{};const h=_e.map(g=>({label:g.name,value:o[g.id]||0}));$e(r),ge(Ae.name),Se(h),xe(!0)}},Ks=e.jsxs(kn,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},sx:{display:"flex",flexDirection:"column",flexGrow:1},children:[e.jsxs(p,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(p,{sx:{display:"flex",alignItems:"center",gap:1,flexGrow:1,minWidth:0,overflow:"hidden"},children:e.jsx(ws,{component:"div",variant:"body2",noWrap:!0,sx:{overflow:"hidden",textOverflow:"ellipsis"},children:Ns})}),e.jsx(Ve,{size:"small",onClick:Hs,disabled:Fs,children:e.jsx($s,{})})]}),Q&&e.jsxs(p,{sx:{display:"flex",alignItems:"center",mb:1,gap:1},children:[e.jsx(ws,{sx:{flexGrow:1,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:q==null?void 0:q.name}),e.jsx(le,{variant:"contained",size:"medium",onClick:()=>{pe(Ye),fe(!0)},startIcon:e.jsx(hn,{}),children:"編集"}),e.jsx(le,{variant:"contained",size:"medium",color:"error",onClick:()=>we(!0),startIcon:e.jsx(as,{}),children:"削除"})]}),e.jsx(As,{component:Os,storageKey:"analysis-list",sx:{flexGrow:1},children:e.jsxs(zs,{size:"small",sx:{"& th, & td":{textAlign:"center",verticalAlign:"middle"},"& .MuiTableRow-root":{height:50}},children:[e.jsx(Us,{children:e.jsxs(ze,{sx:{backgroundColor:s=>s.palette.mode==="dark"?"#343A42":"#f5f5f5"},children:[e.jsx(I,{align:"center",sortDirection:D==="member"?O:!1,children:e.jsx(ls,{active:D==="member",direction:D==="member"?O:"asc",onClick:()=>ss("member"),children:"メンバー"})}),Q&&q?ne.map(s=>{var h,g,K;const t=s.playCategoryId&&((h=b.find(E=>E.id===s.playCategoryId))==null?void 0:h.name)||"",r=s.playDetailId&&((g=v.find(E=>E.id===s.playDetailId))==null?void 0:g.name)||"",c=s.playDetailId?(K=v.find(E=>E.id===s.playDetailId))==null?void 0:K.pointType:void 0,o=[s.pointType,s.pointUnitType].filter(Boolean).join(",");return e.jsx(I,{align:"center",sortDirection:D===s.id?O:!1,children:e.jsx(ls,{active:D===s.id,direction:D===s.id?O:"asc",onClick:()=>ss(s.id),children:e.jsxs(p,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[s.playCategoryTags&&s.playCategoryTags.length>0?e.jsx(p,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center"},children:s.playCategoryTags.map(E=>{const B=x.find(ts=>ts.id===E),ns=(B==null?void 0:B.color)||de;return e.jsx(ce,{label:(B==null?void 0:B.name)||E,size:"small",sx:{mr:.5,mb:.5,backgroundColor:ns,color:"#fff"}},E)})}):t&&e.jsx("span",{children:t}),s.playDetailTags&&s.playDetailTags.length>0?e.jsx(p,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center"},children:s.playDetailTags.map(E=>{const B=w.find(ts=>ts.id===E),ns=(B==null?void 0:B.color)||de;return e.jsx(ce,{label:(B==null?void 0:B.name)||E,size:"small",sx:{mr:.5,mb:.5,backgroundColor:ns,color:"#fff"}},E)})}):r&&e.jsx(p,{component:"span",sx:{color:c==="得点"?T.scoreColor:c==="失点"?T.lossColor:void 0},children:r}),o&&e.jsx("span",{children:o}),e.jsxs("span",{children:["(",s.method,")"]})]})})},s.id)}):_e.map(s=>e.jsx(I,{align:"center",sortDirection:D===s.id?O:!1,sx:{color:s.pointType==="得点"?T.scoreColor:s.pointType==="失点"?T.lossColor:"inherit"},children:e.jsx(ls,{active:D===s.id,direction:D===s.id?O:"asc",onClick:()=>ss(s.id),children:s.name})},s.id))]})}),e.jsxs(Bs,{children:[W!=="ALL"&&e.jsxs(ze,{children:[e.jsx(I,{align:"center",children:e.jsx(Ss,{component:"button",underline:"hover",onClick:()=>vs(W,Ce,"チーム集計"),children:"チーム集計"})}),Q&&q?ne.map(s=>e.jsx(I,{align:"center",children:(te==null?void 0:te[s.id])||0},s.id)):_e.map(s=>e.jsx(I,{align:"center",children:(te==null?void 0:te[s.id])||0},s.id))]}),(Q&&q?ne.some(s=>!js(s)):!Gs)&&qs.map(({teamId:s,member:t})=>e.jsxs(ze,{children:[e.jsx(I,{align:"center",children:e.jsx(Ss,{component:"button",underline:"hover",onClick:()=>vs(s,t.id,t.name),children:t.name})}),Q&&q?ne.map(r=>e.jsx(I,{align:"center",children:js(r)?"－":oe(s,t.id,r)},r.id)):_e.map(r=>{var c,o;return e.jsx(I,{align:"center",children:r.pointUnitType==="チーム"?"－":((o=(c=se[s])==null?void 0:c[t.id])==null?void 0:o[r.id])||0},r.id)})]},`${s}-${t.id}`))]})]})})]},F);return e.jsxs(p,{sx:{display:"flex",height:"100%"},children:[e.jsx(ln,{variant:N?"permanent":"temporary",open:N?!0:X,onClose:()=>{ie(!1),me(!1)},PaperProps:{onTransitionEnd:Ge},ModalProps:{keepMounted:!0,BackdropProps:{sx:{backgroundColor:"rgba(0, 0, 0, 0.5)"}}},sx:{width:N?X?je:Re:je,flexShrink:0,transition:z.transitions.create("width",{easing:z.transitions.easing.sharp,duration:z.transitions.duration.standard}),...N?{zIndex:z.zIndex.appBar-1}:{},"& .MuiDrawer-paper":{width:N?X?je:Re:je,boxSizing:"border-box",overflowX:"hidden",transition:z.transitions.create("width",{easing:z.transitions.easing.sharp,duration:z.transitions.duration.standard}),...N?{top:z.mixins.toolbar.minHeight,height:`calc(100% - ${z.mixins.toolbar.minHeight}px)`,zIndex:z.zIndex.appBar-1}:{}}},children:e.jsx(an,{children:Ze.map((s,t)=>e.jsxs(rn,{selected:t===F,onClick:()=>{t===Ze.length-1?(pe(null),fe(!0)):G(t),N||Ee()},sx:{minHeight:48,justifyContent:X?"initial":"center",px:2.5},children:[e.jsx(on,{sx:{minWidth:0,mr:X?3:0,justifyContent:"center"},children:t===Ze.length-1?e.jsx(Ls,{}):t>=ae.length?e.jsx(Ws,{}):e.jsx(Zs,{})}),e.jsx(dn,{primary:s.label,sx:{opacity:Fe?1:0,display:Fe?"block":"none",whiteSpace:"nowrap"}})]},s.key))})}),e.jsxs(p,{sx:{flexGrow:1,display:"flex",flexDirection:"column",width:N?`calc(100% - ${X?je:Re}px)`:"100%",transition:N?z.transitions.create("width",{duration:z.transitions.duration.standard}):void 0},children:[e.jsx(gn,{mode:"wait",children:Ks}),e.jsxs(Es,{open:J,onClose:()=>ee(!1),children:[e.jsx(is,{children:"詳細検索"}),e.jsxs(os,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(p,{sx:{display:"flex",gap:2},children:[e.jsxs(be,{fullWidth:!0,sx:{flex:1},margin:"dense",children:[e.jsx(ve,{id:"dlg-left",children:"分析チーム"}),e.jsx(Te,{labelId:"dlg-left",value:ye,label:"分析チーム",onChange:s=>{const t=s.target.value;Le(t)},children:f.map(s=>e.jsx($,{value:s.id,children:s.name},s.id))})]}),e.jsxs(be,{fullWidth:!0,sx:{flex:1},margin:"dense",children:[e.jsx(ve,{id:"dlg-right",children:"対戦相手"}),e.jsxs(Te,{labelId:"dlg-right",value:ke,label:"対戦相手",onChange:s=>Ne(s.target.value),children:[e.jsx($,{value:"",children:"指定なし"}),f.map(s=>e.jsx($,{value:s.id,children:s.name},s.id))]})]})]}),e.jsxs(p,{sx:{display:"flex",gap:2},children:[e.jsx(Me,{type:"date",label:"試合日付",margin:"dense",value:n,onChange:s=>l(s.target.value),InputLabelProps:{shrink:!0},fullWidth:!0,sx:{flex:1,"& .MuiOutlinedInput-root":{height:56},"& .MuiOutlinedInput-input":{padding:"0 14px",height:"100%",lineHeight:"56px",fontSize:"1rem",textAlign:"left"},'& input[type="date"]':{WebkitAppearance:"none"}}}),e.jsx(Me,{label:"試合名",margin:"dense",value:d,onChange:s=>y(s.target.value),fullWidth:!0,sx:{flex:1}})]}),e.jsxs(p,{sx:{display:"flex",gap:2,flexDirection:"column"},children:[e.jsxs(ks,{exclusive:!0,value:k,onChange:(s,t)=>P(t),fullWidth:!0,sx:{width:"100%"},children:[e.jsx(Ke,{value:"win",sx:{whiteSpace:"nowrap"},children:"勝ち試合"}),e.jsx(Ke,{value:"lose",sx:{whiteSpace:"nowrap"},children:"負け試合"})]}),e.jsxs(ks,{exclusive:!0,value:_,onChange:(s,t)=>M(t),fullWidth:!0,sx:{width:"100%"},children:[e.jsx(Ke,{value:"win",sx:{whiteSpace:"nowrap"},children:"勝ちセット"}),e.jsx(Ke,{value:"lose",sx:{whiteSpace:"nowrap"},children:"負けセット"})]})]}),e.jsx(p,{sx:{display:"flex",gap:2},children:e.jsx(ds,{multiple:!0,options:j,getOptionLabel:s=>s.name,value:j.filter(s=>R.includes(s.id)),onChange:(s,t)=>U(t.map(r=>r.id)),renderTags:(s,t)=>s.map((r,c)=>e.jsx(ce,{...t({index:c}),label:r.name,size:"small",sx:{backgroundColor:r.color||de,color:"#fff"}})),renderInput:s=>e.jsx(Me,{...s,label:"タグ",margin:"dense"}),fullWidth:!0})})]}),e.jsxs(cs,{children:[e.jsx(le,{onClick:()=>ee(!1),color:"inherit",startIcon:e.jsx(rs,{}),children:"キャンセル"}),e.jsx(le,{onClick:()=>{De({left:ye,right:ke,date:n,name:d,tags:R,matchResult:k||void 0,setResult:_||void 0}),ee(!1)},startIcon:e.jsx(us,{}),children:"検索"})]})]}),e.jsxs(cn,{open:Xe,onClose:()=>we(!1),children:[e.jsx(is,{children:"削除確認"}),e.jsx(os,{sx:{mt:2},children:"このカスタム分析を削除しますか？"}),e.jsxs(cs,{children:[e.jsx(le,{onClick:()=>we(!1),color:"inherit",startIcon:e.jsx(rs,{}),children:"キャンセル"}),e.jsx(le,{onClick:()=>{const s=Ye,t=u[s];S(u.filter((r,c)=>c!==s)),G(0),we(!1),Y("カスタム分析を削除しました","success",{actionLabel:"元に戻す",onAction:()=>{S(r=>{const c=[...r];return c.splice(s,0,t),c}),G(ae.length+s)},autoHideDuration:5e3})},color:"error",startIcon:e.jsx(Ps,{}),children:"OK"})]})]}),e.jsx(mn,{open:re,playCategories:b,playDetails:v,rallyCategoryTags:x,rallyDetailTags:w,initialData:he!==null?u[he]:void 0,onCancel:()=>fe(!1),onSave:s=>{he!==null?(S(u.map((t,r)=>r===he?s:t)),G(ae.length+he)):(S([...u,s]),G(ae.length+u.length)),fe(!1)}}),e.jsx(a.Suspense,{fallback:null,children:e.jsx(Sn,{open:Ue,onClose:()=>xe(!1),memberName:Be,tabName:He,data:We})})]})]})}export{$n as default};
