import{i as Ie,j as e,E as it,G as rt,d as Xe,e as qe,B as s,F as _e,K as Re,S as ze,M as oe,H as lt,r as ue,J as bs,I as De,L as qs,N as ms,a as Mt,O as ys,n as Wt,Q as Pt,R as Ee,Z as We,y as Fe,U as Qe,V as Ks,f as et,g as jt,h as bt,k as Oe,l as C,m as yt,C as Ue,W as qt,X as Ce,A as vs,Y as wt,_ as Js,b as ps,$ as Ns,a0 as ft,a1 as gt,a2 as Gs,a3 as Ys,a4 as Xs,a5 as Ut,D as Vt}from"./mui-vendor-DBE-HG4E.js";import{r as d,f as Qs,u as Zs}from"./react-vendor-QLNaZ7XN.js";import{r as Me,u as dt,R as At,d as tt,a as Ne,B as zt,b as Cs,S as Ss,c as Lt,e as Nt,f as xt,g as Ke,h as st,i as Ft,j as Ve,D as ut,k as Je,A as en}from"./index-CyrVnRqy.js";import{t as Ze,d as tn,a as sn}from"./tooltipMessages-__gkvqJ9.js";import{d as fs}from"./SpaceDashboardOutlined-OarVNFjR.js";import{D as It,C as at,P as ot,d as Ot,u as Ht,a as Kt}from"./useLongPress-CQKDsLck.js";import{m as nn,A as rn}from"./motion-vendor-ArpBbMV7.js";import"./chart-vendor-OsQvonB5.js";var Gt={},ln=Ie;Object.defineProperty(Gt,"__esModule",{value:!0});var Ts=Gt.default=void 0,an=ln(Me()),on=e;Ts=Gt.default=(0,an.default)((0,on.jsx)("path",{d:"M12 5.9c1.16 0 2.1.94 2.1 2.1s-.94 2.1-2.1 2.1S9.9 9.16 9.9 8s.94-2.1 2.1-2.1m0 9c2.97 0 6.1 1.46 6.1 2.1v1.1H5.9V17c0-.64 3.13-2.1 6.1-2.1M12 4C9.79 4 8 5.79 8 8s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4m0 9c-2.67 0-8 1.34-8 4v3h16v-3c0-2.66-5.33-4-8-4"}),"PersonOutlineOutlined");var Yt={},dn=Ie;Object.defineProperty(Yt,"__esModule",{value:!0});var ws=Yt.default=void 0,cn=dn(Me()),un=e;ws=Yt.default=(0,cn.default)((0,un.jsx)("path",{d:"M2 17h2v.5H3v1h1v.5H2v1h3v-4H2zm1-9h1V4H2v1h1zm-1 3h1.8L2 13.1v.9h3v-1H3.2L5 10.9V10H2zm5-6v2h14V5zm0 14h14v-2H7zm0-6h14v-2H7z"}),"FormatListNumberedOutlined");var Xt={},xn=Ie;Object.defineProperty(Xt,"__esModule",{value:!0});var As=Xt.default=void 0,hn=xn(Me()),mn=e;As=Xt.default=(0,hn.default)((0,mn.jsx)("path",{d:"M9 13.75c-2.34 0-7 1.17-7 3.5V19h14v-1.75c0-2.33-4.66-3.5-7-3.5M4.34 17c.84-.58 2.87-1.25 4.66-1.25s3.82.67 4.66 1.25zM9 12c1.93 0 3.5-1.57 3.5-3.5S10.93 5 9 5 5.5 6.57 5.5 8.5 7.07 12 9 12m0-5c.83 0 1.5.67 1.5 1.5S9.83 10 9 10s-1.5-.67-1.5-1.5S8.17 7 9 7m7.04 6.81c1.16.84 1.96 1.96 1.96 3.44V19h4v-1.75c0-2.02-3.5-3.17-5.96-3.44M15 12c1.93 0 3.5-1.57 3.5-3.5S16.93 5 15 5c-.54 0-1.04.13-1.5.35.63.89 1 1.98 1 3.15s-.37 2.26-1 3.15c.46.22.96.35 1.5.35"}),"GroupOutlined");var Qt={},pn=Ie;Object.defineProperty(Qt,"__esModule",{value:!0});var Is=Qt.default=void 0,fn=pn(Me()),gn=e;Is=Qt.default=(0,fn.default)((0,gn.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V5h14zm-7-2h2V7h-4v2h2z"}),"LooksOneOutlined");var Zt={},jn=Ie;Object.defineProperty(Zt,"__esModule",{value:!0});var Ms=Zt.default=void 0,bn=jn(Me()),yn=e;Ms=Zt.default=(0,bn.default)((0,yn.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V5h14zm-4-4h-4v-2h2c1.1 0 2-.89 2-2V9c0-1.11-.9-2-2-2H9v2h4v2h-2c-1.1 0-2 .89-2 2v4h6z"}),"LooksTwoOutlined");var es={},vn=Ie;Object.defineProperty(es,"__esModule",{value:!0});var Ds=es.default=void 0,Cn=vn(Me()),Sn=e;Ds=es.default=(0,Cn.default)((0,Sn.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V5h14zm-4-4v-1.5c0-.83-.67-1.5-1.5-1.5.83 0 1.5-.67 1.5-1.5V9c0-1.11-.9-2-2-2H9v2h4v2h-2v2h2v2H9v2h4c1.1 0 2-.89 2-2"}),"Looks3Outlined");var ts={},Tn=Ie;Object.defineProperty(ts,"__esModule",{value:!0});var Bs=ts.default=void 0,wn=Tn(Me()),An=e;Bs=ts.default=(0,wn.default)((0,An.jsx)("path",{d:"M19.04 3h-14c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16h-14V5h14zm-6-2h2V7h-2v4h-2V7h-2v6h4z"}),"Looks4Outlined");var ss={},In=Ie;Object.defineProperty(ss,"__esModule",{value:!0});var ks=ss.default=void 0,Mn=In(Me()),Dn=e;ks=ss.default=(0,Mn.default)((0,Dn.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V5h14zm-4-4v-2c0-1.11-.9-2-2-2h-2V9h4V7H9v6h4v2H9v2h4c1.1 0 2-.89 2-2"}),"Looks5Outlined");var ns={},Bn=Ie;Object.defineProperty(ns,"__esModule",{value:!0});var $t=ns.default=void 0,kn=Bn(Me()),Pn=e;$t=ns.default=(0,kn.default)((0,Pn.jsx)("path",{d:"M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8"}),"UndoOutlined");var is={},$n=Ie;Object.defineProperty(is,"__esModule",{value:!0});var _t=is.default=void 0,_n=$n(Me()),Rn=e;_t=is.default=(0,_n.default)((0,Rn.jsx)("path",{d:"M18.4 10.6C16.55 8.99 14.15 8 11.5 8c-4.65 0-8.58 3.03-9.96 7.22L3.9 16c1.05-3.19 4.05-5.5 7.6-5.5 1.95 0 3.73.72 5.12 1.88L13 16h9V7z"}),"RedoOutlined");var rs={},zn=Ie;Object.defineProperty(rs,"__esModule",{value:!0});var Ps=rs.default=void 0,Fn=zn(Me()),On=e;Ps=rs.default=(0,Fn.default)((0,On.jsx)("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreVert");function Hn(t,p,u){const b=d.useCallback(i=>{let D=0,j=0;i.rallies.forEach(g=>{if(g.timeoutTeam||g.substitutionTeam)return;const A=p.find(k=>k.id===g.teamAPlayDetail),L=p.find(k=>k.id===g.teamBPlayDetail);(A==null?void 0:A.pointType)==="得点"||(L==null?void 0:L.pointType)==="失点"?D+=1:((L==null?void 0:L.pointType)==="得点"||(A==null?void 0:A.pointType)==="失点")&&(j+=1)}),i.my=D,i.opponent=j},[p]),c=d.useCallback(i=>{const D=[...t.rallies,i],j={...t,rallies:D};b(j),u(j)},[t,b,u]),r=d.useCallback(i=>{const D=t.rallies.filter((g,A)=>A!==i),j={...t,rallies:D};b(j),u(j)},[t,b,u]);return{addRally:c,deleteRally:r,calculateScores:b}}const Ln=d.forwardRef(function({setScore:p,playDetails:u,playCategories:b,teamAMembers:c,teamBMembers:r,teamAName:i,teamBName:D,scoreInputSetting:j,themeSetting:g,locked:A=!1,onAdd:L,onEdit:k},z){var Ae,a,l,w,E,O,R,me;const $=dt("sm"),[G,N]=d.useState(!1),[Q,Z]=d.useState("teamA"),[T,ie]=d.useState(""),[se,re]=d.useState(""),[f,te]=d.useState(""),[ee,B]=d.useState(""),[v,_]=d.useState(""),[U,X]=d.useState(""),[J,xe]=d.useState(""),[le,he]=d.useState(""),[ye,we]=d.useState(null),x=()=>{if(A)return;we(null);const n=[...p.rallies].reverse().find(m=>!m.timeoutTeam&&!m.substitutionTeam);let h="teamA";if(n){const m=u.find(W=>W.id===n.teamAPlayDetail),I=u.find(W=>W.id===n.teamBPlayDetail);(m==null?void 0:m.pointType)==="得点"||(I==null?void 0:I.pointType)==="失点"?h="teamA":((I==null?void 0:I.pointType)==="得点"||(m==null?void 0:m.pointType)==="失点")&&(h="teamB")}Z(h),ie(""),re(""),te(""),B(""),_(""),X(""),xe(""),he(""),N(!0)},S=n=>{var m,I;if(A)return;const h=p.rallies[n];we(n),Z(h.serverTeam||"teamA"),ie(h.server&&(h.serverTeam==="teamA"?c.some(W=>W.id===h.server):r.some(W=>W.id===h.server))?h.server:""),re(((m=u.find(W=>W.id===h.teamAPlayDetail))==null?void 0:m.playCategoryId)||""),B(h.teamAPlayDetail||""),X(c.some(W=>W.id===h.teamAMember)&&h.teamAMember||""),te(((I=u.find(W=>W.id===h.teamBPlayDetail))==null?void 0:I.playCategoryId)||""),_(h.teamBPlayDetail||""),xe(r.some(W=>W.id===h.teamBMember)&&h.teamBMember||""),he(h.timeoutTeam||""),N(!0)};d.useImperativeHandle(z,()=>({openAddDialog:x,openEditDialog:S}));const F=()=>{var W,pe;if(le)return!0;if(j.rallyMemberRequired&&!T||se&&!ee||f&&!v||!!!(se&&ee)&&!!!(f&&v))return!1;const m=(W=u.find(Se=>Se.id===ee))==null?void 0:W.pointUnitType;if(j.rallyMemberRequired&&ee&&m==="メンバー"&&!U)return!1;const I=(pe=u.find(Se=>Se.id===v))==null?void 0:pe.pointUnitType;return!(j.rallyMemberRequired&&v&&I==="メンバー"&&!J)},K=n=>le?{id:n??crypto.randomUUID(),timeoutTeam:le}:{id:n??crypto.randomUUID(),serverTeam:Q,server:T||void 0,teamAPlayDetail:ee||void 0,teamAMember:U||void 0,teamBPlayDetail:v||void 0,teamBMember:J||void 0},H=()=>{if(ye===null)L(K());else{const n=p.rallies[ye].id;k(ye,K(n))}N(!1)};return e.jsxs(At,{open:G,onClose:()=>N(!1),children:[e.jsx(it,{children:ye===null?"ラリー追加":"ラリー編集"}),e.jsxs(rt,{sx:{display:"flex",flexDirection:"column"},children:[e.jsxs(Xe,{exclusive:!0,value:Q,onChange:(n,h)=>h&&Z(h),fullWidth:!0,disabled:!!le,sx:{mb:1},children:[e.jsx(qe,{value:"teamA",sx:{flex:1},children:e.jsx(s,{sx:{whiteSpace:"pre-line",textAlign:"center"},children:`${i||"チームA"}
サーブ`})}),e.jsx(qe,{value:"teamB",sx:{flex:1},children:e.jsx(s,{sx:{whiteSpace:"pre-line",textAlign:"center"},children:`${D||"チームB"}
サーブ`})})]}),e.jsxs(_e,{fullWidth:!0,margin:"dense",required:j.rallyMemberRequired,disabled:!!le,children:[e.jsx(Re,{id:"server",children:"サーバー"}),e.jsx(ze,{labelId:"server",value:T,label:"サーバー",onChange:n=>ie(n.target.value),children:(Q==="teamA"?c:r).map(n=>e.jsx(oe,{value:n.id,children:n.name},n.id))})]}),$?e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(s,{sx:{flex:1,display:"flex",flexDirection:"column",gap:1},children:[e.jsxs(s,{sx:{display:"flex",gap:1,mt:2},children:[e.jsx(Xe,{sx:{flex:1},orientation:"vertical",exclusive:!0,value:se,onChange:(n,h)=>{se===h||h===null?(re(""),B("")):(re(h),B(""))},disabled:!!le,children:b.filter(n=>n.visible!==!1).map(n=>e.jsx(qe,{value:n.id,sx:{whiteSpace:"nowrap"},children:n.name},n.id))}),e.jsx(Xe,{sx:{flex:1},orientation:"vertical",exclusive:!0,value:ee,onChange:(n,h)=>{B(ee===h||h===null?"":h)},disabled:!!le,children:u.filter(n=>n.playCategoryId===se&&n.visible!==!1).map(n=>{const h=n.pointType==="得点"?g.scoreColor:g.lossColor;return e.jsx(qe,{value:n.id,sx:{whiteSpace:"nowrap",color:h,"&.Mui-selected":{color:h}},children:n.name},n.id)})})]}),e.jsxs(_e,{fullWidth:!0,margin:"dense",required:j.rallyMemberRequired&&((Ae=u.find(n=>n.id===ee))==null?void 0:Ae.pointUnitType)==="メンバー",disabled:!!le,children:[e.jsx(Re,{id:"amem",children:`${i||"チームA"}メンバー`}),e.jsxs(ze,{labelId:"amem",value:U,label:`${i||"チームA"}メンバー`,onChange:n=>X(n.target.value),disabled:((a=u.find(n=>n.id===ee))==null?void 0:a.pointUnitType)!=="メンバー",children:[e.jsx(oe,{value:"",children:e.jsx("em",{children:"なし"})}),c.map(n=>e.jsx(oe,{value:n.id,children:n.name},n.id))]})]})]}),e.jsxs(s,{sx:{flex:1,display:"flex",flexDirection:"column",gap:1},children:[e.jsxs(s,{sx:{display:"flex",gap:1,mt:2},children:[e.jsx(Xe,{sx:{flex:1},orientation:"vertical",exclusive:!0,value:f,onChange:(n,h)=>{f===h||h===null?(te(""),_("")):(te(h),_(""))},disabled:!!le,children:b.filter(n=>n.visible!==!1).map(n=>e.jsx(qe,{value:n.id,sx:{whiteSpace:"nowrap"},children:n.name},n.id))}),e.jsx(Xe,{sx:{flex:1},orientation:"vertical",exclusive:!0,value:v,onChange:(n,h)=>{_(v===h||h===null?"":h)},disabled:!!le,children:u.filter(n=>n.playCategoryId===f&&n.visible!==!1).map(n=>{const h=n.pointType==="得点"?g.scoreColor:g.lossColor;return e.jsx(qe,{value:n.id,sx:{whiteSpace:"nowrap",color:h,"&.Mui-selected":{color:h}},children:n.name},n.id)})})]}),e.jsxs(_e,{fullWidth:!0,margin:"dense",required:j.rallyMemberRequired&&((l=u.find(n=>n.id===v))==null?void 0:l.pointUnitType)==="メンバー",disabled:!!le,children:[e.jsx(Re,{id:"bmem",children:`${D||"チームB"}メンバー`}),e.jsxs(ze,{labelId:"bmem",value:J,label:`${D||"チームB"}メンバー`,onChange:n=>xe(n.target.value),disabled:((w=u.find(n=>n.id===v))==null?void 0:w.pointUnitType)!=="メンバー",children:[e.jsx(oe,{value:"",children:e.jsx("em",{children:"なし"})}),r.map(n=>e.jsx(oe,{value:n.id,children:n.name},n.id))]})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(s,{sx:{display:"flex",gap:2,mt:1},children:[e.jsx(Xe,{orientation:"vertical",exclusive:!0,value:se,onChange:(n,h)=>{se===h||h===null?(re(""),B("")):(re(h),B(""))},disabled:!!le,sx:{flex:"1 1 25%"},children:b.filter(n=>n.visible!==!1).map(n=>e.jsx(qe,{value:n.id,sx:{whiteSpace:"nowrap"},children:n.name},n.id))}),e.jsx(Xe,{orientation:"vertical",exclusive:!0,value:ee,onChange:(n,h)=>{B(ee===h||h===null?"":h)},disabled:!!le,sx:{flex:"1 1 25%"},children:u.filter(n=>n.playCategoryId===se&&n.visible!==!1).map(n=>{const h=n.pointType==="得点"?g.scoreColor:g.lossColor;return e.jsx(qe,{value:n.id,sx:{whiteSpace:"nowrap",color:h,"&.Mui-selected":{color:h}},children:n.name},n.id)})}),e.jsx(Xe,{orientation:"vertical",exclusive:!0,value:f,onChange:(n,h)=>{f===h||h===null?(te(""),_("")):(te(h),_(""))},disabled:!!le,sx:{flex:"1 1 25%"},children:b.filter(n=>n.visible!==!1).map(n=>e.jsx(qe,{value:n.id,sx:{whiteSpace:"nowrap"},children:n.name},n.id))}),e.jsx(Xe,{orientation:"vertical",exclusive:!0,value:v,onChange:(n,h)=>{_(v===h||h===null?"":h)},disabled:!!le,sx:{flex:"1 1 25%"},children:u.filter(n=>n.playCategoryId===f&&n.visible!==!1).map(n=>{const h=n.pointType==="得点"?g.scoreColor:g.lossColor;return e.jsx(qe,{value:n.id,sx:{whiteSpace:"nowrap",color:h,"&.Mui-selected":{color:h}},children:n.name},n.id)})})]}),e.jsxs(s,{sx:{display:"flex",gap:2,mt:1},children:[e.jsxs(_e,{fullWidth:!0,margin:"dense",required:j.rallyMemberRequired&&((E=u.find(n=>n.id===ee))==null?void 0:E.pointUnitType)==="メンバー",disabled:!!le,sx:{flex:1},children:[e.jsx(Re,{id:"amem",children:`${i||"チームA"}メンバー`}),e.jsxs(ze,{labelId:"amem",value:U,label:`${i||"チームA"}メンバー`,onChange:n=>X(n.target.value),disabled:((O=u.find(n=>n.id===ee))==null?void 0:O.pointUnitType)!=="メンバー",children:[e.jsx(oe,{value:"",children:e.jsx("em",{children:"なし"})}),c.map(n=>e.jsx(oe,{value:n.id,children:n.name},n.id))]})]}),e.jsxs(_e,{fullWidth:!0,margin:"dense",required:j.rallyMemberRequired&&((R=u.find(n=>n.id===v))==null?void 0:R.pointUnitType)==="メンバー",disabled:!!le,sx:{flex:1},children:[e.jsx(Re,{id:"bmem",children:`${D||"チームB"}メンバー`}),e.jsxs(ze,{labelId:"bmem",value:J,label:`${D||"チームB"}メンバー`,onChange:n=>xe(n.target.value),disabled:((me=u.find(n=>n.id===v))==null?void 0:me.pointUnitType)!=="メンバー",children:[e.jsx(oe,{value:"",children:e.jsx("em",{children:"なし"})}),r.map(n=>e.jsx(oe,{value:n.id,children:n.name},n.id))]})]})]})]})]}),e.jsxs(lt,{children:[e.jsx(ue,{onClick:()=>N(!1),color:"inherit",startIcon:e.jsx(tt,{}),children:"キャンセル"}),e.jsx(ue,{onClick:H,disabled:!F(),startIcon:e.jsx(Ne,{}),children:"OK"})]})]})});var ls={},En=Ie;Object.defineProperty(ls,"__esModule",{value:!0});var $s=ls.default=void 0,Wn=En(Me()),Un=e;$s=ls.default=(0,Wn.default)((0,Un.jsx)("path",{d:"M16 17.01V10h-2v7.01h-3L15 21l4-3.99zM9 3 5 6.99h3V14h2V6.99h3zm7 14.01V10h-2v7.01h-3L15 21l4-3.99zM9 3 5 6.99h3V14h2V6.99h3z"}),"SwapVertOutlined");const Vn=d.forwardRef(function({teamAMembers:p,teamBMembers:u,onSave:b},c){const[r,i]=d.useState(!1),[D,j]=d.useState("teamA"),[g,A]=d.useState(""),[L,k]=d.useState(""),[z,$]=d.useState(null),G=T=>{j(T),A(""),k(""),$(null),i(!0)},N=(T,ie,se,re)=>{j(ie),A(se),k(re),$(T),i(!0)};d.useImperativeHandle(c,()=>({openAddDialog:G,openEditDialog:N}));const Q=()=>{i(!1),$(null)},Z=()=>{b(D,g,L,z),i(!1),$(null)};return e.jsxs(At,{open:r,onClose:Q,children:[e.jsx(it,{children:"選手交代"}),e.jsx(rt,{children:e.jsxs(s,{component:"form",sx:{mt:2},children:[e.jsxs(_e,{fullWidth:!0,sx:{mb:2},children:[e.jsx(Re,{id:"out-member",children:"OUT"}),e.jsx(ze,{labelId:"out-member",value:g,label:"OUT",onChange:T=>A(T.target.value),children:(D==="teamA"?p:u).map(T=>e.jsx(oe,{value:T.id,children:`${T.no}:${T.name}`},T.id))})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mb:2},children:e.jsx($s,{sx:{width:32,height:32}})}),e.jsxs(_e,{fullWidth:!0,children:[e.jsx(Re,{id:"in-member",children:"IN"}),e.jsx(ze,{labelId:"in-member",value:L,label:"IN",onChange:T=>k(T.target.value),children:(D==="teamA"?p:u).map(T=>e.jsx(oe,{value:T.id,children:`${T.no}:${T.name}`},T.id))})]})]})}),e.jsxs(lt,{children:[e.jsx(ue,{onClick:Q,color:"inherit",startIcon:e.jsx(tt,{}),children:"キャンセル"}),e.jsx(ue,{onClick:Z,disabled:!g||!L,startIcon:e.jsx(Ne,{}),children:"OK"})]})]})});function qn({open:t,onClose:p,scores:u,consecutive:b,connections:c,rowHeight:r}){const i=u.length*r,D=()=>{Cs(),p()};return e.jsx(bs,{anchor:"bottom",open:t,onClose:D,onOpen:()=>{},disableSwipeToOpen:!0,sx:{zIndex:j=>j.zIndex.drawer+3},ModalProps:{disableEnforceFocus:!0},PaperProps:{sx:{height:"60vh",borderTopLeftRadius:zt,borderTopRightRadius:zt}},children:e.jsxs(s,{sx:{position:"relative",height:"100%"},children:[e.jsx(s,{sx:{width:40,height:4,bgcolor:"text.secondary",borderRadius:2,position:"absolute",top:8,left:"50%",transform:"translateX(-50%)"}}),e.jsx(De,{onClick:D,sx:{position:"absolute",top:4,right:4},children:e.jsx(tt,{})}),e.jsx(s,{sx:{mt:4,height:"100%",overflowY:"auto"},children:e.jsxs(s,{sx:{flex:"0 0 100%",overflowY:"auto",height:"100%",position:"relative"},children:[u.map((j,g)=>{const A=g===0?{a:0,b:0}:u[g-1],L=j.a!==A.a&&j.a!==0,k=j.b!==A.b&&j.b!==0,z=L&&b[g],$=k&&b[g];return e.jsxs(s,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr 1fr",alignItems:"center",py:.5,height:`${r}px`,position:"relative",zIndex:1},children:[e.jsx(s,{}),e.jsxs(e.Fragment,{children:[e.jsx(s,{sx:{display:"flex",justifyContent:"center"},children:L?e.jsx(s,{sx:{width:32,height:32,border:"1px solid",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:24,borderColor:z?"red":"currentColor",backgroundColor:z?"#ffebee":"#fff",color:"black"},children:j.a}):null}),e.jsx(s,{}),e.jsx(s,{sx:{display:"flex",justifyContent:"center"},children:k?e.jsx(s,{sx:{width:32,height:32,border:"1px solid",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:24,borderColor:$?"red":"currentColor",backgroundColor:$?"#ffebee":"#fff",color:"black"},children:j.b}):null})]}),e.jsx(s,{})]},g)}),e.jsx("svg",{viewBox:`0 0 100 ${i}`,style:{position:"absolute",left:0,top:0,width:"100%",height:i,zIndex:0},preserveAspectRatio:"none",pointerEvents:"none",children:c.map(j=>{const g=j.index*r+r/2,A=(j.index+1)*r+r/2,L=j.from==="A"?30:70,k=j.from==="A"?70:30;return e.jsx("line",{x1:L,y1:g,x2:k,y2:A,stroke:"currentColor",strokeWidth:1},j.index)})})]})})]})})}var as={},Kn=Ie;Object.defineProperty(as,"__esModule",{value:!0});var _s=as.default=void 0,Jn=Kn(Me()),Nn=e;_s=as.default=(0,Jn.default)((0,Nn.jsx)("path",{d:"M3 18h18v-2H3zm0-5h18v-2H3zm0-7v2h18V6z"}),"Menu");function Gn({open:t,onClose:p,teamAName:u,teamBName:b,disableTimeoutA:c,disableTimeoutB:r,showScoreProgressButton:i,onShowScoreProgress:D,onSubstitution:j,onTimeout:g,onAddRally:A}){const L=()=>{Cs(),p()},k=G=>()=>{G(),L()},$=dt("sm")?"vertical":"horizontal";return e.jsx(bs,{anchor:"bottom",open:t,onClose:L,onOpen:()=>{},sx:{zIndex:G=>G.zIndex.drawer+2},ModalProps:{disableEnforceFocus:!0},PaperProps:{sx:{height:"auto",maxHeight:"80vh",borderTopLeftRadius:zt,borderTopRightRadius:zt}},children:e.jsx(s,{sx:{p:2},children:e.jsxs(qs,{spacing:2,children:[i&&e.jsx(ue,{fullWidth:!0,variant:"outlined",onClick:k(D),children:"得点推移表示"}),e.jsxs(ms,{fullWidth:!0,orientation:$,children:[e.jsx(ue,{onClick:k(()=>j("teamA")),children:(u||"チームA")+" メンバー交代"}),e.jsx(ue,{onClick:k(()=>j("teamB")),children:(b||"チームB")+" メンバー交代"})]}),e.jsxs(ms,{fullWidth:!0,orientation:$,children:[e.jsx(ue,{disabled:c,onClick:k(()=>g("teamA")),children:(u||"チームA")+" タイムアウト"}),e.jsx(ue,{disabled:r,onClick:k(()=>g("teamB")),children:(b||"チームB")+" タイムアウト"})]}),e.jsx(ue,{fullWidth:!0,variant:"contained",onClick:k(A),children:"ラリー結果追加"})]})})})}var os={},Yn=Ie;Object.defineProperty(os,"__esModule",{value:!0});var Rs=os.default=void 0,Xn=Yn(Me()),Qn=e;Rs=os.default=(0,Xn.default)((0,Qn.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8m.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"}),"AccessTimeOutlined");var ds={},Zn=Ie;Object.defineProperty(ds,"__esModule",{value:!0});var zs=ds.default=void 0,ei=Zn(Me()),ti=e;zs=ds.default=(0,ei.default)((0,ti.jsx)("path",{d:"M6.99 11 3 15l3.99 4v-3H14v-2H6.99zM21 9l-3.99-4v3H10v2h7.01v3z"}),"SwapHorizOutlined");function si({teamAName:t,teamBName:p,locked:u,disableTimeoutA:b,disableTimeoutB:c,onTimeout:r,onSubstitution:i,onAddRally:D}){const j=Mt(),[g,A]=d.useState(!1),[L,k]=d.useState(!1),z=Ss,[$,G]=d.useState(()=>!localStorage.getItem(z));return u?null:e.jsxs(ys,{children:[e.jsxs(Wt,{ariaLabel:"substitution actions",direction:"left",icon:e.jsx(zs,{}),onOpen:()=>k(!0),onClose:()=>k(!1),open:L,FabProps:{size:"large"},sx:{position:"fixed",right:35,bottom:200,zIndex:N=>N.zIndex.drawer-1},children:[e.jsx(Pt,{icon:e.jsx(e.Fragment,{children:p||"チームB"}),tooltipTitle:"",FabProps:{variant:"extended",size:"small"},onClick:()=>{i("teamB"),k(!1)}}),e.jsx(Pt,{icon:e.jsx(e.Fragment,{children:t||"チームA"}),tooltipTitle:"",FabProps:{variant:"extended",size:"small"},onClick:()=>{i("teamA"),k(!1)}})]}),e.jsxs(Wt,{ariaLabel:"timeout actions",direction:"left",icon:e.jsx(Rs,{}),onOpen:()=>A(!0),onClose:()=>A(!1),open:g,FabProps:{size:"large"},sx:{position:"fixed",right:35,bottom:140,zIndex:N=>N.zIndex.drawer-1},children:[e.jsx(Pt,{icon:e.jsx(e.Fragment,{children:p||"チームB"}),tooltipTitle:"",FabProps:{variant:"extended",size:"small",disabled:c},onClick:()=>{r("teamB"),A(!1)}}),e.jsx(Pt,{icon:e.jsx(e.Fragment,{children:t||"チームA"}),tooltipTitle:"",FabProps:{variant:"extended",size:"small",disabled:b},onClick:()=>{r("teamA"),A(!1)}})]}),e.jsx(Ee,{open:$,onClose:()=>G(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"left",TransitionComponent:We,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${j.palette.text.secondary}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${j.palette.text.secondary}`}}}},title:e.jsxs(s,{sx:{p:1,maxWidth:260},children:[e.jsx(Fe,{variant:"body2",sx:{whiteSpace:"pre-line"},children:Ze.addRally.text}),e.jsx(s,{sx:{textAlign:"right",mt:1},children:e.jsx(Qe,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem(z,"1"),G(!1)},children:"了解した"})})]}),children:e.jsx(Wt,{ariaLabel:"rally actions",direction:"left",icon:e.jsx(Lt,{}),FabProps:{size:"large",onClick:D},sx:{position:"fixed",right:35,bottom:80,zIndex:N=>N.zIndex.drawer-1}})})]})}function ni({isMobile:t,openActionMenu:p,onOpenActionMenu:u,onCloseActionMenu:b,teamAName:c,teamBName:r,disableTimeoutA:i,disableTimeoutB:D,showScoreProgressButton:j,onShowScoreProgress:g,onSubstitution:A,onTimeout:L,onAddRally:k,locked:z}){const $=Mt(),G=Ss,[N,Q]=d.useState(()=>t&&!localStorage.getItem(G));return e.jsxs(e.Fragment,{children:[!z&&t&&e.jsx(ys,{children:e.jsx(Ee,{open:N,onClose:()=>Q(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"top-start",TransitionComponent:We,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${$.palette.text.secondary}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${$.palette.text.secondary}`}}}},title:e.jsxs(s,{sx:{p:1,maxWidth:260},children:[e.jsx(Fe,{variant:"body2",sx:{whiteSpace:"pre-line"},children:Ze.addRally.text}),e.jsx(s,{sx:{textAlign:"right",mt:1},children:e.jsx(Qe,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem(G,"1"),Q(!1)},children:"了解した"})})]}),children:e.jsx(Ks,{color:"primary",onClick:u,sx:{position:"fixed",right:35,bottom:Z=>`calc(${Z.spacing(7)} + env(safe-area-inset-bottom) + 16px)`,zIndex:Z=>Z.zIndex.drawer+2},children:e.jsx(_s,{})})})}),t?e.jsx(Gn,{open:p,onClose:b,teamAName:c,teamBName:r,disableTimeoutA:i,disableTimeoutB:D,showScoreProgressButton:j,onShowScoreProgress:g,onSubstitution:A,onTimeout:L,onAddRally:k}):e.jsx(si,{teamAName:c,teamBName:r,locked:z,disableTimeoutA:i,disableTimeoutB:D,onSubstitution:A,onTimeout:L,onAddRally:k})]})}var cs={},ii=Ie;Object.defineProperty(cs,"__esModule",{value:!0});var Rt=cs.default=void 0,ri=ii(Me()),li=e;Rt=cs.default=(0,ri.default)((0,li.jsx)("path",{d:"M16.01 11H4v2h12.01v3L20 12l-3.99-4z"}),"ArrowRightAlt");var us={},ai=Ie;Object.defineProperty(us,"__esModule",{value:!0});var Fs=us.default=void 0,oi=ai(Me()),di=e;Fs=us.default=(0,oi.default)((0,di.jsx)("path",{d:"m12 4-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"}),"ArrowForward");function ci(t){if(typeof window>"u")return t;try{const u=new DOMParser().parseFromString(t,"image/svg+xml"),b=new Set(["svg","g","path","circle","rect","line","polygon","polyline","text","defs","use"]),c=r=>{[...r.children].forEach(i=>{if(b.has(i.tagName))[...i.attributes].forEach(D=>{D.name.startsWith("on")&&i.removeAttribute(D.name)}),c(i);else{const D=document.createTextNode(i.outerHTML);i.replaceWith(D)}})};return c(u.documentElement),u.documentElement.outerHTML}catch{return""}}function ui({name:t}){const p=d.useRef(null),[u,b]=d.useState(1);return d.useEffect(()=>{const c=p.current;if(!c)return;const r=c.getBBox().width;b(r>64?64/r:1)},[t]),e.jsx("svg",{width:64,height:64,children:e.jsx("g",{transform:`scale(${u})`,children:e.jsx("text",{ref:p,x:32/u,y:32/u,textAnchor:"middle",dominantBaseline:"central",fontSize:8,children:t})})})}function xi({category:t,borderColor:p}){const u=p?{border:"1px solid",borderColor:p,boxSizing:"border-box"}:{};return t.iconType==="svg"&&t.svg?e.jsx(s,{sx:{width:64,height:64,...u},dangerouslySetInnerHTML:{__html:ci(t.svg)}}):t.iconType==="image"&&t.image?e.jsx(s,{component:"img",src:t.image,sx:{width:64,height:64,objectFit:"none",objectPosition:`-${t.cropX||0}px -${t.cropY||0}px`,...u}}):e.jsx(s,{sx:{width:64,height:64,display:"flex",...u},children:e.jsx(ui,{name:t.name})})}function hi({rallies:t,playDetails:p,playCategories:u,teamAMembers:b,teamBMembers:c,teamAName:r,teamBName:i,serveCategory:D,showRallyIcons:j,locked:g,isMobile:A,isPhone:L,scores:k,scoredTeam:z,showRallyHint:$,onCloseRallyHint:G,onEditRally:N,onEditSubstitution:Q,onDelete:Z,onDragEnd:T}){const ie=Mt(),{handleTouchEnd:se,setSwiperRef:re,getSwiperRef:f}=Nt(2),te=d.useRef({}),[ee,B]=d.useState({}),[v,_]=d.useState("");d.useLayoutEffect(()=>{const x={};t.forEach(S=>{const F=te.current[S.id];F&&(x[S.id]=F.offsetHeight)}),B(x)},[t]);const U=x=>{if(!x)return;const S=p.find(F=>F.id===x);return u.find(F=>F.id===(S==null?void 0:S.playCategoryId))},X=(x,S)=>{if(!S)return"－";const K=(x==="teamA"?b:c).find(H=>H.id===S);return K?`${K.no}:${K.name}`:"－"},J=x=>{const S=k[x]||{a:0,b:0},F=z[x],K=ie.palette.text.primary,H=ie.palette.mode==="dark"?"#343A42":"#D3D3D3";return e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{color:F==="A"?K:H},children:String(S.a).padStart(2,"0")}),e.jsx("span",{style:{color:H},children:" - "}),e.jsx("span",{style:{color:F==="B"?K:H},children:String(S.b).padStart(2,"0")})]})},xe=(x,S,F)=>{var l;if(!x)return e.jsx(e.Fragment,{});const K=U(x),H=p.find(w=>w.id===x),Ae=F==="A"?b:c,a=(H==null?void 0:H.pointType)==="得点"?ie.palette.success.main:(H==null?void 0:H.pointType)==="失点"?ie.palette.error.main:void 0;return e.jsxs(s,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[K?e.jsx(Ue,{label:K.name,size:"small",variant:"outlined",sx:{bgcolor:"transparent",color:K.color,borderColor:K.color,mb:.5,height:20,fontSize:"0.75rem","& .MuiChip-label":{px:.5}}}):null,H?e.jsx(Ue,{label:H.name,size:"small",sx:{bgcolor:a,color:"common.white",mb:.5,height:20,fontSize:"0.75rem","& .MuiChip-label":{px:.5}}}):null,!L&&e.jsx(Fe,{variant:"caption",noWrap:!0,sx:{width:"100%",textAlign:"center"},children:(H==null?void 0:H.pointUnitType)==="メンバー"&&((l=Ae.find(w=>w.id===S))==null?void 0:l.name)||"－"})]})},le=(x,S,F)=>e.jsx(s,{ref:F.innerRef,...F.draggableProps,"data-index":S,sx:{mb:.5},children:e.jsxs(Ft,{onSwiper:K=>re(x.id,K),threshold:20,slidesPerView:"auto",style:{overflow:"hidden",height:ee[x.id]},onTouchStart:(K,H)=>H.stopPropagation(),onTouchEnd:K=>se(x.id,K),children:[e.jsx(Ve,{style:{width:"100%",flex:"0 0 auto"},children:(()=>{const K=F.dragHandleProps,{onPointerDown:H,...Ae}=K||{},a=Ht(l=>{if(H==null||H(l),!H)return;const w=f(x.id);w&&(w.allowTouchMove=!1),_(x.id)});return e.jsx(s,{ref:l=>{te.current[x.id]=l},...Ae,...a,sx:{display:"grid",gridTemplateColumns:"38% 24% 38%",alignItems:"center",cursor:g?"default":"grab",touchAction:v===x.id?"none":"pan-y",backgroundColor:l=>x.timeoutTeam||x.substitutionTeam?l.palette.mode==="dark"?"#343A42":"#f5f5f5":void 0},children:x.timeoutTeam?e.jsxs(s,{gridColumn:"1 / 4",sx:{...Ke,display:"flex",justifyContent:"center",alignItems:"center",height:"100%",minHeight:44},children:[x.timeoutTeam==="teamA"?r||"チームA":i||"チームB","タイムアウト"]}):x.substitutionTeam?e.jsxs(s,{gridColumn:"1 / 4",sx:{...Ke,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100%"},children:[e.jsxs("span",{children:[x.substitutionTeam==="teamA"?r||"チームA":i||"チームB","選手交代"]}),e.jsxs(s,{sx:{display:"flex",alignItems:"center",mt:.5},children:[e.jsx("span",{children:X(x.substitutionTeam,x.outMember)}),e.jsx(Rt,{fontSize:"small",sx:{mx:1}}),e.jsx("span",{children:X(x.substitutionTeam,x.inMember)})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(s,{children:xe(x.teamAPlayDetail,x.teamAMember,"A")}),e.jsxs(s,{sx:{fontSize:"2em",display:"flex",justifyContent:"center",flexDirection:"column",alignItems:"center"},children:[e.jsx(s,{sx:{whiteSpace:"nowrap"},children:J(S)}),x.serverTeam&&e.jsx(Fs,{sx:{width:"calc(100% - 8px)",height:20,mx:"4px",transform:x.serverTeam==="teamB"?"scaleX(-1)":void 0}})]}),e.jsx(s,{children:xe(x.teamBPlayDetail,x.teamBMember,"B")})]})})})()}),e.jsx(Ve,{style:{width:ut,flex:"0 0 auto"},children:e.jsx(s,{sx:{height:ee[x.id],display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"primary.main"},children:e.jsx(De,{size:"small",disabled:g||!!x.timeoutTeam,onClick:g||x.timeoutTeam?void 0:()=>x.substitutionTeam?Q(S):N(S),children:e.jsx(Kt,{fontSize:"small",sx:{color:"common.white"}})})})}),e.jsx(Ve,{style:{width:ut,flex:"0 0 auto"},children:e.jsx(s,{sx:{height:ee[x.id],display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"error.main"},children:e.jsx(De,{size:"small",onClick:()=>Z(S),children:e.jsx(st,{fontSize:"small",sx:{color:"common.white"}})})})})]})}),he=(x,S)=>{var F;return e.jsxs(s,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[j&&(D?e.jsx(xi,{category:D}):e.jsxs("svg",{width:64,height:64,children:[e.jsx("rect",{width:64,height:64,fill:"none",stroke:"currentColor"}),e.jsx("text",{x:"50%",y:"50%",textAnchor:"middle",dominantBaseline:"central",fontSize:"12",children:"サーブ"})]})),e.jsx(Fe,{variant:"caption",noWrap:!0,sx:{width:"100%",textAlign:"center"},children:((F=(x==="teamA"?b:c).find(K=>K.id===S))==null?void 0:F.name)||"－"})]})},ye=(x,S,F)=>e.jsx(s,{ref:F.innerRef,...F.draggableProps,"data-index":S,sx:{mb:.5},children:e.jsxs(Ft,{onSwiper:K=>re(x.id,K),threshold:20,slidesPerView:"auto",style:{overflow:"hidden",height:ee[x.id]},onTouchStart:(K,H)=>H.stopPropagation(),onTouchEnd:K=>se(x.id,K),children:[e.jsx(Ve,{style:{width:"100%",flex:"0 0 auto"},children:(()=>{const K=F.dragHandleProps,{onPointerDown:H,...Ae}=K||{},a=Ht(l=>{if(H==null||H(l),!H)return;const w=f(x.id);w&&(w.allowTouchMove=!1),_(x.id)});return e.jsx(s,{ref:l=>{te.current[x.id]=l},...Ae,...a,sx:{display:"grid",gridTemplateColumns:"16% 22% 24% 22% 16%",alignItems:"center",cursor:g?"default":"grab",touchAction:v===x.id?"none":"pan-y",backgroundColor:l=>x.timeoutTeam||x.substitutionTeam?l.palette.mode==="dark"?"#343A42":"#f5f5f5":void 0},children:x.timeoutTeam?e.jsxs(s,{gridColumn:"1 / 6",sx:{...Ke,display:"flex",justifyContent:"center",alignItems:"center",height:"100%",minHeight:44},children:[x.timeoutTeam==="teamA"?r||"チームA":i||"チームB","タイムアウト"]}):x.substitutionTeam?e.jsxs(s,{gridColumn:"1 / 6",sx:{...Ke,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100%"},children:[e.jsxs("span",{children:[x.substitutionTeam==="teamA"?r||"チームA":i||"チームB","選手交代"]}),e.jsxs(s,{sx:{display:"flex",alignItems:"center",mt:.5},children:[e.jsx("span",{children:X(x.substitutionTeam,x.outMember)}),e.jsx(Rt,{fontSize:"small",sx:{mx:1}}),e.jsx("span",{children:X(x.substitutionTeam,x.inMember)})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(s,{children:x.serverTeam==="teamA"?he("teamA",x.server):null}),e.jsx(s,{children:xe(x.teamAPlayDetail,x.teamAMember,"A")}),e.jsx(s,{sx:{fontSize:"2em",display:"flex",justifyContent:"center"},children:J(S)}),e.jsx(s,{children:xe(x.teamBPlayDetail,x.teamBMember,"B")}),e.jsx(s,{children:x.serverTeam==="teamB"?he("teamB",x.server):null})]})})})()}),e.jsx(Ve,{style:{width:ut,flex:"0 0 auto"},children:e.jsx(s,{sx:{height:ee[x.id],display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"primary.main"},children:e.jsx(De,{size:"small",disabled:g||!!x.timeoutTeam,onClick:g||x.timeoutTeam?void 0:()=>x.substitutionTeam?Q(S):N(S),children:e.jsx(Kt,{fontSize:"small",sx:{color:"common.white"}})})})}),e.jsx(Ve,{style:{width:ut,flex:"0 0 auto"},children:e.jsx(s,{sx:{height:ee[x.id],display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"error.main"},children:e.jsx(De,{size:"small",onClick:()=>Z(S),children:e.jsx(st,{fontSize:"small",sx:{color:"common.white"}})})})})]})}),we=x=>{if(v){const S=f(v);S&&(S.allowTouchMove=!0),_("")}T(x)};return e.jsx(Ee,{open:$&&A,onClose:G,disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:We,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${ie.palette.text.secondary}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${ie.palette.text.secondary}`}}}},title:e.jsxs(s,{sx:{p:1,maxWidth:260},children:[e.jsx(Fe,{variant:"body2",sx:{whiteSpace:"pre-line"},children:Ze.rallyListRow.text}),e.jsx(s,{sx:{textAlign:"right",mt:1},children:e.jsx(Qe,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem("tutorial-rally-row","1"),G()},children:"了解した"})})]}),children:e.jsx(s,{children:e.jsxs(It,{onDragEnd:we,children:[A&&e.jsx(xt,{component:et,storageKey:"set-tab",children:e.jsxs(s,{children:[e.jsx(s,{sx:{display:"grid",gridTemplateColumns:L?"38% 24% 38%":"16% 22% 24% 22% 16%",textAlign:"center",alignItems:"center",...Ke},children:L?e.jsxs(e.Fragment,{children:[e.jsxs(s,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("span",{children:r||"チームA"}),e.jsx("span",{children:"ラリー結果"})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:"得点"}),e.jsxs(s,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("span",{children:i||"チームB"}),e.jsx("span",{children:"ラリー結果"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(s,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("span",{children:r||"チームA"}),e.jsx("span",{children:"サーブ"})]}),e.jsxs(s,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("span",{children:r||"チームA"}),e.jsx("span",{children:"ラリー結果"})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:"得点"}),e.jsxs(s,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("span",{children:i||"チームB"}),e.jsx("span",{children:"ラリー結果"})]}),e.jsxs(s,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("span",{children:i||"チームB"}),e.jsx("span",{children:"サーブ"})]})]})}),e.jsx(at,{droppableId:"rallies",children:x=>e.jsxs(s,{ref:x.innerRef,...x.droppableProps,children:[t.map((S,F)=>e.jsx(ot,{draggableId:S.id,index:F,isDragDisabled:g,children:K=>(L?le:ye)(S,F,K)},S.id)),x.placeholder]})})]})}),!A&&e.jsx(xt,{component:et,storageKey:"set-tab",children:e.jsxs(jt,{size:"small",sx:{tableLayout:"fixed","& th, & td":{textAlign:"center",verticalAlign:"middle"}},children:[e.jsx(bt,{children:e.jsxs(Oe,{sx:{...Ke},children:[e.jsx(C,{sx:{width:"6%"}}),e.jsx(C,{sx:{width:"16%"},children:e.jsxs(s,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{children:r||"チームA"}),e.jsx("span",{children:"サーブ"})]})}),e.jsx(C,{sx:{width:"18%"},children:e.jsxs(s,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{children:r||"チームA"}),e.jsx("span",{children:"ラリー結果"})]})}),e.jsx(C,{sx:{width:"20%",display:"flex",justifyContent:"center",alignItems:"center"},children:"得点"}),e.jsx(C,{sx:{width:"18%"},children:e.jsxs(s,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{children:i||"チームB"}),e.jsx("span",{children:"ラリー結果"})]})}),e.jsx(C,{sx:{width:"16%"},children:e.jsxs(s,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{children:i||"チームB"}),e.jsx("span",{children:"サーブ"})]})}),e.jsx(C,{sx:{width:"6%"}})]})}),e.jsx(at,{droppableId:"rallies",children:x=>e.jsxs(yt,{ref:x.innerRef,...x.droppableProps,children:[t.map((S,F)=>e.jsx(ot,{draggableId:S.id,index:F,isDragDisabled:g,children:K=>e.jsxs(Oe,{ref:K.innerRef,...K.draggableProps,"data-index":F,onClick:()=>{g||(S.substitutionTeam?Q(F):S.timeoutTeam||N(F))},sx:{cursor:g||S.timeoutTeam?"default":"pointer",backgroundColor:H=>S.timeoutTeam||S.substitutionTeam?H.palette.mode==="dark"?"#343A42":"#f5f5f5":void 0},children:[e.jsx(C,{padding:"checkbox",sx:{width:"6%"},children:e.jsx(s,{onClick:H=>H.stopPropagation(),...K.dragHandleProps,sx:{cursor:g?"default":"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:e.jsx(Ot,{fontSize:"small"})})}),S.timeoutTeam?e.jsx(C,{colSpan:5,sx:{width:"88%"},children:e.jsxs(s,{sx:{...Ke,display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:[S.timeoutTeam==="teamA"?r||"チームA":i||"チームB","タイムアウト"]})}):S.substitutionTeam?e.jsx(C,{colSpan:5,sx:{width:"88%"},children:e.jsxs(s,{sx:{...Ke,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100%"},children:[e.jsxs("span",{children:[S.substitutionTeam==="teamA"?r||"チームA":i||"チームB","選手交代"]}),e.jsxs(s,{sx:{display:"flex",alignItems:"center",mt:.5},children:[e.jsx("span",{children:X(S.substitutionTeam,S.outMember)}),e.jsx(Rt,{fontSize:"small",sx:{mx:1}}),e.jsx("span",{children:X(S.substitutionTeam,S.inMember)})]})]})}):e.jsxs(e.Fragment,{children:[e.jsx(C,{sx:{width:"16%"},children:S.serverTeam==="teamA"?he("teamA",S.server):null}),e.jsx(C,{sx:{width:"18%"},children:xe(S.teamAPlayDetail,S.teamAMember,"A")}),e.jsx(C,{sx:{width:"20%",fontSize:"2em",textAlign:"center"},children:J(F)}),e.jsx(C,{sx:{width:"18%"},children:xe(S.teamBPlayDetail,S.teamBMember,"B")}),e.jsx(C,{sx:{width:"16%"},children:S.serverTeam==="teamB"?he("teamB",S.server):null})]}),e.jsx(C,{padding:"checkbox",sx:{width:"6%"},children:e.jsx(s,{onClick:H=>H.stopPropagation(),sx:{width:32,height:32,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:e.jsx(De,{size:"small",onClick:g?void 0:()=>Z(F),disabled:g,sx:{width:24,height:24},children:e.jsx(st,{fontSize:"small",color:g?"disabled":"error"})})})})]})},S.id)),x.placeholder]})})]})})]})})})}function mi({scores:t,consecutive:p,connections:u,rowHeight:b}){const c=t.length*b;return e.jsxs(s,{sx:{flex:"0 0 20%",overflowY:"auto",height:"100%",position:"relative"},children:[t.map((r,i)=>{const D=i===0?{a:0,b:0}:t[i-1],j=r.a!==D.a&&r.a!==0,g=r.b!==D.b&&r.b!==0,A=j&&p[i],L=g&&p[i];return e.jsxs(s,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr 1fr",alignItems:"center",py:.5,height:`${b}px`,position:"relative",zIndex:1},children:[e.jsx(s,{}),e.jsxs(e.Fragment,{children:[e.jsx(s,{sx:{display:"flex",justifyContent:"center"},children:j?e.jsx(s,{sx:{width:32,height:32,border:"1px solid",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:24,borderColor:A?"red":"currentColor",backgroundColor:A?"#ffebee":"#fff",color:"black"},children:r.a}):null}),e.jsx(s,{}),e.jsx(s,{sx:{display:"flex",justifyContent:"center"},children:g?e.jsx(s,{sx:{width:32,height:32,border:"1px solid",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:24,borderColor:L?"red":"currentColor",backgroundColor:L?"#ffebee":"#fff",color:"black"},children:r.b}):null})]}),e.jsx(s,{})]},i)}),e.jsx("svg",{viewBox:`0 0 100 ${c}`,style:{position:"absolute",left:0,top:0,width:"100%",height:c,zIndex:0},preserveAspectRatio:"none",pointerEvents:"none",children:u.map(r=>{const i=r.index*b+b/2,D=(r.index+1)*b+b/2,j=r.from==="A"?30:70,g=r.from==="A"?70:30;return e.jsx("line",{x1:j,y1:i,x2:g,y2:D,stroke:"currentColor",strokeWidth:1},r.index)})})]})}function pi({setScore:t,playDetails:p,playCategories:u,teamAMembers:b,teamBMembers:c,teamAName:r,teamBName:i,onChange:D,locked:j=!1,scoreInputSetting:g,themeSetting:A,showSnackbar:L}){const[k,z]=d.useState(!1),[$,G]=d.useState(!1),{addRally:N,deleteRally:Q,calculateScores:Z}=Hn(t,p,D),T=d.useRef(null),ie=d.useRef(null),se=dt("md"),re=dt("sm"),f=!re&&g.showRallyIcons,te=!se&&g.showScoreProgressArea,ee=se&&g.showScoreProgressArea,[B,v]=d.useState(!1),_=u.find(m=>m.id==="init-serve"),U=t.rallies.filter(m=>m.timeoutTeam==="teamA").length,X=t.rallies.filter(m=>m.timeoutTeam==="teamB").length,J=U>=2,xe=X>=2,le=m=>{if(!m.destination||j)return;const I=Array.from(t.rallies),[W]=I.splice(m.source.index,1);I.splice(m.destination.index,0,W);const pe={...t,rallies:I};Z(pe),D(pe)},he=m=>{if(j)return;const I={...t,rallies:[...t.rallies]};Q(m),L("ラリーを削除しました","success",{actionLabel:"元に戻す",onAction:()=>{const W={...I,rallies:[...I.rallies]};Z(W),D(W)},autoHideDuration:5e3})},ye=m=>{const I=!localStorage.getItem("tutorial-rally-row");N(m),se&&I&&z(!0)},we=(m,I)=>{const W=[...t.rallies];W[m]=I;const pe={...t,rallies:W};Z(pe),D(pe)},x=m=>{if(j||m==="teamA"&&J||m==="teamB"&&xe)return;const I=!localStorage.getItem("tutorial-rally-row");N({id:crypto.randomUUID(),timeoutTeam:m}),se&&I&&z(!0)},S=m=>{var I;j||(I=T.current)==null||I.openAddDialog(m)},F=m=>{var W;if(j)return;const I=t.rallies[m];I.substitutionTeam&&((W=T.current)==null||W.openEditDialog(m,I.substitutionTeam,I.outMember||"",I.inMember||""))},K=(m,I,W,pe)=>{const Se=!localStorage.getItem("tutorial-rally-row"),y=[...t.rallies];pe!==null?y[pe]={...y[pe],substitutionTeam:m,outMember:I,inMember:W}:y.push({id:crypto.randomUUID(),substitutionTeam:m,outMember:I,inMember:W});const M={...t,rallies:y};Z(M),D(M),se&&Se&&z(!0)},H=[],Ae=[],a=[],l=[];let w=0,E=0,O=0,R=0;t.rallies.forEach(m=>{const I=p.find(Se=>Se.id===m.teamAPlayDetail),W=p.find(Se=>Se.id===m.teamBPlayDetail);let pe=null;(I==null?void 0:I.pointType)==="得点"||(W==null?void 0:W.pointType)==="失点"?(w+=1,O+=1,pe="A"):((W==null?void 0:W.pointType)==="得点"||(I==null?void 0:I.pointType)==="失点")&&(E+=1,R+=1,pe="B"),!m.timeoutTeam&&!m.substitutionTeam&&(l.push(pe),a.push({a:O,b:R})),Ae.push(m.timeoutTeam||m.substitutionTeam?null:pe),H.push({a:w,b:E})});const me=40,n=[];for(let m=0;m<l.length-1;m++){const I=l[m],W=l[m+1];I&&W&&I!==W&&n.push({from:I,index:m})}const h=l.map((m,I)=>m!==null&&I>0&&m===l[I-1]);return e.jsxs(s,{sx:{position:"relative",display:"flex",flexDirection:"column",height:"100%"},children:[e.jsxs(s,{sx:{display:"flex",gap:2,flex:1,minHeight:0},children:[te&&e.jsx(mi,{scores:a,consecutive:h,connections:n,rowHeight:me}),e.jsx(s,{sx:{flex:1,overflowY:"auto",height:"100%",maxWidth:1024,width:"100%",mx:"auto",mb:2},children:e.jsx(hi,{rallies:t.rallies,playDetails:p,playCategories:u,teamAMembers:b,teamBMembers:c,teamAName:r,teamBName:i,serveCategory:_,showRallyIcons:f,locked:j,isMobile:se,isPhone:re,scores:H,scoredTeam:Ae,showRallyHint:k,onCloseRallyHint:()=>z(!1),onEditRally:m=>{var I;return(I=ie.current)==null?void 0:I.openEditDialog(m)},onEditSubstitution:F,onDelete:he,onDragEnd:le})})]}),ee&&e.jsx(qn,{open:B,onClose:()=>v(!1),scores:a,consecutive:h,connections:n,rowHeight:me}),e.jsx(ni,{isMobile:se,openActionMenu:$,onOpenActionMenu:()=>G(!0),onCloseActionMenu:()=>G(!1),teamAName:r,teamBName:i,disableTimeoutA:J,disableTimeoutB:xe,showScoreProgressButton:g.showScoreProgressArea,onShowScoreProgress:()=>v(!0),onSubstitution:S,onTimeout:x,onAddRally:()=>{var m;return(m=ie.current)==null?void 0:m.openAddDialog()},locked:j}),e.jsx(Ln,{ref:ie,setScore:t,playDetails:p,playCategories:u,teamAMembers:b,teamBMembers:c,teamAName:r,teamBName:i,scoreInputSetting:g,themeSetting:A,locked:j,onAdd:ye,onEdit:we}),e.jsx(Vn,{ref:T,teamAMembers:b,teamBMembers:c,onSave:K})]})}const fi=()=>typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():Math.random().toString(36).slice(2)+Date.now().toString(36);function gi({statsSettings:t,onChange:p,playCategories:u,playDetails:b,rallyCategoryTags:c,rallyDetailTags:r,disabled:i,showSnackbar:D}){const j=a=>{if(ye){const E=he(ye);E&&(E.allowTouchMove=!0),we("")}if(!a.destination)return;const l=Array.from(t),[w]=l.splice(a.source.index,1);l.splice(a.destination.index,0,w),p(l)},g=a=>{var l;return((l=u.find(w=>w.id===a))==null?void 0:l.name)||""},A=a=>{var l;return((l=b.find(w=>w.id===a))==null?void 0:l.name)||""},L=a=>{const l=a.playCategoryId?g(a.playCategoryId):a.playCategoryTags?a.playCategoryTags.map(me=>{var n;return((n=c.find(h=>h.id===me))==null?void 0:n.name)||me}).join(", "):"",w=a.playDetailId?A(a.playDetailId):a.playDetailTags?a.playDetailTags.map(me=>{var n;return((n=r.find(h=>h.id===me))==null?void 0:n.name)||me}).join(", "):"",E=a.pointType||"",O=a.pointUnitType||"",R=a.aggregateType||"合算";return[l,w,E,O,R].filter(me=>me).join(", ")},[k,z]=d.useState(!1),[$,G]=d.useState(null),[N,Q]=d.useState(""),[Z,T]=d.useState(""),[ie,se]=d.useState([]),[re,f]=d.useState([]),[te,ee]=d.useState(""),[B,v]=d.useState(""),[_,U]=d.useState("合算"),X=dt("md"),J=dt("sm"),{handleTouchEnd:xe,setSwiperRef:le,getSwiperRef:he}=Nt(2),[ye,we]=d.useState(""),x=()=>{i||(G(-1),Q(""),T(""),se([]),f([]),ee(""),v(""),U("合算"),z(!0))},S=a=>{if(i)return;const l=t[a];G(a),Q(l.playCategoryId||""),T(l.playDetailId||""),se(l.playCategoryTags||[]),f(l.playDetailTags||[]),ee(l.pointType||""),v(l.pointUnitType||""),U(l.aggregateType||"合算"),z(!0)},F=()=>{const a=N!=="",l=Z!=="",w=ie.length>0,E=re.length>0,O=te!=="",R=B!=="";return a&&!l&&!w&&!E&&!O&&!R||a&&l&&!w&&!E&&!O&&!R||a&&!l&&!w&&!E&&O&&!R||a&&!l&&!w&&!E&&!O&&R||a&&!l&&!w&&!E&&O&&R||!a&&!l&&!w&&!E&&O&&!R||!a&&!l&&!w&&!E&&O&&R||!a&&!l&&!w&&!E&&!O&&R||w&&!a&&!l&&!E&&!O&&!R||w&&E&&!a&&!l&&!O&&!R||w&&E&&!a&&!l&&O&&!R||w&&E&&!a&&!l&&!O&&R||w&&E&&!a&&!l&&O&&R||w&&!a&&!l&&O&&!R||w&&!a&&!l&&!O&&R||w&&!a&&!l&&O&&R||E&&!a&&!l&&!w&&!O&&!R||E&&!a&&!l&&!w&&O&&!R||E&&!a&&!l&&!w&&!O&&R||E&&!a&&!l&&!w&&O&&R},K=()=>{const a={id:$===-1?fi():t[$].id,playCategoryId:N||void 0,playDetailId:Z||void 0,playCategoryTags:N===""&&ie.length>0?ie:void 0,playDetailTags:Z===""&&re.length>0?re:void 0,pointType:Z?void 0:te||void 0,pointUnitType:Z?void 0:B||void 0,aggregateType:_};$===-1?p([...t,a]):$!==null&&p(t.map((l,w)=>w===$?a:l)),z(!1)},H=()=>{z(!1)},Ae=a=>{if(i)return;const l=[...t];p(t.filter((w,E)=>E!==a)),D("スタッツ設定を削除しました","success",{actionLabel:"元に戻す",onAction:()=>p(l),autoHideDuration:5e3})};return e.jsxs(s,{children:[e.jsxs(s,{sx:{maxWidth:1024,mx:"auto",display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(s,{sx:{fontWeight:"bold"},children:"スタッツ設定"}),e.jsx(ue,{onClick:x,variant:"contained",size:"medium",startIcon:e.jsx(Lt,{}),disabled:i,children:"追加"})]}),e.jsx(xt,{component:et,storageKey:"match-stats-grid",sx:{maxWidth:1024,mx:"auto"},children:X?e.jsx(It,{onDragEnd:j,children:e.jsx(at,{droppableId:"stats-settings",children:a=>e.jsxs(s,{ref:a.innerRef,...a.droppableProps,children:[e.jsx(s,{sx:{display:"grid",gridTemplateColumns:J?"1fr":"150px 1fr 110px 130px 110px",alignItems:"center",height:50,px:1,borderBottom:1,borderColor:"divider",...Ke},children:J?e.jsx(s,{children:"分析項目"}):e.jsxs(e.Fragment,{children:[e.jsx(s,{children:"プレー区分"}),e.jsx(s,{children:"プレー詳細"}),e.jsx(s,{children:"得点区分"}),e.jsx(s,{children:"得失点単位区分"}),e.jsx(s,{children:"集計方法"})]})}),t.map((l,w)=>e.jsx(ot,{draggableId:l.id,index:w,isDragDisabled:i,children:E=>{const O=E.dragHandleProps,{onPointerDown:R,...me}=O||{},n=Ht(h=>{R==null||R(h);const m=he(l.id);m&&(m.allowTouchMove=!1),we(l.id)});return e.jsx(s,{ref:E.innerRef,...E.draggableProps,style:E.draggableProps.style,children:e.jsxs(Ft,{onSwiper:h=>le(l.id,h),threshold:20,slidesPerView:"auto",style:{overflow:"hidden"},onTouchStart:(h,m)=>m.stopPropagation(),onTouchEnd:h=>xe(l.id,h),children:[e.jsx(Ve,{style:{width:"100%",flex:"0 0 auto"},children:e.jsx(s,{...me,...n,sx:{display:"grid",gridTemplateColumns:J?"1fr":"150px 1fr 110px 130px 110px",alignItems:"center",height:50,px:1,borderBottom:1,borderColor:"divider",bgcolor:"background.paper",cursor:i?"default":"grab",touchAction:ye===l.id?"none":"pan-y"},children:J?e.jsx(s,{children:L(l)}):e.jsxs(e.Fragment,{children:[e.jsx(s,{sx:{pr:1},children:l.playCategoryId?g(l.playCategoryId):l.playCategoryTags&&l.playCategoryTags.length>0?e.jsx(s,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:l.playCategoryTags.map(h=>{const m=c.find(I=>I.id===h);return e.jsx(Ue,{label:(m==null?void 0:m.name)||h,size:"small",sx:{backgroundColor:(m==null?void 0:m.color)||Je,color:"#fff"}},h)})}):""}),e.jsx(s,{sx:{pr:1},children:l.playDetailId?A(l.playDetailId):l.playDetailTags&&l.playDetailTags.length>0?e.jsx(s,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:l.playDetailTags.map(h=>{const m=r.find(I=>I.id===h);return e.jsx(Ue,{label:(m==null?void 0:m.name)||h,size:"small",sx:{backgroundColor:(m==null?void 0:m.color)||Je,color:"#fff"}},h)})}):""}),e.jsx(s,{sx:{pr:1},children:l.pointType||""}),e.jsx(s,{sx:{pr:1},children:l.pointUnitType||""}),e.jsx(s,{children:l.aggregateType||"合算"})]})})}),e.jsx(Ve,{style:{width:ut,flex:"0 0 auto"},children:e.jsx(s,{sx:{height:50,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"error.main"},children:e.jsx(De,{size:"small",onClick:()=>Ae(w),disabled:i,children:e.jsx(st,{fontSize:"small",sx:{color:"common.white"}})})})}),e.jsx(Ve,{style:{width:ut,flex:"0 0 auto"},children:e.jsx(s,{sx:{height:50,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"primary.main"},children:e.jsx(De,{size:"small",onClick:()=>S(w),disabled:i,children:e.jsx(Kt,{fontSize:"small",sx:{color:"common.white"}})})})})]})})}},l.id)),a.placeholder]})})}):e.jsxs(jt,{size:"small",children:[e.jsx(bt,{children:e.jsxs(Oe,{sx:{backgroundColor:a=>a.palette.mode==="dark"?"#343A42":"#f5f5f5",height:50},children:[e.jsx(C,{}),e.jsx(C,{children:"プレー区分"}),e.jsx(C,{children:"プレー詳細"}),e.jsx(C,{children:"得点区分"}),e.jsx(C,{children:"得失点単位区分"}),e.jsx(C,{children:"集計方法"}),e.jsx(C,{})]})}),e.jsx(It,{onDragEnd:j,children:e.jsx(at,{droppableId:"stats-settings",children:a=>e.jsxs(yt,{ref:a.innerRef,...a.droppableProps,children:[t.map((l,w)=>e.jsx(ot,{draggableId:l.id,index:w,isDragDisabled:i,children:E=>e.jsxs(Oe,{ref:E.innerRef,...E.draggableProps,onClick:()=>S(w),sx:{cursor:i?"default":"pointer",height:50},children:[e.jsx(C,{padding:"checkbox",sx:{width:48},children:e.jsx(s,{...E.dragHandleProps,onClick:O=>O.stopPropagation(),sx:{cursor:i?"default":"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:e.jsx(Ot,{})})}),e.jsx(C,{children:l.playCategoryId?g(l.playCategoryId):l.playCategoryTags&&l.playCategoryTags.length>0?e.jsx(s,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:l.playCategoryTags.map(O=>{const R=c.find(me=>me.id===O);return e.jsx(Ue,{label:(R==null?void 0:R.name)||O,size:"small",sx:{backgroundColor:(R==null?void 0:R.color)||Je,color:"#fff"}},O)})}):""}),e.jsx(C,{children:l.playDetailId?A(l.playDetailId):l.playDetailTags&&l.playDetailTags.length>0?e.jsx(s,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:l.playDetailTags.map(O=>{const R=r.find(me=>me.id===O);return e.jsx(Ue,{label:(R==null?void 0:R.name)||O,size:"small",sx:{backgroundColor:(R==null?void 0:R.color)||Je,color:"#fff"}},O)})}):""}),e.jsx(C,{children:l.pointType||""}),e.jsx(C,{children:l.pointUnitType||""}),e.jsx(C,{children:l.aggregateType||"合算"}),e.jsx(C,{padding:"checkbox",children:e.jsx(De,{size:"small",onClick:O=>{O.stopPropagation(),Ae(w)},disabled:i,children:e.jsx(st,{fontSize:"small"})})})]})},l.id)),a.placeholder]})})})]})}),e.jsxs(At,{open:k,onClose:H,children:[e.jsxs(it,{children:["スタッツ設定",$===-1?"追加":"編集"]}),e.jsxs(rt,{children:[e.jsxs(_e,{fullWidth:!0,margin:"dense",children:[e.jsx(Re,{id:"stat-category-label",children:"プレー区分"}),e.jsxs(ze,{labelId:"stat-category-label",value:N,label:"プレー区分",onChange:a=>{Q(a.target.value),T(""),se([]),f([])},disabled:ie.length>0||re.length>0,children:[e.jsx(oe,{value:"",children:"なし"}),u.map(a=>e.jsx(oe,{value:a.id,children:a.name},a.id))]})]}),e.jsxs(_e,{fullWidth:!0,margin:"dense",children:[e.jsx(Re,{id:"stat-detail-label",children:"プレー詳細"}),e.jsxs(ze,{labelId:"stat-detail-label",value:Z,label:"プレー詳細",onChange:a=>{T(a.target.value),ee(""),v(""),se([]),f([])},disabled:te!==""||B!==""||ie.length>0||re.length>0,children:[e.jsx(oe,{value:"",children:"なし"}),b.filter(a=>a.playCategoryId===N).map(a=>e.jsx(oe,{value:a.id,children:a.name},a.id))]})]}),e.jsx(qt,{multiple:!0,options:c,getOptionLabel:a=>a.name,value:c.filter(a=>ie.includes(a.id)),onChange:(a,l)=>{se(l.map(w=>w.id)),l.length>0&&(Q(""),T(""))},disabled:N!==""||Z!=="",renderTags:(a,l)=>a.map((w,E)=>{const{key:O,...R}=l({index:E});return e.jsx(Ue,{...R,label:w.name,size:"small",sx:{backgroundColor:w.color||Je,color:"#fff"}},O)}),renderInput:a=>e.jsx(Ce,{...a,label:"プレー区分タグ",margin:"dense"}),fullWidth:!0}),e.jsx(qt,{multiple:!0,options:r,getOptionLabel:a=>a.name,value:r.filter(a=>re.includes(a.id)),onChange:(a,l)=>{f(l.map(w=>w.id)),l.length>0&&(Q(""),T(""))},disabled:N!==""||Z!=="",renderTags:(a,l)=>a.map((w,E)=>{const{key:O,...R}=l({index:E});return e.jsx(Ue,{...R,label:w.name,size:"small",sx:{backgroundColor:w.color||Je,color:"#fff"}},O)}),renderInput:a=>e.jsx(Ce,{...a,label:"プレー詳細タグ",margin:"dense"}),fullWidth:!0}),e.jsxs(s,{children:[e.jsxs(_e,{fullWidth:!0,margin:"dense",children:[e.jsx(Re,{id:"stat-point-label",children:"得点区分"}),e.jsxs(ze,{labelId:"stat-point-label",value:te,label:"得点区分",onChange:a=>{ee(a.target.value),a.target.value!==""&&T("")},disabled:Z!=="",children:[e.jsx(oe,{value:"",children:"なし"}),e.jsx(oe,{value:"得点",children:"得点"}),e.jsx(oe,{value:"失点",children:"失点"})]})]}),e.jsxs(_e,{fullWidth:!0,margin:"dense",children:[e.jsx(Re,{id:"stat-unit-label",children:"得失点単位区分"}),e.jsxs(ze,{labelId:"stat-unit-label",value:B,label:"得失点単位区分",onChange:a=>{v(a.target.value),a.target.value!==""&&T("")},disabled:Z!=="",children:[e.jsx(oe,{value:"",children:"なし"}),e.jsx(oe,{value:"メンバー",children:"メンバー"}),e.jsx(oe,{value:"チーム",children:"チーム"})]})]})]}),e.jsxs(_e,{fullWidth:!0,margin:"dense",children:[e.jsx(Re,{id:"stat-aggregate-label",children:"集計方法"}),e.jsxs(ze,{labelId:"stat-aggregate-label",value:_,label:"集計方法",onChange:a=>U(a.target.value),children:[e.jsx(oe,{value:"合算",children:"合算"}),e.jsx(oe,{value:"セット平均",children:"セット平均"})]})]})]}),e.jsxs(lt,{children:[e.jsx(ue,{onClick:H,color:"inherit",startIcon:e.jsx(tt,{}),children:"キャンセル"}),e.jsx(ue,{onClick:K,disabled:!F(),startIcon:e.jsx(Ne,{}),children:"OK"})]})]})]})}function gs(t,p,u){var c,r;if(!t)return!1;const b=p.get(t.playCategoryId);return!(u.playDetailId&&t.id!==u.playDetailId||u.playCategoryId&&t.playCategoryId!==u.playCategoryId||u.playCategoryTags&&u.playCategoryTags.length>0&&!((c=b==null?void 0:b.tags)!=null&&c.some(i=>u.playCategoryTags.includes(i)))||u.playDetailTags&&u.playDetailTags.length>0&&!((r=t.tags)!=null&&r.some(i=>u.playDetailTags.includes(i)))||u.pointType&&t.pointType!==u.pointType||u.pointUnitType&&t.pointUnitType!==u.pointUnitType)}function js(t,p,u,b){const c=b.map(()=>({teamA:0,teamB:0}));return t.forEach(r=>{r.rallies.forEach(i=>{b.forEach((D,j)=>{const g=i.teamAPlayDetail?p.get(i.teamAPlayDetail):void 0;gs(g,u,D)&&(c[j].teamA+=1);const A=i.teamBPlayDetail?p.get(i.teamBPlayDetail):void 0;gs(A,u,D)&&(c[j].teamB+=1)})})}),c}function ji(t,p){const u=[];let b=0,c=0,r=0,i=0;return t.forEach(j=>{let g=0,A=0,L=0,k=0;j.rallies.forEach(z=>{if(z.timeoutTeam||z.substitutionTeam||!z.serverTeam)return;const $=z.teamAPlayDetail?p.get(z.teamAPlayDetail):void 0,G=z.teamBPlayDetail?p.get(z.teamBPlayDetail):void 0;z.serverTeam==="teamA"?(A+=1,($&&$.pointType==="得点"||G&&G.pointType==="失点")&&(g+=1)):(k+=1,(G&&G.pointType==="得点"||$&&$.pointType==="失点")&&(L+=1))}),b+=g,c+=A,r+=L,i+=k,u.push({teamA:A?`${Math.round(g/A*100)}%`:"-",teamB:k?`${Math.round(L/k*100)}%`:"-"})}),{overall:{teamA:c?`${Math.round(b/c*100)}%`:"-",teamB:i?`${Math.round(r/i*100)}%`:"-"},perSet:u}}function bi(t,p){const u=[];let b=0,c=0,r=0,i=0;return t.forEach(j=>{let g=0,A=0,L=0,k=0;j.rallies.forEach(z=>{if(z.timeoutTeam||z.substitutionTeam||!z.serverTeam)return;const $=z.teamAPlayDetail?p.get(z.teamAPlayDetail):void 0,G=z.teamBPlayDetail?p.get(z.teamBPlayDetail):void 0;z.serverTeam==="teamB"?(A+=1,($&&$.pointType==="得点"||G&&G.pointType==="失点")&&(g+=1)):(k+=1,(G&&G.pointType==="得点"||$&&$.pointType==="失点")&&(L+=1))}),b+=g,c+=A,r+=L,i+=k,u.push({teamA:A?`${Math.round(g/A*100)}%`:"-",teamB:k?`${Math.round(L/k*100)}%`:"-"})}),{overall:{teamA:c?`${Math.round(b/c*100)}%`:"-",teamB:i?`${Math.round(r/i*100)}%`:"-"},perSet:u}}function yi({sets:t,playDetails:p,playCategories:u,statsSettings:b,matchStatsSettings:c,onMatchStatsSettingsChange:r,rallyCategoryTags:i,rallyDetailTags:D,teamAName:j,teamBName:g,locked:A,showSnackbar:L}){const k=new Map(p.map(B=>[B.id,B])),z=new Map(u.map(B=>[B.id,B])),$=B=>{var v;return((v=u.find(_=>_.id===B))==null?void 0:v.name)||""},G=B=>{var v;return((v=p.find(_=>_.id===B))==null?void 0:v.name)||""},N=[...b,...c],Q=js(t,k,z,N),Z=t.map(B=>js([B],k,z,N)),T=Q.map((B,v)=>{if(N[v].aggregateType==="セット平均"){const U=t.length||1;return{teamA:(B.teamA/U).toFixed(1),teamB:(B.teamB/U).toFixed(1)}}return B}),ie=Z.map(B=>N.reduce((v,_,U)=>(_.aggregateType!=="セット平均"&&v.push(B[U]),v),[])),se=N.filter(B=>B.aggregateType!=="セット平均"),re=ji(t,k),f=bi(t,k),te=B=>{const v=[];B.playCategoryId?v.push(e.jsx("span",{children:$(B.playCategoryId)},"cat")):B.playCategoryTags&&B.playCategoryTags.length>0&&v.push(e.jsx(s,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center",mt:.5},children:B.playCategoryTags.map(U=>{const X=i.find(J=>J.id===U);return e.jsx(Ue,{label:(X==null?void 0:X.name)||U,size:"small",sx:{mr:.5,mb:.5,backgroundColor:(X==null?void 0:X.color)||Je,color:"#fff"}},U)})},"catTags")),B.playDetailId?v.push(e.jsx("span",{children:G(B.playDetailId)},"detail")):B.playDetailTags&&B.playDetailTags.length>0&&v.push(e.jsx(s,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center",mt:.5},children:B.playDetailTags.map(U=>{const X=D.find(J=>J.id===U);return e.jsx(Ue,{label:(X==null?void 0:X.name)||U,size:"small",sx:{mr:.5,mb:.5,backgroundColor:(X==null?void 0:X.color)||Je,color:"#fff"}},U)})},"detailTags"));const _=[];return B.pointType&&_.push(B.pointType),B.pointUnitType&&_.push(B.pointUnitType),_.length>0&&v.push(e.jsx("span",{children:_.join(",")},"point")),v.push(e.jsxs("span",{children:["(",B.aggregateType||"合算",")"]},"agg")),e.jsx(s,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:v.map((U,X)=>e.jsx(s,{sx:{display:"flex",justifyContent:"center"},children:U},X))})},ee=(B,v,_,U,X)=>e.jsx(xt,{component:et,storageKey:X,sx:{mb:2},children:e.jsxs(jt,{size:"small",sx:{"& th, & td":{textAlign:"center",verticalAlign:"middle"}},children:[e.jsx(bt,{children:e.jsxs(Oe,{sx:{backgroundColor:J=>J.palette.mode==="dark"?"#343A42":"#f5f5f5",height:50},children:[e.jsx(C,{children:j||"チームA"}),e.jsx(C,{children:"項目"}),e.jsx(C,{children:g||"チームB"})]})}),e.jsxs(yt,{children:[e.jsxs(Oe,{sx:{height:50},children:[e.jsx(C,{children:v.teamA}),e.jsx(C,{children:"ブレイク率"}),e.jsx(C,{children:v.teamB})]},"break-rate"),e.jsxs(Oe,{sx:{height:50},children:[e.jsx(C,{children:_.teamA}),e.jsx(C,{children:"サイドアウト率"}),e.jsx(C,{children:_.teamB})]},"sideout-rate"),U.map((J,xe)=>e.jsxs(Oe,{sx:{height:50},children:[e.jsx(C,{children:B[xe].teamA}),e.jsx(C,{children:te(J)}),e.jsx(C,{children:B[xe].teamB})]},J.id))]})]})});return e.jsxs(s,{sx:{display:"grid",gap:2,gridTemplateColumns:{xs:"1fr",md:"repeat(2, 1fr)"},maxWidth:1024,width:"100%",mx:"auto"},children:[e.jsxs(s,{children:[e.jsx(Fe,{variant:"h6",sx:{mb:1},children:"試合全体のスタッツ"}),ee(T,re.overall,f.overall,N,"stats-overall")]}),t.map((B,v)=>e.jsxs(s,{children:[e.jsx(Fe,{variant:"h6",sx:{mb:1},children:`${v+1}セット目(${B.my}-${B.opponent})のスタッツ`}),ee(ie[v],re.perSet[v],f.perSet[v],se,`stats-set-${v}`)]},B.id)),e.jsxs(s,{sx:{gridColumn:"1 / -1"},children:[e.jsx(gi,{statsSettings:c,onChange:r,playCategories:u,playDetails:p,rallyCategoryTags:i,rallyDetailTags:D,disabled:A,showSnackbar:L}),e.jsxs(vs,{severity:"info",sx:{mt:1},children:["本設定は試合内のみでの設定となります",e.jsx("br",{}),"各試合共通でのスタッツ項目の設定は設定＞スタッツメニューから設定してください"]})]})]})}var xs={},vi=Ie;Object.defineProperty(xs,"__esModule",{value:!0});var Jt=xs.default=void 0,Ci=vi(Me()),Si=e;Jt=xs.default=(0,Ci.default)((0,Si.jsx)("path",{d:"M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m-9-2V7H4v3H1v2h3v3h2v-3h3v-2zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"PersonAdd");const Ti=()=>typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():Math.random().toString(36).slice(2)+Date.now().toString(36);function wi({match:t,setMatch:p,teamAName:u,teamBName:b,teamMembers:c,onAddMember:r,locked:i,showSnackbar:D}){const j=Mt(),g=dt("md"),A=dt("sm"),{handleTouchEnd:L,setSwiperRef:k,getSwiperRef:z}=Nt(),$={tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${j.palette.text.secondary}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${j.palette.text.secondary}`}}}},G=(y,M,Y)=>e.jsxs(s,{sx:{p:1,maxWidth:260},children:[e.jsx(Fe,{variant:"body2",sx:{whiteSpace:"pre-line"},children:Ze[y].text}),e.jsx(s,{sx:{textAlign:"right",mt:1},children:e.jsx(Qe,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem(M,"1"),Y()},children:"了解した"})})]}),[N,Q]=d.useState(""),Z="tutorial-member-select",[T,ie]=d.useState(()=>!localStorage.getItem(Z)),se="tutorial-member-row",[re,f]=d.useState(null),[te,ee]=d.useState(!1),[B,v]=d.useState(!1),[_,U]=d.useState(""),[X,J]=d.useState(""),[xe,le]=d.useState([]),[he,ye]=d.useState("teamA"),[we,x]=d.useState([]),S="tutorial-member-select-add",F="tutorial-member-select-list",[K,H]=d.useState(!1),[Ae,a]=d.useState(!1);d.useEffect(()=>{if(te){const y=window.setTimeout(()=>{H(!localStorage.getItem(S)),a(!localStorage.getItem(F))},300);return()=>window.clearTimeout(y)}H(!1),a(!1)},[te]);const l=y=>{if(N){const ae=z(N);ae&&(ae.allowTouchMove=!0),Q("")}if(!y.destination||y.source.droppableId!==y.destination.droppableId||i)return;const M=y.source.droppableId==="teamA"?"teamAMembers":"teamBMembers",Y=Array.from(t[M]),[de]=Y.splice(y.source.index,1);Y.splice(y.destination.index,0,de),p(ae=>({...ae,[M]:Y}))},w=d.useMemo(()=>{const y=he==="teamA"?t.teamA:t.teamB,M=c[y]||[],Y=he==="teamA"?t.teamAMembers:t.teamBMembers;return M.filter(de=>de.visible!==!1&&!Y.some(ae=>ae.id===de.id))},[he,t,c]),E=y=>{ye(y),x([]),ee(!0)},O=y=>{x(M=>M.some(de=>de.id===y.id)?M.filter(de=>de.id!==y.id):[...M,y])},R=()=>{const y=!localStorage.getItem(se);p(he==="teamA"?M=>({...M,teamAMembers:[...M.teamAMembers,...we.map(Y=>({...Y,statuses:Array(M.sets.length).fill("")}))]}):M=>({...M,teamBMembers:[...M.teamBMembers,...we.map(Y=>({...Y,statuses:Array(M.sets.length).fill("")}))]})),ee(!1),y&&f(he)},me=()=>{ee(!1)},n=(y,M)=>{if(i)return;let Y;const de=y==="teamA"?"teamAMembers":"teamBMembers";p(ae=>{const q=[...ae[de]];Y=q[M];const fe=q.filter((Te,be)=>be!==M);return{...ae,[de]:fe}}),D("メンバーを削除しました","success",{actionLabel:"元に戻す",onAction:()=>{Y&&p(ae=>{const q=[...ae[de]];return q.splice(M,0,Y),{...ae,[de]:q}})},autoHideDuration:5e3})},h=()=>{i||(U(""),J(""),le([]),v(!0))},m=()=>{const y=he==="teamA"?t.teamA:t.teamB;y&&r(y,{id:Ti(),no:Number(_),name:X,positions:xe}),v(!1)},I=()=>{v(!1)},W=(y,M,Y)=>{i||p(de=>{const ae=y==="teamA"?"teamAMembers":"teamBMembers",q=[...de[ae]],fe={...q[M]},Te=[...fe.statuses||Array(de.sets.length).fill("")],be=Te[Y]||"";let Be="";return be===""?Be="starter":be==="starter"?Be="libero":Be="",Te[Y]=Be,fe.statuses=Te,q[M]=fe,{...de,[ae]:q}})},pe=()=>G(g?"matchMembersRowMobile":"matchMembersRowDesktop",se,()=>f(null)),Se=y=>{const M=y==="teamA"?t.teamAMembers:t.teamBMembers,Y=y,de=A?"50px 1fr":`40px 1fr ${t.sets.map(()=>"70px").join(" ")}`;return e.jsxs(s,{sx:{maxWidth:1024,mx:"auto",overflowX:"auto"},children:[e.jsxs(s,{sx:{display:"grid",gridTemplateColumns:de,alignItems:"center",height:50,px:1,borderBottom:1,borderColor:"divider",...Ke},children:[e.jsx(s,{children:"番号"}),e.jsx(s,{children:"名前"}),!A&&t.sets.map((ae,q)=>e.jsx(s,{textAlign:"center",children:q+1},q))]}),e.jsx(at,{droppableId:Y,children:ae=>e.jsxs(s,{ref:ae.innerRef,...ae.droppableProps,children:[M.map((q,fe)=>e.jsx(ot,{draggableId:`${Y}-${q.id}`,index:fe,isDragDisabled:i,children:Te=>{const be=`${Y}-${q.id}`,Be=Te.dragHandleProps,{onPointerDown:He,...Ge}=Be||{},nt=Ht(ke=>{He==null||He(ke);const $e=z(be);$e&&($e.allowTouchMove=!1),Q(be)});return e.jsx(s,{ref:Te.innerRef,...Te.draggableProps,children:e.jsxs(Ft,{onSwiper:ke=>k(be,ke),threshold:20,slidesPerView:"auto",style:{overflow:"hidden"},onTouchStart:(ke,$e)=>$e.stopPropagation(),onTouchEnd:ke=>L(be,ke),children:[e.jsx(Ve,{style:{width:"100%",flex:"0 0 auto"},children:e.jsxs(s,{...Ge,...nt,sx:{display:"grid",gridTemplateColumns:de,alignItems:"center",height:50,px:1,borderBottom:1,borderColor:"divider",backgroundColor:"background.paper",cursor:i?"default":"grab",touchAction:N===be?"none":"pan-y"},children:[e.jsx(s,{children:q.no}),e.jsx(s,{children:q.name}),!A&&t.sets.map((ke,$e)=>{var Dt,Bt,vt,ht,kt,Ct;return e.jsx(s,{sx:{textAlign:"center"},children:e.jsx(ue,{size:"small",variant:(Dt=q.statuses)!=null&&Dt[$e]?"contained":"outlined",color:((Bt=q.statuses)==null?void 0:Bt[$e])==="starter"?"primary":void 0,sx:{minWidth:32,width:32,p:0,...((vt=q.statuses)==null?void 0:vt[$e])==="starter"?{backgroundColor:"primary.main",color:"#fff","&:hover":{backgroundColor:"primary.main"}}:((ht=q.statuses)==null?void 0:ht[$e])==="libero"?{backgroundColor:"#FF9933",color:"#fff","&:hover":{backgroundColor:"#FF9933"},"&.Mui-focusVisible":{outline:"2px solid #FF9933"}}:{}},onClick:()=>W(y,fe,$e),disabled:i,children:((kt=q.statuses)==null?void 0:kt[$e])==="starter"?"出":((Ct=q.statuses)==null?void 0:Ct[$e])==="libero"?"リ":"不"})},$e)})]})}),e.jsx(Ve,{style:{width:ut,flex:"0 0 auto"},children:e.jsx(s,{sx:{height:50,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"error.main"},children:e.jsx(De,{size:"small",onClick:()=>n(y,fe),children:e.jsx(st,{fontSize:"small",sx:{color:"common.white"}})})})})]})})}},q.id)),ae.placeholder]})})]})};return e.jsxs(It,{onDragEnd:l,children:[e.jsxs(wt,{container:!0,spacing:2,children:[e.jsxs(wt,{item:!0,xs:12,children:[e.jsxs(s,{sx:{maxWidth:1024,mx:"auto"},children:[e.jsx(Fe,{variant:"h6",sx:{mb:1},children:u}),e.jsx(ue,{variant:"contained",size:"medium",sx:{mb:1},onClick:()=>E("teamA"),disabled:i,startIcon:e.jsx(Jt,{}),children:"メンバー登録"})]}),e.jsx(Ee,{open:T,onClose:()=>ie(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:We,slotProps:$,title:G("matchMembersSelect",Z,()=>ie(!1)),children:e.jsx(s,{children:e.jsx(Ee,{open:re==="teamA",onClose:()=>f(null),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:We,slotProps:$,title:pe(),children:e.jsx(s,{children:g?Se("teamA"):e.jsx(xt,{component:et,storageKey:"members-teamA",sx:{maxWidth:1024,mx:"auto"},children:e.jsxs(jt,{size:"small",children:[e.jsx(bt,{children:e.jsxs(Oe,{sx:{backgroundColor:y=>y.palette.mode==="dark"?"#343A42":"#f5f5f5",height:50},children:[e.jsx(C,{}),e.jsx(C,{children:"番号"}),e.jsx(C,{children:"名前"}),e.jsx(C,{children:"ポジション"}),t.sets.map((y,M)=>e.jsx(C,{align:"center",children:M+1},M)),e.jsx(C,{})]})}),e.jsx(at,{droppableId:"teamA",children:y=>e.jsxs(yt,{ref:y.innerRef,...y.droppableProps,children:[t.teamAMembers.map((M,Y)=>e.jsx(ot,{draggableId:`teamA-${M.id}`,index:Y,isDragDisabled:i,children:de=>e.jsxs(Oe,{ref:de.innerRef,...de.draggableProps,"data-index":Y,sx:{cursor:i?"default":"pointer",height:50},children:[e.jsx(C,{padding:"checkbox",children:e.jsx(s,{onClick:ae=>ae.stopPropagation(),...de.dragHandleProps,sx:{cursor:i?"default":"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:e.jsx(Ot,{})})}),e.jsx(C,{children:M.no}),e.jsx(C,{children:M.name}),e.jsx(C,{children:(M.positions||[]).join(", ")}),t.sets.map((ae,q)=>{var fe,Te,be,Be,He,Ge;return e.jsx(C,{padding:"checkbox",align:"center",children:e.jsx(ue,{size:"small",variant:(fe=M.statuses)!=null&&fe[q]?"contained":"outlined",color:((Te=M.statuses)==null?void 0:Te[q])==="starter"?"primary":void 0,sx:{minWidth:32,width:32,p:0,...((be=M.statuses)==null?void 0:be[q])==="starter"?{backgroundColor:"primary.main",color:"#fff","&:hover":{backgroundColor:"primary.main"}}:((Be=M.statuses)==null?void 0:Be[q])==="libero"?{backgroundColor:"#FF9933",color:"#fff","&:hover":{backgroundColor:"#FF9933"},"&.Mui-focusVisible":{outline:"2px solid #FF9933"}}:{}},onClick:()=>W("teamA",Y,q),disabled:i,children:((He=M.statuses)==null?void 0:He[q])==="starter"?"出":((Ge=M.statuses)==null?void 0:Ge[q])==="libero"?"リ":"不"})},q)}),e.jsx(C,{padding:"checkbox",children:e.jsx(s,{onClick:ae=>ae.stopPropagation(),sx:{width:32,height:32,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:e.jsx(De,{size:"small",onClick:i?void 0:()=>n("teamA",Y),disabled:i,sx:{width:24,height:24},children:e.jsx(st,{fontSize:"small",color:i?"disabled":"error"})})})})]})},M.id)),y.placeholder]})})]})})})})})})]}),e.jsxs(wt,{item:!0,xs:12,children:[e.jsxs(s,{sx:{maxWidth:1024,mx:"auto"},children:[e.jsx(Fe,{variant:"h6",sx:{mb:1},children:b}),e.jsx(ue,{variant:"contained",size:"medium",sx:{mb:1},onClick:()=>E("teamB"),disabled:i,startIcon:e.jsx(Jt,{}),children:"メンバー登録"})]}),e.jsx(Ee,{open:re==="teamB",onClose:()=>f(null),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:We,slotProps:$,title:pe(),children:e.jsx(s,{children:g?Se("teamB"):e.jsx(xt,{component:et,storageKey:"members-teamB",sx:{maxWidth:1024,mx:"auto"},children:e.jsxs(jt,{size:"small",children:[e.jsx(bt,{children:e.jsxs(Oe,{sx:{backgroundColor:y=>y.palette.mode==="dark"?"#343A42":"#f5f5f5",height:50},children:[e.jsx(C,{}),e.jsx(C,{children:"番号"}),e.jsx(C,{children:"名前"}),e.jsx(C,{children:"ポジション"}),t.sets.map((y,M)=>e.jsx(C,{align:"center",children:M+1},M)),e.jsx(C,{})]})}),e.jsx(at,{droppableId:"teamB",children:y=>e.jsxs(yt,{ref:y.innerRef,...y.droppableProps,children:[t.teamBMembers.map((M,Y)=>e.jsx(ot,{draggableId:`teamB-${M.id}`,index:Y,isDragDisabled:i,children:de=>e.jsxs(Oe,{ref:de.innerRef,...de.draggableProps,"data-index":Y,sx:{cursor:i?"default":"pointer",height:50},children:[e.jsx(C,{padding:"checkbox",children:e.jsx(s,{onClick:ae=>ae.stopPropagation(),...de.dragHandleProps,sx:{cursor:i?"default":"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:e.jsx(Ot,{})})}),e.jsx(C,{children:M.no}),e.jsx(C,{children:M.name}),e.jsx(C,{children:(M.positions||[]).join(", ")}),t.sets.map((ae,q)=>{var fe,Te,be,Be,He,Ge;return e.jsx(C,{padding:"checkbox",align:"center",children:e.jsx(ue,{size:"small",variant:(fe=M.statuses)!=null&&fe[q]?"contained":"outlined",color:((Te=M.statuses)==null?void 0:Te[q])==="starter"?"primary":void 0,sx:{minWidth:32,width:32,p:0,...((be=M.statuses)==null?void 0:be[q])==="starter"?{backgroundColor:"primary.main",color:"#fff","&:hover":{backgroundColor:"primary.main"}}:((Be=M.statuses)==null?void 0:Be[q])==="libero"?{backgroundColor:"#FF9933",color:"#fff","&:hover":{backgroundColor:"#FF9933"},"&.Mui-focusVisible":{outline:"2px solid #FF9933"}}:{}},onClick:()=>W("teamB",Y,q),disabled:i,children:((He=M.statuses)==null?void 0:He[q])==="starter"?"出":((Ge=M.statuses)==null?void 0:Ge[q])==="libero"?"リ":"不"})},q)}),e.jsx(C,{padding:"checkbox",children:e.jsx(s,{onClick:ae=>ae.stopPropagation(),sx:{width:32,height:32,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:e.jsx(De,{size:"small",onClick:i?void 0:()=>n("teamB",Y),disabled:i,sx:{width:24,height:24},children:e.jsx(st,{fontSize:"small",color:i?"disabled":"error"})})})})]})},M.id)),y.placeholder]})})]})})})})]})]}),e.jsxs(At,{open:te,onClose:me,children:[e.jsx(it,{children:"メンバー選択"}),e.jsxs(rt,{children:[e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end",mb:1},children:e.jsx(Ee,{open:K,onClose:()=>H(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom-start",TransitionComponent:We,slotProps:{...$,popper:{disablePortal:!0,sx:{zIndex:y=>y.zIndex.tooltip}}},title:G("memberSelectAdd",S,()=>H(!1)),children:e.jsx("span",{children:e.jsx(ue,{onClick:h,variant:"contained",startIcon:e.jsx(Lt,{}),disabled:i||!(he==="teamA"?t.teamA:t.teamB),children:"追加"})})})}),e.jsx(Ee,{open:Ae,onClose:()=>a(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:We,slotProps:{...$,popper:{disablePortal:!0,sx:{zIndex:y=>y.zIndex.tooltip}}},title:G("memberSelectList",F,()=>a(!1)),children:e.jsx(xt,{component:et,storageKey:`members-select-${he}`,children:e.jsxs(jt,{size:"small",children:[e.jsx(bt,{children:e.jsxs(Oe,{sx:{backgroundColor:y=>y.palette.mode==="dark"?"#343A42":"#f5f5f5",height:50},children:[e.jsx(C,{padding:"checkbox"}),!A&&e.jsx(C,{children:"番号"}),e.jsx(C,{children:"名前"}),!A&&e.jsx(C,{children:"ポジション"})]})}),e.jsx(yt,{children:w.map(y=>{const M=we.some(Y=>Y.id===y.id);return e.jsxs(Oe,{sx:{cursor:"pointer",height:50},onClick:()=>O(y),children:[e.jsx(C,{padding:"checkbox",onClick:Y=>Y.stopPropagation(),children:e.jsx(Js,{checked:M,onChange:()=>O(y)})}),!A&&e.jsx(C,{children:y.no}),e.jsx(C,{children:y.name}),!A&&e.jsx(C,{children:(y.positions||[]).join(", ")})]},y.id)})})]})})})]}),e.jsxs(lt,{children:[e.jsx(ue,{onClick:me,startIcon:e.jsx(tt,{}),color:"inherit",children:"キャンセル"}),e.jsx(ue,{onClick:R,disabled:we.length===0,startIcon:e.jsx(Ne,{}),children:"OK"})]})]}),e.jsxs(At,{open:B,onClose:I,children:[e.jsx(it,{children:"メンバー追加"}),e.jsxs(rt,{children:[e.jsx(Ce,{label:"番号",type:"number",value:_,onChange:y=>U(y.target.value),fullWidth:!0,margin:"dense"}),e.jsx(Ce,{label:"名前",value:X,onChange:y=>J(y.target.value),fullWidth:!0,margin:"dense"}),e.jsxs(_e,{fullWidth:!0,margin:"dense",children:[e.jsx(Re,{id:"md-positions-label",children:"ポジション"}),e.jsxs(ze,{labelId:"md-positions-label",multiple:!0,value:xe,label:"ポジション",onChange:y=>le(typeof y.target.value=="string"?y.target.value.split(","):y.target.value),renderValue:y=>y.join(", "),children:[e.jsx(oe,{value:"レフト",children:"レフト"}),e.jsx(oe,{value:"センター",children:"センター"}),e.jsx(oe,{value:"ライト",children:"ライト"}),e.jsx(oe,{value:"セッター",children:"セッター"}),e.jsx(oe,{value:"リベロ",children:"リベロ"})]})]})]}),e.jsxs(lt,{children:[e.jsx(ue,{onClick:I,startIcon:e.jsx(tt,{}),color:"inherit",children:"キャンセル"}),e.jsx(ue,{onClick:m,disabled:_==="",startIcon:e.jsx(Ne,{}),children:"OK"})]})]})]})}function Ai({match:t,setMatch:p,tags:u,onAddTag:b,locked:c}){return e.jsx(s,{sx:{maxWidth:1024,mx:"auto"},children:e.jsx(wt,{container:!0,spacing:2,children:e.jsx(wt,{item:!0,xs:12,children:e.jsxs(et,{elevation:0,sx:{},children:[e.jsx(Ce,{label:"試合日付",type:"date",InputLabelProps:{shrink:!0},value:t.date,onChange:r=>p(i=>({...i,date:r.target.value})),fullWidth:!0,margin:"dense",disabled:c,sx:{"& .MuiOutlinedInput-root":{height:56},"& .MuiOutlinedInput-input":{padding:"0 14px",height:"100%",lineHeight:"56px",fontSize:"1rem",textAlign:"left"},'& input[type="date"]':{WebkitAppearance:"none"}}}),e.jsx(Ce,{label:"試合名",value:t.matchName,onChange:r=>p(i=>({...i,matchName:r.target.value})),fullWidth:!0,margin:"dense",disabled:c}),e.jsx(qt,{multiple:!0,freeSolo:!0,options:u,getOptionLabel:r=>typeof r=="string"?r:r.name,value:t.tags.map(r=>u.find(i=>i.id===r)).filter(Boolean),onChange:(r,i)=>{const D=[];i.forEach(j=>{if(typeof j=="string"){const g={id:crypto.randomUUID(),name:j,color:Je};b(g),D.push(g.id)}else D.push(j.id)}),p(j=>({...j,tags:D}))},renderTags:(r,i)=>r.map((D,j)=>{const{key:g,...A}=i({index:j});return e.jsx(Ue,{...A,label:D.name,sx:{backgroundColor:D.color||Je,color:"#fff",mr:.5,mb:.5}},g)}),renderInput:r=>e.jsx(Ce,{...r,label:"タグ",margin:"dense"}),fullWidth:!0,disabled:c}),e.jsxs(vs,{severity:"info",sx:{mt:1},children:["試合タグは上記項目にて直接入力するか、設定＞タグメニューにて追加できます",e.jsx("br",{}),"試合にタグを設定することにより、試合を横串で集計することが可能となります"]}),e.jsx(Ce,{label:"場所",value:t.location,onChange:r=>p(i=>({...i,location:r.target.value})),fullWidth:!0,margin:"dense",disabled:c}),e.jsx(Ce,{label:"主審",value:t.mainReferee,onChange:r=>p(i=>({...i,mainReferee:r.target.value})),fullWidth:!0,margin:"dense",disabled:c}),e.jsx(Ce,{label:"副審",value:t.subReferee,onChange:r=>p(i=>({...i,subReferee:r.target.value})),fullWidth:!0,margin:"dense",disabled:c}),e.jsx(Ce,{label:"動画URL",value:t.videoUrl,onChange:r=>p(i=>({...i,videoUrl:r.target.value})),multiline:!0,rows:3,fullWidth:!0,margin:"dense",disabled:c}),e.jsx(Ce,{label:"メモ",value:t.memo,onChange:r=>p(i=>({...i,memo:r.target.value})),multiline:!0,rows:3,fullWidth:!0,margin:"dense",disabled:c})]})})})})}function Ii({match:t,setMatch:p,teams:u,locked:b}){return e.jsxs(et,{elevation:0,sx:{},children:[e.jsxs(_e,{fullWidth:!0,margin:"dense",disabled:b,children:[e.jsx(Re,{id:"teamA-label",children:"チームA"}),e.jsx(ze,{labelId:"teamA-label",value:t.teamA,label:"チームA",onChange:c=>p(r=>({...r,teamA:c.target.value,teamAMembers:[]})),disabled:b,children:u.map(c=>e.jsx(oe,{value:c.id,children:c.name},c.id))})]}),e.jsx(Ce,{label:"チームA監督",value:t.teamAHeadCoach,onChange:c=>p(r=>({...r,teamAHeadCoach:c.target.value})),fullWidth:!0,margin:"dense",disabled:b}),e.jsx(Ce,{label:"チームAコーチ",value:t.teamACoach,onChange:c=>p(r=>({...r,teamACoach:c.target.value})),fullWidth:!0,margin:"dense",disabled:b}),e.jsx(Ce,{label:"チームAマネージャー",value:t.teamAManager,onChange:c=>p(r=>({...r,teamAManager:c.target.value})),fullWidth:!0,margin:"dense",disabled:b}),e.jsx(Ce,{label:"チームAキャプテン",value:t.teamACaptain,onChange:c=>p(r=>({...r,teamACaptain:c.target.value})),fullWidth:!0,margin:"dense",disabled:b}),e.jsxs(_e,{fullWidth:!0,margin:"dense",disabled:b,children:[e.jsx(Re,{id:"teamB-label",children:"チームB"}),e.jsx(ze,{labelId:"teamB-label",value:t.teamB,label:"チームB",onChange:c=>p(r=>({...r,teamB:c.target.value,teamBMembers:[]})),disabled:b,children:u.map(c=>e.jsx(oe,{value:c.id,children:c.name},c.id))})]}),e.jsx(Ce,{label:"チームB監督",value:t.teamBHeadCoach,onChange:c=>p(r=>({...r,teamBHeadCoach:c.target.value})),fullWidth:!0,margin:"dense",disabled:b}),e.jsx(Ce,{label:"チームBコーチ",value:t.teamBCoach,onChange:c=>p(r=>({...r,teamBCoach:c.target.value})),fullWidth:!0,margin:"dense",disabled:b}),e.jsx(Ce,{label:"チームBマネージャー",value:t.teamBManager,onChange:c=>p(r=>({...r,teamBManager:c.target.value})),fullWidth:!0,margin:"dense",disabled:b}),e.jsx(Ce,{label:"チームBキャプテン",value:t.teamBCaptain,onChange:c=>p(r=>({...r,teamBCaptain:c.target.value})),fullWidth:!0,margin:"dense",disabled:b})]})}const Mi=nn.create(s),Di=()=>typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():Math.random().toString(36).slice(2)+Date.now().toString(36);function Li({match:t,onSave:p,teams:u,teamMembers:b,playDetails:c,playCategories:r,statsSettings:i,rallyCategoryTags:D,rallyDetailTags:j,themeSetting:g,scoreInputSetting:A,onAddMember:L,setAppBarAction:k,setAppBarLeftAction:z,onDirtyChange:$,tags:G,onAddTag:N}){const Q=Qs(),Z=Zs(),[T,ie]=d.useState("info"),se=!1;d.useEffect(()=>{const o=Z.pathname.split("/").filter(Boolean);if(o[0]!=="matches"||o[1]!==t.id)return;const P=o[2]??"info";P==="setinfo"?(ie("info"),Q(`/matches/${t.id}/info`,{replace:!0})):(ie(P),o[2]||Q(`/matches/${t.id}/info`,{replace:!0}))},[Z.pathname,Q,t.id,se]);const re=d.useCallback(o=>{const P=o.teamA,V=o.teamB,ne=(ve,je)=>!!je&&(b[ve]||[]).some(ce=>ce.id===je&&ce.visible!==!1),ge=(ve,je)=>je.filter(ce=>ne(ve,ce.id)).map(ce=>{const Le=(b[ve]||[]).find(ct=>ct.id===ce.id);return Le?{...ce,no:Le.no,name:Le.name,positions:Le.positions}:ce});return{...o,teamAMembers:ge(P,o.teamAMembers),teamBMembers:ge(V,o.teamBMembers),sets:o.sets.map(ve=>({...ve,rallies:ve.rallies.map(je=>({...je,server:ne(je.serverTeam==="teamA"?P:V,je.server)?je.server:void 0,teamAMember:ne(P,je.teamAMember)?je.teamAMember:void 0,teamBMember:ne(V,je.teamBMember)?je.teamBMember:void 0}))}))}},[b]),[f,te]=d.useState(()=>re({...t,tags:t.tags||[],matchStatsSettings:t.matchStatsSettings||[],teamAMembers:t.teamAMembers.map(o=>({...o,statuses:o.statuses??Array(t.sets.length).fill("")})),teamBMembers:t.teamBMembers.map(o=>({...o,statuses:o.statuses??Array(t.sets.length).fill("")}))})),ee=5,B=[Is,Ms,Ds,Bs,ks],v=!!t.locked,_=Mt(),U=ps(_.breakpoints.up("sm")),X=ps(_.breakpoints.down("sm")),[J,xe]=d.useState(!1),[le,he]=d.useState(!1),ye=200,we=56,[x,S]=d.useState(!1),F=_.palette.text.secondary,K=d.useCallback(()=>{J?(he(!1),xe(!1)):(xe(!0),U||he(!0))},[J,U]),H=d.useCallback(o=>{o.propertyName==="width"&&U&&J&&he(!0)},[U,J]);d.useEffect(()=>{U||(xe(!1),he(!1))},[U]),d.useEffect(()=>(z(e.jsx(Ee,{open:x,onClose:()=>S(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom-end",TransitionComponent:We,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${F}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${F}`}}}},title:e.jsxs(s,{sx:{p:1,maxWidth:260},children:[e.jsxs(Fe,{variant:"body2",sx:{whiteSpace:"pre-line"},children:[e.jsx(fs,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),Ze.setReorder.text]}),e.jsx(s,{sx:{textAlign:"right",mt:1},children:e.jsx(Qe,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem("tutorial-set-reorder","1"),S(!1)},children:"了解した"})})]}),children:e.jsx(De,{color:"inherit",onClick:K,children:e.jsx(fs,{})})})),()=>z(null)),[z,K,x,F]);const[Ae,a]=d.useState(!1),[l,w]=d.useState(!1),[E,O]=d.useState(null),[R,me]=d.useState(!1),[n,h]=d.useState({open:!1,message:"",severity:"success"}),m=(o,P,V)=>{h({open:!0,message:o,severity:P,...V})},I=`matchDraft-${t.id}`,W=d.useRef(!1),[pe,Se]=d.useState(!1),[y,M]=d.useState(!1),[Y,de]=d.useState(null),ae=d.useCallback(o=>{de(o.currentTarget)},[]),q=d.useCallback(()=>{de(null)},[]),[fe,Te]=d.useState({}),be=d.useCallback((o,P,V=!0)=>{te(ne=>{const ge=[...ne.sets],ve=ge.findIndex(ce=>ce.id===o);if(ve===-1)return ne;const je=ge[ve];return V&&Te(ce=>{const Le=ce[o]||{undo:[]};return{...ce,[o]:{undo:[...Le.undo,je],redo:[]}}}),ge[ve]=P,{...ne,sets:ge}})},[]),Be=d.useCallback(()=>{if(!/^[0-9]+$/.test(T))return;const o=Number(T)-1,P=f.sets[o],V=fe[P.id];if(!V||V.undo.length===0)return;const ne=V.undo[V.undo.length-1];Te(ge=>({...ge,[P.id]:{undo:V.undo.slice(0,-1),redo:[...V.redo,P]}})),be(P.id,ne,!1)},[T,f.sets,fe,be]),He=d.useCallback(()=>{if(!/^[0-9]+$/.test(T))return;const o=Number(T)-1,P=f.sets[o],V=fe[P.id];if(!V||V.redo.length===0)return;const ne=V.redo[V.redo.length-1];Te(ge=>({...ge,[P.id]:{undo:[...V.undo,P],redo:V.redo.slice(0,-1)}})),be(P.id,ne,!1)},[T,f.sets,fe,be]),Ge=o=>{if(!o.destination||v)return;const P=o.source.index,V=o.destination.index;if(P===V)return;const ne=Array.from(f.sets),[ge]=ne.splice(P,1);ne.splice(V,0,ge);const ve=Le=>Le.map(ct=>{const Pe=Array.from(ct.statuses||[]),[pt]=Pe.splice(P,1);return Pe.splice(V,0,pt),{...ct,statuses:Pe}}),je=ve(f.teamAMembers),ce=ve(f.teamBMembers);te(Le=>({...Le,sets:ne,teamAMembers:je,teamBMembers:ce}))};d.useEffect(()=>{Te(o=>{const P={...o};return Object.keys(P).forEach(V=>{f.sets.some(ne=>ne.id===V)||delete P[V]}),P})},[f.sets]),d.useEffect(()=>{te(o=>re(o))},[re]);const nt=o=>{var P;return((P=u.find(V=>V.id===o))==null?void 0:P.name)||""},ke=d.useMemo(()=>f.date!==t.date||f.matchName!==t.matchName||f.location!==t.location||f.mainReferee!==t.mainReferee||f.subReferee!==t.subReferee||f.videoUrl!==t.videoUrl||f.memo!==t.memo||f.teamA!==t.teamA||f.teamAHeadCoach!==t.teamAHeadCoach||f.teamACoach!==t.teamACoach||f.teamAManager!==t.teamAManager||f.teamACaptain!==t.teamACaptain||f.teamB!==t.teamB||f.teamBHeadCoach!==t.teamBHeadCoach||f.teamBCoach!==t.teamBCoach||f.teamBManager!==t.teamBManager||f.teamBCaptain!==t.teamBCaptain||JSON.stringify(f.tags)!==JSON.stringify(t.tags)||JSON.stringify(f.teamAMembers)!==JSON.stringify(t.teamAMembers)||JSON.stringify(f.teamBMembers)!==JSON.stringify(t.teamBMembers)||JSON.stringify(f.matchStatsSettings||[])!==JSON.stringify(t.matchStatsSettings||[])||JSON.stringify(f.sets)!==JSON.stringify(t.sets),[f,t]);d.useEffect(()=>{localStorage.getItem(I)&&me(!0)},[I]),d.useEffect(()=>{if(!W.current){W.current=!0;return}ke?localStorage.setItem(I,JSON.stringify(f)):localStorage.removeItem(I)},[f,ke,I]);const $e=()=>{if(v||f.sets.length>=ee)return;f.sets.length===1&&!localStorage.getItem("tutorial-set-reorder")&&S(!0);const o={id:Di(),my:0,opponent:0,rallies:[]},P=f.sets.length+1;te(V=>({...V,sets:[...V.sets,o],teamAMembers:V.teamAMembers.map(ne=>({...ne,statuses:[...ne.statuses||[],""]})),teamBMembers:V.teamBMembers.map(ne=>({...ne,statuses:[...ne.statuses||[],""]}))})),ie(String(P)),Q(`/matches/${t.id}/${P}`)},Dt=o=>{v||(O(o),w(!0))},Bt=()=>{if(E===null)return;const o=E,P=f.sets.length;let V=[],ne=[],ge=[];const ve=T;let je=T;if(T!=="info"&&T!=="members"&&T!=="stats"&&T!=="setinfo"){const ce=Number(T)-1;ce===o?o>0?(je=String(o),Q(`/matches/${t.id}/${o}`)):P>1?(je="1",Q(`/matches/${t.id}/1`)):(je="info",Q(`/matches/${t.id}/info`)):ce>o&&(je=String(ce),Q(`/matches/${t.id}/${ce}`))}ie(je),te(ce=>{V=ce.sets.map(Pe=>({...Pe})),ne=ce.teamAMembers.map(Pe=>({...Pe,statuses:Pe.statuses?[...Pe.statuses]:[]})),ge=ce.teamBMembers.map(Pe=>({...Pe,statuses:Pe.statuses?[...Pe.statuses]:[]}));const Le=ce.sets.filter((Pe,pt)=>pt!==o),ct=Pe=>Pe.map(pt=>({...pt,statuses:(pt.statuses||[]).filter((ki,Vs)=>Vs!==o)}));return{...ce,sets:Le,teamAMembers:ct(ce.teamAMembers),teamBMembers:ct(ce.teamBMembers)}}),O(null),w(!1),m("セットを削除しました","success",{actionLabel:"元に戻す",onAction:()=>{te(ce=>({...ce,sets:V,teamAMembers:ne,teamBMembers:ge})),ve!=="info"&&ve!=="members"&&ve!=="stats"&&ve!=="setinfo"&&Q(`/matches/${t.id}/${ve}`)},autoHideDuration:5e3})},vt=()=>{O(null),w(!1)},ht=d.useCallback(()=>{a(!0)},[]),kt=async()=>{const o=re(f);te(o);try{await Promise.resolve(p(o)),localStorage.removeItem(I),m("保存しました","success")}catch{m("保存に失敗しました","error")}a(!1)},Ct=()=>{a(!1)},Os=()=>{h(o=>({...o,open:!1}))},Hs=()=>{const o=localStorage.getItem(I);if(!o){me(!1);return}try{const P=JSON.parse(o),V={...P,tags:P.tags||[],matchStatsSettings:P.matchStatsSettings||[],teamAMembers:P.teamAMembers.map(ge=>({...ge,statuses:ge.statuses??Array(P.sets.length).fill("")})),teamBMembers:P.teamBMembers.map(ge=>({...ge,statuses:ge.statuses??Array(P.sets.length).fill("")}))},ne=re(V);te(ne),p(ne)}catch{}localStorage.removeItem(I),me(!1)},hs=()=>{localStorage.removeItem(I),me(!1)},Ye=d.useMemo(()=>/^[0-9]+$/.test(T),[T]),mt=d.useMemo(()=>Ye?f.sets[Number(T)-1]:null,[Ye,T,f.sets]),St=d.useMemo(()=>{var o;return!Ye||v||!mt||!((o=fe[mt.id])!=null&&o.undo.length)},[Ye,v,mt,fe]),Tt=d.useMemo(()=>{var o;return!Ye||v||!mt||!((o=fe[mt.id])!=null&&o.redo.length)},[Ye,v,mt,fe]);d.useEffect(()=>{St?Se(!1):localStorage.getItem("tutorial-undo")||Se(!0)},[St]),d.useEffect(()=>{Tt?M(!1):localStorage.getItem("tutorial-redo")||M(!0)},[Tt]),d.useEffect(()=>{if(X){const o=pe?"undo":y?"redo":null;k(e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Ee,{open:!!o,onClose:()=>{o==="undo"?Se(!1):o==="redo"&&M(!1)},disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:We,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${F}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${F}`}}}},title:e.jsx(s,{sx:{p:1,maxWidth:260},children:o==="undo"?e.jsxs(e.Fragment,{children:[e.jsxs(Fe,{variant:"body2",sx:{whiteSpace:"pre-line"},children:["メニューから",e.jsx($t,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),Ze.undoMobile.text]}),e.jsx(s,{sx:{textAlign:"right",mt:1},children:e.jsx(Qe,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem("tutorial-undo","1"),Se(!1)},children:"了解した"})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(Fe,{variant:"body2",sx:{whiteSpace:"pre-line"},children:["メニューから",e.jsx(_t,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),Ze.redoMobile.text]}),e.jsx(s,{sx:{textAlign:"right",mt:1},children:e.jsx(Qe,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem("tutorial-redo","1"),M(!1)},children:"了解した"})})]})}),children:e.jsx(De,{color:"inherit",onClick:ae,children:e.jsx(Ps,{})})}),e.jsxs(Ns,{anchorEl:Y,open:!!Y,onClose:q,MenuListProps:{onClick:q},children:[Ye&&e.jsxs(e.Fragment,{children:[e.jsxs(oe,{onClick:Be,disabled:St,children:[e.jsx(ft,{children:e.jsx($t,{fontSize:"small"})}),e.jsx(gt,{children:"元に戻す"})]}),e.jsxs(oe,{onClick:He,disabled:Tt,children:[e.jsx(ft,{children:e.jsx(_t,{fontSize:"small"})}),e.jsx(gt,{children:"やり直す"})]})]}),e.jsxs(oe,{onClick:ht,disabled:!ke||v,children:[e.jsx(ft,{children:e.jsx(Ne,{fontSize:"small"})}),e.jsx(gt,{children:"保存"})]})]})]}))}else k(e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[Ye&&e.jsxs(e.Fragment,{children:[e.jsx(Ee,{open:pe,onClose:()=>Se(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:We,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${F}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${F}`}}}},title:e.jsxs(s,{sx:{p:1,maxWidth:260},children:[e.jsx(Fe,{variant:"body2",sx:{whiteSpace:"pre-line"},children:Ze.undoDesktop.text}),e.jsx(s,{sx:{textAlign:"right",mt:1},children:e.jsx(Qe,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem("tutorial-undo","1"),Se(!1)},children:"了解した"})})]}),children:e.jsx(De,{onClick:Be,disabled:St,color:"inherit",sx:{ml:1},children:e.jsx($t,{})})}),e.jsx(Ee,{open:y,onClose:()=>M(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:We,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${F}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${F}`}}}},title:e.jsxs(s,{sx:{p:1,maxWidth:260},children:[e.jsx(Fe,{variant:"body2",sx:{whiteSpace:"pre-line"},children:Ze.redoDesktop.text}),e.jsx(s,{sx:{textAlign:"right",mt:1},children:e.jsx(Qe,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem("tutorial-redo","1"),M(!1)},children:"了解した"})})]}),children:e.jsx(De,{onClick:He,disabled:Tt,color:"inherit",sx:{ml:1},children:e.jsx(_t,{})})})]}),e.jsx(ue,{onClick:ht,variant:"contained",disabled:!ke||v,startIcon:e.jsx(Ne,{}),sx:{ml:1},children:"保存"})]}));return()=>k(null)},[k,X,Y,ae,q,Ye,Be,He,ht,ke,v,St,Tt,pe,y,F]),d.useEffect(()=>($==null||$(ke),()=>$==null?void 0:$(!1)),[ke,$]);const Ls=[{key:"info",label:"試合概要",icon:e.jsx(tn,{})},{key:"team",label:"チーム",icon:e.jsx(As,{})},{key:"members",label:"メンバー登録",icon:e.jsx(Ts,{})},{key:"sep1",divider:!0},{key:"stats",label:"スタッツ",icon:e.jsx(sn,{})},{key:"sep2",divider:!0},{key:"setinfo",label:"セット情報",icon:e.jsx(ws,{})}].filter(o=>o.key!=="setinfo"),Es=f.sets.map((o,P)=>{const V=B[P];return{key:`${P+1}`,icon:e.jsx(V,{}),label:`${o.my}-${o.opponent}`}}),Ws=!v&&f.sets.length<ee?[{key:"add",label:"セット追加",icon:e.jsx(Lt,{})}]:[],Et=o=>{o==="add"?$e():(ie(o),Q(`/matches/${t.id}/${o}`)),U||(he(!1),xe(!1))},Us=e.jsxs(Mi,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},sx:{flexGrow:1,overflowY:"auto",display:"flex",flexDirection:"column"},children:[T==="info"&&e.jsx(Ai,{match:f,setMatch:te,tags:G,onAddTag:N,locked:v}),T==="members"&&e.jsx(wi,{match:f,setMatch:te,teamAName:nt(f.teamA)||"チームA",teamBName:nt(f.teamB)||"チームB",teamMembers:b,onAddMember:L,locked:v,showSnackbar:m}),T==="stats"&&e.jsx(yi,{sets:f.sets,playDetails:c,playCategories:r,statsSettings:i,matchStatsSettings:f.matchStatsSettings||[],onMatchStatsSettingsChange:o=>te(P=>({...P,matchStatsSettings:o})),rallyCategoryTags:D,rallyDetailTags:j,teamAName:nt(f.teamA),teamBName:nt(f.teamB),locked:v,showSnackbar:m}),T==="team"&&e.jsx(s,{sx:{maxWidth:1024,mx:"auto"},children:e.jsx(Ii,{match:f,setMatch:te,teams:u,locked:v})}),se,T!=="info"&&T!=="members"&&T!=="stats"&&T!=="setinfo"&&T!=="team"&&e.jsx(pi,{setScore:f.sets[Number(T)-1],playDetails:c,playCategories:r,teamAMembers:f.teamAMembers,teamBMembers:f.teamBMembers,teamAName:nt(f.teamA),teamBName:nt(f.teamB),locked:v,scoreInputSetting:A,themeSetting:g,onChange:o=>be(o.id,o),showSnackbar:m})]},T);return e.jsxs(s,{sx:{display:"flex",height:"100%"},children:[e.jsx(Gs,{variant:U?"permanent":"temporary",open:U?!0:J,onClose:()=>{he(!1),xe(!1)},PaperProps:{onTransitionEnd:H},ModalProps:{keepMounted:!0,BackdropProps:{sx:{backgroundColor:"rgba(0, 0, 0, 0.5)"}}},sx:{width:U?J?ye:we:ye,flexShrink:0,transition:_.transitions.create("width",{easing:_.transitions.easing.sharp,duration:_.transitions.duration.standard}),...U?{zIndex:_.zIndex.appBar-1}:{},"& .MuiDrawer-paper":{width:U?J?ye:we:ye,boxSizing:"border-box",overflowX:"hidden",transition:_.transitions.create("width",{easing:_.transitions.easing.sharp,duration:_.transitions.duration.standard}),...U?{top:_.mixins.toolbar.minHeight,height:`calc(100% - ${_.mixins.toolbar.minHeight}px)`,zIndex:_.zIndex.appBar-1}:{}}},children:e.jsxs(Ys,{children:[Ls.map(o=>o.divider?e.jsx(Xs,{component:"li"},o.key):e.jsxs(Ut,{selected:T===o.key,onClick:()=>Et(o.key),sx:{minHeight:48,justifyContent:J?"initial":"center",px:2.5},children:[e.jsx(ft,{sx:{minWidth:0,mr:J?3:0,justifyContent:"center"},children:o.icon}),e.jsx(gt,{primary:o.label??`セット${o.key}`,sx:{opacity:le?1:0,display:le?"block":"none",whiteSpace:"nowrap"}})]},o.key)),e.jsx(It,{onDragEnd:Ge,children:e.jsx(at,{droppableId:"drawer-sets",children:o=>e.jsxs(s,{ref:o.innerRef,...o.droppableProps,children:[Es.map((P,V)=>e.jsx(ot,{draggableId:f.sets[V].id,index:V,children:ne=>e.jsxs(Ut,{ref:ne.innerRef,...ne.draggableProps,...ne.dragHandleProps,style:ne.draggableProps.style,selected:T===P.key,onClick:()=>Et(P.key),sx:{minHeight:48,justifyContent:J?"initial":"center",px:2.5},children:[e.jsx(ft,{sx:{minWidth:0,mr:J?3:0,justifyContent:"center"},children:P.icon}),e.jsx(gt,{primary:P.label??`セット${P.key}`,sx:{opacity:le?1:0,display:le?"block":"none",whiteSpace:"nowrap"}}),!v&&J&&e.jsx(De,{edge:"end",onClick:ge=>{ge.stopPropagation(),Dt(V)},children:e.jsx(st,{})})]})},f.sets[V].id)),o.placeholder]})})}),Ws.map(o=>e.jsxs(Ut,{selected:T===o.key,onClick:()=>Et(o.key),sx:{minHeight:48,justifyContent:J?"initial":"center",px:2.5},children:[e.jsx(ft,{sx:{minWidth:0,mr:J?3:0,justifyContent:"center"},children:o.icon}),e.jsx(gt,{primary:o.label??`セット${o.key}`,sx:{opacity:le?1:0,display:le?"block":"none",whiteSpace:"nowrap"}})]},o.key))]})}),e.jsxs(s,{sx:{flexGrow:1,display:"flex",flexDirection:"column",width:U?`calc(100% - ${J?ye:we}px)`:"100%",transition:U?_.transitions.create("width",{duration:_.transitions.duration.standard}):void 0},children:[e.jsx(s,{sx:{flexGrow:1,position:"relative",overflowY:"hidden",display:"flex",width:"100%"},children:e.jsx(rn,{mode:"wait",children:Us})}),e.jsxs(Vt,{open:l,onClose:vt,children:[e.jsx(it,{children:"削除確認"}),e.jsx(rt,{sx:{mt:2},children:"このセットを削除しますか？"}),e.jsxs(lt,{children:[e.jsx(ue,{onClick:vt,startIcon:e.jsx(tt,{}),color:"inherit",children:"キャンセル"}),e.jsx(ue,{onClick:Bt,color:"error",startIcon:e.jsx(Ne,{}),children:"OK"})]})]}),e.jsxs(Vt,{open:R,onClose:hs,children:[e.jsx(it,{children:"復元確認"}),e.jsx(rt,{sx:{mt:2},children:"入力途中のデータが存在します。復元しますか？"}),e.jsxs(lt,{children:[e.jsx(ue,{onClick:hs,startIcon:e.jsx(tt,{}),color:"inherit",children:"いいえ"}),e.jsx(ue,{onClick:Hs,startIcon:e.jsx(Ne,{}),children:"はい"})]})]}),e.jsxs(Vt,{open:Ae,onClose:Ct,children:[e.jsx(it,{children:"保存確認"}),e.jsx(rt,{sx:{mt:2},children:"入力内容を保存しますか？"}),e.jsxs(lt,{children:[e.jsx(ue,{onClick:Ct,startIcon:e.jsx(tt,{}),color:"inherit",children:"キャンセル"}),e.jsx(ue,{onClick:kt,disabled:!ke||v,startIcon:e.jsx(Ne,{}),children:"OK"})]})]}),e.jsx(en,{open:n.open,message:n.message,severity:n.severity,onClose:Os,actionLabel:n.actionLabel,onAction:n.onAction,autoHideDuration:n.autoHideDuration})]})]})}export{Li as default};
