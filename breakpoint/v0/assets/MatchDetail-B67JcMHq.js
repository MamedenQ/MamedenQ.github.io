import{i as je,j as e,E as Ke,G as Je,d as We,e as Fe,B as n,F as Te,K as Ae,S as we,M as se,H as Ne,r as ae,J as ps,I as ye,L as Vs,N as us,a as kt,O as js,n as zt,Q as Tt,R as Ge,Z as Xe,y as De,U as Ye,V as qs,f as Le,g as mt,h as ft,k as Me,l as T,m as pt,C as Pe,W as Ht,X as pe,A as gs,Y as bt,_ as Ks,b as xs,$ as Js,a0 as xt,a1 as ht,a2 as Ns,a3 as Gs,a4 as Xs,a5 as Ft,D as Ot}from"./mui-vendor-DBE-HG4E.js";import{r as h,f as Ys,u as Qs}from"./react-vendor-QLNaZ7XN.js";import{r as ge,u as tt,R as yt,d as Ue,a as Qe,B as Dt,b as _t,c as Lt,S as lt,e as Oe,f as Be,g as Bt,h as Re,D as it,i as He,A as Zs}from"./index-Cw67aUCJ.js";import{d as en,a as tn}from"./QueryStatsOutlined-Bk7Q_BNO.js";import{d as hs}from"./SpaceDashboardOutlined-zB6gU8LF.js";import{D as vt,C as Ze,P as et,d as rt,a as At,u as $t}from"./useLongPress-DU9mAExN.js";import{m as sn,A as nn}from"./motion-vendor-ArpBbMV7.js";import"./chart-vendor-OsQvonB5.js";var Ut={},rn=je;Object.defineProperty(Ut,"__esModule",{value:!0});var bs=Ut.default=void 0,ln=rn(ge()),an=e;bs=Ut.default=(0,ln.default)((0,an.jsx)("path",{d:"M12 5.9c1.16 0 2.1.94 2.1 2.1s-.94 2.1-2.1 2.1S9.9 9.16 9.9 8s.94-2.1 2.1-2.1m0 9c2.97 0 6.1 1.46 6.1 2.1v1.1H5.9V17c0-.64 3.13-2.1 6.1-2.1M12 4C9.79 4 8 5.79 8 8s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4m0 9c-2.67 0-8 1.34-8 4v3h16v-3c0-2.66-5.33-4-8-4"}),"PersonOutlineOutlined");var Vt={},on=je;Object.defineProperty(Vt,"__esModule",{value:!0});var ys=Vt.default=void 0,dn=on(ge()),cn=e;ys=Vt.default=(0,dn.default)((0,cn.jsx)("path",{d:"M2 17h2v.5H3v1h1v.5H2v1h3v-4H2zm1-9h1V4H2v1h1zm-1 3h1.8L2 13.1v.9h3v-1H3.2L5 10.9V10H2zm5-6v2h14V5zm0 14h14v-2H7zm0-6h14v-2H7z"}),"FormatListNumberedOutlined");var qt={},un=je;Object.defineProperty(qt,"__esModule",{value:!0});var vs=qt.default=void 0,xn=un(ge()),hn=e;vs=qt.default=(0,xn.default)((0,hn.jsx)("path",{d:"M9 13.75c-2.34 0-7 1.17-7 3.5V19h14v-1.75c0-2.33-4.66-3.5-7-3.5M4.34 17c.84-.58 2.87-1.25 4.66-1.25s3.82.67 4.66 1.25zM9 12c1.93 0 3.5-1.57 3.5-3.5S10.93 5 9 5 5.5 6.57 5.5 8.5 7.07 12 9 12m0-5c.83 0 1.5.67 1.5 1.5S9.83 10 9 10s-1.5-.67-1.5-1.5S8.17 7 9 7m7.04 6.81c1.16.84 1.96 1.96 1.96 3.44V19h4v-1.75c0-2.02-3.5-3.17-5.96-3.44M15 12c1.93 0 3.5-1.57 3.5-3.5S16.93 5 15 5c-.54 0-1.04.13-1.5.35.63.89 1 1.98 1 3.15s-.37 2.26-1 3.15c.46.22.96.35 1.5.35"}),"GroupOutlined");var Kt={},mn=je;Object.defineProperty(Kt,"__esModule",{value:!0});var Cs=Kt.default=void 0,fn=mn(ge()),pn=e;Cs=Kt.default=(0,fn.default)((0,pn.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V5h14zm-7-2h2V7h-4v2h2z"}),"LooksOneOutlined");var Jt={},jn=je;Object.defineProperty(Jt,"__esModule",{value:!0});var Ss=Jt.default=void 0,gn=jn(ge()),bn=e;Ss=Jt.default=(0,gn.default)((0,bn.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V5h14zm-4-4h-4v-2h2c1.1 0 2-.89 2-2V9c0-1.11-.9-2-2-2H9v2h4v2h-2c-1.1 0-2 .89-2 2v4h6z"}),"LooksTwoOutlined");var Nt={},yn=je;Object.defineProperty(Nt,"__esModule",{value:!0});var Ts=Nt.default=void 0,vn=yn(ge()),Cn=e;Ts=Nt.default=(0,vn.default)((0,Cn.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V5h14zm-4-4v-1.5c0-.83-.67-1.5-1.5-1.5.83 0 1.5-.67 1.5-1.5V9c0-1.11-.9-2-2-2H9v2h4v2h-2v2h2v2H9v2h4c1.1 0 2-.89 2-2"}),"Looks3Outlined");var Gt={},Sn=je;Object.defineProperty(Gt,"__esModule",{value:!0});var As=Gt.default=void 0,Tn=Sn(ge()),An=e;As=Gt.default=(0,Tn.default)((0,An.jsx)("path",{d:"M19.04 3h-14c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16h-14V5h14zm-6-2h2V7h-2v4h-2V7h-2v6h4z"}),"Looks4Outlined");var Xt={},wn=je;Object.defineProperty(Xt,"__esModule",{value:!0});var ws=Xt.default=void 0,In=wn(ge()),Mn=e;ws=Xt.default=(0,In.default)((0,Mn.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V5h14zm-4-4v-2c0-1.11-.9-2-2-2h-2V9h4V7H9v6h4v2H9v2h4c1.1 0 2-.89 2-2"}),"Looks5Outlined");var Yt={},Dn=je;Object.defineProperty(Yt,"__esModule",{value:!0});var Et=Yt.default=void 0,Bn=Dn(ge()),$n=e;Et=Yt.default=(0,Bn.default)((0,$n.jsx)("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"}),"Save");var Qt={},kn=je;Object.defineProperty(Qt,"__esModule",{value:!0});var wt=Qt.default=void 0,_n=kn(ge()),Pn=e;wt=Qt.default=(0,_n.default)((0,Pn.jsx)("path",{d:"M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8"}),"UndoOutlined");var Zt={},Rn=je;Object.defineProperty(Zt,"__esModule",{value:!0});var It=Zt.default=void 0,zn=Rn(ge()),Fn=e;It=Zt.default=(0,zn.default)((0,Fn.jsx)("path",{d:"M18.4 10.6C16.55 8.99 14.15 8 11.5 8c-4.65 0-8.58 3.03-9.96 7.22L3.9 16c1.05-3.19 4.05-5.5 7.6-5.5 1.95 0 3.73.72 5.12 1.88L13 16h9V7z"}),"RedoOutlined");var es={},On=je;Object.defineProperty(es,"__esModule",{value:!0});var Is=es.default=void 0,Hn=On(ge()),En=e;Is=es.default=(0,Hn.default)((0,En.jsx)("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreVert");function Wn(s,p,m){const g=h.useCallback(r=>{let v=0,b=0;r.rallies.forEach(y=>{if(y.timeoutTeam||y.substitutionTeam)return;const B=p.find(H=>H.id===y.teamAPlayDetail),_=p.find(H=>H.id===y.teamBPlayDetail);(B==null?void 0:B.pointType)==="得点"||(_==null?void 0:_.pointType)==="失点"?v+=1:((_==null?void 0:_.pointType)==="得点"||(B==null?void 0:B.pointType)==="失点")&&(b+=1)}),r.my=v,r.opponent=b},[p]),u=h.useCallback(r=>{const v=[...s.rallies,r],b={...s,rallies:v};g(b),m(b)},[s,g,m]),a=h.useCallback(r=>{const v=s.rallies.filter((y,B)=>B!==r),b={...s,rallies:v};g(b),m(b)},[s,g,m]);return{addRally:u,deleteRally:a,calculateScores:g}}const Ln=h.forwardRef(function({setScore:p,playDetails:m,playCategories:g,teamAMembers:u,teamBMembers:a,teamAName:r,teamBName:v,scoreInputSetting:b,themeSetting:y,locked:B=!1,onAdd:_,onEdit:H},$){var oe,c,d,M,F,E,i,o;const z=tt("sm"),[ne,q]=h.useState(!1),[ee,te]=h.useState("teamA"),[S,Y]=h.useState(""),[G,ie]=h.useState(""),[j,Q]=h.useState(""),[N,D]=h.useState(""),[C,P]=h.useState(""),[W,J]=h.useState(""),[V,Z]=h.useState(""),[re,ce]=h.useState(""),[he,Ce]=h.useState(null),f=()=>{if(B)return;Ce(null);const t=[...p.rallies].reverse().find(w=>!w.timeoutTeam&&!w.substitutionTeam);let l="teamA";if(t){const w=m.find(K=>K.id===t.teamAPlayDetail),I=m.find(K=>K.id===t.teamBPlayDetail);(w==null?void 0:w.pointType)==="得点"||(I==null?void 0:I.pointType)==="失点"?l="teamA":((I==null?void 0:I.pointType)==="得点"||(w==null?void 0:w.pointType)==="失点")&&(l="teamB")}te(l),Y(""),ie(""),Q(""),D(""),P(""),J(""),Z(""),ce(""),q(!0)},A=t=>{var w,I;if(B)return;const l=p.rallies[t];Ce(t),te(l.serverTeam||"teamA"),Y(l.server&&(l.serverTeam==="teamA"?u.some(K=>K.id===l.server):a.some(K=>K.id===l.server))?l.server:""),ie(((w=m.find(K=>K.id===l.teamAPlayDetail))==null?void 0:w.playCategoryId)||""),D(l.teamAPlayDetail||""),J(u.some(K=>K.id===l.teamAMember)&&l.teamAMember||""),Q(((I=m.find(K=>K.id===l.teamBPlayDetail))==null?void 0:I.playCategoryId)||""),P(l.teamBPlayDetail||""),Z(a.some(K=>K.id===l.teamBMember)&&l.teamBMember||""),ce(l.timeoutTeam||""),q(!0)};h.useImperativeHandle($,()=>({openAddDialog:f,openEditDialog:A}));const O=()=>{var K,me;if(re)return!0;if(b.rallyMemberRequired&&!S||G&&!N||j&&!C||!!!(G&&N)&&!!!(j&&C))return!1;const w=(K=m.find(de=>de.id===N))==null?void 0:K.pointUnitType;if(b.rallyMemberRequired&&N&&w==="メンバー"&&!W)return!1;const I=(me=m.find(de=>de.id===C))==null?void 0:me.pointUnitType;return!(b.rallyMemberRequired&&C&&I==="メンバー"&&!V)},U=t=>re?{id:t??crypto.randomUUID(),timeoutTeam:re}:{id:t??crypto.randomUUID(),serverTeam:ee,server:S||void 0,teamAPlayDetail:N||void 0,teamAMember:W||void 0,teamBPlayDetail:C||void 0,teamBMember:V||void 0},R=()=>{if(he===null)_(U());else{const t=p.rallies[he].id;H(he,U(t))}q(!1)};return e.jsxs(yt,{open:ne,onClose:()=>q(!1),children:[e.jsx(Ke,{children:he===null?"ラリー追加":"ラリー編集"}),e.jsxs(Je,{sx:{display:"flex",flexDirection:"column"},children:[e.jsxs(We,{exclusive:!0,value:ee,onChange:(t,l)=>l&&te(l),fullWidth:!0,disabled:!!re,sx:{mb:1},children:[e.jsx(Fe,{value:"teamA",sx:{flex:1},children:e.jsx(n,{sx:{whiteSpace:"pre-line",textAlign:"center"},children:`${r||"チームA"}
サーブ`})}),e.jsx(Fe,{value:"teamB",sx:{flex:1},children:e.jsx(n,{sx:{whiteSpace:"pre-line",textAlign:"center"},children:`${v||"チームB"}
サーブ`})})]}),e.jsxs(Te,{fullWidth:!0,margin:"dense",required:b.rallyMemberRequired,disabled:!!re,children:[e.jsx(Ae,{id:"server",children:"サーバー"}),e.jsx(we,{labelId:"server",value:S,label:"サーバー",onChange:t=>Y(t.target.value),children:(ee==="teamA"?u:a).map(t=>e.jsx(se,{value:t.id,children:t.name},t.id))})]}),z?e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(n,{sx:{flex:1,display:"flex",flexDirection:"column",gap:1},children:[e.jsx(We,{sx:{mt:2,mb:1},orientation:"vertical",exclusive:!0,value:G,onChange:(t,l)=>{G===l||l===null?(ie(""),D("")):(ie(l),D(""))},disabled:!!re,children:g.filter(t=>t.visible!==!1).map(t=>e.jsx(Fe,{value:t.id,sx:{whiteSpace:"nowrap"},children:t.name},t.id))}),e.jsx(We,{orientation:"vertical",exclusive:!0,value:N,onChange:(t,l)=>{D(N===l||l===null?"":l)},disabled:!!re,children:m.filter(t=>t.playCategoryId===G&&t.visible!==!1).map(t=>{const l=t.pointType==="得点"?y.scoreColor:y.lossColor;return e.jsx(Fe,{value:t.id,sx:{whiteSpace:"nowrap",color:l,"&.Mui-selected":{color:l}},children:t.name},t.id)})}),e.jsxs(Te,{fullWidth:!0,margin:"dense",required:b.rallyMemberRequired&&((oe=m.find(t=>t.id===N))==null?void 0:oe.pointUnitType)==="メンバー",disabled:!!re,children:[e.jsx(Ae,{id:"amem",children:`${r||"チームA"}メンバー`}),e.jsxs(we,{labelId:"amem",value:W,label:`${r||"チームA"}メンバー`,onChange:t=>J(t.target.value),disabled:((c=m.find(t=>t.id===N))==null?void 0:c.pointUnitType)!=="メンバー",children:[e.jsx(se,{value:"",children:e.jsx("em",{children:"なし"})}),u.map(t=>e.jsx(se,{value:t.id,children:t.name},t.id))]})]})]}),e.jsxs(n,{sx:{flex:1,display:"flex",flexDirection:"column",gap:1},children:[e.jsx(We,{orientation:"vertical",exclusive:!0,value:j,onChange:(t,l)=>{j===l||l===null?(Q(""),P("")):(Q(l),P(""))},disabled:!!re,children:g.filter(t=>t.visible!==!1).map(t=>e.jsx(Fe,{value:t.id,sx:{whiteSpace:"nowrap"},children:t.name},t.id))}),e.jsx(We,{orientation:"vertical",exclusive:!0,value:C,onChange:(t,l)=>{P(C===l||l===null?"":l)},sx:{mt:1},disabled:!!re,children:m.filter(t=>t.playCategoryId===j&&t.visible!==!1).map(t=>{const l=t.pointType==="得点"?y.scoreColor:y.lossColor;return e.jsx(Fe,{value:t.id,sx:{whiteSpace:"nowrap",color:l,"&.Mui-selected":{color:l}},children:t.name},t.id)})}),e.jsxs(Te,{fullWidth:!0,margin:"dense",required:b.rallyMemberRequired&&((d=m.find(t=>t.id===C))==null?void 0:d.pointUnitType)==="メンバー",disabled:!!re,children:[e.jsx(Ae,{id:"bmem",children:`${v||"チームB"}メンバー`}),e.jsxs(we,{labelId:"bmem",value:V,label:`${v||"チームB"}メンバー`,onChange:t=>Z(t.target.value),disabled:((M=m.find(t=>t.id===C))==null?void 0:M.pointUnitType)!=="メンバー",children:[e.jsx(se,{value:"",children:e.jsx("em",{children:"なし"})}),a.map(t=>e.jsx(se,{value:t.id,children:t.name},t.id))]})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(n,{sx:{display:"flex",gap:2,mt:1},children:[e.jsx(We,{orientation:"vertical",exclusive:!0,value:G,onChange:(t,l)=>{G===l||l===null?(ie(""),D("")):(ie(l),D(""))},disabled:!!re,sx:{flex:"1 1 25%"},children:g.filter(t=>t.visible!==!1).map(t=>e.jsx(Fe,{value:t.id,sx:{whiteSpace:"nowrap"},children:t.name},t.id))}),e.jsx(We,{orientation:"vertical",exclusive:!0,value:N,onChange:(t,l)=>{D(N===l||l===null?"":l)},disabled:!!re,sx:{flex:"1 1 25%"},children:m.filter(t=>t.playCategoryId===G&&t.visible!==!1).map(t=>{const l=t.pointType==="得点"?y.scoreColor:y.lossColor;return e.jsx(Fe,{value:t.id,sx:{whiteSpace:"nowrap",color:l,"&.Mui-selected":{color:l}},children:t.name},t.id)})}),e.jsx(We,{orientation:"vertical",exclusive:!0,value:j,onChange:(t,l)=>{j===l||l===null?(Q(""),P("")):(Q(l),P(""))},disabled:!!re,sx:{flex:"1 1 25%"},children:g.filter(t=>t.visible!==!1).map(t=>e.jsx(Fe,{value:t.id,sx:{whiteSpace:"nowrap"},children:t.name},t.id))}),e.jsx(We,{orientation:"vertical",exclusive:!0,value:C,onChange:(t,l)=>{P(C===l||l===null?"":l)},disabled:!!re,sx:{flex:"1 1 25%"},children:m.filter(t=>t.playCategoryId===j&&t.visible!==!1).map(t=>{const l=t.pointType==="得点"?y.scoreColor:y.lossColor;return e.jsx(Fe,{value:t.id,sx:{whiteSpace:"nowrap",color:l,"&.Mui-selected":{color:l}},children:t.name},t.id)})})]}),e.jsxs(n,{sx:{display:"flex",gap:2,mt:1},children:[e.jsxs(Te,{fullWidth:!0,margin:"dense",required:b.rallyMemberRequired&&((F=m.find(t=>t.id===N))==null?void 0:F.pointUnitType)==="メンバー",disabled:!!re,sx:{flex:1},children:[e.jsx(Ae,{id:"amem",children:`${r||"チームA"}メンバー`}),e.jsxs(we,{labelId:"amem",value:W,label:`${r||"チームA"}メンバー`,onChange:t=>J(t.target.value),disabled:((E=m.find(t=>t.id===N))==null?void 0:E.pointUnitType)!=="メンバー",children:[e.jsx(se,{value:"",children:e.jsx("em",{children:"なし"})}),u.map(t=>e.jsx(se,{value:t.id,children:t.name},t.id))]})]}),e.jsxs(Te,{fullWidth:!0,margin:"dense",required:b.rallyMemberRequired&&((i=m.find(t=>t.id===C))==null?void 0:i.pointUnitType)==="メンバー",disabled:!!re,sx:{flex:1},children:[e.jsx(Ae,{id:"bmem",children:`${v||"チームB"}メンバー`}),e.jsxs(we,{labelId:"bmem",value:V,label:`${v||"チームB"}メンバー`,onChange:t=>Z(t.target.value),disabled:((o=m.find(t=>t.id===C))==null?void 0:o.pointUnitType)!=="メンバー",children:[e.jsx(se,{value:"",children:e.jsx("em",{children:"なし"})}),a.map(t=>e.jsx(se,{value:t.id,children:t.name},t.id))]})]})]})]})]}),e.jsxs(Ne,{children:[e.jsx(ae,{onClick:()=>q(!1),color:"inherit",startIcon:e.jsx(Ue,{}),children:"キャンセル"}),e.jsx(ae,{onClick:R,disabled:!O(),startIcon:e.jsx(Qe,{}),children:"OK"})]})]})});var ts={},Un=je;Object.defineProperty(ts,"__esModule",{value:!0});var Ms=ts.default=void 0,Vn=Un(ge()),qn=e;Ms=ts.default=(0,Vn.default)((0,qn.jsx)("path",{d:"M16 17.01V10h-2v7.01h-3L15 21l4-3.99zM9 3 5 6.99h3V14h2V6.99h3zm7 14.01V10h-2v7.01h-3L15 21l4-3.99zM9 3 5 6.99h3V14h2V6.99h3z"}),"SwapVertOutlined");const Kn=h.forwardRef(function({teamAMembers:p,teamBMembers:m,onSave:g},u){const[a,r]=h.useState(!1),[v,b]=h.useState("teamA"),[y,B]=h.useState(""),[_,H]=h.useState(""),[$,z]=h.useState(null),ne=S=>{b(S),B(""),H(""),z(null),r(!0)},q=(S,Y,G,ie)=>{b(Y),B(G),H(ie),z(S),r(!0)};h.useImperativeHandle(u,()=>({openAddDialog:ne,openEditDialog:q}));const ee=()=>{r(!1),z(null)},te=()=>{g(v,y,_,$),r(!1),z(null)};return e.jsxs(yt,{open:a,onClose:ee,children:[e.jsx(Ke,{children:"選手交代"}),e.jsx(Je,{children:e.jsxs(n,{component:"form",sx:{mt:2},children:[e.jsxs(Te,{fullWidth:!0,sx:{mb:2},children:[e.jsx(Ae,{id:"out-member",children:"OUT"}),e.jsx(we,{labelId:"out-member",value:y,label:"OUT",onChange:S=>B(S.target.value),children:(v==="teamA"?p:m).map(S=>e.jsx(se,{value:S.id,children:`${S.no}:${S.name}`},S.id))})]}),e.jsx(n,{sx:{display:"flex",justifyContent:"center",mb:2},children:e.jsx(Ms,{sx:{width:32,height:32}})}),e.jsxs(Te,{fullWidth:!0,children:[e.jsx(Ae,{id:"in-member",children:"IN"}),e.jsx(we,{labelId:"in-member",value:_,label:"IN",onChange:S=>H(S.target.value),children:(v==="teamA"?p:m).map(S=>e.jsx(se,{value:S.id,children:`${S.no}:${S.name}`},S.id))})]})]})}),e.jsxs(Ne,{children:[e.jsx(ae,{onClick:ee,color:"inherit",startIcon:e.jsx(Ue,{}),children:"キャンセル"}),e.jsx(ae,{onClick:te,disabled:!y||!_,startIcon:e.jsx(Qe,{}),children:"OK"})]})]})});function Jn({open:s,onClose:p,scores:m,consecutive:g,connections:u,rowHeight:a}){const r=m.length*a;return e.jsx(ps,{anchor:"bottom",open:s,onClose:p,onOpen:()=>{},disableSwipeToOpen:!0,sx:{zIndex:v=>v.zIndex.drawer+3},PaperProps:{sx:{height:"60vh",borderTopLeftRadius:Dt,borderTopRightRadius:Dt}},children:e.jsxs(n,{sx:{position:"relative",height:"100%"},children:[e.jsx(n,{sx:{width:40,height:4,bgcolor:"text.secondary",borderRadius:2,position:"absolute",top:8,left:"50%",transform:"translateX(-50%)"}}),e.jsx(ye,{onClick:p,sx:{position:"absolute",top:4,right:4},children:e.jsx(Ue,{})}),e.jsx(n,{sx:{mt:4,height:"100%",overflowY:"auto"},children:e.jsxs(n,{sx:{flex:"0 0 100%",overflowY:"auto",height:"100%",position:"relative"},children:[m.map((v,b)=>{const y=b===0?{a:0,b:0}:m[b-1],B=v.a!==y.a&&v.a!==0,_=v.b!==y.b&&v.b!==0,H=B&&g[b],$=_&&g[b];return e.jsxs(n,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr 1fr",alignItems:"center",py:.5,height:`${a}px`,position:"relative",zIndex:1},children:[e.jsx(n,{}),e.jsxs(e.Fragment,{children:[e.jsx(n,{sx:{display:"flex",justifyContent:"center"},children:B?e.jsx(n,{sx:{width:32,height:32,border:"1px solid",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:24,borderColor:H?"red":"currentColor",backgroundColor:H?"#ffebee":"#fff",color:"black"},children:v.a}):null}),e.jsx(n,{}),e.jsx(n,{sx:{display:"flex",justifyContent:"center"},children:_?e.jsx(n,{sx:{width:32,height:32,border:"1px solid",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:24,borderColor:$?"red":"currentColor",backgroundColor:$?"#ffebee":"#fff",color:"black"},children:v.b}):null})]}),e.jsx(n,{})]},b)}),e.jsx("svg",{viewBox:`0 0 100 ${r}`,style:{position:"absolute",left:0,top:0,width:"100%",height:r,zIndex:0},preserveAspectRatio:"none",pointerEvents:"none",children:u.map(v=>{const b=v.index*a+a/2,y=(v.index+1)*a+a/2,B=v.from==="A"?30:70,_=v.from==="A"?70:30;return e.jsx("line",{x1:B,y1:b,x2:_,y2:y,stroke:"currentColor",strokeWidth:1},v.index)})})]})})]})})}var ss={},Nn=je;Object.defineProperty(ss,"__esModule",{value:!0});var Ds=ss.default=void 0,Gn=Nn(ge()),Xn=e;Ds=ss.default=(0,Gn.default)((0,Xn.jsx)("path",{d:"M3 18h18v-2H3zm0-5h18v-2H3zm0-7v2h18V6z"}),"Menu");function Yn({open:s,onClose:p,teamAName:m,teamBName:g,disableTimeoutA:u,disableTimeoutB:a,showScoreProgressButton:r,onShowScoreProgress:v,onSubstitution:b,onTimeout:y,onAddRally:B}){const _=z=>()=>{z(),p()},$=tt("sm")?"vertical":"horizontal";return e.jsx(ps,{anchor:"bottom",open:s,onClose:p,onOpen:()=>{},sx:{zIndex:z=>z.zIndex.drawer+2},PaperProps:{sx:{height:"auto",maxHeight:"80vh",borderTopLeftRadius:Dt,borderTopRightRadius:Dt}},children:e.jsx(n,{sx:{p:2},children:e.jsxs(Vs,{spacing:2,children:[r&&e.jsx(ae,{fullWidth:!0,variant:"outlined",onClick:_(v),children:"得点推移表示"}),e.jsxs(us,{fullWidth:!0,orientation:$,children:[e.jsx(ae,{onClick:_(()=>b("teamA")),children:(m||"チームA")+" メンバー交代"}),e.jsx(ae,{onClick:_(()=>b("teamB")),children:(g||"チームB")+" メンバー交代"})]}),e.jsxs(us,{fullWidth:!0,orientation:$,children:[e.jsx(ae,{disabled:u,onClick:_(()=>y("teamA")),children:(m||"チームA")+" タイムアウト"}),e.jsx(ae,{disabled:a,onClick:_(()=>y("teamB")),children:(g||"チームB")+" タイムアウト"})]}),e.jsx(ae,{fullWidth:!0,variant:"contained",onClick:_(B),children:"ラリー結果追加"})]})})})}var ns={},Qn=je;Object.defineProperty(ns,"__esModule",{value:!0});var Bs=ns.default=void 0,Zn=Qn(ge()),ei=e;Bs=ns.default=(0,Zn.default)((0,ei.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8m.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"}),"AccessTimeOutlined");var is={},ti=je;Object.defineProperty(is,"__esModule",{value:!0});var $s=is.default=void 0,si=ti(ge()),ni=e;$s=is.default=(0,si.default)((0,ni.jsx)("path",{d:"M6.99 11 3 15l3.99 4v-3H14v-2H6.99zM21 9l-3.99-4v3H10v2h7.01v3z"}),"SwapHorizOutlined");function ii({teamAName:s,teamBName:p,locked:m,disableTimeoutA:g,disableTimeoutB:u,onTimeout:a,onSubstitution:r,onAddRally:v}){const b=kt(),[y,B]=h.useState(!1),[_,H]=h.useState(!1),$="tutorial-settab-add-rally",[z,ne]=h.useState(()=>!localStorage.getItem($));return m?null:e.jsxs(js,{children:[e.jsxs(zt,{ariaLabel:"substitution actions",direction:"left",icon:e.jsx($s,{}),onOpen:()=>H(!0),onClose:()=>H(!1),open:_,FabProps:{size:"large"},sx:{position:"fixed",right:35,bottom:200,zIndex:q=>q.zIndex.drawer-1},children:[e.jsx(Tt,{icon:e.jsx(e.Fragment,{children:p||"チームB"}),tooltipTitle:"",FabProps:{variant:"extended",size:"small"},onClick:()=>{r("teamB"),H(!1)}}),e.jsx(Tt,{icon:e.jsx(e.Fragment,{children:s||"チームA"}),tooltipTitle:"",FabProps:{variant:"extended",size:"small"},onClick:()=>{r("teamA"),H(!1)}})]}),e.jsxs(zt,{ariaLabel:"timeout actions",direction:"left",icon:e.jsx(Bs,{}),onOpen:()=>B(!0),onClose:()=>B(!1),open:y,FabProps:{size:"large"},sx:{position:"fixed",right:35,bottom:140,zIndex:q=>q.zIndex.drawer-1},children:[e.jsx(Tt,{icon:e.jsx(e.Fragment,{children:p||"チームB"}),tooltipTitle:"",FabProps:{variant:"extended",size:"small",disabled:u},onClick:()=>{a("teamB"),B(!1)}}),e.jsx(Tt,{icon:e.jsx(e.Fragment,{children:s||"チームA"}),tooltipTitle:"",FabProps:{variant:"extended",size:"small",disabled:g},onClick:()=>{a("teamA"),B(!1)}})]}),e.jsx(Ge,{open:z,onClose:()=>ne(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"left",TransitionComponent:Xe,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${b.palette.text.secondary}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${b.palette.text.secondary}`}}}},title:e.jsxs(n,{sx:{p:1,maxWidth:260},children:[e.jsx(De,{variant:"body2",children:"ラリー結果、タイムアウト、メンバー交代を追加できます"}),e.jsx(n,{sx:{textAlign:"right",mt:1},children:e.jsx(Ye,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem($,"1"),ne(!1)},children:"了解した"})})]}),children:e.jsx(zt,{ariaLabel:"rally actions",direction:"left",icon:e.jsx(_t,{}),FabProps:{size:"large",onClick:v},sx:{position:"fixed",right:35,bottom:80,zIndex:q=>q.zIndex.drawer-1}})})]})}function ri({isMobile:s,openActionMenu:p,onOpenActionMenu:m,onCloseActionMenu:g,teamAName:u,teamBName:a,disableTimeoutA:r,disableTimeoutB:v,showScoreProgressButton:b,onShowScoreProgress:y,onSubstitution:B,onTimeout:_,onAddRally:H,locked:$}){return e.jsxs(e.Fragment,{children:[!$&&s&&e.jsx(js,{children:e.jsx(qs,{color:"primary",onClick:m,sx:{position:"fixed",right:35,bottom:z=>`calc(${z.spacing(7)} + env(safe-area-inset-bottom) + 16px)`,zIndex:z=>z.zIndex.drawer+2},children:e.jsx(Ds,{})})}),s?e.jsx(Yn,{open:p,onClose:g,teamAName:u,teamBName:a,disableTimeoutA:r,disableTimeoutB:v,showScoreProgressButton:b,onShowScoreProgress:y,onSubstitution:B,onTimeout:_,onAddRally:H}):e.jsx(ii,{teamAName:u,teamBName:a,locked:$,disableTimeoutA:r,disableTimeoutB:v,onSubstitution:B,onTimeout:_,onAddRally:H})]})}var rs={},li=je;Object.defineProperty(rs,"__esModule",{value:!0});var Mt=rs.default=void 0,ai=li(ge()),oi=e;Mt=rs.default=(0,ai.default)((0,oi.jsx)("path",{d:"M16.01 11H4v2h12.01v3L20 12l-3.99-4z"}),"ArrowRightAlt");var ls={},di=je;Object.defineProperty(ls,"__esModule",{value:!0});var ks=ls.default=void 0,ci=di(ge()),ui=e;ks=ls.default=(0,ci.default)((0,ui.jsx)("path",{d:"m12 4-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"}),"ArrowForward");function xi(s){if(typeof window>"u")return s;try{const m=new DOMParser().parseFromString(s,"image/svg+xml"),g=new Set(["svg","g","path","circle","rect","line","polygon","polyline","text","defs","use"]),u=a=>{[...a.children].forEach(r=>{if(g.has(r.tagName))[...r.attributes].forEach(v=>{v.name.startsWith("on")&&r.removeAttribute(v.name)}),u(r);else{const v=document.createTextNode(r.outerHTML);r.replaceWith(v)}})};return u(m.documentElement),m.documentElement.outerHTML}catch{return""}}function hi({name:s}){const p=h.useRef(null),[m,g]=h.useState(1);return h.useEffect(()=>{const u=p.current;if(!u)return;const a=u.getBBox().width;g(a>64?64/a:1)},[s]),e.jsx("svg",{width:64,height:64,children:e.jsx("g",{transform:`scale(${m})`,children:e.jsx("text",{ref:p,x:32/m,y:32/m,textAnchor:"middle",dominantBaseline:"central",fontSize:8,children:s})})})}function mi({category:s,borderColor:p}){const m=p?{border:"1px solid",borderColor:p,boxSizing:"border-box"}:{};return s.iconType==="svg"&&s.svg?e.jsx(n,{sx:{width:64,height:64,...m},dangerouslySetInnerHTML:{__html:xi(s.svg)}}):s.iconType==="image"&&s.image?e.jsx(n,{component:"img",src:s.image,sx:{width:64,height:64,objectFit:"none",objectPosition:`-${s.cropX||0}px -${s.cropY||0}px`,...m}}):e.jsx(n,{sx:{width:64,height:64,display:"flex",...m},children:e.jsx(hi,{name:s.name})})}function fi({rallies:s,playDetails:p,playCategories:m,teamAMembers:g,teamBMembers:u,teamAName:a,teamBName:r,serveCategory:v,showRallyIcons:b,locked:y,isMobile:B,isPhone:_,scores:H,scoredTeam:$,showRallyHint:z,onCloseRallyHint:ne,onEditRally:q,onEditSubstitution:ee,onDelete:te,onDragEnd:S}){const Y=kt(),{handleTouchEnd:G,setSwiperRef:ie,getSwiperRef:j}=Lt(2),Q=h.useRef({}),[N,D]=h.useState({}),[C,P]=h.useState("");h.useLayoutEffect(()=>{const f={};s.forEach(A=>{const O=Q.current[A.id];O&&(f[A.id]=O.offsetHeight)}),D(f)},[s]);const W=f=>{if(!f)return;const A=p.find(O=>O.id===f);return m.find(O=>O.id===(A==null?void 0:A.playCategoryId))},J=(f,A)=>{if(!A)return"－";const U=(f==="teamA"?g:u).find(R=>R.id===A);return U?`${U.no}:${U.name}`:"－"},V=f=>{const A=H[f]||{a:0,b:0},O=$[f],U=Y.palette.text.primary,R=Y.palette.mode==="dark"?"#343A42":"#D3D3D3";return e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{color:O==="A"?U:R},children:String(A.a).padStart(2,"0")}),e.jsx("span",{style:{color:R},children:" - "}),e.jsx("span",{style:{color:O==="B"?U:R},children:String(A.b).padStart(2,"0")})]})},Z=(f,A,O)=>{var d;if(!f)return e.jsx(e.Fragment,{});const U=W(f),R=p.find(M=>M.id===f),oe=O==="A"?g:u,c=(R==null?void 0:R.pointType)==="得点"?Y.palette.success.main:(R==null?void 0:R.pointType)==="失点"?Y.palette.error.main:void 0;return e.jsxs(n,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[U?e.jsx(Pe,{label:U.name,size:"small",variant:"outlined",sx:{bgcolor:"transparent",color:U.color,borderColor:U.color,mb:.5,height:20,fontSize:"0.75rem","& .MuiChip-label":{px:.5}}}):null,R?e.jsx(Pe,{label:R.name,size:"small",sx:{bgcolor:c,color:"common.white",mb:.5,height:20,fontSize:"0.75rem","& .MuiChip-label":{px:.5}}}):null,e.jsx(De,{variant:"caption",noWrap:!0,sx:{width:"100%",textAlign:"center"},children:(R==null?void 0:R.pointUnitType)==="メンバー"&&((d=oe.find(M=>M.id===A))==null?void 0:d.name)||"－"})]})},re=(f,A,O)=>e.jsx(n,{ref:O.innerRef,...O.draggableProps,"data-index":A,sx:{mb:.5},children:e.jsxs(Bt,{onSwiper:U=>ie(f.id,U),threshold:20,slidesPerView:"auto",style:{overflow:"hidden",height:N[f.id]},onTouchStart:(U,R)=>R.stopPropagation(),onTouchEnd:U=>G(f.id,U),children:[e.jsx(Re,{style:{width:"100%",flex:"0 0 auto"},children:(()=>{const U=O.dragHandleProps,{onPointerDown:R,...oe}=U||{},c=$t(d=>{if(R==null||R(d),!R)return;const M=j(f.id);M&&(M.allowTouchMove=!1),P(f.id)});return e.jsx(n,{ref:d=>{Q.current[f.id]=d},...oe,...c,sx:{display:"grid",gridTemplateColumns:"38% 24% 38%",alignItems:"center",cursor:y?"default":"grab",touchAction:C===f.id?"none":"pan-y",backgroundColor:d=>f.timeoutTeam||f.substitutionTeam?d.palette.mode==="dark"?"#343A42":"#f5f5f5":void 0},children:f.timeoutTeam?e.jsxs(n,{gridColumn:"1 / 4",sx:{...Oe,display:"flex",justifyContent:"center",alignItems:"center",height:"100%",minHeight:44},children:[f.timeoutTeam==="teamA"?a||"チームA":r||"チームB","タイムアウト"]}):f.substitutionTeam?e.jsxs(n,{gridColumn:"1 / 4",sx:{...Oe,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100%"},children:[e.jsxs("span",{children:[f.substitutionTeam==="teamA"?a||"チームA":r||"チームB","選手交代"]}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",mt:.5},children:[e.jsx("span",{children:J(f.substitutionTeam,f.outMember)}),e.jsx(Mt,{fontSize:"small",sx:{mx:1}}),e.jsx("span",{children:J(f.substitutionTeam,f.inMember)})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(n,{children:Z(f.teamAPlayDetail,f.teamAMember,"A")}),e.jsxs(n,{sx:{fontSize:"2em",display:"flex",justifyContent:"center",flexDirection:"column",alignItems:"center"},children:[e.jsx(n,{sx:{whiteSpace:"nowrap"},children:V(A)}),f.serverTeam&&e.jsx(ks,{sx:{width:"calc(100% - 8px)",height:20,mx:"4px",transform:f.serverTeam==="teamB"?"scaleX(-1)":void 0}})]}),e.jsx(n,{children:Z(f.teamBPlayDetail,f.teamBMember,"B")})]})})})()}),e.jsx(Re,{style:{width:it,flex:"0 0 auto"},children:e.jsx(n,{sx:{height:N[f.id],display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"primary.main"},children:e.jsx(ye,{size:"small",disabled:y||!!f.timeoutTeam,onClick:y||f.timeoutTeam?void 0:()=>f.substitutionTeam?ee(A):q(A),children:e.jsx(At,{fontSize:"small",sx:{color:"common.white"}})})})}),e.jsx(Re,{style:{width:it,flex:"0 0 auto"},children:e.jsx(n,{sx:{height:N[f.id],display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"error.main"},children:e.jsx(ye,{size:"small",onClick:()=>te(A),children:e.jsx(Be,{fontSize:"small",sx:{color:"common.white"}})})})})]})}),ce=(f,A)=>{var O;return e.jsxs(n,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[b&&(v?e.jsx(mi,{category:v}):e.jsxs("svg",{width:64,height:64,children:[e.jsx("rect",{width:64,height:64,fill:"none",stroke:"currentColor"}),e.jsx("text",{x:"50%",y:"50%",textAnchor:"middle",dominantBaseline:"central",fontSize:"12",children:"サーブ"})]})),e.jsx(De,{variant:"caption",noWrap:!0,sx:{width:"100%",textAlign:"center"},children:((O=(f==="teamA"?g:u).find(U=>U.id===A))==null?void 0:O.name)||"－"})]})},he=(f,A,O)=>e.jsx(n,{ref:O.innerRef,...O.draggableProps,"data-index":A,sx:{mb:.5},children:e.jsxs(Bt,{onSwiper:U=>ie(f.id,U),threshold:20,slidesPerView:"auto",style:{overflow:"hidden",height:N[f.id]},onTouchStart:(U,R)=>R.stopPropagation(),onTouchEnd:U=>G(f.id,U),children:[e.jsx(Re,{style:{width:"100%",flex:"0 0 auto"},children:(()=>{const U=O.dragHandleProps,{onPointerDown:R,...oe}=U||{},c=$t(d=>{if(R==null||R(d),!R)return;const M=j(f.id);M&&(M.allowTouchMove=!1),P(f.id)});return e.jsx(n,{ref:d=>{Q.current[f.id]=d},...oe,...c,sx:{display:"grid",gridTemplateColumns:"16% 22% 24% 22% 16%",alignItems:"center",cursor:y?"default":"grab",touchAction:C===f.id?"none":"pan-y",backgroundColor:d=>f.timeoutTeam||f.substitutionTeam?d.palette.mode==="dark"?"#343A42":"#f5f5f5":void 0},children:f.timeoutTeam?e.jsxs(n,{gridColumn:"1 / 6",sx:{...Oe,display:"flex",justifyContent:"center",alignItems:"center",height:"100%",minHeight:44},children:[f.timeoutTeam==="teamA"?a||"チームA":r||"チームB","タイムアウト"]}):f.substitutionTeam?e.jsxs(n,{gridColumn:"1 / 6",sx:{...Oe,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100%"},children:[e.jsxs("span",{children:[f.substitutionTeam==="teamA"?a||"チームA":r||"チームB","選手交代"]}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",mt:.5},children:[e.jsx("span",{children:J(f.substitutionTeam,f.outMember)}),e.jsx(Mt,{fontSize:"small",sx:{mx:1}}),e.jsx("span",{children:J(f.substitutionTeam,f.inMember)})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(n,{children:f.serverTeam==="teamA"?ce("teamA",f.server):null}),e.jsx(n,{children:Z(f.teamAPlayDetail,f.teamAMember,"A")}),e.jsx(n,{sx:{fontSize:"2em",display:"flex",justifyContent:"center"},children:V(A)}),e.jsx(n,{children:Z(f.teamBPlayDetail,f.teamBMember,"B")}),e.jsx(n,{children:f.serverTeam==="teamB"?ce("teamB",f.server):null})]})})})()}),e.jsx(Re,{style:{width:it,flex:"0 0 auto"},children:e.jsx(n,{sx:{height:N[f.id],display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"primary.main"},children:e.jsx(ye,{size:"small",disabled:y||!!f.timeoutTeam,onClick:y||f.timeoutTeam?void 0:()=>f.substitutionTeam?ee(A):q(A),children:e.jsx(At,{fontSize:"small",sx:{color:"common.white"}})})})}),e.jsx(Re,{style:{width:it,flex:"0 0 auto"},children:e.jsx(n,{sx:{height:N[f.id],display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"error.main"},children:e.jsx(ye,{size:"small",onClick:()=>te(A),children:e.jsx(Be,{fontSize:"small",sx:{color:"common.white"}})})})})]})}),Ce=f=>{if(C){const A=j(C);A&&(A.allowTouchMove=!0),P("")}S(f)};return e.jsx(Ge,{open:z,onClose:ne,disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:Xe,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${Y.palette.text.secondary}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${Y.palette.text.secondary}`}}}},title:e.jsxs(n,{sx:{p:1,maxWidth:260},children:[e.jsx(De,{variant:"body2",children:B?e.jsxs(e.Fragment,{children:["行を長押ししてドラッグすることでラリー結果の順番を入れ替えることができます",e.jsx("br",{}),"左にスワイプすると",e.jsx(At,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),"で編集、",e.jsx(Be,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),"で削除できます"]}):e.jsxs(e.Fragment,{children:["行をタップすることでラリー結果を編集できます",e.jsx("br",{}),"左端の",e.jsx(rt,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),"をドラッグすることでラリー結果の順番を入れ替えることができます",e.jsx("br",{}),"右端の",e.jsx(Be,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),"をタップすることでラリー結果を削除することができます"]})}),e.jsx(n,{sx:{textAlign:"right",mt:1},children:e.jsx(Ye,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem("tutorial-rally-row","1"),ne()},children:"了解した"})})]}),children:e.jsx(n,{children:e.jsxs(vt,{onDragEnd:Ce,children:[B&&e.jsx(lt,{component:Le,storageKey:"set-tab",children:e.jsxs(n,{children:[e.jsx(n,{sx:{display:"grid",gridTemplateColumns:_?"38% 24% 38%":"16% 22% 24% 22% 16%",textAlign:"center",alignItems:"center",...Oe},children:_?e.jsxs(e.Fragment,{children:[e.jsxs(n,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("span",{children:a||"チームA"}),e.jsx("span",{children:"ラリー結果"})]}),e.jsx(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:"得点"}),e.jsxs(n,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("span",{children:r||"チームB"}),e.jsx("span",{children:"ラリー結果"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(n,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("span",{children:a||"チームA"}),e.jsx("span",{children:"サーブ"})]}),e.jsxs(n,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("span",{children:a||"チームA"}),e.jsx("span",{children:"ラリー結果"})]}),e.jsx(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:"得点"}),e.jsxs(n,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("span",{children:r||"チームB"}),e.jsx("span",{children:"ラリー結果"})]}),e.jsxs(n,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("span",{children:r||"チームB"}),e.jsx("span",{children:"サーブ"})]})]})}),e.jsx(Ze,{droppableId:"rallies",children:f=>e.jsxs(n,{ref:f.innerRef,...f.droppableProps,children:[s.map((A,O)=>e.jsx(et,{draggableId:A.id,index:O,isDragDisabled:y,children:U=>(_?re:he)(A,O,U)},A.id)),f.placeholder]})})]})}),!B&&e.jsx(lt,{component:Le,storageKey:"set-tab",children:e.jsxs(mt,{size:"small",sx:{tableLayout:"fixed","& th, & td":{textAlign:"center",verticalAlign:"middle"}},children:[e.jsx(ft,{children:e.jsxs(Me,{sx:{...Oe},children:[e.jsx(T,{sx:{width:"6%"}}),e.jsx(T,{sx:{width:"16%"},children:e.jsxs(n,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{children:a||"チームA"}),e.jsx("span",{children:"サーブ"})]})}),e.jsx(T,{sx:{width:"18%"},children:e.jsxs(n,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{children:a||"チームA"}),e.jsx("span",{children:"ラリー結果"})]})}),e.jsx(T,{sx:{width:"20%",display:"flex",justifyContent:"center",alignItems:"center"},children:"得点"}),e.jsx(T,{sx:{width:"18%"},children:e.jsxs(n,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{children:r||"チームB"}),e.jsx("span",{children:"ラリー結果"})]})}),e.jsx(T,{sx:{width:"16%"},children:e.jsxs(n,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{children:r||"チームB"}),e.jsx("span",{children:"サーブ"})]})}),e.jsx(T,{sx:{width:"6%"}})]})}),e.jsx(Ze,{droppableId:"rallies",children:f=>e.jsxs(pt,{ref:f.innerRef,...f.droppableProps,children:[s.map((A,O)=>e.jsx(et,{draggableId:A.id,index:O,isDragDisabled:y,children:U=>e.jsxs(Me,{ref:U.innerRef,...U.draggableProps,"data-index":O,onClick:()=>{y||(A.substitutionTeam?ee(O):A.timeoutTeam||q(O))},sx:{cursor:y||A.timeoutTeam?"default":"pointer",backgroundColor:R=>A.timeoutTeam||A.substitutionTeam?R.palette.mode==="dark"?"#343A42":"#f5f5f5":void 0},children:[e.jsx(T,{padding:"checkbox",sx:{width:"6%"},children:e.jsx(n,{onClick:R=>R.stopPropagation(),...U.dragHandleProps,sx:{cursor:y?"default":"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:e.jsx(rt,{fontSize:"small"})})}),A.timeoutTeam?e.jsx(T,{colSpan:5,sx:{width:"88%"},children:e.jsxs(n,{sx:{...Oe,display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:[A.timeoutTeam==="teamA"?a||"チームA":r||"チームB","タイムアウト"]})}):A.substitutionTeam?e.jsx(T,{colSpan:5,sx:{width:"88%"},children:e.jsxs(n,{sx:{...Oe,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100%"},children:[e.jsxs("span",{children:[A.substitutionTeam==="teamA"?a||"チームA":r||"チームB","選手交代"]}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",mt:.5},children:[e.jsx("span",{children:J(A.substitutionTeam,A.outMember)}),e.jsx(Mt,{fontSize:"small",sx:{mx:1}}),e.jsx("span",{children:J(A.substitutionTeam,A.inMember)})]})]})}):e.jsxs(e.Fragment,{children:[e.jsx(T,{sx:{width:"16%"},children:A.serverTeam==="teamA"?ce("teamA",A.server):null}),e.jsx(T,{sx:{width:"18%"},children:Z(A.teamAPlayDetail,A.teamAMember,"A")}),e.jsx(T,{sx:{width:"20%",fontSize:"2em",textAlign:"center"},children:V(O)}),e.jsx(T,{sx:{width:"18%"},children:Z(A.teamBPlayDetail,A.teamBMember,"B")}),e.jsx(T,{sx:{width:"16%"},children:A.serverTeam==="teamB"?ce("teamB",A.server):null})]}),e.jsx(T,{padding:"checkbox",sx:{width:"6%"},children:e.jsx(n,{onClick:R=>R.stopPropagation(),sx:{width:32,height:32,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:e.jsx(ye,{size:"small",onClick:y?void 0:()=>te(O),disabled:y,sx:{width:24,height:24},children:e.jsx(Be,{fontSize:"small",color:y?"disabled":"error"})})})})]})},A.id)),f.placeholder]})})]})})]})})})}function pi({scores:s,consecutive:p,connections:m,rowHeight:g}){const u=s.length*g;return e.jsxs(n,{sx:{flex:"0 0 20%",overflowY:"auto",height:"100%",position:"relative"},children:[s.map((a,r)=>{const v=r===0?{a:0,b:0}:s[r-1],b=a.a!==v.a&&a.a!==0,y=a.b!==v.b&&a.b!==0,B=b&&p[r],_=y&&p[r];return e.jsxs(n,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr 1fr",alignItems:"center",py:.5,height:`${g}px`,position:"relative",zIndex:1},children:[e.jsx(n,{}),e.jsxs(e.Fragment,{children:[e.jsx(n,{sx:{display:"flex",justifyContent:"center"},children:b?e.jsx(n,{sx:{width:32,height:32,border:"1px solid",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:24,borderColor:B?"red":"currentColor",backgroundColor:B?"#ffebee":"#fff",color:"black"},children:a.a}):null}),e.jsx(n,{}),e.jsx(n,{sx:{display:"flex",justifyContent:"center"},children:y?e.jsx(n,{sx:{width:32,height:32,border:"1px solid",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:24,borderColor:_?"red":"currentColor",backgroundColor:_?"#ffebee":"#fff",color:"black"},children:a.b}):null})]}),e.jsx(n,{})]},r)}),e.jsx("svg",{viewBox:`0 0 100 ${u}`,style:{position:"absolute",left:0,top:0,width:"100%",height:u,zIndex:0},preserveAspectRatio:"none",pointerEvents:"none",children:m.map(a=>{const r=a.index*g+g/2,v=(a.index+1)*g+g/2,b=a.from==="A"?30:70,y=a.from==="A"?70:30;return e.jsx("line",{x1:b,y1:r,x2:y,y2:v,stroke:"currentColor",strokeWidth:1},a.index)})})]})}function ji({setScore:s,playDetails:p,playCategories:m,teamAMembers:g,teamBMembers:u,teamAName:a,teamBName:r,onChange:v,locked:b=!1,scoreInputSetting:y,themeSetting:B,showSnackbar:_}){const[H,$]=h.useState(!1),[z,ne]=h.useState(!1),{addRally:q,deleteRally:ee,calculateScores:te}=Wn(s,p,v),S=h.useRef(null),Y=h.useRef(null),G=tt("md"),ie=tt("sm"),j=!ie&&y.showRallyIcons,Q=!G&&y.showScoreProgressArea,N=G&&y.showScoreProgressArea,[D,C]=h.useState(!1),P=m.find(i=>i.id==="init-serve"),W=s.rallies.filter(i=>i.timeoutTeam==="teamA").length,J=s.rallies.filter(i=>i.timeoutTeam==="teamB").length,V=W>=2,Z=J>=2,re=i=>{if(!i.destination||b)return;const o=Array.from(s.rallies),[t]=o.splice(i.source.index,1);o.splice(i.destination.index,0,t);const l={...s,rallies:o};te(l),v(l)},ce=i=>{if(b)return;const o={...s,rallies:[...s.rallies]};ee(i),_("ラリーを削除しました","success",{actionLabel:"元に戻す",onAction:()=>{const t={...o,rallies:[...o.rallies]};te(t),v(t)},autoHideDuration:5e3})},he=i=>{const o=!localStorage.getItem("tutorial-rally-row");q(i),o&&$(!0)},Ce=(i,o)=>{const t=[...s.rallies];t[i]=o;const l={...s,rallies:t};te(l),v(l)},f=i=>{if(b||i==="teamA"&&V||i==="teamB"&&Z)return;const o=!localStorage.getItem("tutorial-rally-row");q({id:crypto.randomUUID(),timeoutTeam:i}),o&&$(!0)},A=i=>{var o;b||(o=S.current)==null||o.openAddDialog(i)},O=i=>{var t;if(b)return;const o=s.rallies[i];o.substitutionTeam&&((t=S.current)==null||t.openEditDialog(i,o.substitutionTeam,o.outMember||"",o.inMember||""))},U=(i,o,t,l)=>{const w=!localStorage.getItem("tutorial-rally-row"),I=[...s.rallies];l!==null?I[l]={...I[l],substitutionTeam:i,outMember:o,inMember:t}:I.push({id:crypto.randomUUID(),substitutionTeam:i,outMember:o,inMember:t});const K={...s,rallies:I};te(K),v(K),w&&$(!0)},R=[],oe=[];let c=0,d=0;s.rallies.forEach(i=>{if(i.timeoutTeam||i.substitutionTeam){oe.push(null),R.push({a:c,b:d});return}const o=p.find(l=>l.id===i.teamAPlayDetail),t=p.find(l=>l.id===i.teamBPlayDetail);(o==null?void 0:o.pointType)==="得点"||(t==null?void 0:t.pointType)==="失点"?(c+=1,oe.push("A")):(t==null?void 0:t.pointType)==="得点"||(o==null?void 0:o.pointType)==="失点"?(d+=1,oe.push("B")):oe.push(null),R.push({a:c,b:d})});const M=40,F=[];for(let i=0;i<oe.length-1;i++){const o=oe[i],t=oe[i+1];o&&t&&o!==t&&F.push({from:o,index:i})}const E=oe.map((i,o)=>i!==null&&o>0&&i===oe[o-1]);return e.jsxs(n,{sx:{position:"relative",display:"flex",flexDirection:"column",height:"100%"},children:[e.jsxs(n,{sx:{display:"flex",gap:2,flex:1,minHeight:0},children:[Q&&e.jsx(pi,{scores:R,consecutive:E,connections:F,rowHeight:M}),e.jsx(n,{sx:{flex:1,overflowY:"auto",height:"100%",maxWidth:1024,width:"100%",mx:"auto",mb:2},children:e.jsx(fi,{rallies:s.rallies,playDetails:p,playCategories:m,teamAMembers:g,teamBMembers:u,teamAName:a,teamBName:r,serveCategory:P,showRallyIcons:j,locked:b,isMobile:G,isPhone:ie,scores:R,scoredTeam:oe,showRallyHint:H,onCloseRallyHint:()=>$(!1),onEditRally:i=>{var o;return(o=Y.current)==null?void 0:o.openEditDialog(i)},onEditSubstitution:O,onDelete:ce,onDragEnd:re})})]}),N&&e.jsx(Jn,{open:D,onClose:()=>C(!1),scores:R,consecutive:E,connections:F,rowHeight:M}),e.jsx(ri,{isMobile:G,openActionMenu:z,onOpenActionMenu:()=>ne(!0),onCloseActionMenu:()=>ne(!1),teamAName:a,teamBName:r,disableTimeoutA:V,disableTimeoutB:Z,showScoreProgressButton:y.showScoreProgressArea,onShowScoreProgress:()=>C(!0),onSubstitution:A,onTimeout:f,onAddRally:()=>{var i;return(i=Y.current)==null?void 0:i.openAddDialog()},locked:b}),e.jsx(Ln,{ref:Y,setScore:s,playDetails:p,playCategories:m,teamAMembers:g,teamBMembers:u,teamAName:a,teamBName:r,scoreInputSetting:y,themeSetting:B,locked:b,onAdd:he,onEdit:Ce}),e.jsx(Kn,{ref:S,teamAMembers:g,teamBMembers:u,onSave:U})]})}const gi=()=>typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():Math.random().toString(36).slice(2)+Date.now().toString(36);function bi({statsSettings:s,onChange:p,playCategories:m,playDetails:g,rallyCategoryTags:u,rallyDetailTags:a,disabled:r,showSnackbar:v}){const b=c=>{if(he){const F=ce(he);F&&(F.allowTouchMove=!0),Ce("")}if(!c.destination)return;const d=Array.from(s),[M]=d.splice(c.source.index,1);d.splice(c.destination.index,0,M),p(d)},y=c=>{var d;return((d=m.find(M=>M.id===c))==null?void 0:d.name)||""},B=c=>{var d;return((d=g.find(M=>M.id===c))==null?void 0:d.name)||""},_=c=>{const d=c.playCategoryId?y(c.playCategoryId):c.playCategoryTags?c.playCategoryTags.map(o=>{var t;return((t=u.find(l=>l.id===o))==null?void 0:t.name)||o}).join(", "):"",M=c.playDetailId?B(c.playDetailId):c.playDetailTags?c.playDetailTags.map(o=>{var t;return((t=a.find(l=>l.id===o))==null?void 0:t.name)||o}).join(", "):"",F=c.pointType||"",E=c.pointUnitType||"",i=c.aggregateType||"合算";return[d,M,F,E,i].filter(o=>o).join(", ")},[H,$]=h.useState(!1),[z,ne]=h.useState(null),[q,ee]=h.useState(""),[te,S]=h.useState(""),[Y,G]=h.useState([]),[ie,j]=h.useState([]),[Q,N]=h.useState(""),[D,C]=h.useState(""),[P,W]=h.useState("合算"),J=tt("md"),V=tt("sm"),{handleTouchEnd:Z,setSwiperRef:re,getSwiperRef:ce}=Lt(2),[he,Ce]=h.useState(""),f=()=>{r||(ne(-1),ee(""),S(""),G([]),j([]),N(""),C(""),W("合算"),$(!0))},A=c=>{if(r)return;const d=s[c];ne(c),ee(d.playCategoryId||""),S(d.playDetailId||""),G(d.playCategoryTags||[]),j(d.playDetailTags||[]),N(d.pointType||""),C(d.pointUnitType||""),W(d.aggregateType||"合算"),$(!0)},O=()=>{const c=q!=="",d=te!=="",M=Y.length>0,F=ie.length>0,E=Q!=="",i=D!=="";return c&&!d&&!M&&!F&&!E&&!i||c&&d&&!M&&!F&&!E&&!i||c&&!d&&!M&&!F&&E&&!i||c&&!d&&!M&&!F&&!E&&i||c&&!d&&!M&&!F&&E&&i||!c&&!d&&!M&&!F&&E&&!i||!c&&!d&&!M&&!F&&E&&i||!c&&!d&&!M&&!F&&!E&&i||M&&!c&&!d&&!F&&!E&&!i||M&&F&&!c&&!d&&!E&&!i||M&&F&&!c&&!d&&E&&!i||M&&F&&!c&&!d&&!E&&i||M&&F&&!c&&!d&&E&&i||M&&!c&&!d&&E&&!i||M&&!c&&!d&&!E&&i||M&&!c&&!d&&E&&i||F&&!c&&!d&&!M&&!E&&!i||F&&!c&&!d&&!M&&E&&!i||F&&!c&&!d&&!M&&!E&&i||F&&!c&&!d&&!M&&E&&i},U=()=>{const c={id:z===-1?gi():s[z].id,playCategoryId:q||void 0,playDetailId:te||void 0,playCategoryTags:q===""&&Y.length>0?Y:void 0,playDetailTags:te===""&&ie.length>0?ie:void 0,pointType:te?void 0:Q||void 0,pointUnitType:te?void 0:D||void 0,aggregateType:P};z===-1?p([...s,c]):z!==null&&p(s.map((d,M)=>M===z?c:d)),$(!1)},R=()=>{$(!1)},oe=c=>{if(r)return;const d=[...s];p(s.filter((M,F)=>F!==c)),v("スタッツ設定を削除しました","success",{actionLabel:"元に戻す",onAction:()=>p(d),autoHideDuration:5e3})};return e.jsxs(n,{children:[e.jsxs(n,{sx:{maxWidth:1024,mx:"auto",display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(n,{sx:{fontWeight:"bold"},children:"スタッツ設定"}),e.jsx(ae,{onClick:f,variant:"contained",size:"medium",startIcon:e.jsx(_t,{}),disabled:r,children:"追加"})]}),e.jsx(lt,{component:Le,storageKey:"match-stats-grid",sx:{maxWidth:1024,mx:"auto"},children:J?e.jsx(vt,{onDragEnd:b,children:e.jsx(Ze,{droppableId:"stats-settings",children:c=>e.jsxs(n,{ref:c.innerRef,...c.droppableProps,children:[e.jsx(n,{sx:{display:"grid",gridTemplateColumns:V?"1fr":"150px 1fr 110px 130px 110px",alignItems:"center",height:50,px:1,borderBottom:1,borderColor:"divider",...Oe},children:V?e.jsx(n,{children:"分析項目"}):e.jsxs(e.Fragment,{children:[e.jsx(n,{children:"プレー区分"}),e.jsx(n,{children:"プレー詳細"}),e.jsx(n,{children:"得点区分"}),e.jsx(n,{children:"得失点単位区分"}),e.jsx(n,{children:"集計方法"})]})}),s.map((d,M)=>e.jsx(et,{draggableId:d.id,index:M,isDragDisabled:r,children:F=>{const E=F.dragHandleProps,{onPointerDown:i,...o}=E||{},t=$t(l=>{i==null||i(l);const w=ce(d.id);w&&(w.allowTouchMove=!1),Ce(d.id)});return e.jsx(n,{ref:F.innerRef,...F.draggableProps,style:F.draggableProps.style,children:e.jsxs(Bt,{onSwiper:l=>re(d.id,l),threshold:20,slidesPerView:"auto",style:{overflow:"hidden"},onTouchStart:(l,w)=>w.stopPropagation(),onTouchEnd:l=>Z(d.id,l),children:[e.jsx(Re,{style:{width:"100%",flex:"0 0 auto"},children:e.jsx(n,{...o,...t,sx:{display:"grid",gridTemplateColumns:V?"1fr":"150px 1fr 110px 130px 110px",alignItems:"center",height:50,px:1,borderBottom:1,borderColor:"divider",bgcolor:"background.paper",cursor:r?"default":"grab",touchAction:he===d.id?"none":"pan-y"},children:V?e.jsx(n,{children:_(d)}):e.jsxs(e.Fragment,{children:[e.jsx(n,{sx:{pr:1},children:d.playCategoryId?y(d.playCategoryId):d.playCategoryTags&&d.playCategoryTags.length>0?e.jsx(n,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:d.playCategoryTags.map(l=>{const w=u.find(I=>I.id===l);return e.jsx(Pe,{label:(w==null?void 0:w.name)||l,size:"small",sx:{backgroundColor:(w==null?void 0:w.color)||He,color:"#fff"}},l)})}):""}),e.jsx(n,{sx:{pr:1},children:d.playDetailId?B(d.playDetailId):d.playDetailTags&&d.playDetailTags.length>0?e.jsx(n,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:d.playDetailTags.map(l=>{const w=a.find(I=>I.id===l);return e.jsx(Pe,{label:(w==null?void 0:w.name)||l,size:"small",sx:{backgroundColor:(w==null?void 0:w.color)||He,color:"#fff"}},l)})}):""}),e.jsx(n,{sx:{pr:1},children:d.pointType||""}),e.jsx(n,{sx:{pr:1},children:d.pointUnitType||""}),e.jsx(n,{children:d.aggregateType||"合算"})]})})}),e.jsx(Re,{style:{width:it,flex:"0 0 auto"},children:e.jsx(n,{sx:{height:50,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"error.main"},children:e.jsx(ye,{size:"small",onClick:()=>oe(M),disabled:r,children:e.jsx(Be,{fontSize:"small",sx:{color:"common.white"}})})})}),e.jsx(Re,{style:{width:it,flex:"0 0 auto"},children:e.jsx(n,{sx:{height:50,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"primary.main"},children:e.jsx(ye,{size:"small",onClick:()=>A(M),disabled:r,children:e.jsx(At,{fontSize:"small",sx:{color:"common.white"}})})})})]})})}},d.id)),c.placeholder]})})}):e.jsxs(mt,{size:"small",children:[e.jsx(ft,{children:e.jsxs(Me,{sx:{backgroundColor:c=>c.palette.mode==="dark"?"#343A42":"#f5f5f5",height:50},children:[e.jsx(T,{}),e.jsx(T,{children:"プレー区分"}),e.jsx(T,{children:"プレー詳細"}),e.jsx(T,{children:"得点区分"}),e.jsx(T,{children:"得失点単位区分"}),e.jsx(T,{children:"集計方法"}),e.jsx(T,{})]})}),e.jsx(vt,{onDragEnd:b,children:e.jsx(Ze,{droppableId:"stats-settings",children:c=>e.jsxs(pt,{ref:c.innerRef,...c.droppableProps,children:[s.map((d,M)=>e.jsx(et,{draggableId:d.id,index:M,isDragDisabled:r,children:F=>e.jsxs(Me,{ref:F.innerRef,...F.draggableProps,onClick:()=>A(M),sx:{cursor:r?"default":"pointer",height:50},children:[e.jsx(T,{padding:"checkbox",sx:{width:48},children:e.jsx(n,{...F.dragHandleProps,onClick:E=>E.stopPropagation(),sx:{cursor:r?"default":"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:e.jsx(rt,{})})}),e.jsx(T,{children:d.playCategoryId?y(d.playCategoryId):d.playCategoryTags&&d.playCategoryTags.length>0?e.jsx(n,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:d.playCategoryTags.map(E=>{const i=u.find(o=>o.id===E);return e.jsx(Pe,{label:(i==null?void 0:i.name)||E,size:"small",sx:{backgroundColor:(i==null?void 0:i.color)||He,color:"#fff"}},E)})}):""}),e.jsx(T,{children:d.playDetailId?B(d.playDetailId):d.playDetailTags&&d.playDetailTags.length>0?e.jsx(n,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:d.playDetailTags.map(E=>{const i=a.find(o=>o.id===E);return e.jsx(Pe,{label:(i==null?void 0:i.name)||E,size:"small",sx:{backgroundColor:(i==null?void 0:i.color)||He,color:"#fff"}},E)})}):""}),e.jsx(T,{children:d.pointType||""}),e.jsx(T,{children:d.pointUnitType||""}),e.jsx(T,{children:d.aggregateType||"合算"}),e.jsx(T,{padding:"checkbox",children:e.jsx(ye,{size:"small",onClick:E=>{E.stopPropagation(),oe(M)},disabled:r,children:e.jsx(Be,{fontSize:"small"})})})]})},d.id)),c.placeholder]})})})]})}),e.jsxs(yt,{open:H,onClose:R,children:[e.jsxs(Ke,{children:["スタッツ設定",z===-1?"追加":"編集"]}),e.jsxs(Je,{children:[e.jsxs(Te,{fullWidth:!0,margin:"dense",children:[e.jsx(Ae,{id:"stat-category-label",children:"プレー区分"}),e.jsxs(we,{labelId:"stat-category-label",value:q,label:"プレー区分",onChange:c=>{ee(c.target.value),S(""),G([]),j([])},disabled:Y.length>0||ie.length>0,children:[e.jsx(se,{value:"",children:"なし"}),m.map(c=>e.jsx(se,{value:c.id,children:c.name},c.id))]})]}),e.jsxs(Te,{fullWidth:!0,margin:"dense",children:[e.jsx(Ae,{id:"stat-detail-label",children:"プレー詳細"}),e.jsxs(we,{labelId:"stat-detail-label",value:te,label:"プレー詳細",onChange:c=>{S(c.target.value),N(""),C(""),G([]),j([])},disabled:Q!==""||D!==""||Y.length>0||ie.length>0,children:[e.jsx(se,{value:"",children:"なし"}),g.filter(c=>c.playCategoryId===q).map(c=>e.jsx(se,{value:c.id,children:c.name},c.id))]})]}),e.jsx(Ht,{multiple:!0,options:u,getOptionLabel:c=>c.name,value:u.filter(c=>Y.includes(c.id)),onChange:(c,d)=>{G(d.map(M=>M.id)),d.length>0&&(ee(""),S(""))},disabled:q!==""||te!=="",renderTags:(c,d)=>c.map((M,F)=>e.jsx(Pe,{...d({index:F}),label:M.name,size:"small",sx:{backgroundColor:M.color||He,color:"#fff"}})),renderInput:c=>e.jsx(pe,{...c,label:"プレー区分タグ",margin:"dense"}),fullWidth:!0}),e.jsx(Ht,{multiple:!0,options:a,getOptionLabel:c=>c.name,value:a.filter(c=>ie.includes(c.id)),onChange:(c,d)=>{j(d.map(M=>M.id)),d.length>0&&(ee(""),S(""))},disabled:q!==""||te!=="",renderTags:(c,d)=>c.map((M,F)=>e.jsx(Pe,{...d({index:F}),label:M.name,size:"small",sx:{backgroundColor:M.color||He,color:"#fff"}})),renderInput:c=>e.jsx(pe,{...c,label:"プレー詳細タグ",margin:"dense"}),fullWidth:!0}),e.jsxs(n,{children:[e.jsxs(Te,{fullWidth:!0,margin:"dense",children:[e.jsx(Ae,{id:"stat-point-label",children:"得点区分"}),e.jsxs(we,{labelId:"stat-point-label",value:Q,label:"得点区分",onChange:c=>{N(c.target.value),c.target.value!==""&&S("")},disabled:te!=="",children:[e.jsx(se,{value:"",children:"なし"}),e.jsx(se,{value:"得点",children:"得点"}),e.jsx(se,{value:"失点",children:"失点"})]})]}),e.jsxs(Te,{fullWidth:!0,margin:"dense",children:[e.jsx(Ae,{id:"stat-unit-label",children:"得失点単位区分"}),e.jsxs(we,{labelId:"stat-unit-label",value:D,label:"得失点単位区分",onChange:c=>{C(c.target.value),c.target.value!==""&&S("")},disabled:te!=="",children:[e.jsx(se,{value:"",children:"なし"}),e.jsx(se,{value:"メンバー",children:"メンバー"}),e.jsx(se,{value:"チーム",children:"チーム"})]})]})]}),e.jsxs(Te,{fullWidth:!0,margin:"dense",children:[e.jsx(Ae,{id:"stat-aggregate-label",children:"集計方法"}),e.jsxs(we,{labelId:"stat-aggregate-label",value:P,label:"集計方法",onChange:c=>W(c.target.value),children:[e.jsx(se,{value:"合算",children:"合算"}),e.jsx(se,{value:"セット平均",children:"セット平均"})]})]})]}),e.jsxs(Ne,{children:[e.jsx(ae,{onClick:R,color:"inherit",startIcon:e.jsx(Ue,{}),children:"キャンセル"}),e.jsx(ae,{onClick:U,disabled:!O(),startIcon:e.jsx(Qe,{}),children:"OK"})]})]})]})}function ms(s,p,m){var u,a;if(!s)return!1;const g=p.get(s.playCategoryId);return!(m.playDetailId&&s.id!==m.playDetailId||m.playCategoryId&&s.playCategoryId!==m.playCategoryId||m.playCategoryTags&&m.playCategoryTags.length>0&&!((u=g==null?void 0:g.tags)!=null&&u.some(r=>m.playCategoryTags.includes(r)))||m.playDetailTags&&m.playDetailTags.length>0&&!((a=s.tags)!=null&&a.some(r=>m.playDetailTags.includes(r)))||m.pointType&&s.pointType!==m.pointType||m.pointUnitType&&s.pointUnitType!==m.pointUnitType)}function fs(s,p,m,g){const u=g.map(()=>({teamA:0,teamB:0}));return s.forEach(a=>{a.rallies.forEach(r=>{g.forEach((v,b)=>{const y=r.teamAPlayDetail?p.get(r.teamAPlayDetail):void 0;ms(y,m,v)&&(u[b].teamA+=1);const B=r.teamBPlayDetail?p.get(r.teamBPlayDetail):void 0;ms(B,m,v)&&(u[b].teamB+=1)})})}),u}function yi(s,p){const m=[];let g=0,u=0,a=0,r=0;return s.forEach(b=>{let y=0,B=0,_=0,H=0;b.rallies.forEach($=>{if($.timeoutTeam||$.substitutionTeam||!$.serverTeam)return;const z=$.teamAPlayDetail?p.get($.teamAPlayDetail):void 0,ne=$.teamBPlayDetail?p.get($.teamBPlayDetail):void 0;$.serverTeam==="teamA"?(B+=1,(z&&z.pointType==="得点"||ne&&ne.pointType==="失点")&&(y+=1)):(H+=1,(ne&&ne.pointType==="得点"||z&&z.pointType==="失点")&&(_+=1))}),g+=y,u+=B,a+=_,r+=H,m.push({teamA:B?`${Math.round(y/B*100)}%`:"-",teamB:H?`${Math.round(_/H*100)}%`:"-"})}),{overall:{teamA:u?`${Math.round(g/u*100)}%`:"-",teamB:r?`${Math.round(a/r*100)}%`:"-"},perSet:m}}function vi(s,p){const m=[];let g=0,u=0,a=0,r=0;return s.forEach(b=>{let y=0,B=0,_=0,H=0;b.rallies.forEach($=>{if($.timeoutTeam||$.substitutionTeam||!$.serverTeam)return;const z=$.teamAPlayDetail?p.get($.teamAPlayDetail):void 0,ne=$.teamBPlayDetail?p.get($.teamBPlayDetail):void 0;$.serverTeam==="teamB"?(B+=1,(z&&z.pointType==="得点"||ne&&ne.pointType==="失点")&&(y+=1)):(H+=1,(ne&&ne.pointType==="得点"||z&&z.pointType==="失点")&&(_+=1))}),g+=y,u+=B,a+=_,r+=H,m.push({teamA:B?`${Math.round(y/B*100)}%`:"-",teamB:H?`${Math.round(_/H*100)}%`:"-"})}),{overall:{teamA:u?`${Math.round(g/u*100)}%`:"-",teamB:r?`${Math.round(a/r*100)}%`:"-"},perSet:m}}function Ci({sets:s,playDetails:p,playCategories:m,statsSettings:g,matchStatsSettings:u,onMatchStatsSettingsChange:a,rallyCategoryTags:r,rallyDetailTags:v,teamAName:b,teamBName:y,locked:B,showSnackbar:_}){const H=new Map(p.map(D=>[D.id,D])),$=new Map(m.map(D=>[D.id,D])),z=D=>{var C;return((C=m.find(P=>P.id===D))==null?void 0:C.name)||""},ne=D=>{var C;return((C=p.find(P=>P.id===D))==null?void 0:C.name)||""},q=[...g,...u],ee=fs(s,H,$,q),te=s.map(D=>fs([D],H,$,q)),S=ee.map((D,C)=>{if(q[C].aggregateType==="セット平均"){const W=s.length||1;return{teamA:(D.teamA/W).toFixed(1),teamB:(D.teamB/W).toFixed(1)}}return D}),Y=te.map(D=>q.reduce((C,P,W)=>(P.aggregateType!=="セット平均"&&C.push(D[W]),C),[])),G=q.filter(D=>D.aggregateType!=="セット平均"),ie=yi(s,H),j=vi(s,H),Q=D=>{const C=[];D.playCategoryId?C.push(e.jsx("span",{children:z(D.playCategoryId)},"cat")):D.playCategoryTags&&D.playCategoryTags.length>0&&C.push(e.jsx(n,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center",mt:.5},children:D.playCategoryTags.map(W=>{const J=r.find(V=>V.id===W);return e.jsx(Pe,{label:(J==null?void 0:J.name)||W,size:"small",sx:{mr:.5,mb:.5,backgroundColor:(J==null?void 0:J.color)||He,color:"#fff"}},W)})},"catTags")),D.playDetailId?C.push(e.jsx("span",{children:ne(D.playDetailId)},"detail")):D.playDetailTags&&D.playDetailTags.length>0&&C.push(e.jsx(n,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center",mt:.5},children:D.playDetailTags.map(W=>{const J=v.find(V=>V.id===W);return e.jsx(Pe,{label:(J==null?void 0:J.name)||W,size:"small",sx:{mr:.5,mb:.5,backgroundColor:(J==null?void 0:J.color)||He,color:"#fff"}},W)})},"detailTags"));const P=[];return D.pointType&&P.push(D.pointType),D.pointUnitType&&P.push(D.pointUnitType),P.length>0&&C.push(e.jsx("span",{children:P.join(",")},"point")),C.push(e.jsxs("span",{children:["(",D.aggregateType||"合算",")"]},"agg")),e.jsx(n,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:C.map((W,J)=>e.jsx(n,{sx:{display:"flex",justifyContent:"center"},children:W},J))})},N=(D,C,P,W,J)=>e.jsx(lt,{component:Le,storageKey:J,sx:{mb:2},children:e.jsxs(mt,{size:"small",sx:{"& th, & td":{textAlign:"center",verticalAlign:"middle"}},children:[e.jsx(ft,{children:e.jsxs(Me,{sx:{backgroundColor:V=>V.palette.mode==="dark"?"#343A42":"#f5f5f5",height:50},children:[e.jsx(T,{children:b||"チームA"}),e.jsx(T,{children:"項目"}),e.jsx(T,{children:y||"チームB"})]})}),e.jsxs(pt,{children:[e.jsxs(Me,{sx:{height:50},children:[e.jsx(T,{children:C.teamA}),e.jsx(T,{children:"ブレイク率"}),e.jsx(T,{children:C.teamB})]},"break-rate"),e.jsxs(Me,{sx:{height:50},children:[e.jsx(T,{children:P.teamA}),e.jsx(T,{children:"サイドアウト率"}),e.jsx(T,{children:P.teamB})]},"sideout-rate"),W.map((V,Z)=>e.jsxs(Me,{sx:{height:50},children:[e.jsx(T,{children:D[Z].teamA}),e.jsx(T,{children:Q(V)}),e.jsx(T,{children:D[Z].teamB})]},V.id))]})]})});return e.jsxs(n,{sx:{display:"grid",gap:2,gridTemplateColumns:{xs:"1fr",md:"repeat(2, 1fr)"},maxWidth:1024,width:"100%",mx:"auto"},children:[e.jsxs(n,{children:[e.jsx(De,{variant:"h6",sx:{mb:1},children:"試合全体のスタッツ"}),N(S,ie.overall,j.overall,q,"stats-overall")]}),s.map((D,C)=>e.jsxs(n,{children:[e.jsx(De,{variant:"h6",sx:{mb:1},children:`${C+1}セット目(${D.my}-${D.opponent})のスタッツ`}),N(Y[C],ie.perSet[C],j.perSet[C],G,`stats-set-${C}`)]},D.id)),e.jsxs(n,{sx:{gridColumn:"1 / -1"},children:[e.jsx(bi,{statsSettings:u,onChange:a,playCategories:m,playDetails:p,rallyCategoryTags:r,rallyDetailTags:v,disabled:B,showSnackbar:_}),e.jsxs(gs,{severity:"info",sx:{mt:1},children:["本設定は試合内のみでの設定となります",e.jsx("br",{}),"各試合共通でのスタッツ項目の設定は設定＞スタッツメニューから設定してください"]})]})]})}var as={},Si=je;Object.defineProperty(as,"__esModule",{value:!0});var Wt=as.default=void 0,Ti=Si(ge()),Ai=e;Wt=as.default=(0,Ti.default)((0,Ai.jsx)("path",{d:"M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m-9-2V7H4v3H1v2h3v3h2v-3h3v-2zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"PersonAdd");const wi=()=>typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():Math.random().toString(36).slice(2)+Date.now().toString(36);function Ii({match:s,setMatch:p,teamAName:m,teamBName:g,teamMembers:u,onAddMember:a,locked:r,showSnackbar:v}){const b=kt(),y=tt("md"),B=tt("sm"),{handleTouchEnd:_,setSwiperRef:H,getSwiperRef:$}=Lt(),[z,ne]=h.useState(""),q="tutorial-member-select",[ee,te]=h.useState(()=>!localStorage.getItem(q)),S="tutorial-member-row",[Y,G]=h.useState(null),[ie,j]=h.useState(!1),[Q,N]=h.useState(!1),[D,C]=h.useState(""),[P,W]=h.useState(""),[J,V]=h.useState([]),[Z,re]=h.useState("teamA"),[ce,he]=h.useState([]),Ce=i=>{if(z){const w=$(z);w&&(w.allowTouchMove=!0),ne("")}if(!i.destination||i.source.droppableId!==i.destination.droppableId||r)return;const o=i.source.droppableId==="teamA"?"teamAMembers":"teamBMembers",t=Array.from(s[o]),[l]=t.splice(i.source.index,1);t.splice(i.destination.index,0,l),p(w=>({...w,[o]:t}))},f=h.useMemo(()=>{const i=Z==="teamA"?s.teamA:s.teamB,o=u[i]||[],t=Z==="teamA"?s.teamAMembers:s.teamBMembers;return o.filter(l=>l.visible!==!1&&!t.some(w=>w.id===l.id))},[Z,s,u]),A=i=>{re(i),he([]),j(!0)},O=i=>{he(o=>o.some(l=>l.id===i.id)?o.filter(l=>l.id!==i.id):[...o,i])},U=()=>{const i=!localStorage.getItem(S);p(Z==="teamA"?o=>({...o,teamAMembers:[...o.teamAMembers,...ce.map(t=>({...t,statuses:Array(o.sets.length).fill("")}))]}):o=>({...o,teamBMembers:[...o.teamBMembers,...ce.map(t=>({...t,statuses:Array(o.sets.length).fill("")}))]})),j(!1),i&&G(Z)},R=()=>{j(!1)},oe=(i,o)=>{if(r)return;let t;const l=i==="teamA"?"teamAMembers":"teamBMembers";p(w=>{const I=[...w[l]];t=I[o];const K=I.filter((me,de)=>de!==o);return{...w,[l]:K}}),v("メンバーを削除しました","success",{actionLabel:"元に戻す",onAction:()=>{t&&p(w=>{const I=[...w[l]];return I.splice(o,0,t),{...w,[l]:I}})},autoHideDuration:5e3})},c=()=>{r||(C(""),W(""),V([]),N(!0))},d=()=>{const i=Z==="teamA"?s.teamA:s.teamB;i&&a(i,{id:wi(),no:Number(D),name:P,positions:J}),N(!1)},M=()=>{N(!1)},F=(i,o,t)=>{r||p(l=>{const w=i==="teamA"?"teamAMembers":"teamBMembers",I=[...l[w]],K={...I[o]},me=[...K.statuses||Array(l.sets.length).fill("")],de=me[t]||"";let Se="";return de===""?Se="starter":de==="starter"?Se="libero":Se="",me[t]=Se,K.statuses=me,I[o]=K,{...l,[w]:I}})},E=i=>{const o=i==="teamA"?s.teamAMembers:s.teamBMembers,t=i,l=B?"50px 1fr":`40px 1fr ${s.sets.map(()=>"70px").join(" ")}`;return e.jsxs(n,{sx:{maxWidth:1024,mx:"auto",overflowX:"auto"},children:[e.jsxs(n,{sx:{display:"grid",gridTemplateColumns:l,alignItems:"center",height:50,px:1,borderBottom:1,borderColor:"divider",...Oe},children:[e.jsx(n,{children:"番号"}),e.jsx(n,{children:"名前"}),!B&&s.sets.map((w,I)=>e.jsx(n,{textAlign:"center",children:I+1},I))]}),e.jsx(Ze,{droppableId:t,children:w=>e.jsxs(n,{ref:w.innerRef,...w.droppableProps,children:[o.map((I,K)=>e.jsx(et,{draggableId:`${t}-${I.id}`,index:K,isDragDisabled:r,children:me=>{const de=`${t}-${I.id}`,Se=me.dragHandleProps,{onPointerDown:Ie,...ke}=Se||{},Ct=$t(ze=>{Ie==null||Ie(ze);const be=$(de);be&&(be.allowTouchMove=!1),ne(de)});return e.jsx(n,{ref:me.innerRef,...me.draggableProps,children:e.jsxs(Bt,{onSwiper:ze=>H(de,ze),threshold:20,slidesPerView:"auto",style:{overflow:"hidden"},onTouchStart:(ze,be)=>be.stopPropagation(),onTouchEnd:ze=>_(de,ze),children:[e.jsx(Re,{style:{width:"100%",flex:"0 0 auto"},children:e.jsxs(n,{...ke,...Ct,sx:{display:"grid",gridTemplateColumns:l,alignItems:"center",height:50,px:1,borderBottom:1,borderColor:"divider",backgroundColor:"background.paper",cursor:r?"default":"grab",touchAction:z===de?"none":"pan-y"},children:[e.jsx(n,{children:I.no}),e.jsx(n,{children:I.name}),!B&&s.sets.map((ze,be)=>{var _e,st,Ve,at,ot,St;return e.jsx(n,{sx:{textAlign:"center"},children:e.jsx(ae,{size:"small",variant:(_e=I.statuses)!=null&&_e[be]?"contained":"outlined",color:((st=I.statuses)==null?void 0:st[be])==="starter"?"primary":void 0,sx:{minWidth:32,width:32,p:0,...((Ve=I.statuses)==null?void 0:Ve[be])==="starter"?{backgroundColor:"primary.main",color:"#fff","&:hover":{backgroundColor:"primary.main"}}:((at=I.statuses)==null?void 0:at[be])==="libero"?{backgroundColor:"#FF9933",color:"#fff","&:hover":{backgroundColor:"#FF9933"},"&.Mui-focusVisible":{outline:"2px solid #FF9933"}}:{}},onClick:()=>F(i,K,be),disabled:r,children:((ot=I.statuses)==null?void 0:ot[be])==="starter"?"出":((St=I.statuses)==null?void 0:St[be])==="libero"?"リ":"不"})},be)})]})}),e.jsx(Re,{style:{width:it,flex:"0 0 auto"},children:e.jsx(n,{sx:{height:50,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"error.main"},children:e.jsx(ye,{size:"small",onClick:()=>oe(i,K),children:e.jsx(Be,{fontSize:"small",sx:{color:"common.white"}})})})})]})})}},I.id)),w.placeholder]})})]})};return e.jsxs(vt,{onDragEnd:Ce,children:[e.jsxs(bt,{container:!0,spacing:2,children:[e.jsxs(bt,{item:!0,xs:12,children:[e.jsxs(n,{sx:{maxWidth:1024,mx:"auto"},children:[e.jsx(De,{variant:"h6",sx:{mb:1},children:m}),e.jsx(ae,{variant:"contained",size:"medium",sx:{mb:1},onClick:()=>A("teamA"),disabled:r,startIcon:e.jsx(Wt,{}),children:"メンバー登録"})]}),e.jsx(Ge,{open:ee,onClose:()=>te(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:Xe,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${b.palette.text.secondary}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${b.palette.text.secondary}`}}}},title:e.jsxs(n,{sx:{p:1,maxWidth:260},children:[e.jsx(De,{variant:"body2",children:"各セットのラリー結果を入力する際に選択するメンバーとして表示されますが、未登録の場合においてもラリー結果の入力自体は可能です"}),e.jsx(n,{sx:{textAlign:"right",mt:1},children:e.jsx(Ye,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem(q,"1"),te(!1)},children:"了解した"})})]}),children:e.jsx(n,{children:e.jsx(Ge,{open:Y==="teamA",onClose:()=>G(null),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:Xe,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${b.palette.text.secondary}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${b.palette.text.secondary}`}}}},title:e.jsxs(n,{sx:{p:1,maxWidth:260},children:[e.jsxs(De,{variant:"body2",children:["行を長押し、または左側の",e.jsx(rt,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),"をドラッグすることで順番を入れ替えることができます",e.jsx("br",{}),"右側の",e.jsx(Be,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),"をタップすることで削除ができます",e.jsx("br",{}),"各セットごとで出場設定をすることができますが、現状は何かに使われることはありません（今後の機能アップデートにて利用）"]}),e.jsx(n,{sx:{textAlign:"right",mt:1},children:e.jsx(Ye,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem(S,"1"),G(null)},children:"了解した"})})]}),children:e.jsx(n,{children:y?E("teamA"):e.jsx(lt,{component:Le,storageKey:"members-teamA",sx:{maxWidth:1024,mx:"auto"},children:e.jsxs(mt,{size:"small",children:[e.jsx(ft,{children:e.jsxs(Me,{sx:{backgroundColor:i=>i.palette.mode==="dark"?"#343A42":"#f5f5f5",height:50},children:[e.jsx(T,{}),e.jsx(T,{children:"番号"}),e.jsx(T,{children:"名前"}),e.jsx(T,{children:"ポジション"}),s.sets.map((i,o)=>e.jsx(T,{align:"center",children:o+1},o)),e.jsx(T,{})]})}),e.jsx(Ze,{droppableId:"teamA",children:i=>e.jsxs(pt,{ref:i.innerRef,...i.droppableProps,children:[s.teamAMembers.map((o,t)=>e.jsx(et,{draggableId:`teamA-${o.id}`,index:t,isDragDisabled:r,children:l=>e.jsxs(Me,{ref:l.innerRef,...l.draggableProps,"data-index":t,sx:{cursor:r?"default":"pointer",height:50},children:[e.jsx(T,{padding:"checkbox",children:e.jsx(n,{onClick:w=>w.stopPropagation(),...l.dragHandleProps,sx:{cursor:r?"default":"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:e.jsx(rt,{})})}),e.jsx(T,{children:o.no}),e.jsx(T,{children:o.name}),e.jsx(T,{children:(o.positions||[]).join(", ")}),s.sets.map((w,I)=>{var K,me,de,Se,Ie,ke;return e.jsx(T,{padding:"checkbox",align:"center",children:e.jsx(ae,{size:"small",variant:(K=o.statuses)!=null&&K[I]?"contained":"outlined",color:((me=o.statuses)==null?void 0:me[I])==="starter"?"primary":void 0,sx:{minWidth:32,width:32,p:0,...((de=o.statuses)==null?void 0:de[I])==="starter"?{backgroundColor:"primary.main",color:"#fff","&:hover":{backgroundColor:"primary.main"}}:((Se=o.statuses)==null?void 0:Se[I])==="libero"?{backgroundColor:"#FF9933",color:"#fff","&:hover":{backgroundColor:"#FF9933"},"&.Mui-focusVisible":{outline:"2px solid #FF9933"}}:{}},onClick:()=>F("teamA",t,I),disabled:r,children:((Ie=o.statuses)==null?void 0:Ie[I])==="starter"?"出":((ke=o.statuses)==null?void 0:ke[I])==="libero"?"リ":"不"})},I)}),e.jsx(T,{padding:"checkbox",children:e.jsx(n,{onClick:w=>w.stopPropagation(),sx:{width:32,height:32,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:e.jsx(ye,{size:"small",onClick:r?void 0:()=>oe("teamA",t),disabled:r,sx:{width:24,height:24},children:e.jsx(Be,{fontSize:"small",color:r?"disabled":"error"})})})})]})},o.id)),i.placeholder]})})]})})})})})})]}),e.jsxs(bt,{item:!0,xs:12,children:[e.jsxs(n,{sx:{maxWidth:1024,mx:"auto"},children:[e.jsx(De,{variant:"h6",sx:{mb:1},children:g}),e.jsx(ae,{variant:"contained",size:"medium",sx:{mb:1},onClick:()=>A("teamB"),disabled:r,startIcon:e.jsx(Wt,{}),children:"メンバー登録"})]}),e.jsx(Ge,{open:Y==="teamB",onClose:()=>G(null),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:Xe,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${b.palette.text.secondary}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${b.palette.text.secondary}`}}}},title:e.jsxs(n,{sx:{p:1,maxWidth:260},children:[e.jsxs(De,{variant:"body2",children:["行を長押し、または左側の",e.jsx(rt,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),"をドラッグすることで順番を入れ替えることができます",e.jsx("br",{}),"右側の",e.jsx(Be,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),"をタップすることで削除ができます",e.jsx("br",{}),"各セットごとで出場設定をすることができますが、現状は何かに使われることはありません（今後の機能アップデートにて利用）"]}),e.jsx(n,{sx:{textAlign:"right",mt:1},children:e.jsx(Ye,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem(S,"1"),G(null)},children:"了解した"})})]}),children:e.jsx(n,{children:y?E("teamB"):e.jsx(lt,{component:Le,storageKey:"members-teamB",sx:{maxWidth:1024,mx:"auto"},children:e.jsxs(mt,{size:"small",children:[e.jsx(ft,{children:e.jsxs(Me,{sx:{backgroundColor:i=>i.palette.mode==="dark"?"#343A42":"#f5f5f5",height:50},children:[e.jsx(T,{}),e.jsx(T,{children:"番号"}),e.jsx(T,{children:"名前"}),e.jsx(T,{children:"ポジション"}),s.sets.map((i,o)=>e.jsx(T,{align:"center",children:o+1},o)),e.jsx(T,{})]})}),e.jsx(Ze,{droppableId:"teamB",children:i=>e.jsxs(pt,{ref:i.innerRef,...i.droppableProps,children:[s.teamBMembers.map((o,t)=>e.jsx(et,{draggableId:`teamB-${o.id}`,index:t,isDragDisabled:r,children:l=>e.jsxs(Me,{ref:l.innerRef,...l.draggableProps,"data-index":t,sx:{cursor:r?"default":"pointer",height:50},children:[e.jsx(T,{padding:"checkbox",children:e.jsx(n,{onClick:w=>w.stopPropagation(),...l.dragHandleProps,sx:{cursor:r?"default":"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:e.jsx(rt,{})})}),e.jsx(T,{children:o.no}),e.jsx(T,{children:o.name}),e.jsx(T,{children:(o.positions||[]).join(", ")}),s.sets.map((w,I)=>{var K,me,de,Se,Ie,ke;return e.jsx(T,{padding:"checkbox",align:"center",children:e.jsx(ae,{size:"small",variant:(K=o.statuses)!=null&&K[I]?"contained":"outlined",color:((me=o.statuses)==null?void 0:me[I])==="starter"?"primary":void 0,sx:{minWidth:32,width:32,p:0,...((de=o.statuses)==null?void 0:de[I])==="starter"?{backgroundColor:"primary.main",color:"#fff","&:hover":{backgroundColor:"primary.main"}}:((Se=o.statuses)==null?void 0:Se[I])==="libero"?{backgroundColor:"#FF9933",color:"#fff","&:hover":{backgroundColor:"#FF9933"},"&.Mui-focusVisible":{outline:"2px solid #FF9933"}}:{}},onClick:()=>F("teamB",t,I),disabled:r,children:((Ie=o.statuses)==null?void 0:Ie[I])==="starter"?"出":((ke=o.statuses)==null?void 0:ke[I])==="libero"?"リ":"不"})},I)}),e.jsx(T,{padding:"checkbox",children:e.jsx(n,{onClick:w=>w.stopPropagation(),sx:{width:32,height:32,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:e.jsx(ye,{size:"small",onClick:r?void 0:()=>oe("teamB",t),disabled:r,sx:{width:24,height:24},children:e.jsx(Be,{fontSize:"small",color:r?"disabled":"error"})})})})]})},o.id)),i.placeholder]})})]})})})})]})]}),e.jsxs(yt,{open:ie,onClose:R,children:[e.jsx(Ke,{children:"メンバー選択"}),e.jsxs(Je,{children:[e.jsx(n,{sx:{display:"flex",justifyContent:"flex-end",mb:1},children:e.jsx(ae,{onClick:c,variant:"contained",startIcon:e.jsx(_t,{}),disabled:r||!(Z==="teamA"?s.teamA:s.teamB),children:"追加"})}),e.jsx(lt,{component:Le,storageKey:`members-select-${Z}`,children:e.jsxs(mt,{size:"small",children:[e.jsx(ft,{children:e.jsxs(Me,{sx:{backgroundColor:i=>i.palette.mode==="dark"?"#343A42":"#f5f5f5",height:50},children:[e.jsx(T,{padding:"checkbox"}),e.jsx(T,{children:"番号"}),e.jsx(T,{children:"名前"}),e.jsx(T,{children:"ポジション"})]})}),e.jsx(pt,{children:f.map(i=>{const o=ce.some(t=>t.id===i.id);return e.jsxs(Me,{sx:{cursor:"pointer",height:50},children:[e.jsx(T,{padding:"checkbox",onClick:t=>t.stopPropagation(),children:e.jsx(Ks,{checked:o,onChange:()=>O(i)})}),e.jsx(T,{children:i.no}),e.jsx(T,{children:i.name}),e.jsx(T,{children:(i.positions||[]).join(", ")})]},i.id)})})]})})]}),e.jsxs(Ne,{children:[e.jsx(ae,{onClick:R,startIcon:e.jsx(Ue,{}),color:"inherit",children:"キャンセル"}),e.jsx(ae,{onClick:U,disabled:ce.length===0,startIcon:e.jsx(Qe,{}),children:"OK"})]})]}),e.jsxs(yt,{open:Q,onClose:M,children:[e.jsx(Ke,{children:"メンバー追加"}),e.jsxs(Je,{children:[e.jsx(pe,{label:"番号",type:"number",value:D,onChange:i=>C(i.target.value),fullWidth:!0,margin:"dense"}),e.jsx(pe,{label:"名前",value:P,onChange:i=>W(i.target.value),fullWidth:!0,margin:"dense"}),e.jsxs(Te,{fullWidth:!0,margin:"dense",children:[e.jsx(Ae,{id:"md-positions-label",children:"ポジション"}),e.jsxs(we,{labelId:"md-positions-label",multiple:!0,value:J,label:"ポジション",onChange:i=>V(typeof i.target.value=="string"?i.target.value.split(","):i.target.value),renderValue:i=>i.join(", "),children:[e.jsx(se,{value:"レフト",children:"レフト"}),e.jsx(se,{value:"センター",children:"センター"}),e.jsx(se,{value:"ライト",children:"ライト"}),e.jsx(se,{value:"セッター",children:"セッター"}),e.jsx(se,{value:"リベロ",children:"リベロ"})]})]})]}),e.jsxs(Ne,{children:[e.jsx(ae,{onClick:M,startIcon:e.jsx(Ue,{}),color:"inherit",children:"キャンセル"}),e.jsx(ae,{onClick:d,disabled:D==="",startIcon:e.jsx(Qe,{}),children:"OK"})]})]})]})}function Mi({match:s,setMatch:p,tags:m,onAddTag:g,locked:u}){return e.jsx(n,{sx:{maxWidth:1024,mx:"auto"},children:e.jsx(bt,{container:!0,spacing:2,children:e.jsx(bt,{item:!0,xs:12,children:e.jsxs(Le,{elevation:0,sx:{},children:[e.jsx(pe,{label:"試合日付",type:"date",InputLabelProps:{shrink:!0},value:s.date,onChange:a=>p(r=>({...r,date:a.target.value})),fullWidth:!0,margin:"dense",disabled:u,sx:{"& .MuiOutlinedInput-root":{height:56},"& .MuiOutlinedInput-input":{padding:"0 14px",height:"100%",lineHeight:"56px",fontSize:"1rem",textAlign:"left"},'& input[type="date"]':{WebkitAppearance:"none"}}}),e.jsx(pe,{label:"試合名",value:s.matchName,onChange:a=>p(r=>({...r,matchName:a.target.value})),fullWidth:!0,margin:"dense",disabled:u}),e.jsx(Ht,{multiple:!0,freeSolo:!0,options:m,getOptionLabel:a=>typeof a=="string"?a:a.name,value:s.tags.map(a=>m.find(r=>r.id===a)).filter(Boolean),onChange:(a,r)=>{const v=[];r.forEach(b=>{if(typeof b=="string"){const y={id:crypto.randomUUID(),name:b,color:He};g(y),v.push(y.id)}else v.push(b.id)}),p(b=>({...b,tags:v}))},renderTags:(a,r)=>a.map((v,b)=>e.jsx(Pe,{...r({index:b}),label:v.name,sx:{backgroundColor:v.color||He,color:"#fff",mr:.5,mb:.5}})),renderInput:a=>e.jsx(pe,{...a,label:"タグ",margin:"dense"}),fullWidth:!0,disabled:u}),e.jsxs(gs,{severity:"info",sx:{mt:1},children:["試合タグは上記項目にて直接入力するか、設定＞タグメニューにて追加できます",e.jsx("br",{}),"試合にタグを設定することにより、試合を横串で集計することが可能となります"]}),e.jsx(pe,{label:"場所",value:s.location,onChange:a=>p(r=>({...r,location:a.target.value})),fullWidth:!0,margin:"dense",disabled:u}),e.jsx(pe,{label:"主審",value:s.mainReferee,onChange:a=>p(r=>({...r,mainReferee:a.target.value})),fullWidth:!0,margin:"dense",disabled:u}),e.jsx(pe,{label:"副審",value:s.subReferee,onChange:a=>p(r=>({...r,subReferee:a.target.value})),fullWidth:!0,margin:"dense",disabled:u}),e.jsx(pe,{label:"動画URL",value:s.videoUrl,onChange:a=>p(r=>({...r,videoUrl:a.target.value})),multiline:!0,rows:3,fullWidth:!0,margin:"dense",disabled:u}),e.jsx(pe,{label:"メモ",value:s.memo,onChange:a=>p(r=>({...r,memo:a.target.value})),multiline:!0,rows:3,fullWidth:!0,margin:"dense",disabled:u})]})})})})}function Di({match:s,setMatch:p,teams:m,locked:g}){return e.jsxs(Le,{elevation:0,sx:{},children:[e.jsxs(Te,{fullWidth:!0,margin:"dense",disabled:g,children:[e.jsx(Ae,{id:"teamA-label",children:"チームA"}),e.jsx(we,{labelId:"teamA-label",value:s.teamA,label:"チームA",onChange:u=>p(a=>({...a,teamA:u.target.value,teamAMembers:[]})),disabled:g,children:m.map(u=>e.jsx(se,{value:u.id,children:u.name},u.id))})]}),e.jsx(pe,{label:"チームA監督",value:s.teamAHeadCoach,onChange:u=>p(a=>({...a,teamAHeadCoach:u.target.value})),fullWidth:!0,margin:"dense",disabled:g}),e.jsx(pe,{label:"チームAコーチ",value:s.teamACoach,onChange:u=>p(a=>({...a,teamACoach:u.target.value})),fullWidth:!0,margin:"dense",disabled:g}),e.jsx(pe,{label:"チームAマネージャー",value:s.teamAManager,onChange:u=>p(a=>({...a,teamAManager:u.target.value})),fullWidth:!0,margin:"dense",disabled:g}),e.jsx(pe,{label:"チームAキャプテン",value:s.teamACaptain,onChange:u=>p(a=>({...a,teamACaptain:u.target.value})),fullWidth:!0,margin:"dense",disabled:g}),e.jsxs(Te,{fullWidth:!0,margin:"dense",disabled:g,children:[e.jsx(Ae,{id:"teamB-label",children:"チームB"}),e.jsx(we,{labelId:"teamB-label",value:s.teamB,label:"チームB",onChange:u=>p(a=>({...a,teamB:u.target.value,teamBMembers:[]})),disabled:g,children:m.map(u=>e.jsx(se,{value:u.id,children:u.name},u.id))})]}),e.jsx(pe,{label:"チームB監督",value:s.teamBHeadCoach,onChange:u=>p(a=>({...a,teamBHeadCoach:u.target.value})),fullWidth:!0,margin:"dense",disabled:g}),e.jsx(pe,{label:"チームBコーチ",value:s.teamBCoach,onChange:u=>p(a=>({...a,teamBCoach:u.target.value})),fullWidth:!0,margin:"dense",disabled:g}),e.jsx(pe,{label:"チームBマネージャー",value:s.teamBManager,onChange:u=>p(a=>({...a,teamBManager:u.target.value})),fullWidth:!0,margin:"dense",disabled:g}),e.jsx(pe,{label:"チームBキャプテン",value:s.teamBCaptain,onChange:u=>p(a=>({...a,teamBCaptain:u.target.value})),fullWidth:!0,margin:"dense",disabled:g})]})}const Bi=sn.create(n),$i=()=>typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():Math.random().toString(36).slice(2)+Date.now().toString(36);function Li({match:s,onSave:p,teams:m,teamMembers:g,playDetails:u,playCategories:a,statsSettings:r,rallyCategoryTags:v,rallyDetailTags:b,themeSetting:y,scoreInputSetting:B,onAddMember:_,setAppBarAction:H,setAppBarLeftAction:$,onDirtyChange:z,tags:ne,onAddTag:q}){const ee=Ys(),te=Qs(),[S,Y]=h.useState("info"),G=!1;h.useEffect(()=>{const x=te.pathname.split("/").filter(Boolean);if(x[0]!=="matches"||x[1]!==s.id)return;const k=x[2]??"info";k==="setinfo"?(Y("info"),ee(`/matches/${s.id}/info`,{replace:!0})):(Y(k),x[2]||ee(`/matches/${s.id}/info`,{replace:!0}))},[te.pathname,ee,s.id,G]);const ie=h.useCallback(x=>{const k=x.teamA,L=x.teamB,X=(fe,xe)=>!!xe&&(g[fe]||[]).some(le=>le.id===xe&&le.visible!==!1),ue=(fe,xe)=>xe.filter(le=>X(fe,le.id)).map(le=>{const $e=(g[fe]||[]).find(nt=>nt.id===le.id);return $e?{...le,no:$e.no,name:$e.name,positions:$e.positions}:le});return{...x,teamAMembers:ue(k,x.teamAMembers),teamBMembers:ue(L,x.teamBMembers),sets:x.sets.map(fe=>({...fe,rallies:fe.rallies.map(xe=>({...xe,server:X(xe.serverTeam==="teamA"?k:L,xe.server)?xe.server:void 0,teamAMember:X(k,xe.teamAMember)?xe.teamAMember:void 0,teamBMember:X(L,xe.teamBMember)?xe.teamBMember:void 0}))}))}},[g]),[j,Q]=h.useState(()=>ie({...s,tags:s.tags||[],matchStatsSettings:s.matchStatsSettings||[],teamAMembers:s.teamAMembers.map(x=>({...x,statuses:x.statuses??Array(s.sets.length).fill("")})),teamBMembers:s.teamBMembers.map(x=>({...x,statuses:x.statuses??Array(s.sets.length).fill("")}))})),N=5,D=[Cs,Ss,Ts,As,ws],C=!!s.locked,P=kt(),W=xs(P.breakpoints.up("sm")),J=xs(P.breakpoints.down("sm")),[V,Z]=h.useState(!1),[re,ce]=h.useState(!1),he=200,Ce=56,[f,A]=h.useState(!1),O=P.palette.text.secondary,U=h.useCallback(()=>{V?(ce(!1),Z(!1)):(Z(!0),W||ce(!0))},[V,W]),R=h.useCallback(x=>{x.propertyName==="width"&&W&&V&&ce(!0)},[W,V]);h.useEffect(()=>{W||(Z(!1),ce(!1))},[W]),h.useEffect(()=>($(e.jsx(Ge,{open:f,onClose:()=>A(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:Xe,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${O}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${O}`}}}},title:e.jsxs(n,{sx:{p:1,maxWidth:260},children:[e.jsxs(De,{variant:"body2",children:[e.jsx(hs,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),"からメニューを開き、各セットのメニューをロングタップし上下にスライドすることでセット順の変更が可能です"]}),e.jsx(n,{sx:{textAlign:"right",mt:1},children:e.jsx(Ye,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem("tutorial-set-reorder","1"),A(!1)},children:"了解した"})})]}),children:e.jsx(ye,{color:"inherit",onClick:U,children:e.jsx(hs,{})})})),()=>$(null)),[$,U,f,O]);const[oe,c]=h.useState(!1),[d,M]=h.useState(!1),[F,E]=h.useState(null),[i,o]=h.useState(!1),[t,l]=h.useState({open:!1,message:"",severity:"success"}),w=(x,k,L)=>{l({open:!0,message:x,severity:k,...L})},I=`matchDraft-${s.id}`,K=h.useRef(!1),[me,de]=h.useState(!1),[Se,Ie]=h.useState(!1),[ke,Ct]=h.useState(null),ze=h.useCallback(x=>{Ct(x.currentTarget)},[]),be=h.useCallback(()=>{Ct(null)},[]),[_e,st]=h.useState({}),Ve=h.useCallback((x,k,L=!0)=>{Q(X=>{const ue=[...X.sets],fe=ue.findIndex(le=>le.id===x);if(fe===-1)return X;const xe=ue[fe];return L&&st(le=>{const $e=le[x]||{undo:[]};return{...le,[x]:{undo:[...$e.undo,xe],redo:[]}}}),ue[fe]=k,{...X,sets:ue}})},[]),at=h.useCallback(()=>{if(!/^[0-9]+$/.test(S))return;const x=Number(S)-1,k=j.sets[x],L=_e[k.id];if(!L||L.undo.length===0)return;const X=L.undo[L.undo.length-1];st(ue=>({...ue,[k.id]:{undo:L.undo.slice(0,-1),redo:[...L.redo,k]}})),Ve(k.id,X,!1)},[S,j.sets,_e,Ve]),ot=h.useCallback(()=>{if(!/^[0-9]+$/.test(S))return;const x=Number(S)-1,k=j.sets[x],L=_e[k.id];if(!L||L.redo.length===0)return;const X=L.redo[L.redo.length-1];st(ue=>({...ue,[k.id]:{undo:[...L.undo,k],redo:L.redo.slice(0,-1)}})),Ve(k.id,X,!1)},[S,j.sets,_e,Ve]),St=x=>{if(!x.destination||C)return;const k=x.source.index,L=x.destination.index;if(k===L)return;const X=Array.from(j.sets),[ue]=X.splice(k,1);X.splice(L,0,ue);const fe=$e=>$e.map(nt=>{const ve=Array.from(nt.statuses||[]),[ut]=ve.splice(k,1);return ve.splice(L,0,ut),{...nt,statuses:ve}}),xe=fe(j.teamAMembers),le=fe(j.teamBMembers);Q($e=>({...$e,sets:X,teamAMembers:xe,teamBMembers:le}))};h.useEffect(()=>{st(x=>{const k={...x};return Object.keys(k).forEach(L=>{j.sets.some(X=>X.id===L)||delete k[L]}),k})},[j.sets]),h.useEffect(()=>{Q(x=>ie(x))},[ie]);const dt=x=>{var k;return((k=m.find(L=>L.id===x))==null?void 0:k.name)||""},qe=h.useMemo(()=>j.date!==s.date||j.matchName!==s.matchName||j.location!==s.location||j.mainReferee!==s.mainReferee||j.subReferee!==s.subReferee||j.videoUrl!==s.videoUrl||j.memo!==s.memo||j.teamA!==s.teamA||j.teamAHeadCoach!==s.teamAHeadCoach||j.teamACoach!==s.teamACoach||j.teamAManager!==s.teamAManager||j.teamACaptain!==s.teamACaptain||j.teamB!==s.teamB||j.teamBHeadCoach!==s.teamBHeadCoach||j.teamBCoach!==s.teamBCoach||j.teamBManager!==s.teamBManager||j.teamBCaptain!==s.teamBCaptain||JSON.stringify(j.tags)!==JSON.stringify(s.tags)||JSON.stringify(j.teamAMembers)!==JSON.stringify(s.teamAMembers)||JSON.stringify(j.teamBMembers)!==JSON.stringify(s.teamBMembers)||JSON.stringify(j.matchStatsSettings||[])!==JSON.stringify(s.matchStatsSettings||[])||JSON.stringify(j.sets)!==JSON.stringify(s.sets),[j,s]);h.useEffect(()=>{localStorage.getItem(I)&&o(!0)},[I]),h.useEffect(()=>{if(!K.current){K.current=!0;return}qe?localStorage.setItem(I,JSON.stringify(j)):localStorage.removeItem(I)},[j,qe,I]);const _s=()=>{if(C||j.sets.length>=N)return;j.sets.length===1&&!localStorage.getItem("tutorial-set-reorder")&&A(!0);const x={id:$i(),my:0,opponent:0,rallies:[]},k=j.sets.length+1;Q(L=>({...L,sets:[...L.sets,x],teamAMembers:L.teamAMembers.map(X=>({...X,statuses:[...X.statuses||[],""]})),teamBMembers:L.teamBMembers.map(X=>({...X,statuses:[...X.statuses||[],""]}))})),Y(String(k)),ee(`/matches/${s.id}/${k}`)},Ps=x=>{C||(E(x),M(!0))},Rs=()=>{if(F===null)return;const x=F,k=j.sets.length;let L=[],X=[],ue=[];const fe=S;let xe=S;if(S!=="info"&&S!=="members"&&S!=="stats"&&S!=="setinfo"){const le=Number(S)-1;le===x?x>0?(xe=String(x),ee(`/matches/${s.id}/${x}`)):k>1?(xe="1",ee(`/matches/${s.id}/1`)):(xe="info",ee(`/matches/${s.id}/info`)):le>x&&(xe=String(le),ee(`/matches/${s.id}/${le}`))}Y(xe),Q(le=>{L=le.sets.map(ve=>({...ve})),X=le.teamAMembers.map(ve=>({...ve,statuses:ve.statuses?[...ve.statuses]:[]})),ue=le.teamBMembers.map(ve=>({...ve,statuses:ve.statuses?[...ve.statuses]:[]}));const $e=le.sets.filter((ve,ut)=>ut!==x),nt=ve=>ve.map(ut=>({...ut,statuses:(ut.statuses||[]).filter((_i,Us)=>Us!==x)}));return{...le,sets:$e,teamAMembers:nt(le.teamAMembers),teamBMembers:nt(le.teamBMembers)}}),E(null),M(!1),w("セットを削除しました","success",{actionLabel:"元に戻す",onAction:()=>{Q(le=>({...le,sets:L,teamAMembers:X,teamBMembers:ue})),fe!=="info"&&fe!=="members"&&fe!=="stats"&&fe!=="setinfo"&&ee(`/matches/${s.id}/${fe}`)},autoHideDuration:5e3})},os=()=>{E(null),M(!1)},Pt=h.useCallback(()=>{c(!0)},[]),zs=async()=>{const x=ie(j);Q(x);try{await Promise.resolve(p(x)),localStorage.removeItem(I),w("保存しました","success")}catch{w("保存に失敗しました","error")}c(!1)},ds=()=>{c(!1)},Fs=()=>{l(x=>({...x,open:!1}))},Os=()=>{const x=localStorage.getItem(I);if(!x){o(!1);return}try{const k=JSON.parse(x),L={...k,tags:k.tags||[],matchStatsSettings:k.matchStatsSettings||[],teamAMembers:k.teamAMembers.map(ue=>({...ue,statuses:ue.statuses??Array(k.sets.length).fill("")})),teamBMembers:k.teamBMembers.map(ue=>({...ue,statuses:ue.statuses??Array(k.sets.length).fill("")}))},X=ie(L);Q(X),p(X)}catch{}localStorage.removeItem(I),o(!1)},cs=()=>{localStorage.removeItem(I),o(!1)},Ee=h.useMemo(()=>/^[0-9]+$/.test(S),[S]),ct=h.useMemo(()=>Ee?j.sets[Number(S)-1]:null,[Ee,S,j.sets]),jt=h.useMemo(()=>{var x;return!Ee||C||!ct||!((x=_e[ct.id])!=null&&x.undo.length)},[Ee,C,ct,_e]),gt=h.useMemo(()=>{var x;return!Ee||C||!ct||!((x=_e[ct.id])!=null&&x.redo.length)},[Ee,C,ct,_e]);h.useEffect(()=>{jt?de(!1):localStorage.getItem("tutorial-undo")||de(!0)},[jt]),h.useEffect(()=>{gt?Ie(!1):localStorage.getItem("tutorial-redo")||Ie(!0)},[gt]),h.useEffect(()=>(H(J?e.jsxs(n,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(ye,{color:"inherit",onClick:ze,children:e.jsx(Is,{})}),e.jsxs(Js,{anchorEl:ke,open:!!ke,onClose:be,MenuListProps:{onClick:be},children:[Ee&&e.jsxs(e.Fragment,{children:[e.jsxs(se,{onClick:at,disabled:jt,children:[e.jsx(xt,{children:e.jsx(wt,{fontSize:"small"})}),e.jsx(ht,{children:"元に戻す"})]}),e.jsxs(se,{onClick:ot,disabled:gt,children:[e.jsx(xt,{children:e.jsx(It,{fontSize:"small"})}),e.jsx(ht,{children:"やり直す"})]})]}),e.jsxs(se,{onClick:Pt,disabled:!qe||C,children:[e.jsx(xt,{children:e.jsx(Et,{fontSize:"small"})}),e.jsx(ht,{children:"保存"})]})]})]}):e.jsxs(n,{sx:{display:"flex",alignItems:"center"},children:[Ee&&e.jsxs(e.Fragment,{children:[e.jsx(Ge,{open:me,onClose:()=>de(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:Xe,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${O}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${O}`}}}},title:e.jsxs(n,{sx:{p:1,maxWidth:260},children:[e.jsxs(De,{variant:"body2",children:["各セットタブで独立し、ラリー結果の操作履歴を保持しています。",e.jsx("br",{}),e.jsx(wt,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),"を選択することで1つ前の操作を取り消すことができます。",e.jsx("br",{}),"操作履歴は試合画面を離れると消去されます。"]}),e.jsx(n,{sx:{textAlign:"right",mt:1},children:e.jsx(Ye,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem("tutorial-undo","1"),de(!1)},children:"了解した"})})]}),children:e.jsx(ye,{onClick:at,disabled:jt,color:"inherit",sx:{ml:1},children:e.jsx(wt,{})})}),e.jsx(Ge,{open:Se,onClose:()=>Ie(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:Xe,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${O}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${O}`}}}},title:e.jsxs(n,{sx:{p:1,maxWidth:260},children:[e.jsxs(De,{variant:"body2",children:[e.jsx(It,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),"を選択することで1つ前に取り消した操作を復活することができます。"]}),e.jsx(n,{sx:{textAlign:"right",mt:1},children:e.jsx(Ye,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem("tutorial-redo","1"),Ie(!1)},children:"了解した"})})]}),children:e.jsx(ye,{onClick:ot,disabled:gt,color:"inherit",sx:{ml:1},children:e.jsx(It,{})})})]}),e.jsx(ae,{onClick:Pt,variant:"contained",disabled:!qe||C,startIcon:e.jsx(Et,{}),sx:{ml:1},children:"保存"})]})),()=>H(null)),[H,J,ke,ze,be,Ee,at,ot,Pt,qe,C,jt,gt,me,Se,O]),h.useEffect(()=>(z==null||z(qe),()=>z==null?void 0:z(!1)),[qe,z]);const Hs=[{key:"info",label:"試合概要",icon:e.jsx(en,{})},{key:"team",label:"チーム",icon:e.jsx(vs,{})},{key:"members",label:"メンバー登録",icon:e.jsx(bs,{})},{key:"sep1",divider:!0},{key:"stats",label:"スタッツ",icon:e.jsx(tn,{})},{key:"sep2",divider:!0},{key:"setinfo",label:"セット情報",icon:e.jsx(ys,{})}].filter(x=>x.key!=="setinfo"),Es=j.sets.map((x,k)=>{const L=D[k];return{key:`${k+1}`,icon:e.jsx(L,{}),label:`${x.my}-${x.opponent}`}}),Ws=!C&&j.sets.length<N?[{key:"add",label:"セット追加",icon:e.jsx(_t,{})}]:[],Rt=x=>{x==="add"?_s():(Y(x),ee(`/matches/${s.id}/${x}`)),W||(ce(!1),Z(!1))},Ls=e.jsxs(Bi,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},sx:{flexGrow:1,overflowY:"auto",display:"flex",flexDirection:"column"},children:[S==="info"&&e.jsx(Mi,{match:j,setMatch:Q,tags:ne,onAddTag:q,locked:C}),S==="members"&&e.jsx(Ii,{match:j,setMatch:Q,teamAName:dt(j.teamA)||"チームA",teamBName:dt(j.teamB)||"チームB",teamMembers:g,onAddMember:_,locked:C,showSnackbar:w}),S==="stats"&&e.jsx(Ci,{sets:j.sets,playDetails:u,playCategories:a,statsSettings:r,matchStatsSettings:j.matchStatsSettings||[],onMatchStatsSettingsChange:x=>Q(k=>({...k,matchStatsSettings:x})),rallyCategoryTags:v,rallyDetailTags:b,teamAName:dt(j.teamA),teamBName:dt(j.teamB),locked:C,showSnackbar:w}),S==="team"&&e.jsx(n,{sx:{maxWidth:1024,mx:"auto"},children:e.jsx(Di,{match:j,setMatch:Q,teams:m,locked:C})}),G,S!=="info"&&S!=="members"&&S!=="stats"&&S!=="setinfo"&&S!=="team"&&e.jsx(ji,{setScore:j.sets[Number(S)-1],playDetails:u,playCategories:a,teamAMembers:j.teamAMembers,teamBMembers:j.teamBMembers,teamAName:dt(j.teamA),teamBName:dt(j.teamB),locked:C,scoreInputSetting:B,themeSetting:y,onChange:x=>Ve(x.id,x),showSnackbar:w})]},S);return e.jsxs(n,{sx:{display:"flex",height:"100%"},children:[e.jsx(Ns,{variant:W?"permanent":"temporary",open:W?!0:V,onClose:()=>{ce(!1),Z(!1)},PaperProps:{onTransitionEnd:R},ModalProps:{keepMounted:!0,BackdropProps:{sx:{backgroundColor:"rgba(0, 0, 0, 0.5)"}}},sx:{width:W?V?he:Ce:he,flexShrink:0,transition:P.transitions.create("width",{easing:P.transitions.easing.sharp,duration:P.transitions.duration.standard}),...W?{zIndex:P.zIndex.appBar-1}:{},"& .MuiDrawer-paper":{width:W?V?he:Ce:he,boxSizing:"border-box",overflowX:"hidden",transition:P.transitions.create("width",{easing:P.transitions.easing.sharp,duration:P.transitions.duration.standard}),...W?{top:P.mixins.toolbar.minHeight,height:`calc(100% - ${P.mixins.toolbar.minHeight}px)`,zIndex:P.zIndex.appBar-1}:{}}},children:e.jsxs(Gs,{children:[Hs.map(x=>x.divider?e.jsx(Xs,{component:"li"},x.key):e.jsxs(Ft,{selected:S===x.key,onClick:()=>Rt(x.key),sx:{minHeight:48,justifyContent:V?"initial":"center",px:2.5},children:[e.jsx(xt,{sx:{minWidth:0,mr:V?3:0,justifyContent:"center"},children:x.icon}),e.jsx(ht,{primary:x.label??`セット${x.key}`,sx:{opacity:re?1:0,display:re?"block":"none",whiteSpace:"nowrap"}})]},x.key)),e.jsx(vt,{onDragEnd:St,children:e.jsx(Ze,{droppableId:"drawer-sets",children:x=>e.jsxs(n,{ref:x.innerRef,...x.droppableProps,children:[Es.map((k,L)=>e.jsx(et,{draggableId:j.sets[L].id,index:L,children:X=>e.jsxs(Ft,{ref:X.innerRef,...X.draggableProps,...X.dragHandleProps,style:X.draggableProps.style,selected:S===k.key,onClick:()=>Rt(k.key),sx:{minHeight:48,justifyContent:V?"initial":"center",px:2.5},children:[e.jsx(xt,{sx:{minWidth:0,mr:V?3:0,justifyContent:"center"},children:k.icon}),e.jsx(ht,{primary:k.label??`セット${k.key}`,sx:{opacity:re?1:0,display:re?"block":"none",whiteSpace:"nowrap"}}),!C&&V&&e.jsx(ye,{edge:"end",onClick:ue=>{ue.stopPropagation(),Ps(L)},children:e.jsx(Be,{})})]})},j.sets[L].id)),x.placeholder]})})}),Ws.map(x=>e.jsxs(Ft,{selected:S===x.key,onClick:()=>Rt(x.key),sx:{minHeight:48,justifyContent:V?"initial":"center",px:2.5},children:[e.jsx(xt,{sx:{minWidth:0,mr:V?3:0,justifyContent:"center"},children:x.icon}),e.jsx(ht,{primary:x.label??`セット${x.key}`,sx:{opacity:re?1:0,display:re?"block":"none",whiteSpace:"nowrap"}})]},x.key))]})}),e.jsxs(n,{sx:{flexGrow:1,display:"flex",flexDirection:"column",width:W?`calc(100% - ${V?he:Ce}px)`:"100%",transition:W?P.transitions.create("width",{duration:P.transitions.duration.standard}):void 0},children:[e.jsx(n,{sx:{flexGrow:1,position:"relative",overflowY:"hidden",display:"flex",width:"100%"},children:e.jsx(nn,{mode:"wait",children:Ls})}),e.jsxs(Ot,{open:d,onClose:os,children:[e.jsx(Ke,{children:"削除確認"}),e.jsx(Je,{sx:{mt:2},children:"このセットを削除しますか？"}),e.jsxs(Ne,{children:[e.jsx(ae,{onClick:os,startIcon:e.jsx(Ue,{}),color:"inherit",children:"キャンセル"}),e.jsx(ae,{onClick:Rs,color:"error",startIcon:e.jsx(Qe,{}),children:"OK"})]})]}),e.jsxs(Ot,{open:i,onClose:cs,children:[e.jsx(Ke,{children:"復元確認"}),e.jsx(Je,{sx:{mt:2},children:"入力途中のデータが存在します。復元しますか？"}),e.jsxs(Ne,{children:[e.jsx(ae,{onClick:cs,startIcon:e.jsx(Ue,{}),color:"inherit",children:"いいえ"}),e.jsx(ae,{onClick:Os,startIcon:e.jsx(Qe,{}),children:"はい"})]})]}),e.jsxs(Ot,{open:oe,onClose:ds,children:[e.jsx(Ke,{children:"保存確認"}),e.jsx(Je,{sx:{mt:2},children:"入力内容を保存しますか？"}),e.jsxs(Ne,{children:[e.jsx(ae,{onClick:ds,startIcon:e.jsx(Ue,{}),color:"inherit",children:"キャンセル"}),e.jsx(ae,{onClick:zs,disabled:!qe||C,startIcon:e.jsx(Qe,{}),children:"OK"})]})]}),e.jsx(Zs,{open:t.open,message:t.message,severity:t.severity,onClose:Fs,actionLabel:t.actionLabel,onAction:t.onAction,autoHideDuration:t.autoHideDuration})]})]})}export{Li as default};
