import{i as je,j as e,E as qe,G as Ke,d as Ee,e as Fe,B as n,F as Te,K as Ae,S as we,M as ae,H as Je,r as oe,J as us,I as Se,L as zs,N as as,a as wt,O as xs,n as Bt,Q as yt,R as Ne,Z as Ge,y as Be,U as Xe,V as Fs,f as Le,g as ot,h as dt,k as De,l as w,m as ct,C as Pe,W as _t,X as fe,A as hs,Y as ut,_ as Os,b as Hs,$ as Ws,a0 as Es,a1 as Ls,a2 as Mt,a3 as $t,a4 as kt,D as Pt}from"./mui-vendor-BMqVnbO7.js";import{r as f,f as Us,u as Vs}from"./react-vendor-QLNaZ7XN.js";import{r as be,u as et,R as xt,d as Ue,a as Ye,B as St,b as It,c as Ot,S as rt,e as Oe,f as Me,g as Tt,h as _e,D as nt,i as He,A as qs}from"./index-DBlwNfpj.js";import{d as Ks,a as Js}from"./QueryStatsOutlined-uWFYKp2H.js";import{d as os}from"./SpaceDashboardOutlined-BGeQDlZM.js";import{D as ht,C as Qe,P as Ze,d as it,a as vt,u as At}from"./useLongPress-DNKfQ2E_.js";import{m as Ns,A as Gs}from"./motion-vendor-D1Sky_hw.js";import"./chart-vendor-DUy3Dv5T.js";var Ht={},Xs=je;Object.defineProperty(Ht,"__esModule",{value:!0});var ms=Ht.default=void 0,Ys=Xs(be()),Qs=e;ms=Ht.default=(0,Ys.default)((0,Qs.jsx)("path",{d:"M12 5.9c1.16 0 2.1.94 2.1 2.1s-.94 2.1-2.1 2.1S9.9 9.16 9.9 8s.94-2.1 2.1-2.1m0 9c2.97 0 6.1 1.46 6.1 2.1v1.1H5.9V17c0-.64 3.13-2.1 6.1-2.1M12 4C9.79 4 8 5.79 8 8s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4m0 9c-2.67 0-8 1.34-8 4v3h16v-3c0-2.66-5.33-4-8-4"}),"PersonOutlineOutlined");var Wt={},Zs=je;Object.defineProperty(Wt,"__esModule",{value:!0});var fs=Wt.default=void 0,en=Zs(be()),tn=e;fs=Wt.default=(0,en.default)((0,tn.jsx)("path",{d:"M2 17h2v.5H3v1h1v.5H2v1h3v-4H2zm1-9h1V4H2v1h1zm-1 3h1.8L2 13.1v.9h3v-1H3.2L5 10.9V10H2zm5-6v2h14V5zm0 14h14v-2H7zm0-6h14v-2H7z"}),"FormatListNumberedOutlined");var Et={},sn=je;Object.defineProperty(Et,"__esModule",{value:!0});var ps=Et.default=void 0,nn=sn(be()),rn=e;ps=Et.default=(0,nn.default)((0,rn.jsx)("path",{d:"M9 13.75c-2.34 0-7 1.17-7 3.5V19h14v-1.75c0-2.33-4.66-3.5-7-3.5M4.34 17c.84-.58 2.87-1.25 4.66-1.25s3.82.67 4.66 1.25zM9 12c1.93 0 3.5-1.57 3.5-3.5S10.93 5 9 5 5.5 6.57 5.5 8.5 7.07 12 9 12m0-5c.83 0 1.5.67 1.5 1.5S9.83 10 9 10s-1.5-.67-1.5-1.5S8.17 7 9 7m7.04 6.81c1.16.84 1.96 1.96 1.96 3.44V19h4v-1.75c0-2.02-3.5-3.17-5.96-3.44M15 12c1.93 0 3.5-1.57 3.5-3.5S16.93 5 15 5c-.54 0-1.04.13-1.5.35.63.89 1 1.98 1 3.15s-.37 2.26-1 3.15c.46.22.96.35 1.5.35"}),"GroupOutlined");var Lt={},ln=je;Object.defineProperty(Lt,"__esModule",{value:!0});var gs=Lt.default=void 0,an=ln(be()),on=e;gs=Lt.default=(0,an.default)((0,on.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V5h14zm-7-2h2V7h-4v2h2z"}),"LooksOneOutlined");var Ut={},dn=je;Object.defineProperty(Ut,"__esModule",{value:!0});var js=Ut.default=void 0,cn=dn(be()),un=e;js=Ut.default=(0,cn.default)((0,un.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V5h14zm-4-4h-4v-2h2c1.1 0 2-.89 2-2V9c0-1.11-.9-2-2-2H9v2h4v2h-2c-1.1 0-2 .89-2 2v4h6z"}),"LooksTwoOutlined");var Vt={},xn=je;Object.defineProperty(Vt,"__esModule",{value:!0});var bs=Vt.default=void 0,hn=xn(be()),mn=e;bs=Vt.default=(0,hn.default)((0,mn.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V5h14zm-4-4v-1.5c0-.83-.67-1.5-1.5-1.5.83 0 1.5-.67 1.5-1.5V9c0-1.11-.9-2-2-2H9v2h4v2h-2v2h2v2H9v2h4c1.1 0 2-.89 2-2"}),"Looks3Outlined");var qt={},fn=je;Object.defineProperty(qt,"__esModule",{value:!0});var ys=qt.default=void 0,pn=fn(be()),gn=e;ys=qt.default=(0,pn.default)((0,gn.jsx)("path",{d:"M19.04 3h-14c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16h-14V5h14zm-6-2h2V7h-2v4h-2V7h-2v6h4z"}),"Looks4Outlined");var Kt={},jn=je;Object.defineProperty(Kt,"__esModule",{value:!0});var vs=Kt.default=void 0,bn=jn(be()),yn=e;vs=Kt.default=(0,bn.default)((0,yn.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V5h14zm-4-4v-2c0-1.11-.9-2-2-2h-2V9h4V7H9v6h4v2H9v2h4c1.1 0 2-.89 2-2"}),"Looks5Outlined");var Jt={},vn=je;Object.defineProperty(Jt,"__esModule",{value:!0});var Cs=Jt.default=void 0,Cn=vn(be()),Sn=e;Cs=Jt.default=(0,Cn.default)((0,Sn.jsx)("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"}),"Save");var Nt={},Tn=je;Object.defineProperty(Nt,"__esModule",{value:!0});var Rt=Nt.default=void 0,An=Tn(be()),wn=e;Rt=Nt.default=(0,An.default)((0,wn.jsx)("path",{d:"M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8"}),"UndoOutlined");var Gt={},In=je;Object.defineProperty(Gt,"__esModule",{value:!0});var zt=Gt.default=void 0,Dn=In(be()),Bn=e;zt=Gt.default=(0,Dn.default)((0,Bn.jsx)("path",{d:"M18.4 10.6C16.55 8.99 14.15 8 11.5 8c-4.65 0-8.58 3.03-9.96 7.22L3.9 16c1.05-3.19 4.05-5.5 7.6-5.5 1.95 0 3.73.72 5.12 1.88L13 16h9V7z"}),"RedoOutlined");function Mn(s,p,h){const j=f.useCallback(r=>{let v=0,b=0;r.rallies.forEach(y=>{if(y.timeoutTeam||y.substitutionTeam)return;const M=p.find(H=>H.id===y.teamAPlayDetail),P=p.find(H=>H.id===y.teamBPlayDetail);(M==null?void 0:M.pointType)==="得点"||(P==null?void 0:P.pointType)==="失点"?v+=1:((P==null?void 0:P.pointType)==="得点"||(M==null?void 0:M.pointType)==="失点")&&(b+=1)}),r.my=v,r.opponent=b},[p]),u=f.useCallback(r=>{const v=[...s.rallies,r],b={...s,rallies:v};j(b),h(b)},[s,j,h]),a=f.useCallback(r=>{const v=s.rallies.filter((y,M)=>M!==r),b={...s,rallies:v};j(b),h(b)},[s,j,h]);return{addRally:u,deleteRally:a,calculateScores:j}}const $n=f.forwardRef(function({setScore:p,playDetails:h,playCategories:j,teamAMembers:u,teamBMembers:a,teamAName:r,teamBName:v,scoreInputSetting:b,themeSetting:y,locked:M=!1,onAdd:P,onEdit:H},$){var re,c,d,I,F,E,i,o;const O=et("sm"),[se,q]=f.useState(!1),[ee,te]=f.useState("teamA"),[A,Y]=f.useState(""),[N,ne]=f.useState(""),[g,Q]=f.useState(""),[J,D]=f.useState(""),[T,R]=f.useState(""),[W,z]=f.useState(""),[Z,G]=f.useState(""),[ie,ce]=f.useState(""),[pe,Ie]=f.useState(null),m=()=>{if(M)return;Ie(null);const t=[...p.rallies].reverse().find(S=>!S.timeoutTeam&&!S.substitutionTeam);let l="teamA";if(t){const S=h.find(K=>K.id===t.teamAPlayDetail),B=h.find(K=>K.id===t.teamBPlayDetail);(S==null?void 0:S.pointType)==="得点"||(B==null?void 0:B.pointType)==="失点"?l="teamA":((B==null?void 0:B.pointType)==="得点"||(S==null?void 0:S.pointType)==="失点")&&(l="teamB")}te(l),Y(""),ne(""),Q(""),D(""),R(""),z(""),G(""),ce(""),q(!0)},C=t=>{var S,B;if(M)return;const l=p.rallies[t];Ie(t),te(l.serverTeam||"teamA"),Y(l.server&&(l.serverTeam==="teamA"?u.some(K=>K.id===l.server):a.some(K=>K.id===l.server))?l.server:""),ne(((S=h.find(K=>K.id===l.teamAPlayDetail))==null?void 0:S.playCategoryId)||""),D(l.teamAPlayDetail||""),z(u.some(K=>K.id===l.teamAMember)&&l.teamAMember||""),Q(((B=h.find(K=>K.id===l.teamBPlayDetail))==null?void 0:B.playCategoryId)||""),R(l.teamBPlayDetail||""),G(a.some(K=>K.id===l.teamBMember)&&l.teamBMember||""),ce(l.timeoutTeam||""),q(!0)};f.useImperativeHandle($,()=>({openAddDialog:m,openEditDialog:C}));const U=()=>{var K,he;if(ie)return!0;if(b.rallyMemberRequired&&!A||N&&!J||g&&!T||!!!(N&&J)&&!!!(g&&T))return!1;const S=(K=h.find(ue=>ue.id===J))==null?void 0:K.pointUnitType;if(b.rallyMemberRequired&&J&&S==="メンバー"&&!W)return!1;const B=(he=h.find(ue=>ue.id===T))==null?void 0:he.pointUnitType;return!(b.rallyMemberRequired&&T&&B==="メンバー"&&!Z)},V=t=>ie?{id:t??crypto.randomUUID(),timeoutTeam:ie}:{id:t??crypto.randomUUID(),serverTeam:ee,server:A||void 0,teamAPlayDetail:J||void 0,teamAMember:W||void 0,teamBPlayDetail:T||void 0,teamBMember:Z||void 0},_=()=>{if(pe===null)P(V());else{const t=p.rallies[pe].id;H(pe,V(t))}q(!1)};return e.jsxs(xt,{open:se,onClose:()=>q(!1),children:[e.jsx(qe,{children:pe===null?"ラリー追加":"ラリー編集"}),e.jsxs(Ke,{sx:{display:"flex",flexDirection:"column"},children:[e.jsxs(Ee,{exclusive:!0,value:ee,onChange:(t,l)=>l&&te(l),fullWidth:!0,disabled:!!ie,sx:{mb:1},children:[e.jsx(Fe,{value:"teamA",sx:{flex:1},children:e.jsx(n,{sx:{whiteSpace:"pre-line",textAlign:"center"},children:`${r||"チームA"}
サーブ`})}),e.jsx(Fe,{value:"teamB",sx:{flex:1},children:e.jsx(n,{sx:{whiteSpace:"pre-line",textAlign:"center"},children:`${v||"チームB"}
サーブ`})})]}),e.jsxs(Te,{fullWidth:!0,margin:"dense",required:b.rallyMemberRequired,disabled:!!ie,children:[e.jsx(Ae,{id:"server",children:"サーバー"}),e.jsx(we,{labelId:"server",value:A,label:"サーバー",onChange:t=>Y(t.target.value),children:(ee==="teamA"?u:a).map(t=>e.jsx(ae,{value:t.id,children:t.name},t.id))})]}),O?e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(n,{sx:{flex:1,display:"flex",flexDirection:"column",gap:1},children:[e.jsx(Ee,{sx:{mt:2,mb:1},orientation:"vertical",exclusive:!0,value:N,onChange:(t,l)=>{N===l||l===null?(ne(""),D("")):(ne(l),D(""))},disabled:!!ie,children:j.filter(t=>t.visible!==!1).map(t=>e.jsx(Fe,{value:t.id,sx:{whiteSpace:"nowrap"},children:t.name},t.id))}),e.jsx(Ee,{orientation:"vertical",exclusive:!0,value:J,onChange:(t,l)=>{D(J===l||l===null?"":l)},disabled:!!ie,children:h.filter(t=>t.playCategoryId===N&&t.visible!==!1).map(t=>{const l=t.pointType==="得点"?y.scoreColor:y.lossColor;return e.jsx(Fe,{value:t.id,sx:{whiteSpace:"nowrap",color:l,"&.Mui-selected":{color:l}},children:t.name},t.id)})}),e.jsxs(Te,{fullWidth:!0,margin:"dense",required:b.rallyMemberRequired&&((re=h.find(t=>t.id===J))==null?void 0:re.pointUnitType)==="メンバー",disabled:!!ie,children:[e.jsx(Ae,{id:"amem",children:`${r||"チームA"}メンバー`}),e.jsxs(we,{labelId:"amem",value:W,label:`${r||"チームA"}メンバー`,onChange:t=>z(t.target.value),disabled:((c=h.find(t=>t.id===J))==null?void 0:c.pointUnitType)!=="メンバー",children:[e.jsx(ae,{value:"",children:e.jsx("em",{children:"なし"})}),u.map(t=>e.jsx(ae,{value:t.id,children:t.name},t.id))]})]})]}),e.jsxs(n,{sx:{flex:1,display:"flex",flexDirection:"column",gap:1},children:[e.jsx(Ee,{orientation:"vertical",exclusive:!0,value:g,onChange:(t,l)=>{g===l||l===null?(Q(""),R("")):(Q(l),R(""))},disabled:!!ie,children:j.filter(t=>t.visible!==!1).map(t=>e.jsx(Fe,{value:t.id,sx:{whiteSpace:"nowrap"},children:t.name},t.id))}),e.jsx(Ee,{orientation:"vertical",exclusive:!0,value:T,onChange:(t,l)=>{R(T===l||l===null?"":l)},sx:{mt:1},disabled:!!ie,children:h.filter(t=>t.playCategoryId===g&&t.visible!==!1).map(t=>{const l=t.pointType==="得点"?y.scoreColor:y.lossColor;return e.jsx(Fe,{value:t.id,sx:{whiteSpace:"nowrap",color:l,"&.Mui-selected":{color:l}},children:t.name},t.id)})}),e.jsxs(Te,{fullWidth:!0,margin:"dense",required:b.rallyMemberRequired&&((d=h.find(t=>t.id===T))==null?void 0:d.pointUnitType)==="メンバー",disabled:!!ie,children:[e.jsx(Ae,{id:"bmem",children:`${v||"チームB"}メンバー`}),e.jsxs(we,{labelId:"bmem",value:Z,label:`${v||"チームB"}メンバー`,onChange:t=>G(t.target.value),disabled:((I=h.find(t=>t.id===T))==null?void 0:I.pointUnitType)!=="メンバー",children:[e.jsx(ae,{value:"",children:e.jsx("em",{children:"なし"})}),a.map(t=>e.jsx(ae,{value:t.id,children:t.name},t.id))]})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(n,{sx:{display:"flex",gap:2,mt:1},children:[e.jsx(Ee,{orientation:"vertical",exclusive:!0,value:N,onChange:(t,l)=>{N===l||l===null?(ne(""),D("")):(ne(l),D(""))},disabled:!!ie,sx:{flex:"1 1 25%"},children:j.filter(t=>t.visible!==!1).map(t=>e.jsx(Fe,{value:t.id,sx:{whiteSpace:"nowrap"},children:t.name},t.id))}),e.jsx(Ee,{orientation:"vertical",exclusive:!0,value:J,onChange:(t,l)=>{D(J===l||l===null?"":l)},disabled:!!ie,sx:{flex:"1 1 25%"},children:h.filter(t=>t.playCategoryId===N&&t.visible!==!1).map(t=>{const l=t.pointType==="得点"?y.scoreColor:y.lossColor;return e.jsx(Fe,{value:t.id,sx:{whiteSpace:"nowrap",color:l,"&.Mui-selected":{color:l}},children:t.name},t.id)})}),e.jsx(Ee,{orientation:"vertical",exclusive:!0,value:g,onChange:(t,l)=>{g===l||l===null?(Q(""),R("")):(Q(l),R(""))},disabled:!!ie,sx:{flex:"1 1 25%"},children:j.filter(t=>t.visible!==!1).map(t=>e.jsx(Fe,{value:t.id,sx:{whiteSpace:"nowrap"},children:t.name},t.id))}),e.jsx(Ee,{orientation:"vertical",exclusive:!0,value:T,onChange:(t,l)=>{R(T===l||l===null?"":l)},disabled:!!ie,sx:{flex:"1 1 25%"},children:h.filter(t=>t.playCategoryId===g&&t.visible!==!1).map(t=>{const l=t.pointType==="得点"?y.scoreColor:y.lossColor;return e.jsx(Fe,{value:t.id,sx:{whiteSpace:"nowrap",color:l,"&.Mui-selected":{color:l}},children:t.name},t.id)})})]}),e.jsxs(n,{sx:{display:"flex",gap:2,mt:1},children:[e.jsxs(Te,{fullWidth:!0,margin:"dense",required:b.rallyMemberRequired&&((F=h.find(t=>t.id===J))==null?void 0:F.pointUnitType)==="メンバー",disabled:!!ie,sx:{flex:1},children:[e.jsx(Ae,{id:"amem",children:`${r||"チームA"}メンバー`}),e.jsxs(we,{labelId:"amem",value:W,label:`${r||"チームA"}メンバー`,onChange:t=>z(t.target.value),disabled:((E=h.find(t=>t.id===J))==null?void 0:E.pointUnitType)!=="メンバー",children:[e.jsx(ae,{value:"",children:e.jsx("em",{children:"なし"})}),u.map(t=>e.jsx(ae,{value:t.id,children:t.name},t.id))]})]}),e.jsxs(Te,{fullWidth:!0,margin:"dense",required:b.rallyMemberRequired&&((i=h.find(t=>t.id===T))==null?void 0:i.pointUnitType)==="メンバー",disabled:!!ie,sx:{flex:1},children:[e.jsx(Ae,{id:"bmem",children:`${v||"チームB"}メンバー`}),e.jsxs(we,{labelId:"bmem",value:Z,label:`${v||"チームB"}メンバー`,onChange:t=>G(t.target.value),disabled:((o=h.find(t=>t.id===T))==null?void 0:o.pointUnitType)!=="メンバー",children:[e.jsx(ae,{value:"",children:e.jsx("em",{children:"なし"})}),a.map(t=>e.jsx(ae,{value:t.id,children:t.name},t.id))]})]})]})]})]}),e.jsxs(Je,{children:[e.jsx(oe,{onClick:()=>q(!1),color:"inherit",startIcon:e.jsx(Ue,{}),children:"キャンセル"}),e.jsx(oe,{onClick:_,disabled:!U(),startIcon:e.jsx(Ye,{}),children:"OK"})]})]})});var Xt={},kn=je;Object.defineProperty(Xt,"__esModule",{value:!0});var Ss=Xt.default=void 0,Pn=kn(be()),_n=e;Ss=Xt.default=(0,Pn.default)((0,_n.jsx)("path",{d:"M16 17.01V10h-2v7.01h-3L15 21l4-3.99zM9 3 5 6.99h3V14h2V6.99h3zm7 14.01V10h-2v7.01h-3L15 21l4-3.99zM9 3 5 6.99h3V14h2V6.99h3z"}),"SwapVertOutlined");const Rn=f.forwardRef(function({teamAMembers:p,teamBMembers:h,onSave:j},u){const[a,r]=f.useState(!1),[v,b]=f.useState("teamA"),[y,M]=f.useState(""),[P,H]=f.useState(""),[$,O]=f.useState(null),se=A=>{b(A),M(""),H(""),O(null),r(!0)},q=(A,Y,N,ne)=>{b(Y),M(N),H(ne),O(A),r(!0)};f.useImperativeHandle(u,()=>({openAddDialog:se,openEditDialog:q}));const ee=()=>{r(!1),O(null)},te=()=>{j(v,y,P,$),r(!1),O(null)};return e.jsxs(xt,{open:a,onClose:ee,children:[e.jsx(qe,{children:"選手交代"}),e.jsx(Ke,{children:e.jsxs(n,{component:"form",sx:{mt:2},children:[e.jsxs(Te,{fullWidth:!0,sx:{mb:2},children:[e.jsx(Ae,{id:"out-member",children:"OUT"}),e.jsx(we,{labelId:"out-member",value:y,label:"OUT",onChange:A=>M(A.target.value),children:(v==="teamA"?p:h).map(A=>e.jsx(ae,{value:A.id,children:`${A.no}:${A.name}`},A.id))})]}),e.jsx(n,{sx:{display:"flex",justifyContent:"center",mb:2},children:e.jsx(Ss,{sx:{width:32,height:32}})}),e.jsxs(Te,{fullWidth:!0,children:[e.jsx(Ae,{id:"in-member",children:"IN"}),e.jsx(we,{labelId:"in-member",value:P,label:"IN",onChange:A=>H(A.target.value),children:(v==="teamA"?p:h).map(A=>e.jsx(ae,{value:A.id,children:`${A.no}:${A.name}`},A.id))})]})]})}),e.jsxs(Je,{children:[e.jsx(oe,{onClick:ee,color:"inherit",startIcon:e.jsx(Ue,{}),children:"キャンセル"}),e.jsx(oe,{onClick:te,disabled:!y||!P,startIcon:e.jsx(Ye,{}),children:"OK"})]})]})});function zn({open:s,onClose:p,scores:h,consecutive:j,connections:u,rowHeight:a}){const r=h.length*a;return e.jsx(us,{anchor:"bottom",open:s,onClose:p,onOpen:()=>{},disableSwipeToOpen:!0,sx:{zIndex:v=>v.zIndex.drawer+3},PaperProps:{sx:{height:"60vh",borderTopLeftRadius:St,borderTopRightRadius:St}},children:e.jsxs(n,{sx:{position:"relative",height:"100%"},children:[e.jsx(n,{sx:{width:40,height:4,bgcolor:"text.secondary",borderRadius:2,position:"absolute",top:8,left:"50%",transform:"translateX(-50%)"}}),e.jsx(Se,{onClick:p,sx:{position:"absolute",top:4,right:4},children:e.jsx(Ue,{})}),e.jsx(n,{sx:{mt:4,height:"100%",overflowY:"auto"},children:e.jsxs(n,{sx:{flex:"0 0 100%",overflowY:"auto",height:"100%",position:"relative"},children:[h.map((v,b)=>{const y=b===0?{a:0,b:0}:h[b-1],M=v.a!==y.a&&v.a!==0,P=v.b!==y.b&&v.b!==0,H=M&&j[b],$=P&&j[b];return e.jsxs(n,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr 1fr",alignItems:"center",py:.5,height:`${a}px`,position:"relative",zIndex:1},children:[e.jsx(n,{}),e.jsxs(e.Fragment,{children:[e.jsx(n,{sx:{display:"flex",justifyContent:"center"},children:M?e.jsx(n,{sx:{width:32,height:32,border:"1px solid",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:24,borderColor:H?"red":"currentColor",backgroundColor:H?"#ffebee":"#fff",color:"black"},children:v.a}):null}),e.jsx(n,{}),e.jsx(n,{sx:{display:"flex",justifyContent:"center"},children:P?e.jsx(n,{sx:{width:32,height:32,border:"1px solid",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:24,borderColor:$?"red":"currentColor",backgroundColor:$?"#ffebee":"#fff",color:"black"},children:v.b}):null})]}),e.jsx(n,{})]},b)}),e.jsx("svg",{viewBox:`0 0 100 ${r}`,style:{position:"absolute",left:0,top:0,width:"100%",height:r,zIndex:0},preserveAspectRatio:"none",pointerEvents:"none",children:u.map(v=>{const b=v.index*a+a/2,y=(v.index+1)*a+a/2,M=v.from==="A"?30:70,P=v.from==="A"?70:30;return e.jsx("line",{x1:M,y1:b,x2:P,y2:y,stroke:"currentColor",strokeWidth:1},v.index)})})]})})]})})}var Yt={},Fn=je;Object.defineProperty(Yt,"__esModule",{value:!0});var Ts=Yt.default=void 0,On=Fn(be()),Hn=e;Ts=Yt.default=(0,On.default)((0,Hn.jsx)("path",{d:"M3 18h18v-2H3zm0-5h18v-2H3zm0-7v2h18V6z"}),"Menu");function Wn({open:s,onClose:p,teamAName:h,teamBName:j,disableTimeoutA:u,disableTimeoutB:a,showScoreProgressButton:r,onShowScoreProgress:v,onSubstitution:b,onTimeout:y,onAddRally:M}){const P=O=>()=>{O(),p()},$=et("sm")?"vertical":"horizontal";return e.jsx(us,{anchor:"bottom",open:s,onClose:p,onOpen:()=>{},sx:{zIndex:O=>O.zIndex.drawer+2},PaperProps:{sx:{height:"auto",maxHeight:"80vh",borderTopLeftRadius:St,borderTopRightRadius:St}},children:e.jsx(n,{sx:{p:2},children:e.jsxs(zs,{spacing:2,children:[r&&e.jsx(oe,{fullWidth:!0,variant:"outlined",onClick:P(v),children:"得点推移表示"}),e.jsxs(as,{fullWidth:!0,orientation:$,children:[e.jsx(oe,{onClick:P(()=>b("teamA")),children:(h||"チームA")+" メンバー交代"}),e.jsx(oe,{onClick:P(()=>b("teamB")),children:(j||"チームB")+" メンバー交代"})]}),e.jsxs(as,{fullWidth:!0,orientation:$,children:[e.jsx(oe,{disabled:u,onClick:P(()=>y("teamA")),children:(h||"チームA")+" タイムアウト"}),e.jsx(oe,{disabled:a,onClick:P(()=>y("teamB")),children:(j||"チームB")+" タイムアウト"})]}),e.jsx(oe,{fullWidth:!0,variant:"contained",onClick:P(M),children:"ラリー結果追加"})]})})})}var Qt={},En=je;Object.defineProperty(Qt,"__esModule",{value:!0});var As=Qt.default=void 0,Ln=En(be()),Un=e;As=Qt.default=(0,Ln.default)((0,Un.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8m.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"}),"AccessTimeOutlined");var Zt={},Vn=je;Object.defineProperty(Zt,"__esModule",{value:!0});var ws=Zt.default=void 0,qn=Vn(be()),Kn=e;ws=Zt.default=(0,qn.default)((0,Kn.jsx)("path",{d:"M6.99 11 3 15l3.99 4v-3H14v-2H6.99zM21 9l-3.99-4v3H10v2h7.01v3z"}),"SwapHorizOutlined");function Jn({teamAName:s,teamBName:p,locked:h,disableTimeoutA:j,disableTimeoutB:u,onTimeout:a,onSubstitution:r,onAddRally:v}){const b=wt(),[y,M]=f.useState(!1),[P,H]=f.useState(!1),$="tutorial-settab-add-rally",[O,se]=f.useState(()=>!localStorage.getItem($));return h?null:e.jsxs(xs,{children:[e.jsxs(Bt,{ariaLabel:"substitution actions",direction:"left",icon:e.jsx(ws,{}),onOpen:()=>H(!0),onClose:()=>H(!1),open:P,FabProps:{size:"large"},sx:{position:"fixed",right:35,bottom:200,zIndex:q=>q.zIndex.drawer-1},children:[e.jsx(yt,{icon:e.jsx(e.Fragment,{children:p||"チームB"}),tooltipTitle:"",FabProps:{variant:"extended",size:"small"},onClick:()=>{r("teamB"),H(!1)}}),e.jsx(yt,{icon:e.jsx(e.Fragment,{children:s||"チームA"}),tooltipTitle:"",FabProps:{variant:"extended",size:"small"},onClick:()=>{r("teamA"),H(!1)}})]}),e.jsxs(Bt,{ariaLabel:"timeout actions",direction:"left",icon:e.jsx(As,{}),onOpen:()=>M(!0),onClose:()=>M(!1),open:y,FabProps:{size:"large"},sx:{position:"fixed",right:35,bottom:140,zIndex:q=>q.zIndex.drawer-1},children:[e.jsx(yt,{icon:e.jsx(e.Fragment,{children:p||"チームB"}),tooltipTitle:"",FabProps:{variant:"extended",size:"small",disabled:u},onClick:()=>{a("teamB"),M(!1)}}),e.jsx(yt,{icon:e.jsx(e.Fragment,{children:s||"チームA"}),tooltipTitle:"",FabProps:{variant:"extended",size:"small",disabled:j},onClick:()=>{a("teamA"),M(!1)}})]}),e.jsx(Ne,{open:O,onClose:()=>se(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"left",TransitionComponent:Ge,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${b.palette.text.secondary}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${b.palette.text.secondary}`}}}},title:e.jsxs(n,{sx:{p:1,maxWidth:260},children:[e.jsx(Be,{variant:"body2",children:"ラリー結果、タイムアウト、メンバー交代を追加できます"}),e.jsx(n,{sx:{textAlign:"right",mt:1},children:e.jsx(Xe,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem($,"1"),se(!1)},children:"了解した"})})]}),children:e.jsx(Bt,{ariaLabel:"rally actions",direction:"left",icon:e.jsx(It,{}),FabProps:{size:"large",onClick:v},sx:{position:"fixed",right:35,bottom:80,zIndex:q=>q.zIndex.drawer-1}})})]})}function Nn({isMobile:s,openActionMenu:p,onOpenActionMenu:h,onCloseActionMenu:j,teamAName:u,teamBName:a,disableTimeoutA:r,disableTimeoutB:v,showScoreProgressButton:b,onShowScoreProgress:y,onSubstitution:M,onTimeout:P,onAddRally:H,locked:$}){return e.jsxs(e.Fragment,{children:[!$&&s&&e.jsx(xs,{children:e.jsx(Fs,{color:"primary",onClick:h,sx:{position:"fixed",right:35,bottom:O=>`calc(${O.spacing(7)} + env(safe-area-inset-bottom) + 16px)`,zIndex:O=>O.zIndex.drawer+2},children:e.jsx(Ts,{})})}),s?e.jsx(Wn,{open:p,onClose:j,teamAName:u,teamBName:a,disableTimeoutA:r,disableTimeoutB:v,showScoreProgressButton:b,onShowScoreProgress:y,onSubstitution:M,onTimeout:P,onAddRally:H}):e.jsx(Jn,{teamAName:u,teamBName:a,locked:$,disableTimeoutA:r,disableTimeoutB:v,onSubstitution:M,onTimeout:P,onAddRally:H})]})}var es={},Gn=je;Object.defineProperty(es,"__esModule",{value:!0});var Ct=es.default=void 0,Xn=Gn(be()),Yn=e;Ct=es.default=(0,Xn.default)((0,Yn.jsx)("path",{d:"M16.01 11H4v2h12.01v3L20 12l-3.99-4z"}),"ArrowRightAlt");var ts={},Qn=je;Object.defineProperty(ts,"__esModule",{value:!0});var Is=ts.default=void 0,Zn=Qn(be()),ei=e;Is=ts.default=(0,Zn.default)((0,ei.jsx)("path",{d:"m12 4-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"}),"ArrowForward");function ti(s){if(typeof window>"u")return s;try{const h=new DOMParser().parseFromString(s,"image/svg+xml"),j=new Set(["svg","g","path","circle","rect","line","polygon","polyline","text","defs","use"]),u=a=>{[...a.children].forEach(r=>{if(j.has(r.tagName))[...r.attributes].forEach(v=>{v.name.startsWith("on")&&r.removeAttribute(v.name)}),u(r);else{const v=document.createTextNode(r.outerHTML);r.replaceWith(v)}})};return u(h.documentElement),h.documentElement.outerHTML}catch{return""}}function si({name:s}){const p=f.useRef(null),[h,j]=f.useState(1);return f.useEffect(()=>{const u=p.current;if(!u)return;const a=u.getBBox().width;j(a>64?64/a:1)},[s]),e.jsx("svg",{width:64,height:64,children:e.jsx("g",{transform:`scale(${h})`,children:e.jsx("text",{ref:p,x:32/h,y:32/h,textAnchor:"middle",dominantBaseline:"central",fontSize:8,children:s})})})}function ni({category:s,borderColor:p}){const h=p?{border:"1px solid",borderColor:p,boxSizing:"border-box"}:{};return s.iconType==="svg"&&s.svg?e.jsx(n,{sx:{width:64,height:64,...h},dangerouslySetInnerHTML:{__html:ti(s.svg)}}):s.iconType==="image"&&s.image?e.jsx(n,{component:"img",src:s.image,sx:{width:64,height:64,objectFit:"none",objectPosition:`-${s.cropX||0}px -${s.cropY||0}px`,...h}}):e.jsx(n,{sx:{width:64,height:64,display:"flex",...h},children:e.jsx(si,{name:s.name})})}function ii({rallies:s,playDetails:p,playCategories:h,teamAMembers:j,teamBMembers:u,teamAName:a,teamBName:r,serveCategory:v,showRallyIcons:b,locked:y,isMobile:M,isPhone:P,scores:H,scoredTeam:$,showRallyHint:O,onCloseRallyHint:se,onEditRally:q,onEditSubstitution:ee,onDelete:te,onDragEnd:A}){const Y=wt(),{handleTouchEnd:N,setSwiperRef:ne,getSwiperRef:g}=Ot(2),Q=f.useRef({}),[J,D]=f.useState({}),[T,R]=f.useState("");f.useLayoutEffect(()=>{const m={};s.forEach(C=>{const U=Q.current[C.id];U&&(m[C.id]=U.offsetHeight)}),D(m)},[s]);const W=m=>{if(!m)return;const C=p.find(U=>U.id===m);return h.find(U=>U.id===(C==null?void 0:C.playCategoryId))},z=(m,C)=>{if(!C)return"－";const V=(m==="teamA"?j:u).find(_=>_.id===C);return V?`${V.no}:${V.name}`:"－"},Z=m=>{const C=H[m]||{a:0,b:0},U=$[m],V=Y.palette.text.primary,_=Y.palette.mode==="dark"?"#343A42":"#D3D3D3";return e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{color:U==="A"?V:_},children:String(C.a).padStart(2,"0")}),e.jsx("span",{style:{color:_},children:" - "}),e.jsx("span",{style:{color:U==="B"?V:_},children:String(C.b).padStart(2,"0")})]})},G=(m,C,U)=>{var d;if(!m)return e.jsx(e.Fragment,{});const V=W(m),_=p.find(I=>I.id===m),re=U==="A"?j:u,c=(_==null?void 0:_.pointType)==="得点"?Y.palette.success.main:(_==null?void 0:_.pointType)==="失点"?Y.palette.error.main:void 0;return e.jsxs(n,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[V?e.jsx(Pe,{label:V.name,size:"small",sx:{bgcolor:V.color,color:"common.white",mb:.5,height:20,fontSize:"0.75rem","& .MuiChip-label":{px:.5}}}):null,_?e.jsx(Pe,{label:_.name,size:"small",sx:{bgcolor:c,color:"common.white",mb:.5,height:20,fontSize:"0.75rem","& .MuiChip-label":{px:.5}}}):null,e.jsx(Be,{variant:"caption",noWrap:!0,sx:{width:"100%",textAlign:"center"},children:(_==null?void 0:_.pointUnitType)==="メンバー"&&((d=re.find(I=>I.id===C))==null?void 0:d.name)||"－"})]})},ie=(m,C,U)=>e.jsx(n,{ref:U.innerRef,...U.draggableProps,"data-index":C,sx:{mb:.5},children:e.jsxs(Tt,{onSwiper:V=>ne(m.id,V),threshold:20,slidesPerView:"auto",style:{overflow:"hidden",height:J[m.id]},onTouchStart:(V,_)=>_.stopPropagation(),onTouchEnd:V=>N(m.id,V),children:[e.jsx(_e,{style:{width:"100%",flex:"0 0 auto"},children:(()=>{const V=U.dragHandleProps,{onPointerDown:_,...re}=V||{},c=At(d=>{if(_==null||_(d),!_)return;const I=g(m.id);I&&(I.allowTouchMove=!1),R(m.id)});return e.jsx(n,{ref:d=>{Q.current[m.id]=d},...re,...c,sx:{display:"grid",gridTemplateColumns:"38% 24% 38%",alignItems:"center",cursor:y?"default":"grab",touchAction:T===m.id?"none":"pan-y",backgroundColor:d=>m.timeoutTeam||m.substitutionTeam?d.palette.mode==="dark"?"#343A42":"#f5f5f5":void 0},children:m.timeoutTeam?e.jsxs(n,{gridColumn:"1 / 4",sx:{...Oe,display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:[m.timeoutTeam==="teamA"?a||"チームA":r||"チームB","タイムアウト"]}):m.substitutionTeam?e.jsxs(n,{gridColumn:"1 / 4",sx:{...Oe,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100%"},children:[e.jsxs("span",{children:[m.substitutionTeam==="teamA"?a||"チームA":r||"チームB","選手交代"]}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",mt:.5},children:[e.jsx("span",{children:z(m.substitutionTeam,m.outMember)}),e.jsx(Ct,{fontSize:"small",sx:{mx:1}}),e.jsx("span",{children:z(m.substitutionTeam,m.inMember)})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(n,{children:G(m.teamAPlayDetail,m.teamAMember,"A")}),e.jsxs(n,{sx:{fontSize:"2em",display:"flex",justifyContent:"center",flexDirection:"column",alignItems:"center"},children:[e.jsx(n,{sx:{whiteSpace:"nowrap"},children:Z(C)}),m.serverTeam&&e.jsx(Is,{sx:{width:"calc(100% - 8px)",height:20,mx:"4px",transform:m.serverTeam==="teamB"?"scaleX(-1)":void 0}})]}),e.jsx(n,{children:G(m.teamBPlayDetail,m.teamBMember,"B")})]})})})()}),e.jsx(_e,{style:{width:nt,flex:"0 0 auto"},children:e.jsx(n,{sx:{height:J[m.id],display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"warning.main"},children:e.jsx(Se,{size:"small",disabled:y||!!m.timeoutTeam,onClick:y||m.timeoutTeam?void 0:()=>m.substitutionTeam?ee(C):q(C),children:e.jsx(vt,{fontSize:"small",sx:{color:"common.white"}})})})}),e.jsx(_e,{style:{width:nt,flex:"0 0 auto"},children:e.jsx(n,{sx:{height:J[m.id],display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"error.main"},children:e.jsx(Se,{size:"small",onClick:()=>te(C),children:e.jsx(Me,{fontSize:"small",sx:{color:"common.white"}})})})})]})}),ce=(m,C)=>{var U;return e.jsxs(n,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[b&&(v?e.jsx(ni,{category:v}):e.jsxs("svg",{width:64,height:64,children:[e.jsx("rect",{width:64,height:64,fill:"none",stroke:"currentColor"}),e.jsx("text",{x:"50%",y:"50%",textAnchor:"middle",dominantBaseline:"central",fontSize:"12",children:"サーブ"})]})),e.jsx(Be,{variant:"caption",noWrap:!0,sx:{width:"100%",textAlign:"center"},children:((U=(m==="teamA"?j:u).find(V=>V.id===C))==null?void 0:U.name)||"－"})]})},pe=(m,C,U)=>e.jsx(n,{ref:U.innerRef,...U.draggableProps,"data-index":C,sx:{mb:.5},children:e.jsxs(Tt,{onSwiper:V=>ne(m.id,V),threshold:20,slidesPerView:"auto",style:{overflow:"hidden",height:J[m.id]},onTouchStart:(V,_)=>_.stopPropagation(),onTouchEnd:V=>N(m.id,V),children:[e.jsx(_e,{style:{width:"100%",flex:"0 0 auto"},children:(()=>{const V=U.dragHandleProps,{onPointerDown:_,...re}=V||{},c=At(d=>{if(_==null||_(d),!_)return;const I=g(m.id);I&&(I.allowTouchMove=!1),R(m.id)});return e.jsx(n,{ref:d=>{Q.current[m.id]=d},...re,...c,sx:{display:"grid",gridTemplateColumns:"16% 22% 24% 22% 16%",alignItems:"center",cursor:y?"default":"grab",touchAction:T===m.id?"none":"pan-y",backgroundColor:d=>m.timeoutTeam||m.substitutionTeam?d.palette.mode==="dark"?"#343A42":"#f5f5f5":void 0},children:m.timeoutTeam?e.jsxs(n,{gridColumn:"1 / 6",sx:{...Oe,display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:[m.timeoutTeam==="teamA"?a||"チームA":r||"チームB","タイムアウト"]}):m.substitutionTeam?e.jsxs(n,{gridColumn:"1 / 6",sx:{...Oe,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100%"},children:[e.jsxs("span",{children:[m.substitutionTeam==="teamA"?a||"チームA":r||"チームB","選手交代"]}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",mt:.5},children:[e.jsx("span",{children:z(m.substitutionTeam,m.outMember)}),e.jsx(Ct,{fontSize:"small",sx:{mx:1}}),e.jsx("span",{children:z(m.substitutionTeam,m.inMember)})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(n,{children:m.serverTeam==="teamA"?ce("teamA",m.server):null}),e.jsx(n,{children:G(m.teamAPlayDetail,m.teamAMember,"A")}),e.jsx(n,{sx:{fontSize:"2em",display:"flex",justifyContent:"center"},children:Z(C)}),e.jsx(n,{children:G(m.teamBPlayDetail,m.teamBMember,"B")}),e.jsx(n,{children:m.serverTeam==="teamB"?ce("teamB",m.server):null})]})})})()}),e.jsx(_e,{style:{width:nt,flex:"0 0 auto"},children:e.jsx(n,{sx:{height:J[m.id],display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"warning.main"},children:e.jsx(Se,{size:"small",disabled:y||!!m.timeoutTeam,onClick:y||m.timeoutTeam?void 0:()=>m.substitutionTeam?ee(C):q(C),children:e.jsx(vt,{fontSize:"small",sx:{color:"common.white"}})})})}),e.jsx(_e,{style:{width:nt,flex:"0 0 auto"},children:e.jsx(n,{sx:{height:J[m.id],display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"error.main"},children:e.jsx(Se,{size:"small",onClick:()=>te(C),children:e.jsx(Me,{fontSize:"small",sx:{color:"common.white"}})})})})]})}),Ie=m=>{if(T){const C=g(T);C&&(C.allowTouchMove=!0),R("")}A(m)};return e.jsx(Ne,{open:O,onClose:se,disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:Ge,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${Y.palette.text.secondary}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${Y.palette.text.secondary}`}}}},title:e.jsxs(n,{sx:{p:1,maxWidth:260},children:[e.jsx(Be,{variant:"body2",children:M?e.jsxs(e.Fragment,{children:["行を長押ししてドラッグすることでラリー結果の順番を入れ替えることができます",e.jsx("br",{}),"左にスワイプすると",e.jsx(vt,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),"で編集、",e.jsx(Me,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),"で削除できます"]}):e.jsxs(e.Fragment,{children:["行をタップすることでラリー結果を編集できます",e.jsx("br",{}),"左端の",e.jsx(it,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),"をドラッグすることでラリー結果の順番を入れ替えることができます",e.jsx("br",{}),"右端の",e.jsx(Me,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),"をタップすることでラリー結果を削除することができます"]})}),e.jsx(n,{sx:{textAlign:"right",mt:1},children:e.jsx(Xe,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem("tutorial-rally-row","1"),se()},children:"了解した"})})]}),children:e.jsx(n,{children:e.jsxs(ht,{onDragEnd:Ie,children:[M&&e.jsx(rt,{component:Le,storageKey:"set-tab",children:e.jsxs(n,{children:[e.jsx(n,{sx:{display:"grid",gridTemplateColumns:P?"38% 24% 38%":"16% 22% 24% 22% 16%",textAlign:"center",alignItems:"center",...Oe},children:P?e.jsxs(e.Fragment,{children:[e.jsxs(n,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("span",{children:a||"チームA"}),e.jsx("span",{children:"ラリー結果"})]}),e.jsx(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:"得点"}),e.jsxs(n,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("span",{children:r||"チームB"}),e.jsx("span",{children:"ラリー結果"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(n,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("span",{children:a||"チームA"}),e.jsx("span",{children:"サーブ"})]}),e.jsxs(n,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("span",{children:a||"チームA"}),e.jsx("span",{children:"ラリー結果"})]}),e.jsx(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:"得点"}),e.jsxs(n,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("span",{children:r||"チームB"}),e.jsx("span",{children:"ラリー結果"})]}),e.jsxs(n,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("span",{children:r||"チームB"}),e.jsx("span",{children:"サーブ"})]})]})}),e.jsx(Qe,{droppableId:"rallies",children:m=>e.jsxs(n,{ref:m.innerRef,...m.droppableProps,children:[s.map((C,U)=>e.jsx(Ze,{draggableId:C.id,index:U,isDragDisabled:y,children:V=>(P?ie:pe)(C,U,V)},C.id)),m.placeholder]})})]})}),!M&&e.jsx(rt,{component:Le,storageKey:"set-tab",children:e.jsxs(ot,{size:"small",sx:{tableLayout:"fixed","& th, & td":{textAlign:"center",verticalAlign:"middle"}},children:[e.jsx(dt,{children:e.jsxs(De,{sx:{...Oe},children:[e.jsx(w,{sx:{width:"6%"}}),e.jsx(w,{sx:{width:"16%"},children:e.jsxs(n,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{children:a||"チームA"}),e.jsx("span",{children:"サーブ"})]})}),e.jsx(w,{sx:{width:"18%"},children:e.jsxs(n,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{children:a||"チームA"}),e.jsx("span",{children:"ラリー結果"})]})}),e.jsx(w,{sx:{width:"20%",display:"flex",justifyContent:"center",alignItems:"center"},children:"得点"}),e.jsx(w,{sx:{width:"18%"},children:e.jsxs(n,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{children:r||"チームB"}),e.jsx("span",{children:"ラリー結果"})]})}),e.jsx(w,{sx:{width:"16%"},children:e.jsxs(n,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{children:r||"チームB"}),e.jsx("span",{children:"サーブ"})]})}),e.jsx(w,{sx:{width:"6%"}})]})}),e.jsx(Qe,{droppableId:"rallies",children:m=>e.jsxs(ct,{ref:m.innerRef,...m.droppableProps,children:[s.map((C,U)=>e.jsx(Ze,{draggableId:C.id,index:U,isDragDisabled:y,children:V=>e.jsxs(De,{ref:V.innerRef,...V.draggableProps,"data-index":U,onClick:()=>{y||(C.substitutionTeam?ee(U):C.timeoutTeam||q(U))},sx:{cursor:y||C.timeoutTeam?"default":"pointer",backgroundColor:_=>C.timeoutTeam||C.substitutionTeam?_.palette.mode==="dark"?"#343A42":"#f5f5f5":void 0},children:[e.jsx(w,{padding:"checkbox",sx:{width:"6%"},children:e.jsx(n,{onClick:_=>_.stopPropagation(),...V.dragHandleProps,sx:{cursor:y?"default":"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:e.jsx(it,{fontSize:"small"})})}),C.timeoutTeam?e.jsx(w,{colSpan:5,sx:{width:"88%"},children:e.jsxs(n,{sx:{...Oe,display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:[C.timeoutTeam==="teamA"?a||"チームA":r||"チームB","タイムアウト"]})}):C.substitutionTeam?e.jsx(w,{colSpan:5,sx:{width:"88%"},children:e.jsxs(n,{sx:{...Oe,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100%"},children:[e.jsxs("span",{children:[C.substitutionTeam==="teamA"?a||"チームA":r||"チームB","選手交代"]}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",mt:.5},children:[e.jsx("span",{children:z(C.substitutionTeam,C.outMember)}),e.jsx(Ct,{fontSize:"small",sx:{mx:1}}),e.jsx("span",{children:z(C.substitutionTeam,C.inMember)})]})]})}):e.jsxs(e.Fragment,{children:[e.jsx(w,{sx:{width:"16%"},children:C.serverTeam==="teamA"?ce("teamA",C.server):null}),e.jsx(w,{sx:{width:"18%"},children:G(C.teamAPlayDetail,C.teamAMember,"A")}),e.jsx(w,{sx:{width:"20%",fontSize:"2em",textAlign:"center"},children:Z(U)}),e.jsx(w,{sx:{width:"18%"},children:G(C.teamBPlayDetail,C.teamBMember,"B")}),e.jsx(w,{sx:{width:"16%"},children:C.serverTeam==="teamB"?ce("teamB",C.server):null})]}),e.jsx(w,{padding:"checkbox",sx:{width:"6%"},children:e.jsx(n,{onClick:_=>_.stopPropagation(),sx:{width:32,height:32,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Se,{size:"small",onClick:y?void 0:()=>te(U),disabled:y,sx:{width:24,height:24},children:e.jsx(Me,{fontSize:"small",color:y?"disabled":"error"})})})})]})},C.id)),m.placeholder]})})]})})]})})})}function ri({scores:s,consecutive:p,connections:h,rowHeight:j}){const u=s.length*j;return e.jsxs(n,{sx:{flex:"0 0 20%",overflowY:"auto",height:"100%",position:"relative"},children:[s.map((a,r)=>{const v=r===0?{a:0,b:0}:s[r-1],b=a.a!==v.a&&a.a!==0,y=a.b!==v.b&&a.b!==0,M=b&&p[r],P=y&&p[r];return e.jsxs(n,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr 1fr",alignItems:"center",py:.5,height:`${j}px`,position:"relative",zIndex:1},children:[e.jsx(n,{}),e.jsxs(e.Fragment,{children:[e.jsx(n,{sx:{display:"flex",justifyContent:"center"},children:b?e.jsx(n,{sx:{width:32,height:32,border:"1px solid",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:24,borderColor:M?"red":"currentColor",backgroundColor:M?"#ffebee":"#fff",color:"black"},children:a.a}):null}),e.jsx(n,{}),e.jsx(n,{sx:{display:"flex",justifyContent:"center"},children:y?e.jsx(n,{sx:{width:32,height:32,border:"1px solid",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:24,borderColor:P?"red":"currentColor",backgroundColor:P?"#ffebee":"#fff",color:"black"},children:a.b}):null})]}),e.jsx(n,{})]},r)}),e.jsx("svg",{viewBox:`0 0 100 ${u}`,style:{position:"absolute",left:0,top:0,width:"100%",height:u,zIndex:0},preserveAspectRatio:"none",pointerEvents:"none",children:h.map(a=>{const r=a.index*j+j/2,v=(a.index+1)*j+j/2,b=a.from==="A"?30:70,y=a.from==="A"?70:30;return e.jsx("line",{x1:b,y1:r,x2:y,y2:v,stroke:"currentColor",strokeWidth:1},a.index)})})]})}function li({setScore:s,playDetails:p,playCategories:h,teamAMembers:j,teamBMembers:u,teamAName:a,teamBName:r,onChange:v,locked:b=!1,scoreInputSetting:y,themeSetting:M,showSnackbar:P}){const[H,$]=f.useState(!1),[O,se]=f.useState(!1),{addRally:q,deleteRally:ee,calculateScores:te}=Mn(s,p,v),A=f.useRef(null),Y=f.useRef(null),N=et("md"),ne=et("sm"),g=!ne&&y.showRallyIcons,Q=!N&&y.showScoreProgressArea,J=N&&y.showScoreProgressArea,[D,T]=f.useState(!1),R=h.find(i=>i.id==="init-serve"),W=s.rallies.filter(i=>i.timeoutTeam==="teamA").length,z=s.rallies.filter(i=>i.timeoutTeam==="teamB").length,Z=W>=2,G=z>=2,ie=i=>{if(!i.destination||b)return;const o=Array.from(s.rallies),[t]=o.splice(i.source.index,1);o.splice(i.destination.index,0,t);const l={...s,rallies:o};te(l),v(l)},ce=i=>{if(b)return;const o={...s,rallies:[...s.rallies]};ee(i),P("ラリーを削除しました","success",{actionLabel:"元に戻す",onAction:()=>{const t={...o,rallies:[...o.rallies]};te(t),v(t)},autoHideDuration:5e3})},pe=i=>{const o=!localStorage.getItem("tutorial-rally-row");q(i),o&&$(!0)},Ie=(i,o)=>{const t=[...s.rallies];t[i]=o;const l={...s,rallies:t};te(l),v(l)},m=i=>{if(b||i==="teamA"&&Z||i==="teamB"&&G)return;const o=!localStorage.getItem("tutorial-rally-row");q({id:crypto.randomUUID(),timeoutTeam:i}),o&&$(!0)},C=i=>{var o;b||(o=A.current)==null||o.openAddDialog(i)},U=i=>{var t;if(b)return;const o=s.rallies[i];o.substitutionTeam&&((t=A.current)==null||t.openEditDialog(i,o.substitutionTeam,o.outMember||"",o.inMember||""))},V=(i,o,t,l)=>{const S=!localStorage.getItem("tutorial-rally-row"),B=[...s.rallies];l!==null?B[l]={...B[l],substitutionTeam:i,outMember:o,inMember:t}:B.push({id:crypto.randomUUID(),substitutionTeam:i,outMember:o,inMember:t});const K={...s,rallies:B};te(K),v(K),S&&$(!0)},_=[],re=[];let c=0,d=0;s.rallies.forEach(i=>{if(i.timeoutTeam||i.substitutionTeam){re.push(null),_.push({a:c,b:d});return}const o=p.find(l=>l.id===i.teamAPlayDetail),t=p.find(l=>l.id===i.teamBPlayDetail);(o==null?void 0:o.pointType)==="得点"||(t==null?void 0:t.pointType)==="失点"?(c+=1,re.push("A")):(t==null?void 0:t.pointType)==="得点"||(o==null?void 0:o.pointType)==="失点"?(d+=1,re.push("B")):re.push(null),_.push({a:c,b:d})});const I=40,F=[];for(let i=0;i<re.length-1;i++){const o=re[i],t=re[i+1];o&&t&&o!==t&&F.push({from:o,index:i})}const E=re.map((i,o)=>i!==null&&o>0&&i===re[o-1]);return e.jsxs(n,{sx:{position:"relative",display:"flex",flexDirection:"column",height:"100%"},children:[e.jsxs(n,{sx:{display:"flex",gap:2,flex:1,minHeight:0},children:[Q&&e.jsx(ri,{scores:_,consecutive:E,connections:F,rowHeight:I}),e.jsx(n,{sx:{flex:1,overflowY:"auto",height:"100%",maxWidth:1024,width:"100%",mx:"auto",mb:2},children:e.jsx(ii,{rallies:s.rallies,playDetails:p,playCategories:h,teamAMembers:j,teamBMembers:u,teamAName:a,teamBName:r,serveCategory:R,showRallyIcons:g,locked:b,isMobile:N,isPhone:ne,scores:_,scoredTeam:re,showRallyHint:H,onCloseRallyHint:()=>$(!1),onEditRally:i=>{var o;return(o=Y.current)==null?void 0:o.openEditDialog(i)},onEditSubstitution:U,onDelete:ce,onDragEnd:ie})})]}),J&&e.jsx(zn,{open:D,onClose:()=>T(!1),scores:_,consecutive:E,connections:F,rowHeight:I}),e.jsx(Nn,{isMobile:N,openActionMenu:O,onOpenActionMenu:()=>se(!0),onCloseActionMenu:()=>se(!1),teamAName:a,teamBName:r,disableTimeoutA:Z,disableTimeoutB:G,showScoreProgressButton:y.showScoreProgressArea,onShowScoreProgress:()=>T(!0),onSubstitution:C,onTimeout:m,onAddRally:()=>{var i;return(i=Y.current)==null?void 0:i.openAddDialog()},locked:b}),e.jsx($n,{ref:Y,setScore:s,playDetails:p,playCategories:h,teamAMembers:j,teamBMembers:u,teamAName:a,teamBName:r,scoreInputSetting:y,themeSetting:M,locked:b,onAdd:pe,onEdit:Ie}),e.jsx(Rn,{ref:A,teamAMembers:j,teamBMembers:u,onSave:V})]})}const ai=()=>typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():Math.random().toString(36).slice(2)+Date.now().toString(36);function oi({statsSettings:s,onChange:p,playCategories:h,playDetails:j,rallyCategoryTags:u,rallyDetailTags:a,disabled:r,showSnackbar:v}){const b=c=>{if(pe){const F=ce(pe);F&&(F.allowTouchMove=!0),Ie("")}if(!c.destination)return;const d=Array.from(s),[I]=d.splice(c.source.index,1);d.splice(c.destination.index,0,I),p(d)},y=c=>{var d;return((d=h.find(I=>I.id===c))==null?void 0:d.name)||""},M=c=>{var d;return((d=j.find(I=>I.id===c))==null?void 0:d.name)||""},P=c=>{const d=c.playCategoryId?y(c.playCategoryId):c.playCategoryTags?c.playCategoryTags.map(o=>{var t;return((t=u.find(l=>l.id===o))==null?void 0:t.name)||o}).join(", "):"",I=c.playDetailId?M(c.playDetailId):c.playDetailTags?c.playDetailTags.map(o=>{var t;return((t=a.find(l=>l.id===o))==null?void 0:t.name)||o}).join(", "):"",F=c.pointType||"",E=c.pointUnitType||"",i=c.aggregateType||"合算";return[d,I,F,E,i].filter(o=>o).join(", ")},[H,$]=f.useState(!1),[O,se]=f.useState(null),[q,ee]=f.useState(""),[te,A]=f.useState(""),[Y,N]=f.useState([]),[ne,g]=f.useState([]),[Q,J]=f.useState(""),[D,T]=f.useState(""),[R,W]=f.useState("合算"),z=et("md"),Z=et("sm"),{handleTouchEnd:G,setSwiperRef:ie,getSwiperRef:ce}=Ot(2),[pe,Ie]=f.useState(""),m=()=>{r||(se(-1),ee(""),A(""),N([]),g([]),J(""),T(""),W("合算"),$(!0))},C=c=>{if(r)return;const d=s[c];se(c),ee(d.playCategoryId||""),A(d.playDetailId||""),N(d.playCategoryTags||[]),g(d.playDetailTags||[]),J(d.pointType||""),T(d.pointUnitType||""),W(d.aggregateType||"合算"),$(!0)},U=()=>{const c=q!=="",d=te!=="",I=Y.length>0,F=ne.length>0,E=Q!=="",i=D!=="";return c&&!d&&!I&&!F&&!E&&!i||c&&d&&!I&&!F&&!E&&!i||c&&!d&&!I&&!F&&E&&!i||c&&!d&&!I&&!F&&!E&&i||c&&!d&&!I&&!F&&E&&i||!c&&!d&&!I&&!F&&E&&!i||!c&&!d&&!I&&!F&&E&&i||!c&&!d&&!I&&!F&&!E&&i||I&&!c&&!d&&!F&&!E&&!i||I&&F&&!c&&!d&&!E&&!i||I&&F&&!c&&!d&&E&&!i||I&&F&&!c&&!d&&!E&&i||I&&F&&!c&&!d&&E&&i||I&&!c&&!d&&E&&!i||I&&!c&&!d&&!E&&i||I&&!c&&!d&&E&&i||F&&!c&&!d&&!I&&!E&&!i||F&&!c&&!d&&!I&&E&&!i||F&&!c&&!d&&!I&&!E&&i||F&&!c&&!d&&!I&&E&&i},V=()=>{const c={id:O===-1?ai():s[O].id,playCategoryId:q||void 0,playDetailId:te||void 0,playCategoryTags:q===""&&Y.length>0?Y:void 0,playDetailTags:te===""&&ne.length>0?ne:void 0,pointType:te?void 0:Q||void 0,pointUnitType:te?void 0:D||void 0,aggregateType:R};O===-1?p([...s,c]):O!==null&&p(s.map((d,I)=>I===O?c:d)),$(!1)},_=()=>{$(!1)},re=c=>{if(r)return;const d=[...s];p(s.filter((I,F)=>F!==c)),v("スタッツ設定を削除しました","success",{actionLabel:"元に戻す",onAction:()=>p(d),autoHideDuration:5e3})};return e.jsxs(n,{children:[e.jsxs(n,{sx:{maxWidth:1024,mx:"auto",display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(n,{sx:{fontWeight:"bold"},children:"スタッツ設定"}),e.jsx(oe,{onClick:m,variant:"contained",size:"medium",startIcon:e.jsx(It,{}),disabled:r,children:"追加"})]}),e.jsx(rt,{component:Le,storageKey:"match-stats-grid",sx:{maxWidth:1024,mx:"auto"},children:z?e.jsx(ht,{onDragEnd:b,children:e.jsx(Qe,{droppableId:"stats-settings",children:c=>e.jsxs(n,{ref:c.innerRef,...c.droppableProps,children:[e.jsx(n,{sx:{display:"grid",gridTemplateColumns:Z?"1fr":"150px 1fr 110px 130px 110px",alignItems:"center",height:50,px:1,borderBottom:1,borderColor:"divider",...Oe},children:Z?e.jsx(n,{children:"分析項目"}):e.jsxs(e.Fragment,{children:[e.jsx(n,{children:"プレー区分"}),e.jsx(n,{children:"プレー詳細"}),e.jsx(n,{children:"得点区分"}),e.jsx(n,{children:"得失点単位区分"}),e.jsx(n,{children:"集計方法"})]})}),s.map((d,I)=>e.jsx(Ze,{draggableId:d.id,index:I,isDragDisabled:r,children:F=>{const E=F.dragHandleProps,{onPointerDown:i,...o}=E||{},t=At(l=>{i==null||i(l);const S=ce(d.id);S&&(S.allowTouchMove=!1),Ie(d.id)});return e.jsx(n,{ref:F.innerRef,...F.draggableProps,style:F.draggableProps.style,children:e.jsxs(Tt,{onSwiper:l=>ie(d.id,l),threshold:20,slidesPerView:"auto",style:{overflow:"hidden"},onTouchStart:(l,S)=>S.stopPropagation(),onTouchEnd:l=>G(d.id,l),children:[e.jsx(_e,{style:{width:"100%",flex:"0 0 auto"},children:e.jsx(n,{...o,...t,sx:{display:"grid",gridTemplateColumns:Z?"1fr":"150px 1fr 110px 130px 110px",alignItems:"center",height:50,px:1,borderBottom:1,borderColor:"divider",bgcolor:"background.paper",cursor:r?"default":"grab",touchAction:pe===d.id?"none":"pan-y"},children:Z?e.jsx(n,{children:P(d)}):e.jsxs(e.Fragment,{children:[e.jsx(n,{sx:{pr:1},children:d.playCategoryId?y(d.playCategoryId):d.playCategoryTags&&d.playCategoryTags.length>0?e.jsx(n,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:d.playCategoryTags.map(l=>{const S=u.find(B=>B.id===l);return e.jsx(Pe,{label:(S==null?void 0:S.name)||l,size:"small",sx:{backgroundColor:(S==null?void 0:S.color)||He,color:"#fff"}},l)})}):""}),e.jsx(n,{sx:{pr:1},children:d.playDetailId?M(d.playDetailId):d.playDetailTags&&d.playDetailTags.length>0?e.jsx(n,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:d.playDetailTags.map(l=>{const S=a.find(B=>B.id===l);return e.jsx(Pe,{label:(S==null?void 0:S.name)||l,size:"small",sx:{backgroundColor:(S==null?void 0:S.color)||He,color:"#fff"}},l)})}):""}),e.jsx(n,{sx:{pr:1},children:d.pointType||""}),e.jsx(n,{sx:{pr:1},children:d.pointUnitType||""}),e.jsx(n,{children:d.aggregateType||"合算"})]})})}),e.jsx(_e,{style:{width:nt,flex:"0 0 auto"},children:e.jsx(n,{sx:{height:50,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"error.main"},children:e.jsx(Se,{size:"small",onClick:()=>re(I),disabled:r,children:e.jsx(Me,{fontSize:"small",sx:{color:"common.white"}})})})}),e.jsx(_e,{style:{width:nt,flex:"0 0 auto"},children:e.jsx(n,{sx:{height:50,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"primary.main"},children:e.jsx(Se,{size:"small",onClick:()=>C(I),disabled:r,children:e.jsx(vt,{fontSize:"small",sx:{color:"common.white"}})})})})]})})}},d.id)),c.placeholder]})})}):e.jsxs(ot,{size:"small",children:[e.jsx(dt,{children:e.jsxs(De,{sx:{backgroundColor:c=>c.palette.mode==="dark"?"#343A42":"#f5f5f5",height:50},children:[e.jsx(w,{}),e.jsx(w,{children:"プレー区分"}),e.jsx(w,{children:"プレー詳細"}),e.jsx(w,{children:"得点区分"}),e.jsx(w,{children:"得失点単位区分"}),e.jsx(w,{children:"集計方法"}),e.jsx(w,{})]})}),e.jsx(ht,{onDragEnd:b,children:e.jsx(Qe,{droppableId:"stats-settings",children:c=>e.jsxs(ct,{ref:c.innerRef,...c.droppableProps,children:[s.map((d,I)=>e.jsx(Ze,{draggableId:d.id,index:I,isDragDisabled:r,children:F=>e.jsxs(De,{ref:F.innerRef,...F.draggableProps,onClick:()=>C(I),sx:{cursor:r?"default":"pointer",height:50},children:[e.jsx(w,{padding:"checkbox",sx:{width:48},children:e.jsx(n,{...F.dragHandleProps,onClick:E=>E.stopPropagation(),sx:{cursor:r?"default":"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:e.jsx(it,{})})}),e.jsx(w,{children:d.playCategoryId?y(d.playCategoryId):d.playCategoryTags&&d.playCategoryTags.length>0?e.jsx(n,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:d.playCategoryTags.map(E=>{const i=u.find(o=>o.id===E);return e.jsx(Pe,{label:(i==null?void 0:i.name)||E,size:"small",sx:{backgroundColor:(i==null?void 0:i.color)||He,color:"#fff"}},E)})}):""}),e.jsx(w,{children:d.playDetailId?M(d.playDetailId):d.playDetailTags&&d.playDetailTags.length>0?e.jsx(n,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:d.playDetailTags.map(E=>{const i=a.find(o=>o.id===E);return e.jsx(Pe,{label:(i==null?void 0:i.name)||E,size:"small",sx:{backgroundColor:(i==null?void 0:i.color)||He,color:"#fff"}},E)})}):""}),e.jsx(w,{children:d.pointType||""}),e.jsx(w,{children:d.pointUnitType||""}),e.jsx(w,{children:d.aggregateType||"合算"}),e.jsx(w,{padding:"checkbox",children:e.jsx(Se,{size:"small",onClick:E=>{E.stopPropagation(),re(I)},disabled:r,children:e.jsx(Me,{fontSize:"small"})})})]})},d.id)),c.placeholder]})})})]})}),e.jsxs(xt,{open:H,onClose:_,children:[e.jsxs(qe,{children:["スタッツ設定",O===-1?"追加":"編集"]}),e.jsxs(Ke,{children:[e.jsxs(Te,{fullWidth:!0,margin:"dense",children:[e.jsx(Ae,{id:"stat-category-label",children:"プレー区分"}),e.jsxs(we,{labelId:"stat-category-label",value:q,label:"プレー区分",onChange:c=>{ee(c.target.value),A(""),N([]),g([])},disabled:Y.length>0||ne.length>0,children:[e.jsx(ae,{value:"",children:"なし"}),h.map(c=>e.jsx(ae,{value:c.id,children:c.name},c.id))]})]}),e.jsxs(Te,{fullWidth:!0,margin:"dense",children:[e.jsx(Ae,{id:"stat-detail-label",children:"プレー詳細"}),e.jsxs(we,{labelId:"stat-detail-label",value:te,label:"プレー詳細",onChange:c=>{A(c.target.value),J(""),T(""),N([]),g([])},disabled:Q!==""||D!==""||Y.length>0||ne.length>0,children:[e.jsx(ae,{value:"",children:"なし"}),j.filter(c=>c.playCategoryId===q).map(c=>e.jsx(ae,{value:c.id,children:c.name},c.id))]})]}),e.jsx(_t,{multiple:!0,options:u,getOptionLabel:c=>c.name,value:u.filter(c=>Y.includes(c.id)),onChange:(c,d)=>{N(d.map(I=>I.id)),d.length>0&&(ee(""),A(""))},disabled:q!==""||te!=="",renderTags:(c,d)=>c.map((I,F)=>e.jsx(Pe,{...d({index:F}),label:I.name,size:"small",sx:{backgroundColor:I.color||He,color:"#fff"}})),renderInput:c=>e.jsx(fe,{...c,label:"プレー区分タグ",margin:"dense"}),fullWidth:!0}),e.jsx(_t,{multiple:!0,options:a,getOptionLabel:c=>c.name,value:a.filter(c=>ne.includes(c.id)),onChange:(c,d)=>{g(d.map(I=>I.id)),d.length>0&&(ee(""),A(""))},disabled:q!==""||te!=="",renderTags:(c,d)=>c.map((I,F)=>e.jsx(Pe,{...d({index:F}),label:I.name,size:"small",sx:{backgroundColor:I.color||He,color:"#fff"}})),renderInput:c=>e.jsx(fe,{...c,label:"プレー詳細タグ",margin:"dense"}),fullWidth:!0}),e.jsxs(n,{children:[e.jsxs(Te,{fullWidth:!0,margin:"dense",children:[e.jsx(Ae,{id:"stat-point-label",children:"得点区分"}),e.jsxs(we,{labelId:"stat-point-label",value:Q,label:"得点区分",onChange:c=>{J(c.target.value),c.target.value!==""&&A("")},disabled:te!=="",children:[e.jsx(ae,{value:"",children:"なし"}),e.jsx(ae,{value:"得点",children:"得点"}),e.jsx(ae,{value:"失点",children:"失点"})]})]}),e.jsxs(Te,{fullWidth:!0,margin:"dense",children:[e.jsx(Ae,{id:"stat-unit-label",children:"得失点単位区分"}),e.jsxs(we,{labelId:"stat-unit-label",value:D,label:"得失点単位区分",onChange:c=>{T(c.target.value),c.target.value!==""&&A("")},disabled:te!=="",children:[e.jsx(ae,{value:"",children:"なし"}),e.jsx(ae,{value:"メンバー",children:"メンバー"}),e.jsx(ae,{value:"チーム",children:"チーム"})]})]})]}),e.jsxs(Te,{fullWidth:!0,margin:"dense",children:[e.jsx(Ae,{id:"stat-aggregate-label",children:"集計方法"}),e.jsxs(we,{labelId:"stat-aggregate-label",value:R,label:"集計方法",onChange:c=>W(c.target.value),children:[e.jsx(ae,{value:"合算",children:"合算"}),e.jsx(ae,{value:"セット平均",children:"セット平均"})]})]})]}),e.jsxs(Je,{children:[e.jsx(oe,{onClick:_,color:"inherit",startIcon:e.jsx(Ue,{}),children:"キャンセル"}),e.jsx(oe,{onClick:V,disabled:!U(),startIcon:e.jsx(Ye,{}),children:"OK"})]})]})]})}function ds(s,p,h){var u,a;if(!s)return!1;const j=p.get(s.playCategoryId);return!(h.playDetailId&&s.id!==h.playDetailId||h.playCategoryId&&s.playCategoryId!==h.playCategoryId||h.playCategoryTags&&h.playCategoryTags.length>0&&!((u=j==null?void 0:j.tags)!=null&&u.some(r=>h.playCategoryTags.includes(r)))||h.playDetailTags&&h.playDetailTags.length>0&&!((a=s.tags)!=null&&a.some(r=>h.playDetailTags.includes(r)))||h.pointType&&s.pointType!==h.pointType||h.pointUnitType&&s.pointUnitType!==h.pointUnitType)}function cs(s,p,h,j){const u=j.map(()=>({teamA:0,teamB:0}));return s.forEach(a=>{a.rallies.forEach(r=>{j.forEach((v,b)=>{const y=r.teamAPlayDetail?p.get(r.teamAPlayDetail):void 0;ds(y,h,v)&&(u[b].teamA+=1);const M=r.teamBPlayDetail?p.get(r.teamBPlayDetail):void 0;ds(M,h,v)&&(u[b].teamB+=1)})})}),u}function di(s,p){const h=[];let j=0,u=0,a=0,r=0;return s.forEach(b=>{let y=0,M=0,P=0,H=0;b.rallies.forEach($=>{if($.timeoutTeam||$.substitutionTeam||!$.serverTeam)return;const O=$.teamAPlayDetail?p.get($.teamAPlayDetail):void 0,se=$.teamBPlayDetail?p.get($.teamBPlayDetail):void 0;$.serverTeam==="teamA"?(M+=1,(O&&O.pointType==="得点"||se&&se.pointType==="失点")&&(y+=1)):(H+=1,(se&&se.pointType==="得点"||O&&O.pointType==="失点")&&(P+=1))}),j+=y,u+=M,a+=P,r+=H,h.push({teamA:M?`${Math.round(y/M*100)}%`:"-",teamB:H?`${Math.round(P/H*100)}%`:"-"})}),{overall:{teamA:u?`${Math.round(j/u*100)}%`:"-",teamB:r?`${Math.round(a/r*100)}%`:"-"},perSet:h}}function ci(s,p){const h=[];let j=0,u=0,a=0,r=0;return s.forEach(b=>{let y=0,M=0,P=0,H=0;b.rallies.forEach($=>{if($.timeoutTeam||$.substitutionTeam||!$.serverTeam)return;const O=$.teamAPlayDetail?p.get($.teamAPlayDetail):void 0,se=$.teamBPlayDetail?p.get($.teamBPlayDetail):void 0;$.serverTeam==="teamB"?(M+=1,(O&&O.pointType==="得点"||se&&se.pointType==="失点")&&(y+=1)):(H+=1,(se&&se.pointType==="得点"||O&&O.pointType==="失点")&&(P+=1))}),j+=y,u+=M,a+=P,r+=H,h.push({teamA:M?`${Math.round(y/M*100)}%`:"-",teamB:H?`${Math.round(P/H*100)}%`:"-"})}),{overall:{teamA:u?`${Math.round(j/u*100)}%`:"-",teamB:r?`${Math.round(a/r*100)}%`:"-"},perSet:h}}function ui({sets:s,playDetails:p,playCategories:h,statsSettings:j,matchStatsSettings:u,onMatchStatsSettingsChange:a,rallyCategoryTags:r,rallyDetailTags:v,teamAName:b,teamBName:y,locked:M,showSnackbar:P}){const H=new Map(p.map(D=>[D.id,D])),$=new Map(h.map(D=>[D.id,D])),O=D=>{var T;return((T=h.find(R=>R.id===D))==null?void 0:T.name)||""},se=D=>{var T;return((T=p.find(R=>R.id===D))==null?void 0:T.name)||""},q=[...j,...u],ee=cs(s,H,$,q),te=s.map(D=>cs([D],H,$,q)),A=ee.map((D,T)=>{if(q[T].aggregateType==="セット平均"){const W=s.length||1;return{teamA:(D.teamA/W).toFixed(1),teamB:(D.teamB/W).toFixed(1)}}return D}),Y=te.map(D=>q.reduce((T,R,W)=>(R.aggregateType!=="セット平均"&&T.push(D[W]),T),[])),N=q.filter(D=>D.aggregateType!=="セット平均"),ne=di(s,H),g=ci(s,H),Q=D=>{const T=[];D.playCategoryId?T.push(e.jsx("span",{children:O(D.playCategoryId)},"cat")):D.playCategoryTags&&D.playCategoryTags.length>0&&T.push(e.jsx(n,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center",mt:.5},children:D.playCategoryTags.map(W=>{const z=r.find(Z=>Z.id===W);return e.jsx(Pe,{label:(z==null?void 0:z.name)||W,size:"small",sx:{mr:.5,mb:.5,backgroundColor:(z==null?void 0:z.color)||He,color:"#fff"}},W)})},"catTags")),D.playDetailId?T.push(e.jsx("span",{children:se(D.playDetailId)},"detail")):D.playDetailTags&&D.playDetailTags.length>0&&T.push(e.jsx(n,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center",mt:.5},children:D.playDetailTags.map(W=>{const z=v.find(Z=>Z.id===W);return e.jsx(Pe,{label:(z==null?void 0:z.name)||W,size:"small",sx:{mr:.5,mb:.5,backgroundColor:(z==null?void 0:z.color)||He,color:"#fff"}},W)})},"detailTags"));const R=[];return D.pointType&&R.push(D.pointType),D.pointUnitType&&R.push(D.pointUnitType),R.length>0&&T.push(e.jsx("span",{children:R.join(",")},"point")),T.push(e.jsxs("span",{children:["(",D.aggregateType||"合算",")"]},"agg")),e.jsx(n,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:T.map((W,z)=>e.jsx(n,{sx:{display:"flex",justifyContent:"center"},children:W},z))})},J=(D,T,R,W,z)=>e.jsx(rt,{component:Le,storageKey:z,sx:{mb:2},children:e.jsxs(ot,{size:"small",sx:{"& th, & td":{textAlign:"center",verticalAlign:"middle"}},children:[e.jsx(dt,{children:e.jsxs(De,{sx:{backgroundColor:Z=>Z.palette.mode==="dark"?"#343A42":"#f5f5f5",height:50},children:[e.jsx(w,{children:b||"チームA"}),e.jsx(w,{children:"項目"}),e.jsx(w,{children:y||"チームB"})]})}),e.jsxs(ct,{children:[e.jsxs(De,{sx:{height:50},children:[e.jsx(w,{children:T.teamA}),e.jsx(w,{children:"ブレイク率"}),e.jsx(w,{children:T.teamB})]},"break-rate"),e.jsxs(De,{sx:{height:50},children:[e.jsx(w,{children:R.teamA}),e.jsx(w,{children:"サイドアウト率"}),e.jsx(w,{children:R.teamB})]},"sideout-rate"),W.map((Z,G)=>e.jsxs(De,{sx:{height:50},children:[e.jsx(w,{children:D[G].teamA}),e.jsx(w,{children:Q(Z)}),e.jsx(w,{children:D[G].teamB})]},Z.id))]})]})});return e.jsxs(n,{sx:{display:"grid",gap:2,gridTemplateColumns:{xs:"1fr",md:"repeat(2, 1fr)"},maxWidth:1024,width:"100%",mx:"auto"},children:[e.jsxs(n,{children:[e.jsx(Be,{variant:"h6",sx:{mb:1},children:"試合全体のスタッツ"}),J(A,ne.overall,g.overall,q,"stats-overall")]}),s.map((D,T)=>e.jsxs(n,{children:[e.jsx(Be,{variant:"h6",sx:{mb:1},children:`${T+1}セット目(${D.my}-${D.opponent})のスタッツ`}),J(Y[T],ne.perSet[T],g.perSet[T],N,`stats-set-${T}`)]},D.id)),e.jsxs(n,{sx:{gridColumn:"1 / -1"},children:[e.jsx(oi,{statsSettings:u,onChange:a,playCategories:h,playDetails:p,rallyCategoryTags:r,rallyDetailTags:v,disabled:M,showSnackbar:P}),e.jsxs(hs,{severity:"info",sx:{mt:1},children:["本設定は試合内のみでの設定となります",e.jsx("br",{}),"各試合共通でのスタッツ項目の設定は設定＞スタッツメニューから設定してください"]})]})]})}var ss={},xi=je;Object.defineProperty(ss,"__esModule",{value:!0});var Ft=ss.default=void 0,hi=xi(be()),mi=e;Ft=ss.default=(0,hi.default)((0,mi.jsx)("path",{d:"M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m-9-2V7H4v3H1v2h3v3h2v-3h3v-2zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"PersonAdd");const fi=()=>typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():Math.random().toString(36).slice(2)+Date.now().toString(36);function pi({match:s,setMatch:p,teamAName:h,teamBName:j,teamMembers:u,onAddMember:a,locked:r,showSnackbar:v}){const b=wt(),y=et("md"),M=et("sm"),{handleTouchEnd:P,setSwiperRef:H,getSwiperRef:$}=Ot(),[O,se]=f.useState(""),q="tutorial-member-select",[ee,te]=f.useState(()=>!localStorage.getItem(q)),A="tutorial-member-row",[Y,N]=f.useState(null),[ne,g]=f.useState(!1),[Q,J]=f.useState(!1),[D,T]=f.useState(""),[R,W]=f.useState(""),[z,Z]=f.useState([]),[G,ie]=f.useState("teamA"),[ce,pe]=f.useState([]),Ie=i=>{if(O){const S=$(O);S&&(S.allowTouchMove=!0),se("")}if(!i.destination||i.source.droppableId!==i.destination.droppableId||r)return;const o=i.source.droppableId==="teamA"?"teamAMembers":"teamBMembers",t=Array.from(s[o]),[l]=t.splice(i.source.index,1);t.splice(i.destination.index,0,l),p(S=>({...S,[o]:t}))},m=f.useMemo(()=>{const i=G==="teamA"?s.teamA:s.teamB,o=u[i]||[],t=G==="teamA"?s.teamAMembers:s.teamBMembers;return o.filter(l=>l.visible!==!1&&!t.some(S=>S.id===l.id))},[G,s,u]),C=i=>{ie(i),pe([]),g(!0)},U=i=>{pe(o=>o.some(l=>l.id===i.id)?o.filter(l=>l.id!==i.id):[...o,i])},V=()=>{const i=!localStorage.getItem(A);p(G==="teamA"?o=>({...o,teamAMembers:[...o.teamAMembers,...ce.map(t=>({...t,statuses:Array(o.sets.length).fill("")}))]}):o=>({...o,teamBMembers:[...o.teamBMembers,...ce.map(t=>({...t,statuses:Array(o.sets.length).fill("")}))]})),g(!1),i&&N(G)},_=()=>{g(!1)},re=(i,o)=>{if(r)return;let t;const l=i==="teamA"?"teamAMembers":"teamBMembers";p(S=>{const B=[...S[l]];t=B[o];const K=B.filter((he,ue)=>ue!==o);return{...S,[l]:K}}),v("メンバーを削除しました","success",{actionLabel:"元に戻す",onAction:()=>{t&&p(S=>{const B=[...S[l]];return B.splice(o,0,t),{...S,[l]:B}})},autoHideDuration:5e3})},c=()=>{r||(T(""),W(""),Z([]),J(!0))},d=()=>{const i=G==="teamA"?s.teamA:s.teamB;i&&a(i,{id:fi(),no:Number(D),name:R,positions:z}),J(!1)},I=()=>{J(!1)},F=(i,o,t)=>{r||p(l=>{const S=i==="teamA"?"teamAMembers":"teamBMembers",B=[...l[S]],K={...B[o]},he=[...K.statuses||Array(l.sets.length).fill("")],ue=he[t]||"";let ye="";return ue===""?ye="starter":ue==="starter"?ye="libero":ye="",he[t]=ye,K.statuses=he,B[o]=K,{...l,[S]:B}})},E=i=>{const o=i==="teamA"?s.teamAMembers:s.teamBMembers,t=i,l=M?"50px 1fr":`40px 1fr ${s.sets.map(()=>"70px").join(" ")}`;return e.jsxs(n,{sx:{maxWidth:1024,mx:"auto",overflowX:"auto"},children:[e.jsxs(n,{sx:{display:"grid",gridTemplateColumns:l,alignItems:"center",height:50,px:1,borderBottom:1,borderColor:"divider",...Oe},children:[e.jsx(n,{children:"番号"}),e.jsx(n,{children:"名前"}),!M&&s.sets.map((S,B)=>e.jsx(n,{textAlign:"center",children:B+1},B))]}),e.jsx(Qe,{droppableId:t,children:S=>e.jsxs(n,{ref:S.innerRef,...S.droppableProps,children:[o.map((B,K)=>e.jsx(Ze,{draggableId:`${t}-${B.id}`,index:K,isDragDisabled:r,children:he=>{const ue=`${t}-${B.id}`,ye=he.dragHandleProps,{onPointerDown:ge,...$e}=ye||{},tt=At(Re=>{ge==null||ge(Re);const ve=$(ue);ve&&(ve.allowTouchMove=!1),se(ue)});return e.jsx(n,{ref:he.innerRef,...he.draggableProps,children:e.jsxs(Tt,{onSwiper:Re=>H(ue,Re),threshold:20,slidesPerView:"auto",style:{overflow:"hidden"},onTouchStart:(Re,ve)=>ve.stopPropagation(),onTouchEnd:Re=>P(ue,Re),children:[e.jsx(_e,{style:{width:"100%",flex:"0 0 auto"},children:e.jsxs(n,{...$e,...tt,sx:{display:"grid",gridTemplateColumns:l,alignItems:"center",height:50,px:1,borderBottom:1,borderColor:"divider",backgroundColor:"background.paper",cursor:r?"default":"grab",touchAction:O===ue?"none":"pan-y"},children:[e.jsx(n,{children:B.no}),e.jsx(n,{children:B.name}),!M&&s.sets.map((Re,ve)=>{var mt,We,ze,ft,pt,gt;return e.jsx(n,{sx:{textAlign:"center"},children:e.jsx(oe,{size:"small",variant:(mt=B.statuses)!=null&&mt[ve]?"contained":"outlined",color:((We=B.statuses)==null?void 0:We[ve])==="starter"?"primary":void 0,sx:{minWidth:32,width:32,p:0,...((ze=B.statuses)==null?void 0:ze[ve])==="starter"?{backgroundColor:"primary.main",color:"#fff","&:hover":{backgroundColor:"primary.main"}}:((ft=B.statuses)==null?void 0:ft[ve])==="libero"?{backgroundColor:"#FF9933",color:"#fff","&:hover":{backgroundColor:"#FF9933"},"&.Mui-focusVisible":{outline:"2px solid #FF9933"}}:{}},onClick:()=>F(i,K,ve),disabled:r,children:((pt=B.statuses)==null?void 0:pt[ve])==="starter"?"出":((gt=B.statuses)==null?void 0:gt[ve])==="libero"?"リ":"不"})},ve)})]})}),e.jsx(_e,{style:{width:nt,flex:"0 0 auto"},children:e.jsx(n,{sx:{height:50,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"error.main"},children:e.jsx(Se,{size:"small",onClick:()=>re(i,K),children:e.jsx(Me,{fontSize:"small",sx:{color:"common.white"}})})})})]})})}},B.id)),S.placeholder]})})]})};return e.jsxs(ht,{onDragEnd:Ie,children:[e.jsxs(ut,{container:!0,spacing:2,children:[e.jsxs(ut,{item:!0,xs:12,children:[e.jsxs(n,{sx:{maxWidth:1024,mx:"auto"},children:[e.jsx(Be,{variant:"h6",sx:{mb:1},children:h}),e.jsx(oe,{variant:"contained",size:"medium",sx:{mb:1},onClick:()=>C("teamA"),disabled:r,startIcon:e.jsx(Ft,{}),children:"メンバー登録"})]}),e.jsx(Ne,{open:ee,onClose:()=>te(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:Ge,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${b.palette.text.secondary}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${b.palette.text.secondary}`}}}},title:e.jsxs(n,{sx:{p:1,maxWidth:260},children:[e.jsx(Be,{variant:"body2",children:"各セットのラリー結果を入力する際に選択するメンバーとして表示されますが、未登録の場合においてもラリー結果の入力自体は可能です"}),e.jsx(n,{sx:{textAlign:"right",mt:1},children:e.jsx(Xe,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem(q,"1"),te(!1)},children:"了解した"})})]}),children:e.jsx(n,{children:e.jsx(Ne,{open:Y==="teamA",onClose:()=>N(null),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:Ge,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${b.palette.text.secondary}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${b.palette.text.secondary}`}}}},title:e.jsxs(n,{sx:{p:1,maxWidth:260},children:[e.jsxs(Be,{variant:"body2",children:["行を長押し、または左側の",e.jsx(it,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),"をドラッグすることで順番を入れ替えることができます",e.jsx("br",{}),"右側の",e.jsx(Me,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),"をタップすることで削除ができます",e.jsx("br",{}),"各セットごとで出場設定をすることができますが、現状は何かに使われることはありません（今後の機能アップデートにて利用）"]}),e.jsx(n,{sx:{textAlign:"right",mt:1},children:e.jsx(Xe,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem(A,"1"),N(null)},children:"了解した"})})]}),children:e.jsx(n,{children:y?E("teamA"):e.jsx(rt,{component:Le,storageKey:"members-teamA",sx:{maxWidth:1024,mx:"auto"},children:e.jsxs(ot,{size:"small",children:[e.jsx(dt,{children:e.jsxs(De,{sx:{backgroundColor:i=>i.palette.mode==="dark"?"#343A42":"#f5f5f5",height:50},children:[e.jsx(w,{}),e.jsx(w,{children:"番号"}),e.jsx(w,{children:"名前"}),e.jsx(w,{children:"ポジション"}),s.sets.map((i,o)=>e.jsx(w,{align:"center",children:o+1},o)),e.jsx(w,{})]})}),e.jsx(Qe,{droppableId:"teamA",children:i=>e.jsxs(ct,{ref:i.innerRef,...i.droppableProps,children:[s.teamAMembers.map((o,t)=>e.jsx(Ze,{draggableId:`teamA-${o.id}`,index:t,isDragDisabled:r,children:l=>e.jsxs(De,{ref:l.innerRef,...l.draggableProps,"data-index":t,sx:{cursor:r?"default":"pointer",height:50},children:[e.jsx(w,{padding:"checkbox",children:e.jsx(n,{onClick:S=>S.stopPropagation(),...l.dragHandleProps,sx:{cursor:r?"default":"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:e.jsx(it,{})})}),e.jsx(w,{children:o.no}),e.jsx(w,{children:o.name}),e.jsx(w,{children:(o.positions||[]).join(", ")}),s.sets.map((S,B)=>{var K,he,ue,ye,ge,$e;return e.jsx(w,{padding:"checkbox",align:"center",children:e.jsx(oe,{size:"small",variant:(K=o.statuses)!=null&&K[B]?"contained":"outlined",color:((he=o.statuses)==null?void 0:he[B])==="starter"?"primary":void 0,sx:{minWidth:32,width:32,p:0,...((ue=o.statuses)==null?void 0:ue[B])==="starter"?{backgroundColor:"primary.main",color:"#fff","&:hover":{backgroundColor:"primary.main"}}:((ye=o.statuses)==null?void 0:ye[B])==="libero"?{backgroundColor:"#FF9933",color:"#fff","&:hover":{backgroundColor:"#FF9933"},"&.Mui-focusVisible":{outline:"2px solid #FF9933"}}:{}},onClick:()=>F("teamA",t,B),disabled:r,children:((ge=o.statuses)==null?void 0:ge[B])==="starter"?"出":(($e=o.statuses)==null?void 0:$e[B])==="libero"?"リ":"不"})},B)}),e.jsx(w,{padding:"checkbox",children:e.jsx(n,{onClick:S=>S.stopPropagation(),sx:{width:32,height:32,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Se,{size:"small",onClick:r?void 0:()=>re("teamA",t),disabled:r,sx:{width:24,height:24},children:e.jsx(Me,{fontSize:"small",color:r?"disabled":"error"})})})})]})},o.id)),i.placeholder]})})]})})})})})})]}),e.jsxs(ut,{item:!0,xs:12,children:[e.jsxs(n,{sx:{maxWidth:1024,mx:"auto"},children:[e.jsx(Be,{variant:"h6",sx:{mb:1},children:j}),e.jsx(oe,{variant:"contained",size:"medium",sx:{mb:1},onClick:()=>C("teamB"),disabled:r,startIcon:e.jsx(Ft,{}),children:"メンバー登録"})]}),e.jsx(Ne,{open:Y==="teamB",onClose:()=>N(null),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:Ge,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${b.palette.text.secondary}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${b.palette.text.secondary}`}}}},title:e.jsxs(n,{sx:{p:1,maxWidth:260},children:[e.jsxs(Be,{variant:"body2",children:["行を長押し、または左側の",e.jsx(it,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),"をドラッグすることで順番を入れ替えることができます",e.jsx("br",{}),"右側の",e.jsx(Me,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),"をタップすることで削除ができます",e.jsx("br",{}),"各セットごとで出場設定をすることができますが、現状は何かに使われることはありません（今後の機能アップデートにて利用）"]}),e.jsx(n,{sx:{textAlign:"right",mt:1},children:e.jsx(Xe,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem(A,"1"),N(null)},children:"了解した"})})]}),children:e.jsx(n,{children:y?E("teamB"):e.jsx(rt,{component:Le,storageKey:"members-teamB",sx:{maxWidth:1024,mx:"auto"},children:e.jsxs(ot,{size:"small",children:[e.jsx(dt,{children:e.jsxs(De,{sx:{backgroundColor:i=>i.palette.mode==="dark"?"#343A42":"#f5f5f5",height:50},children:[e.jsx(w,{}),e.jsx(w,{children:"番号"}),e.jsx(w,{children:"名前"}),e.jsx(w,{children:"ポジション"}),s.sets.map((i,o)=>e.jsx(w,{align:"center",children:o+1},o)),e.jsx(w,{})]})}),e.jsx(Qe,{droppableId:"teamB",children:i=>e.jsxs(ct,{ref:i.innerRef,...i.droppableProps,children:[s.teamBMembers.map((o,t)=>e.jsx(Ze,{draggableId:`teamB-${o.id}`,index:t,isDragDisabled:r,children:l=>e.jsxs(De,{ref:l.innerRef,...l.draggableProps,"data-index":t,sx:{cursor:r?"default":"pointer",height:50},children:[e.jsx(w,{padding:"checkbox",children:e.jsx(n,{onClick:S=>S.stopPropagation(),...l.dragHandleProps,sx:{cursor:r?"default":"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:e.jsx(it,{})})}),e.jsx(w,{children:o.no}),e.jsx(w,{children:o.name}),e.jsx(w,{children:(o.positions||[]).join(", ")}),s.sets.map((S,B)=>{var K,he,ue,ye,ge,$e;return e.jsx(w,{padding:"checkbox",align:"center",children:e.jsx(oe,{size:"small",variant:(K=o.statuses)!=null&&K[B]?"contained":"outlined",color:((he=o.statuses)==null?void 0:he[B])==="starter"?"primary":void 0,sx:{minWidth:32,width:32,p:0,...((ue=o.statuses)==null?void 0:ue[B])==="starter"?{backgroundColor:"primary.main",color:"#fff","&:hover":{backgroundColor:"primary.main"}}:((ye=o.statuses)==null?void 0:ye[B])==="libero"?{backgroundColor:"#FF9933",color:"#fff","&:hover":{backgroundColor:"#FF9933"},"&.Mui-focusVisible":{outline:"2px solid #FF9933"}}:{}},onClick:()=>F("teamB",t,B),disabled:r,children:((ge=o.statuses)==null?void 0:ge[B])==="starter"?"出":(($e=o.statuses)==null?void 0:$e[B])==="libero"?"リ":"不"})},B)}),e.jsx(w,{padding:"checkbox",children:e.jsx(n,{onClick:S=>S.stopPropagation(),sx:{width:32,height:32,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Se,{size:"small",onClick:r?void 0:()=>re("teamB",t),disabled:r,sx:{width:24,height:24},children:e.jsx(Me,{fontSize:"small",color:r?"disabled":"error"})})})})]})},o.id)),i.placeholder]})})]})})})})]})]}),e.jsxs(xt,{open:ne,onClose:_,children:[e.jsx(qe,{children:"メンバー選択"}),e.jsxs(Ke,{children:[e.jsx(n,{sx:{display:"flex",justifyContent:"flex-end",mb:1},children:e.jsx(oe,{onClick:c,variant:"contained",startIcon:e.jsx(It,{}),disabled:r||!(G==="teamA"?s.teamA:s.teamB),children:"追加"})}),e.jsx(rt,{component:Le,storageKey:`members-select-${G}`,children:e.jsxs(ot,{size:"small",children:[e.jsx(dt,{children:e.jsxs(De,{sx:{backgroundColor:i=>i.palette.mode==="dark"?"#343A42":"#f5f5f5",height:50},children:[e.jsx(w,{padding:"checkbox"}),e.jsx(w,{children:"番号"}),e.jsx(w,{children:"名前"}),e.jsx(w,{children:"ポジション"})]})}),e.jsx(ct,{children:m.map(i=>{const o=ce.some(t=>t.id===i.id);return e.jsxs(De,{sx:{cursor:"pointer",height:50},children:[e.jsx(w,{padding:"checkbox",onClick:t=>t.stopPropagation(),children:e.jsx(Os,{checked:o,onChange:()=>U(i)})}),e.jsx(w,{children:i.no}),e.jsx(w,{children:i.name}),e.jsx(w,{children:(i.positions||[]).join(", ")})]},i.id)})})]})})]}),e.jsxs(Je,{children:[e.jsx(oe,{onClick:_,startIcon:e.jsx(Ue,{}),color:"inherit",children:"キャンセル"}),e.jsx(oe,{onClick:V,disabled:ce.length===0,startIcon:e.jsx(Ye,{}),children:"OK"})]})]}),e.jsxs(xt,{open:Q,onClose:I,children:[e.jsx(qe,{children:"メンバー追加"}),e.jsxs(Ke,{children:[e.jsx(fe,{label:"番号",type:"number",value:D,onChange:i=>T(i.target.value),fullWidth:!0,margin:"dense"}),e.jsx(fe,{label:"名前",value:R,onChange:i=>W(i.target.value),fullWidth:!0,margin:"dense"}),e.jsxs(Te,{fullWidth:!0,margin:"dense",children:[e.jsx(Ae,{id:"md-positions-label",children:"ポジション"}),e.jsxs(we,{labelId:"md-positions-label",multiple:!0,value:z,label:"ポジション",onChange:i=>Z(typeof i.target.value=="string"?i.target.value.split(","):i.target.value),renderValue:i=>i.join(", "),children:[e.jsx(ae,{value:"レフト",children:"レフト"}),e.jsx(ae,{value:"センター",children:"センター"}),e.jsx(ae,{value:"ライト",children:"ライト"}),e.jsx(ae,{value:"セッター",children:"セッター"}),e.jsx(ae,{value:"リベロ",children:"リベロ"})]})]})]}),e.jsxs(Je,{children:[e.jsx(oe,{onClick:I,startIcon:e.jsx(Ue,{}),color:"inherit",children:"キャンセル"}),e.jsx(oe,{onClick:d,disabled:D==="",startIcon:e.jsx(Ye,{}),children:"OK"})]})]})]})}function gi({match:s,setMatch:p,tags:h,onAddTag:j,locked:u}){return e.jsx(n,{sx:{maxWidth:1024,mx:"auto"},children:e.jsx(ut,{container:!0,spacing:2,children:e.jsx(ut,{item:!0,xs:12,children:e.jsxs(Le,{elevation:0,sx:{},children:[e.jsx(fe,{label:"試合日付",type:"date",InputLabelProps:{shrink:!0},value:s.date,onChange:a=>p(r=>({...r,date:a.target.value})),fullWidth:!0,margin:"dense",disabled:u,sx:{"& .MuiOutlinedInput-root":{height:56},"& .MuiOutlinedInput-input":{padding:"0 14px",height:"100%",lineHeight:"56px",fontSize:"1rem",textAlign:"left"},'& input[type="date"]':{WebkitAppearance:"none"}}}),e.jsx(fe,{label:"試合名",value:s.matchName,onChange:a=>p(r=>({...r,matchName:a.target.value})),fullWidth:!0,margin:"dense",disabled:u}),e.jsx(_t,{multiple:!0,freeSolo:!0,options:h,getOptionLabel:a=>typeof a=="string"?a:a.name,value:s.tags.map(a=>h.find(r=>r.id===a)).filter(Boolean),onChange:(a,r)=>{const v=[];r.forEach(b=>{if(typeof b=="string"){const y={id:crypto.randomUUID(),name:b,color:He};j(y),v.push(y.id)}else v.push(b.id)}),p(b=>({...b,tags:v}))},renderTags:(a,r)=>a.map((v,b)=>e.jsx(Pe,{...r({index:b}),label:v.name,sx:{backgroundColor:v.color||He,color:"#fff",mr:.5,mb:.5}})),renderInput:a=>e.jsx(fe,{...a,label:"タグ",margin:"dense"}),fullWidth:!0,disabled:u}),e.jsxs(hs,{severity:"info",sx:{mt:1},children:["試合タグは上記項目にて直接入力するか、設定＞タグメニューにて追加できます",e.jsx("br",{}),"試合にタグを設定することにより、試合を横串で集計することが可能となります"]}),e.jsx(fe,{label:"場所",value:s.location,onChange:a=>p(r=>({...r,location:a.target.value})),fullWidth:!0,margin:"dense",disabled:u}),e.jsx(fe,{label:"主審",value:s.mainReferee,onChange:a=>p(r=>({...r,mainReferee:a.target.value})),fullWidth:!0,margin:"dense",disabled:u}),e.jsx(fe,{label:"副審",value:s.subReferee,onChange:a=>p(r=>({...r,subReferee:a.target.value})),fullWidth:!0,margin:"dense",disabled:u}),e.jsx(fe,{label:"動画URL",value:s.videoUrl,onChange:a=>p(r=>({...r,videoUrl:a.target.value})),multiline:!0,rows:3,fullWidth:!0,margin:"dense",disabled:u}),e.jsx(fe,{label:"メモ",value:s.memo,onChange:a=>p(r=>({...r,memo:a.target.value})),multiline:!0,rows:3,fullWidth:!0,margin:"dense",disabled:u})]})})})})}function ji({match:s,setMatch:p,teams:h,locked:j}){return e.jsxs(Le,{elevation:0,sx:{},children:[e.jsxs(Te,{fullWidth:!0,margin:"dense",disabled:j,children:[e.jsx(Ae,{id:"teamA-label",children:"チームA"}),e.jsx(we,{labelId:"teamA-label",value:s.teamA,label:"チームA",onChange:u=>p(a=>({...a,teamA:u.target.value,teamAMembers:[]})),disabled:j,children:h.map(u=>e.jsx(ae,{value:u.id,children:u.name},u.id))})]}),e.jsx(fe,{label:"チームA監督",value:s.teamAHeadCoach,onChange:u=>p(a=>({...a,teamAHeadCoach:u.target.value})),fullWidth:!0,margin:"dense",disabled:j}),e.jsx(fe,{label:"チームAコーチ",value:s.teamACoach,onChange:u=>p(a=>({...a,teamACoach:u.target.value})),fullWidth:!0,margin:"dense",disabled:j}),e.jsx(fe,{label:"チームAマネージャー",value:s.teamAManager,onChange:u=>p(a=>({...a,teamAManager:u.target.value})),fullWidth:!0,margin:"dense",disabled:j}),e.jsx(fe,{label:"チームAキャプテン",value:s.teamACaptain,onChange:u=>p(a=>({...a,teamACaptain:u.target.value})),fullWidth:!0,margin:"dense",disabled:j}),e.jsxs(Te,{fullWidth:!0,margin:"dense",disabled:j,children:[e.jsx(Ae,{id:"teamB-label",children:"チームB"}),e.jsx(we,{labelId:"teamB-label",value:s.teamB,label:"チームB",onChange:u=>p(a=>({...a,teamB:u.target.value,teamBMembers:[]})),disabled:j,children:h.map(u=>e.jsx(ae,{value:u.id,children:u.name},u.id))})]}),e.jsx(fe,{label:"チームB監督",value:s.teamBHeadCoach,onChange:u=>p(a=>({...a,teamBHeadCoach:u.target.value})),fullWidth:!0,margin:"dense",disabled:j}),e.jsx(fe,{label:"チームBコーチ",value:s.teamBCoach,onChange:u=>p(a=>({...a,teamBCoach:u.target.value})),fullWidth:!0,margin:"dense",disabled:j}),e.jsx(fe,{label:"チームBマネージャー",value:s.teamBManager,onChange:u=>p(a=>({...a,teamBManager:u.target.value})),fullWidth:!0,margin:"dense",disabled:j}),e.jsx(fe,{label:"チームBキャプテン",value:s.teamBCaptain,onChange:u=>p(a=>({...a,teamBCaptain:u.target.value})),fullWidth:!0,margin:"dense",disabled:j})]})}const bi=Ns.create(n),yi=()=>typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():Math.random().toString(36).slice(2)+Date.now().toString(36);function $i({match:s,onSave:p,teams:h,teamMembers:j,playDetails:u,playCategories:a,statsSettings:r,rallyCategoryTags:v,rallyDetailTags:b,themeSetting:y,scoreInputSetting:M,onAddMember:P,setAppBarAction:H,setAppBarLeftAction:$,onDirtyChange:O,tags:se,onAddTag:q}){const ee=Us(),te=Vs(),[A,Y]=f.useState("info"),N=!1;f.useEffect(()=>{const x=te.pathname.split("/").filter(Boolean);if(x[0]!=="matches"||x[1]!==s.id)return;const k=x[2]??"info";k==="setinfo"?(Y("info"),ee(`/matches/${s.id}/info`,{replace:!0})):(Y(k),x[2]||ee(`/matches/${s.id}/info`,{replace:!0}))},[te.pathname,ee,s.id,N]);const ne=f.useCallback(x=>{const k=x.teamA,L=x.teamB,X=(me,xe)=>!!xe&&(j[me]||[]).some(le=>le.id===xe&&le.visible!==!1),de=(me,xe)=>xe.filter(le=>X(me,le.id)).map(le=>{const ke=(j[me]||[]).find(st=>st.id===le.id);return ke?{...le,no:ke.no,name:ke.name,positions:ke.positions}:le});return{...x,teamAMembers:de(k,x.teamAMembers),teamBMembers:de(L,x.teamBMembers),sets:x.sets.map(me=>({...me,rallies:me.rallies.map(xe=>({...xe,server:X(xe.serverTeam==="teamA"?k:L,xe.server)?xe.server:void 0,teamAMember:X(k,xe.teamAMember)?xe.teamAMember:void 0,teamBMember:X(L,xe.teamBMember)?xe.teamBMember:void 0}))}))}},[j]),[g,Q]=f.useState(()=>ne({...s,tags:s.tags||[],matchStatsSettings:s.matchStatsSettings||[],teamAMembers:s.teamAMembers.map(x=>({...x,statuses:x.statuses??Array(s.sets.length).fill("")})),teamBMembers:s.teamBMembers.map(x=>({...x,statuses:x.statuses??Array(s.sets.length).fill("")}))})),J=5,D=[gs,js,bs,ys,vs],T=!!s.locked,R=wt(),W=Hs(R.breakpoints.up("sm")),[z,Z]=f.useState(!1),[G,ie]=f.useState(!1),ce=200,pe=56,[Ie,m]=f.useState(!1),C=R.palette.text.secondary,U=f.useCallback(()=>{z?(ie(!1),Z(!1)):(Z(!0),W||ie(!0))},[z,W]),V=f.useCallback(x=>{x.propertyName==="width"&&W&&z&&ie(!0)},[W,z]);f.useEffect(()=>{W||(Z(!1),ie(!1))},[W]),f.useEffect(()=>($(e.jsx(Ne,{open:Ie,onClose:()=>m(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:Ge,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${C}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${C}`}}}},title:e.jsxs(n,{sx:{p:1,maxWidth:260},children:[e.jsxs(Be,{variant:"body2",children:[e.jsx(os,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),"からメニューを開き、各セットのメニューをロングタップし上下にスライドすることでセット順の変更が可能です"]}),e.jsx(n,{sx:{textAlign:"right",mt:1},children:e.jsx(Xe,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem("tutorial-set-reorder","1"),m(!1)},children:"了解した"})})]}),children:e.jsx(Se,{color:"inherit",onClick:U,children:e.jsx(os,{})})})),()=>$(null)),[$,U,Ie,C]);const[_,re]=f.useState(!1),[c,d]=f.useState(!1),[I,F]=f.useState(null),[E,i]=f.useState(!1),[o,t]=f.useState({open:!1,message:"",severity:"success"}),l=(x,k,L)=>{t({open:!0,message:x,severity:k,...L})},S=`matchDraft-${s.id}`,B=f.useRef(!1),[K,he]=f.useState(!1),[ue,ye]=f.useState(!1),[ge,$e]=f.useState({}),tt=f.useCallback((x,k,L=!0)=>{Q(X=>{const de=[...X.sets],me=de.findIndex(le=>le.id===x);if(me===-1)return X;const xe=de[me];return L&&$e(le=>{const ke=le[x]||{undo:[]};return{...le,[x]:{undo:[...ke.undo,xe],redo:[]}}}),de[me]=k,{...X,sets:de}})},[]),Re=f.useCallback(()=>{if(!/^[0-9]+$/.test(A))return;const x=Number(A)-1,k=g.sets[x],L=ge[k.id];if(!L||L.undo.length===0)return;const X=L.undo[L.undo.length-1];$e(de=>({...de,[k.id]:{undo:L.undo.slice(0,-1),redo:[...L.redo,k]}})),tt(k.id,X,!1)},[A,g.sets,ge,tt]),ve=f.useCallback(()=>{if(!/^[0-9]+$/.test(A))return;const x=Number(A)-1,k=g.sets[x],L=ge[k.id];if(!L||L.redo.length===0)return;const X=L.redo[L.redo.length-1];$e(de=>({...de,[k.id]:{undo:[...L.undo,k],redo:L.redo.slice(0,-1)}})),tt(k.id,X,!1)},[A,g.sets,ge,tt]),mt=x=>{if(!x.destination||T)return;const k=x.source.index,L=x.destination.index;if(k===L)return;const X=Array.from(g.sets),[de]=X.splice(k,1);X.splice(L,0,de);const me=ke=>ke.map(st=>{const Ce=Array.from(st.statuses||[]),[at]=Ce.splice(k,1);return Ce.splice(L,0,at),{...st,statuses:Ce}}),xe=me(g.teamAMembers),le=me(g.teamBMembers);Q(ke=>({...ke,sets:X,teamAMembers:xe,teamBMembers:le}))};f.useEffect(()=>{$e(x=>{const k={...x};return Object.keys(k).forEach(L=>{g.sets.some(X=>X.id===L)||delete k[L]}),k})},[g.sets]),f.useEffect(()=>{Q(x=>ne(x))},[ne]);const We=x=>{var k;return((k=h.find(L=>L.id===x))==null?void 0:k.name)||""},ze=f.useMemo(()=>g.date!==s.date||g.matchName!==s.matchName||g.location!==s.location||g.mainReferee!==s.mainReferee||g.subReferee!==s.subReferee||g.videoUrl!==s.videoUrl||g.memo!==s.memo||g.teamA!==s.teamA||g.teamAHeadCoach!==s.teamAHeadCoach||g.teamACoach!==s.teamACoach||g.teamAManager!==s.teamAManager||g.teamACaptain!==s.teamACaptain||g.teamB!==s.teamB||g.teamBHeadCoach!==s.teamBHeadCoach||g.teamBCoach!==s.teamBCoach||g.teamBManager!==s.teamBManager||g.teamBCaptain!==s.teamBCaptain||JSON.stringify(g.tags)!==JSON.stringify(s.tags)||JSON.stringify(g.teamAMembers)!==JSON.stringify(s.teamAMembers)||JSON.stringify(g.teamBMembers)!==JSON.stringify(s.teamBMembers)||JSON.stringify(g.matchStatsSettings||[])!==JSON.stringify(s.matchStatsSettings||[])||JSON.stringify(g.sets)!==JSON.stringify(s.sets),[g,s]);f.useEffect(()=>{localStorage.getItem(S)&&i(!0)},[S]),f.useEffect(()=>{if(!B.current){B.current=!0;return}ze?localStorage.setItem(S,JSON.stringify(g)):localStorage.removeItem(S)},[g,ze,S]);const ft=()=>{if(T||g.sets.length>=J)return;g.sets.length===1&&!localStorage.getItem("tutorial-set-reorder")&&m(!0);const x={id:yi(),my:0,opponent:0,rallies:[]},k=g.sets.length+1;Q(L=>({...L,sets:[...L.sets,x],teamAMembers:L.teamAMembers.map(X=>({...X,statuses:[...X.statuses||[],""]})),teamBMembers:L.teamBMembers.map(X=>({...X,statuses:[...X.statuses||[],""]}))})),Y(String(k)),ee(`/matches/${s.id}/${k}`)},pt=x=>{T||(F(x),d(!0))},gt=()=>{if(I===null)return;const x=I,k=g.sets.length;let L=[],X=[],de=[];const me=A;let xe=A;if(A!=="info"&&A!=="members"&&A!=="stats"&&A!=="setinfo"){const le=Number(A)-1;le===x?x>0?(xe=String(x),ee(`/matches/${s.id}/${x}`)):k>1?(xe="1",ee(`/matches/${s.id}/1`)):(xe="info",ee(`/matches/${s.id}/info`)):le>x&&(xe=String(le),ee(`/matches/${s.id}/${le}`))}Y(xe),Q(le=>{L=le.sets.map(Ce=>({...Ce})),X=le.teamAMembers.map(Ce=>({...Ce,statuses:Ce.statuses?[...Ce.statuses]:[]})),de=le.teamBMembers.map(Ce=>({...Ce,statuses:Ce.statuses?[...Ce.statuses]:[]}));const ke=le.sets.filter((Ce,at)=>at!==x),st=Ce=>Ce.map(at=>({...at,statuses:(at.statuses||[]).filter((Ci,Rs)=>Rs!==x)}));return{...le,sets:ke,teamAMembers:st(le.teamAMembers),teamBMembers:st(le.teamBMembers)}}),F(null),d(!1),l("セットを削除しました","success",{actionLabel:"元に戻す",onAction:()=>{Q(le=>({...le,sets:L,teamAMembers:X,teamBMembers:de})),me!=="info"&&me!=="members"&&me!=="stats"&&me!=="setinfo"&&ee(`/matches/${s.id}/${me}`)},autoHideDuration:5e3})},ns=()=>{F(null),d(!1)},is=f.useCallback(()=>{re(!0)},[]),Ds=async()=>{const x=ne(g);Q(x);try{await Promise.resolve(p(x)),localStorage.removeItem(S),l("保存しました","success")}catch{l("保存に失敗しました","error")}re(!1)},rs=()=>{re(!1)},Bs=()=>{t(x=>({...x,open:!1}))},Ms=()=>{const x=localStorage.getItem(S);if(!x){i(!1);return}try{const k=JSON.parse(x),L={...k,tags:k.tags||[],matchStatsSettings:k.matchStatsSettings||[],teamAMembers:k.teamAMembers.map(de=>({...de,statuses:de.statuses??Array(k.sets.length).fill("")})),teamBMembers:k.teamBMembers.map(de=>({...de,statuses:de.statuses??Array(k.sets.length).fill("")}))},X=ne(L);Q(X),p(X)}catch{}localStorage.removeItem(S),i(!1)},ls=()=>{localStorage.removeItem(S),i(!1)},Ve=f.useMemo(()=>/^[0-9]+$/.test(A),[A]),lt=f.useMemo(()=>Ve?g.sets[Number(A)-1]:null,[Ve,A,g.sets]),jt=f.useMemo(()=>{var x;return!Ve||T||!lt||!((x=ge[lt.id])!=null&&x.undo.length)},[Ve,T,lt,ge]),bt=f.useMemo(()=>{var x;return!Ve||T||!lt||!((x=ge[lt.id])!=null&&x.redo.length)},[Ve,T,lt,ge]);f.useEffect(()=>{jt?he(!1):localStorage.getItem("tutorial-undo")||he(!0)},[jt]),f.useEffect(()=>{bt?ye(!1):localStorage.getItem("tutorial-redo")||ye(!0)},[bt]),f.useEffect(()=>(H(e.jsxs(n,{sx:{display:"flex",alignItems:"center"},children:[Ve&&e.jsxs(e.Fragment,{children:[e.jsx(Ne,{open:K,onClose:()=>he(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:Ge,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${C}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${C}`}}}},title:e.jsxs(n,{sx:{p:1,maxWidth:260},children:[e.jsxs(Be,{variant:"body2",children:["各セットタブで独立し、ラリー結果の操作履歴を保持しています。",e.jsx("br",{}),e.jsx(Rt,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),"を選択することで1つ前の操作を取り消すことができます。",e.jsx("br",{}),"操作履歴は試合画面を離れると消去されます。"]}),e.jsx(n,{sx:{textAlign:"right",mt:1},children:e.jsx(Xe,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem("tutorial-undo","1"),he(!1)},children:"了解した"})})]}),children:e.jsx(Se,{onClick:Re,disabled:jt,color:"inherit",sx:{ml:1},children:e.jsx(Rt,{})})}),e.jsx(Ne,{open:ue,onClose:()=>ye(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:Ge,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${C}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${C}`}}}},title:e.jsxs(n,{sx:{p:1,maxWidth:260},children:[e.jsxs(Be,{variant:"body2",children:[e.jsx(zt,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),"を選択することで1つ前に取り消した操作を復活することができます。"]}),e.jsx(n,{sx:{textAlign:"right",mt:1},children:e.jsx(Xe,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem("tutorial-redo","1"),ye(!1)},children:"了解した"})})]}),children:e.jsx(Se,{onClick:ve,disabled:bt,color:"inherit",sx:{ml:1},children:e.jsx(zt,{})})})]}),e.jsx(oe,{onClick:is,variant:"contained",disabled:!ze||T,startIcon:e.jsx(Cs,{}),sx:{ml:1},children:"保存"})]})),()=>H(null)),[H,Ve,Re,ve,is,ze,T,jt,bt,K,ue,C]),f.useEffect(()=>(O==null||O(ze),()=>O==null?void 0:O(!1)),[ze,O]);const $s=[{key:"info",label:"試合概要",icon:e.jsx(Ks,{})},{key:"team",label:"チーム",icon:e.jsx(ps,{})},{key:"members",label:"メンバー登録",icon:e.jsx(ms,{})},{key:"sep1",divider:!0},{key:"stats",label:"スタッツ",icon:e.jsx(Js,{})},{key:"sep2",divider:!0},{key:"setinfo",label:"セット情報",icon:e.jsx(fs,{})}].filter(x=>x.key!=="setinfo"),ks=g.sets.map((x,k)=>{const L=D[k];return{key:`${k+1}`,icon:e.jsx(L,{}),label:`${x.my}-${x.opponent}`}}),Ps=!T&&g.sets.length<J?[{key:"add",label:"セット追加",icon:e.jsx(It,{})}]:[],Dt=x=>{x==="add"?ft():(Y(x),ee(`/matches/${s.id}/${x}`)),W||(ie(!1),Z(!1))},_s=e.jsxs(bi,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},sx:{flexGrow:1,overflowY:"auto",display:"flex",flexDirection:"column"},children:[A==="info"&&e.jsx(gi,{match:g,setMatch:Q,tags:se,onAddTag:q,locked:T}),A==="members"&&e.jsx(pi,{match:g,setMatch:Q,teamAName:We(g.teamA)||"チームA",teamBName:We(g.teamB)||"チームB",teamMembers:j,onAddMember:P,locked:T,showSnackbar:l}),A==="stats"&&e.jsx(ui,{sets:g.sets,playDetails:u,playCategories:a,statsSettings:r,matchStatsSettings:g.matchStatsSettings||[],onMatchStatsSettingsChange:x=>Q(k=>({...k,matchStatsSettings:x})),rallyCategoryTags:v,rallyDetailTags:b,teamAName:We(g.teamA),teamBName:We(g.teamB),locked:T,showSnackbar:l}),A==="team"&&e.jsx(n,{sx:{maxWidth:1024,mx:"auto"},children:e.jsx(ji,{match:g,setMatch:Q,teams:h,locked:T})}),N,A!=="info"&&A!=="members"&&A!=="stats"&&A!=="setinfo"&&A!=="team"&&e.jsx(li,{setScore:g.sets[Number(A)-1],playDetails:u,playCategories:a,teamAMembers:g.teamAMembers,teamBMembers:g.teamBMembers,teamAName:We(g.teamA),teamBName:We(g.teamB),locked:T,scoreInputSetting:M,themeSetting:y,onChange:x=>tt(x.id,x),showSnackbar:l})]},A);return e.jsxs(n,{sx:{display:"flex",height:"100%"},children:[e.jsx(Ws,{variant:W?"permanent":"temporary",open:W?!0:z,onClose:()=>{ie(!1),Z(!1)},PaperProps:{onTransitionEnd:V},ModalProps:{keepMounted:!0,BackdropProps:{sx:{backgroundColor:"rgba(0, 0, 0, 0.5)"}}},sx:{width:W?z?ce:pe:ce,flexShrink:0,transition:R.transitions.create("width",{easing:R.transitions.easing.sharp,duration:R.transitions.duration.standard}),...W?{zIndex:R.zIndex.appBar-1}:{},"& .MuiDrawer-paper":{width:W?z?ce:pe:ce,boxSizing:"border-box",overflowX:"hidden",transition:R.transitions.create("width",{easing:R.transitions.easing.sharp,duration:R.transitions.duration.standard}),...W?{top:R.mixins.toolbar.minHeight,height:`calc(100% - ${R.mixins.toolbar.minHeight}px)`,zIndex:R.zIndex.appBar-1}:{}}},children:e.jsxs(Es,{children:[$s.map(x=>x.divider?e.jsx(Ls,{component:"li"},x.key):e.jsxs(Mt,{selected:A===x.key,onClick:()=>Dt(x.key),sx:{minHeight:48,justifyContent:z?"initial":"center",px:2.5},children:[e.jsx($t,{sx:{minWidth:0,mr:z?3:0,justifyContent:"center"},children:x.icon}),e.jsx(kt,{primary:x.label??`セット${x.key}`,sx:{opacity:G?1:0,display:G?"block":"none",whiteSpace:"nowrap"}})]},x.key)),e.jsx(ht,{onDragEnd:mt,children:e.jsx(Qe,{droppableId:"drawer-sets",children:x=>e.jsxs(n,{ref:x.innerRef,...x.droppableProps,children:[ks.map((k,L)=>e.jsx(Ze,{draggableId:g.sets[L].id,index:L,children:X=>e.jsxs(Mt,{ref:X.innerRef,...X.draggableProps,...X.dragHandleProps,style:X.draggableProps.style,selected:A===k.key,onClick:()=>Dt(k.key),sx:{minHeight:48,justifyContent:z?"initial":"center",px:2.5},children:[e.jsx($t,{sx:{minWidth:0,mr:z?3:0,justifyContent:"center"},children:k.icon}),e.jsx(kt,{primary:k.label??`セット${k.key}`,sx:{opacity:G?1:0,display:G?"block":"none",whiteSpace:"nowrap"}}),!T&&z&&e.jsx(Se,{edge:"end",onClick:de=>{de.stopPropagation(),pt(L)},children:e.jsx(Me,{})})]})},g.sets[L].id)),x.placeholder]})})}),Ps.map(x=>e.jsxs(Mt,{selected:A===x.key,onClick:()=>Dt(x.key),sx:{minHeight:48,justifyContent:z?"initial":"center",px:2.5},children:[e.jsx($t,{sx:{minWidth:0,mr:z?3:0,justifyContent:"center"},children:x.icon}),e.jsx(kt,{primary:x.label??`セット${x.key}`,sx:{opacity:G?1:0,display:G?"block":"none",whiteSpace:"nowrap"}})]},x.key))]})}),e.jsxs(n,{sx:{flexGrow:1,display:"flex",flexDirection:"column",width:W?`calc(100% - ${z?ce:pe}px)`:"100%",transition:W?R.transitions.create("width",{duration:R.transitions.duration.standard}):void 0},children:[e.jsx(n,{sx:{flexGrow:1,position:"relative",overflowY:"hidden",display:"flex",width:"100%"},children:e.jsx(Gs,{mode:"wait",children:_s})}),e.jsxs(Pt,{open:c,onClose:ns,children:[e.jsx(qe,{children:"削除確認"}),e.jsx(Ke,{sx:{mt:2},children:"このセットを削除しますか？"}),e.jsxs(Je,{children:[e.jsx(oe,{onClick:ns,startIcon:e.jsx(Ue,{}),color:"inherit",children:"キャンセル"}),e.jsx(oe,{onClick:gt,color:"error",startIcon:e.jsx(Ye,{}),children:"OK"})]})]}),e.jsxs(Pt,{open:E,onClose:ls,children:[e.jsx(qe,{children:"復元確認"}),e.jsx(Ke,{sx:{mt:2},children:"入力途中のデータが存在します。復元しますか？"}),e.jsxs(Je,{children:[e.jsx(oe,{onClick:ls,startIcon:e.jsx(Ue,{}),color:"inherit",children:"いいえ"}),e.jsx(oe,{onClick:Ms,startIcon:e.jsx(Ye,{}),children:"はい"})]})]}),e.jsxs(Pt,{open:_,onClose:rs,children:[e.jsx(qe,{children:"保存確認"}),e.jsx(Ke,{sx:{mt:2},children:"入力内容を保存しますか？"}),e.jsxs(Je,{children:[e.jsx(oe,{onClick:rs,startIcon:e.jsx(Ue,{}),color:"inherit",children:"キャンセル"}),e.jsx(oe,{onClick:Ds,disabled:!ze||T,startIcon:e.jsx(Ye,{}),children:"OK"})]})]}),e.jsx(qs,{open:o.open,message:o.message,severity:o.severity,onClose:Bs,actionLabel:o.actionLabel,onAction:o.onAction,autoHideDuration:o.autoHideDuration})]})]})}export{$i as default};
