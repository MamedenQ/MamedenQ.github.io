import{i as Ie,j as e,E as it,G as rt,d as Xe,e as qe,B as s,F as _e,K as Re,S as ze,M as oe,H as lt,r as ue,J as bs,I as De,L as qs,N as ms,a as Mt,O as ys,n as Wt,Q as $t,R as Ee,Z as We,y as Fe,U as Qe,V as Ks,f as et,g as jt,h as bt,k as Oe,l as T,m as yt,C as Ue,W as qt,X as Ce,A as vs,Y as wt,_ as Js,b as ps,$ as Ns,a0 as ft,a1 as gt,a2 as Gs,a3 as Ys,a4 as Xs,a5 as Ut,D as Vt}from"./mui-vendor-DBE-HG4E.js";import{r as d,f as Qs,u as Zs}from"./react-vendor-QLNaZ7XN.js";import{r as Me,u as dt,R as At,d as tt,a as Ne,B as zt,b as Cs,S as Ss,c as Lt,e as Nt,f as xt,g as Ke,h as st,i as Ft,j as Ve,D as ut,k as Je,A as en}from"./index-CzXZeLVS.js";import{t as Ze,d as tn,a as sn}from"./tooltipMessages-C97C6VYw.js";import{d as fs}from"./SpaceDashboardOutlined-ajG_COCc.js";import{D as It,C as at,P as ot,d as Ot,u as Ht,a as Kt}from"./useLongPress-uVAkfOvK.js";import{m as nn,A as rn}from"./motion-vendor-ArpBbMV7.js";import"./chart-vendor-OsQvonB5.js";var Gt={},ln=Ie;Object.defineProperty(Gt,"__esModule",{value:!0});var Ts=Gt.default=void 0,an=ln(Me()),on=e;Ts=Gt.default=(0,an.default)((0,on.jsx)("path",{d:"M12 5.9c1.16 0 2.1.94 2.1 2.1s-.94 2.1-2.1 2.1S9.9 9.16 9.9 8s.94-2.1 2.1-2.1m0 9c2.97 0 6.1 1.46 6.1 2.1v1.1H5.9V17c0-.64 3.13-2.1 6.1-2.1M12 4C9.79 4 8 5.79 8 8s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4m0 9c-2.67 0-8 1.34-8 4v3h16v-3c0-2.66-5.33-4-8-4"}),"PersonOutlineOutlined");var Yt={},dn=Ie;Object.defineProperty(Yt,"__esModule",{value:!0});var ws=Yt.default=void 0,cn=dn(Me()),un=e;ws=Yt.default=(0,cn.default)((0,un.jsx)("path",{d:"M2 17h2v.5H3v1h1v.5H2v1h3v-4H2zm1-9h1V4H2v1h1zm-1 3h1.8L2 13.1v.9h3v-1H3.2L5 10.9V10H2zm5-6v2h14V5zm0 14h14v-2H7zm0-6h14v-2H7z"}),"FormatListNumberedOutlined");var Xt={},xn=Ie;Object.defineProperty(Xt,"__esModule",{value:!0});var As=Xt.default=void 0,hn=xn(Me()),mn=e;As=Xt.default=(0,hn.default)((0,mn.jsx)("path",{d:"M9 13.75c-2.34 0-7 1.17-7 3.5V19h14v-1.75c0-2.33-4.66-3.5-7-3.5M4.34 17c.84-.58 2.87-1.25 4.66-1.25s3.82.67 4.66 1.25zM9 12c1.93 0 3.5-1.57 3.5-3.5S10.93 5 9 5 5.5 6.57 5.5 8.5 7.07 12 9 12m0-5c.83 0 1.5.67 1.5 1.5S9.83 10 9 10s-1.5-.67-1.5-1.5S8.17 7 9 7m7.04 6.81c1.16.84 1.96 1.96 1.96 3.44V19h4v-1.75c0-2.02-3.5-3.17-5.96-3.44M15 12c1.93 0 3.5-1.57 3.5-3.5S16.93 5 15 5c-.54 0-1.04.13-1.5.35.63.89 1 1.98 1 3.15s-.37 2.26-1 3.15c.46.22.96.35 1.5.35"}),"GroupOutlined");var Qt={},pn=Ie;Object.defineProperty(Qt,"__esModule",{value:!0});var Is=Qt.default=void 0,fn=pn(Me()),gn=e;Is=Qt.default=(0,fn.default)((0,gn.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V5h14zm-7-2h2V7h-4v2h2z"}),"LooksOneOutlined");var Zt={},jn=Ie;Object.defineProperty(Zt,"__esModule",{value:!0});var Ms=Zt.default=void 0,bn=jn(Me()),yn=e;Ms=Zt.default=(0,bn.default)((0,yn.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V5h14zm-4-4h-4v-2h2c1.1 0 2-.89 2-2V9c0-1.11-.9-2-2-2H9v2h4v2h-2c-1.1 0-2 .89-2 2v4h6z"}),"LooksTwoOutlined");var es={},vn=Ie;Object.defineProperty(es,"__esModule",{value:!0});var Ds=es.default=void 0,Cn=vn(Me()),Sn=e;Ds=es.default=(0,Cn.default)((0,Sn.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V5h14zm-4-4v-1.5c0-.83-.67-1.5-1.5-1.5.83 0 1.5-.67 1.5-1.5V9c0-1.11-.9-2-2-2H9v2h4v2h-2v2h2v2H9v2h4c1.1 0 2-.89 2-2"}),"Looks3Outlined");var ts={},Tn=Ie;Object.defineProperty(ts,"__esModule",{value:!0});var Bs=ts.default=void 0,wn=Tn(Me()),An=e;Bs=ts.default=(0,wn.default)((0,An.jsx)("path",{d:"M19.04 3h-14c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16h-14V5h14zm-6-2h2V7h-2v4h-2V7h-2v6h4z"}),"Looks4Outlined");var ss={},In=Ie;Object.defineProperty(ss,"__esModule",{value:!0});var Ps=ss.default=void 0,Mn=In(Me()),Dn=e;Ps=ss.default=(0,Mn.default)((0,Dn.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V5h14zm-4-4v-2c0-1.11-.9-2-2-2h-2V9h4V7H9v6h4v2H9v2h4c1.1 0 2-.89 2-2"}),"Looks5Outlined");var ns={},Bn=Ie;Object.defineProperty(ns,"__esModule",{value:!0});var kt=ns.default=void 0,Pn=Bn(Me()),$n=e;kt=ns.default=(0,Pn.default)((0,$n.jsx)("path",{d:"M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8"}),"UndoOutlined");var is={},kn=Ie;Object.defineProperty(is,"__esModule",{value:!0});var _t=is.default=void 0,_n=kn(Me()),Rn=e;_t=is.default=(0,_n.default)((0,Rn.jsx)("path",{d:"M18.4 10.6C16.55 8.99 14.15 8 11.5 8c-4.65 0-8.58 3.03-9.96 7.22L3.9 16c1.05-3.19 4.05-5.5 7.6-5.5 1.95 0 3.73.72 5.12 1.88L13 16h9V7z"}),"RedoOutlined");var rs={},zn=Ie;Object.defineProperty(rs,"__esModule",{value:!0});var $s=rs.default=void 0,Fn=zn(Me()),On=e;$s=rs.default=(0,Fn.default)((0,On.jsx)("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreVert");function Hn(t,g,x){const y=d.useCallback(n=>{let D=0,j=0;n.rallies.forEach(h=>{if(h.timeoutTeam||h.substitutionTeam)return;const M=g.find(R=>R.id===h.teamAPlayDetail),L=g.find(R=>R.id===h.teamBPlayDetail);(M==null?void 0:M.pointType)==="得点"||(L==null?void 0:L.pointType)==="失点"?D+=1:((L==null?void 0:L.pointType)==="得点"||(M==null?void 0:M.pointType)==="失点")&&(j+=1)}),n.my=D,n.opponent=j},[g]),c=d.useCallback(n=>{const D=[...t.rallies,n],j={...t,rallies:D};y(j),x(j)},[t,y,x]),r=d.useCallback(n=>{const D=t.rallies.filter((h,M)=>M!==n),j={...t,rallies:D};y(j),x(j)},[t,y,x]);return{addRally:c,deleteRally:r,calculateScores:y}}const Ln=d.forwardRef(function({setScore:g,playDetails:x,playCategories:y,teamAMembers:c,teamBMembers:r,teamAName:n,teamBName:D,scoreInputSetting:j,themeSetting:h,locked:M=!1,onAdd:L,onEdit:R},P){var Ae,a,l,I,E,F,_,me;const O=dt("sm"),[Y,V]=d.useState(!1),[Q,Z]=d.useState("teamA"),[w,ie]=d.useState(""),[se,re]=d.useState(""),[f,te]=d.useState(""),[ee,B]=d.useState(""),[b,k]=d.useState(""),[U,X]=d.useState(""),[G,xe]=d.useState(""),[le,he]=d.useState(""),[ye,we]=d.useState(null),u=()=>{if(M)return;we(null);const i=[...g.rallies].reverse().find(p=>!p.timeoutTeam&&!p.substitutionTeam);let m="teamA";if(i){const p=x.find(W=>W.id===i.teamAPlayDetail),A=x.find(W=>W.id===i.teamBPlayDetail);(p==null?void 0:p.pointType)==="得点"||(A==null?void 0:A.pointType)==="失点"?m="teamA":((A==null?void 0:A.pointType)==="得点"||(p==null?void 0:p.pointType)==="失点")&&(m="teamB")}Z(m),ie(""),re(""),te(""),B(""),k(""),X(""),xe(""),he(""),V(!0)},C=i=>{var p,A;if(M)return;const m=g.rallies[i];we(i),Z(m.serverTeam||"teamA"),ie(m.server&&(m.serverTeam==="teamA"?c.some(W=>W.id===m.server):r.some(W=>W.id===m.server))?m.server:""),re(((p=x.find(W=>W.id===m.teamAPlayDetail))==null?void 0:p.playCategoryId)||""),B(m.teamAPlayDetail||""),X(c.some(W=>W.id===m.teamAMember)&&m.teamAMember||""),te(((A=x.find(W=>W.id===m.teamBPlayDetail))==null?void 0:A.playCategoryId)||""),k(m.teamBPlayDetail||""),xe(r.some(W=>W.id===m.teamBMember)&&m.teamBMember||""),he(m.timeoutTeam||""),V(!0)};d.useImperativeHandle(P,()=>({openAddDialog:u,openEditDialog:C}));const z=()=>{var W,pe;if(le)return!0;if(j.rallyMemberRequired&&!w||se&&!ee||f&&!b||!!!(se&&ee)&&!!!(f&&b))return!1;const p=(W=x.find(Se=>Se.id===ee))==null?void 0:W.pointUnitType;if(j.rallyMemberRequired&&ee&&p==="メンバー"&&!U)return!1;const A=(pe=x.find(Se=>Se.id===b))==null?void 0:pe.pointUnitType;return!(j.rallyMemberRequired&&b&&A==="メンバー"&&!G)},J=i=>le?{id:i??crypto.randomUUID(),timeoutTeam:le}:{id:i??crypto.randomUUID(),serverTeam:Q,server:w||void 0,teamAPlayDetail:ee||void 0,teamAMember:U||void 0,teamBPlayDetail:b||void 0,teamBMember:G||void 0},H=()=>{if(ye===null)L(J());else{const i=g.rallies[ye].id;R(ye,J(i))}V(!1)};return e.jsxs(At,{open:Y,onClose:()=>V(!1),children:[e.jsx(it,{children:ye===null?"ラリー追加":"ラリー編集"}),e.jsxs(rt,{sx:{display:"flex",flexDirection:"column"},children:[e.jsxs(Xe,{exclusive:!0,value:Q,onChange:(i,m)=>m&&Z(m),fullWidth:!0,disabled:!!le,sx:{mb:1},children:[e.jsx(qe,{value:"teamA",sx:{flex:1},children:e.jsx(s,{sx:{whiteSpace:"pre-line",textAlign:"center"},children:`${n||"チームA"}
サーブ`})}),e.jsx(qe,{value:"teamB",sx:{flex:1},children:e.jsx(s,{sx:{whiteSpace:"pre-line",textAlign:"center"},children:`${D||"チームB"}
サーブ`})})]}),e.jsxs(_e,{fullWidth:!0,margin:"dense",required:j.rallyMemberRequired,disabled:!!le,children:[e.jsx(Re,{id:"server",children:"サーバー"}),e.jsx(ze,{labelId:"server",value:w,label:"サーバー",onChange:i=>ie(i.target.value),children:(Q==="teamA"?c:r).map(i=>e.jsx(oe,{value:i.id,children:i.name},i.id))})]}),O?e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(s,{sx:{flex:1,display:"flex",flexDirection:"column",gap:1},children:[e.jsxs(s,{sx:{display:"flex",gap:1,mt:2},children:[e.jsx(Xe,{sx:{flex:1},orientation:"vertical",exclusive:!0,value:se,onChange:(i,m)=>{se===m||m===null?(re(""),B("")):(re(m),B(""))},disabled:!!le,children:y.filter(i=>i.visible!==!1).map(i=>e.jsx(qe,{value:i.id,sx:{whiteSpace:"nowrap"},children:i.name},i.id))}),e.jsx(Xe,{sx:{flex:1},orientation:"vertical",exclusive:!0,value:ee,onChange:(i,m)=>{B(ee===m||m===null?"":m)},disabled:!!le,children:x.filter(i=>i.playCategoryId===se&&i.visible!==!1).map(i=>{const m=i.pointType==="得点"?h.scoreColor:h.lossColor;return e.jsx(qe,{value:i.id,sx:{whiteSpace:"nowrap",color:m,"&.Mui-selected":{color:m}},children:i.name},i.id)})})]}),e.jsxs(_e,{fullWidth:!0,margin:"dense",required:j.rallyMemberRequired&&((Ae=x.find(i=>i.id===ee))==null?void 0:Ae.pointUnitType)==="メンバー",disabled:!!le,children:[e.jsx(Re,{id:"amem",children:`${n||"チームA"}メンバー`}),e.jsxs(ze,{labelId:"amem",value:U,label:`${n||"チームA"}メンバー`,onChange:i=>X(i.target.value),disabled:((a=x.find(i=>i.id===ee))==null?void 0:a.pointUnitType)!=="メンバー",children:[e.jsx(oe,{value:"",children:e.jsx("em",{children:"なし"})}),c.map(i=>e.jsx(oe,{value:i.id,children:i.name},i.id))]})]})]}),e.jsxs(s,{sx:{flex:1,display:"flex",flexDirection:"column",gap:1},children:[e.jsxs(s,{sx:{display:"flex",gap:1,mt:2},children:[e.jsx(Xe,{sx:{flex:1},orientation:"vertical",exclusive:!0,value:f,onChange:(i,m)=>{f===m||m===null?(te(""),k("")):(te(m),k(""))},disabled:!!le,children:y.filter(i=>i.visible!==!1).map(i=>e.jsx(qe,{value:i.id,sx:{whiteSpace:"nowrap"},children:i.name},i.id))}),e.jsx(Xe,{sx:{flex:1},orientation:"vertical",exclusive:!0,value:b,onChange:(i,m)=>{k(b===m||m===null?"":m)},disabled:!!le,children:x.filter(i=>i.playCategoryId===f&&i.visible!==!1).map(i=>{const m=i.pointType==="得点"?h.scoreColor:h.lossColor;return e.jsx(qe,{value:i.id,sx:{whiteSpace:"nowrap",color:m,"&.Mui-selected":{color:m}},children:i.name},i.id)})})]}),e.jsxs(_e,{fullWidth:!0,margin:"dense",required:j.rallyMemberRequired&&((l=x.find(i=>i.id===b))==null?void 0:l.pointUnitType)==="メンバー",disabled:!!le,children:[e.jsx(Re,{id:"bmem",children:`${D||"チームB"}メンバー`}),e.jsxs(ze,{labelId:"bmem",value:G,label:`${D||"チームB"}メンバー`,onChange:i=>xe(i.target.value),disabled:((I=x.find(i=>i.id===b))==null?void 0:I.pointUnitType)!=="メンバー",children:[e.jsx(oe,{value:"",children:e.jsx("em",{children:"なし"})}),r.map(i=>e.jsx(oe,{value:i.id,children:i.name},i.id))]})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(s,{sx:{display:"flex",gap:2,mt:1},children:[e.jsx(Xe,{orientation:"vertical",exclusive:!0,value:se,onChange:(i,m)=>{se===m||m===null?(re(""),B("")):(re(m),B(""))},disabled:!!le,sx:{flex:"1 1 25%"},children:y.filter(i=>i.visible!==!1).map(i=>e.jsx(qe,{value:i.id,sx:{whiteSpace:"nowrap"},children:i.name},i.id))}),e.jsx(Xe,{orientation:"vertical",exclusive:!0,value:ee,onChange:(i,m)=>{B(ee===m||m===null?"":m)},disabled:!!le,sx:{flex:"1 1 25%"},children:x.filter(i=>i.playCategoryId===se&&i.visible!==!1).map(i=>{const m=i.pointType==="得点"?h.scoreColor:h.lossColor;return e.jsx(qe,{value:i.id,sx:{whiteSpace:"nowrap",color:m,"&.Mui-selected":{color:m}},children:i.name},i.id)})}),e.jsx(Xe,{orientation:"vertical",exclusive:!0,value:f,onChange:(i,m)=>{f===m||m===null?(te(""),k("")):(te(m),k(""))},disabled:!!le,sx:{flex:"1 1 25%"},children:y.filter(i=>i.visible!==!1).map(i=>e.jsx(qe,{value:i.id,sx:{whiteSpace:"nowrap"},children:i.name},i.id))}),e.jsx(Xe,{orientation:"vertical",exclusive:!0,value:b,onChange:(i,m)=>{k(b===m||m===null?"":m)},disabled:!!le,sx:{flex:"1 1 25%"},children:x.filter(i=>i.playCategoryId===f&&i.visible!==!1).map(i=>{const m=i.pointType==="得点"?h.scoreColor:h.lossColor;return e.jsx(qe,{value:i.id,sx:{whiteSpace:"nowrap",color:m,"&.Mui-selected":{color:m}},children:i.name},i.id)})})]}),e.jsxs(s,{sx:{display:"flex",gap:2,mt:1},children:[e.jsxs(_e,{fullWidth:!0,margin:"dense",required:j.rallyMemberRequired&&((E=x.find(i=>i.id===ee))==null?void 0:E.pointUnitType)==="メンバー",disabled:!!le,sx:{flex:1},children:[e.jsx(Re,{id:"amem",children:`${n||"チームA"}メンバー`}),e.jsxs(ze,{labelId:"amem",value:U,label:`${n||"チームA"}メンバー`,onChange:i=>X(i.target.value),disabled:((F=x.find(i=>i.id===ee))==null?void 0:F.pointUnitType)!=="メンバー",children:[e.jsx(oe,{value:"",children:e.jsx("em",{children:"なし"})}),c.map(i=>e.jsx(oe,{value:i.id,children:i.name},i.id))]})]}),e.jsxs(_e,{fullWidth:!0,margin:"dense",required:j.rallyMemberRequired&&((_=x.find(i=>i.id===b))==null?void 0:_.pointUnitType)==="メンバー",disabled:!!le,sx:{flex:1},children:[e.jsx(Re,{id:"bmem",children:`${D||"チームB"}メンバー`}),e.jsxs(ze,{labelId:"bmem",value:G,label:`${D||"チームB"}メンバー`,onChange:i=>xe(i.target.value),disabled:((me=x.find(i=>i.id===b))==null?void 0:me.pointUnitType)!=="メンバー",children:[e.jsx(oe,{value:"",children:e.jsx("em",{children:"なし"})}),r.map(i=>e.jsx(oe,{value:i.id,children:i.name},i.id))]})]})]})]})]}),e.jsxs(lt,{children:[e.jsx(ue,{onClick:()=>V(!1),color:"inherit",startIcon:e.jsx(tt,{}),children:"キャンセル"}),e.jsx(ue,{onClick:H,disabled:!z(),startIcon:e.jsx(Ne,{}),children:"OK"})]})]})});var ls={},En=Ie;Object.defineProperty(ls,"__esModule",{value:!0});var ks=ls.default=void 0,Wn=En(Me()),Un=e;ks=ls.default=(0,Wn.default)((0,Un.jsx)("path",{d:"M16 17.01V10h-2v7.01h-3L15 21l4-3.99zM9 3 5 6.99h3V14h2V6.99h3zm7 14.01V10h-2v7.01h-3L15 21l4-3.99zM9 3 5 6.99h3V14h2V6.99h3z"}),"SwapVertOutlined");const Vn=d.forwardRef(function({teamAMembers:g,teamBMembers:x,onSave:y},c){const[r,n]=d.useState(!1),[D,j]=d.useState("teamA"),[h,M]=d.useState(""),[L,R]=d.useState(""),[P,O]=d.useState(null),Y=w=>{j(w),M(""),R(""),O(null),n(!0)},V=(w,ie,se,re)=>{j(ie),M(se),R(re),O(w),n(!0)};d.useImperativeHandle(c,()=>({openAddDialog:Y,openEditDialog:V}));const Q=()=>{n(!1),O(null)},Z=()=>{y(D,h,L,P),n(!1),O(null)};return e.jsxs(At,{open:r,onClose:Q,children:[e.jsx(it,{children:"選手交代"}),e.jsx(rt,{children:e.jsxs(s,{component:"form",sx:{mt:2},children:[e.jsxs(_e,{fullWidth:!0,sx:{mb:2},children:[e.jsx(Re,{id:"out-member",children:"OUT"}),e.jsx(ze,{labelId:"out-member",value:h,label:"OUT",onChange:w=>M(w.target.value),children:(D==="teamA"?g:x).map(w=>e.jsx(oe,{value:w.id,children:`${w.no}:${w.name}`},w.id))})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",mb:2},children:e.jsx(ks,{sx:{width:32,height:32}})}),e.jsxs(_e,{fullWidth:!0,children:[e.jsx(Re,{id:"in-member",children:"IN"}),e.jsx(ze,{labelId:"in-member",value:L,label:"IN",onChange:w=>R(w.target.value),children:(D==="teamA"?g:x).map(w=>e.jsx(oe,{value:w.id,children:`${w.no}:${w.name}`},w.id))})]})]})}),e.jsxs(lt,{children:[e.jsx(ue,{onClick:Q,color:"inherit",startIcon:e.jsx(tt,{}),children:"キャンセル"}),e.jsx(ue,{onClick:Z,disabled:!h||!L,startIcon:e.jsx(Ne,{}),children:"OK"})]})]})});function qn({open:t,onClose:g,scores:x,consecutive:y,connections:c,rowHeight:r}){const n=x.length*r,D=()=>{Cs(),g()};return e.jsx(bs,{anchor:"bottom",open:t,onClose:D,onOpen:()=>{},disableSwipeToOpen:!0,sx:{zIndex:j=>j.zIndex.drawer+3},ModalProps:{disableEnforceFocus:!0},PaperProps:{sx:{height:"60vh",borderTopLeftRadius:zt,borderTopRightRadius:zt}},children:e.jsxs(s,{sx:{position:"relative",height:"100%"},children:[e.jsx(s,{sx:{width:40,height:4,bgcolor:"text.secondary",borderRadius:2,position:"absolute",top:8,left:"50%",transform:"translateX(-50%)"}}),e.jsx(De,{onClick:D,sx:{position:"absolute",top:4,right:4},children:e.jsx(tt,{})}),e.jsx(s,{sx:{mt:4,height:"100%",overflowY:"auto"},children:e.jsxs(s,{sx:{flex:"0 0 100%",overflowY:"auto",height:"100%",position:"relative"},children:[x.map((j,h)=>{const M=h===0?{a:0,b:0}:x[h-1],L=j.a!==M.a&&j.a!==0,R=j.b!==M.b&&j.b!==0,P=L&&y[h],O=R&&y[h];return e.jsxs(s,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr 1fr",alignItems:"center",py:.5,height:`${r}px`,position:"relative",zIndex:1},children:[e.jsx(s,{}),e.jsxs(e.Fragment,{children:[e.jsx(s,{sx:{display:"flex",justifyContent:"center"},children:L?e.jsx(s,{sx:{width:32,height:32,border:"1px solid",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:24,borderColor:P?"red":"currentColor",backgroundColor:P?"#ffebee":"#fff",color:"black"},children:j.a}):null}),e.jsx(s,{}),e.jsx(s,{sx:{display:"flex",justifyContent:"center"},children:R?e.jsx(s,{sx:{width:32,height:32,border:"1px solid",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:24,borderColor:O?"red":"currentColor",backgroundColor:O?"#ffebee":"#fff",color:"black"},children:j.b}):null})]}),e.jsx(s,{})]},h)}),e.jsx("svg",{viewBox:`0 0 100 ${n}`,style:{position:"absolute",left:0,top:0,width:"100%",height:n,zIndex:0},preserveAspectRatio:"none",pointerEvents:"none",children:c.map(j=>{const h=j.index*r+r/2,M=(j.index+1)*r+r/2,L=j.from==="A"?30:70,R=j.from==="A"?70:30;return e.jsx("line",{x1:L,y1:h,x2:R,y2:M,stroke:"currentColor",strokeWidth:1},j.index)})})]})})]})})}var as={},Kn=Ie;Object.defineProperty(as,"__esModule",{value:!0});var _s=as.default=void 0,Jn=Kn(Me()),Nn=e;_s=as.default=(0,Jn.default)((0,Nn.jsx)("path",{d:"M3 18h18v-2H3zm0-5h18v-2H3zm0-7v2h18V6z"}),"Menu");function Gn({open:t,onClose:g,teamAName:x,teamBName:y,disableTimeoutA:c,disableTimeoutB:r,showScoreProgressButton:n,onShowScoreProgress:D,onSubstitution:j,onTimeout:h,onAddRally:M,locked:L}){const R=()=>{Cs(),g()},P=V=>()=>{V(),R()},Y=dt("sm")?"vertical":"horizontal";return e.jsx(bs,{anchor:"bottom",open:t,onClose:R,onOpen:()=>{},sx:{zIndex:V=>V.zIndex.drawer+2},ModalProps:{disableEnforceFocus:!0},disableSwipeToOpen:L,PaperProps:{sx:{height:"auto",maxHeight:"80vh",borderTopLeftRadius:zt,borderTopRightRadius:zt}},children:e.jsx(s,{sx:{p:2},children:e.jsxs(qs,{spacing:2,children:[n&&e.jsx(ue,{fullWidth:!0,variant:"outlined",onClick:P(D),children:"得点推移表示"}),e.jsxs(ms,{fullWidth:!0,orientation:Y,children:[e.jsx(ue,{onClick:P(()=>j("teamA")),children:(x||"チームA")+" メンバー交代"}),e.jsx(ue,{onClick:P(()=>j("teamB")),children:(y||"チームB")+" メンバー交代"})]}),e.jsxs(ms,{fullWidth:!0,orientation:Y,children:[e.jsx(ue,{disabled:c,onClick:P(()=>h("teamA")),children:(x||"チームA")+" タイムアウト"}),e.jsx(ue,{disabled:r,onClick:P(()=>h("teamB")),children:(y||"チームB")+" タイムアウト"})]}),e.jsx(ue,{fullWidth:!0,variant:"contained",onClick:P(M),children:"ラリー結果追加"})]})})})}var os={},Yn=Ie;Object.defineProperty(os,"__esModule",{value:!0});var Rs=os.default=void 0,Xn=Yn(Me()),Qn=e;Rs=os.default=(0,Xn.default)((0,Qn.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8m.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"}),"AccessTimeOutlined");var ds={},Zn=Ie;Object.defineProperty(ds,"__esModule",{value:!0});var zs=ds.default=void 0,ei=Zn(Me()),ti=e;zs=ds.default=(0,ei.default)((0,ti.jsx)("path",{d:"M6.99 11 3 15l3.99 4v-3H14v-2H6.99zM21 9l-3.99-4v3H10v2h7.01v3z"}),"SwapHorizOutlined");function si({teamAName:t,teamBName:g,locked:x,disableTimeoutA:y,disableTimeoutB:c,onTimeout:r,onSubstitution:n,onAddRally:D}){const j=Mt(),[h,M]=d.useState(!1),[L,R]=d.useState(!1),P=Ss,[O,Y]=d.useState(()=>!localStorage.getItem(P));return x?null:e.jsxs(ys,{children:[e.jsxs(Wt,{ariaLabel:"substitution actions",direction:"left",icon:e.jsx(zs,{}),onOpen:()=>R(!0),onClose:()=>R(!1),open:L,FabProps:{size:"large"},sx:{position:"fixed",right:35,bottom:200,zIndex:V=>V.zIndex.drawer-1},children:[e.jsx($t,{icon:e.jsx(e.Fragment,{children:g||"チームB"}),tooltipTitle:"",FabProps:{variant:"extended",size:"small"},onClick:()=>{n("teamB"),R(!1)}}),e.jsx($t,{icon:e.jsx(e.Fragment,{children:t||"チームA"}),tooltipTitle:"",FabProps:{variant:"extended",size:"small"},onClick:()=>{n("teamA"),R(!1)}})]}),e.jsxs(Wt,{ariaLabel:"timeout actions",direction:"left",icon:e.jsx(Rs,{}),onOpen:()=>M(!0),onClose:()=>M(!1),open:h,FabProps:{size:"large"},sx:{position:"fixed",right:35,bottom:140,zIndex:V=>V.zIndex.drawer-1},children:[e.jsx($t,{icon:e.jsx(e.Fragment,{children:g||"チームB"}),tooltipTitle:"",FabProps:{variant:"extended",size:"small",disabled:c},onClick:()=>{r("teamB"),M(!1)}}),e.jsx($t,{icon:e.jsx(e.Fragment,{children:t||"チームA"}),tooltipTitle:"",FabProps:{variant:"extended",size:"small",disabled:y},onClick:()=>{r("teamA"),M(!1)}})]}),e.jsx(Ee,{open:O,onClose:()=>Y(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"left",TransitionComponent:We,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${j.palette.text.secondary}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${j.palette.text.secondary}`}}}},title:e.jsxs(s,{sx:{p:1,maxWidth:260},children:[e.jsx(Fe,{variant:"body2",sx:{whiteSpace:"pre-line"},children:Ze.addRally.text}),e.jsx(s,{sx:{textAlign:"right",mt:1},children:e.jsx(Qe,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem(P,"1"),Y(!1)},children:"了解した"})})]}),children:e.jsx(Wt,{ariaLabel:"rally actions",direction:"left",icon:e.jsx(Lt,{}),FabProps:{size:"large",onClick:D},sx:{position:"fixed",right:35,bottom:80,zIndex:V=>V.zIndex.drawer-1}})})]})}function ni({isMobile:t,openActionMenu:g,onOpenActionMenu:x,onCloseActionMenu:y,teamAName:c,teamBName:r,disableTimeoutA:n,disableTimeoutB:D,showScoreProgressButton:j,onShowScoreProgress:h,onSubstitution:M,onTimeout:L,onAddRally:R,locked:P}){const O=Mt(),Y=Ss,[V,Q]=d.useState(()=>t&&!localStorage.getItem(Y));return e.jsxs(e.Fragment,{children:[!P&&t&&e.jsx(ys,{children:e.jsx(Ee,{open:V,onClose:()=>Q(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"top-start",TransitionComponent:We,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${O.palette.text.secondary}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${O.palette.text.secondary}`}}}},title:e.jsxs(s,{sx:{p:1,maxWidth:260},children:[e.jsx(Fe,{variant:"body2",sx:{whiteSpace:"pre-line"},children:Ze.addRally.text}),e.jsx(s,{sx:{textAlign:"right",mt:1},children:e.jsx(Qe,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem(Y,"1"),Q(!1)},children:"了解した"})})]}),children:e.jsx(Ks,{color:"primary",onClick:x,sx:{position:"fixed",right:35,bottom:Z=>`calc(${Z.spacing(7)} + env(safe-area-inset-bottom) + 16px)`,zIndex:Z=>Z.zIndex.drawer+2},children:e.jsx(_s,{})})})}),t?e.jsx(Gn,{open:g,onClose:y,teamAName:c,teamBName:r,disableTimeoutA:n,disableTimeoutB:D,showScoreProgressButton:j,onShowScoreProgress:h,onSubstitution:M,onTimeout:L,onAddRally:R,locked:P}):e.jsx(si,{teamAName:c,teamBName:r,locked:P,disableTimeoutA:n,disableTimeoutB:D,onSubstitution:M,onTimeout:L,onAddRally:R})]})}var cs={},ii=Ie;Object.defineProperty(cs,"__esModule",{value:!0});var Rt=cs.default=void 0,ri=ii(Me()),li=e;Rt=cs.default=(0,ri.default)((0,li.jsx)("path",{d:"M16.01 11H4v2h12.01v3L20 12l-3.99-4z"}),"ArrowRightAlt");var us={},ai=Ie;Object.defineProperty(us,"__esModule",{value:!0});var Fs=us.default=void 0,oi=ai(Me()),di=e;Fs=us.default=(0,oi.default)((0,di.jsx)("path",{d:"m12 4-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"}),"ArrowForward");function ci(t){if(typeof window>"u")return t;try{const x=new DOMParser().parseFromString(t,"image/svg+xml"),y=new Set(["svg","g","path","circle","rect","line","polygon","polyline","text","defs","use"]),c=r=>{[...r.children].forEach(n=>{if(y.has(n.tagName))[...n.attributes].forEach(D=>{D.name.startsWith("on")&&n.removeAttribute(D.name)}),c(n);else{const D=document.createTextNode(n.outerHTML);n.replaceWith(D)}})};return c(x.documentElement),x.documentElement.outerHTML}catch{return""}}function ui({name:t}){const g=d.useRef(null),[x,y]=d.useState(1);return d.useEffect(()=>{const c=g.current;if(!c)return;const r=c.getBBox().width;y(r>64?64/r:1)},[t]),e.jsx("svg",{width:64,height:64,children:e.jsx("g",{transform:`scale(${x})`,children:e.jsx("text",{ref:g,x:32/x,y:32/x,textAnchor:"middle",dominantBaseline:"central",fontSize:8,children:t})})})}function xi({category:t,borderColor:g}){const x=g?{border:"1px solid",borderColor:g,boxSizing:"border-box"}:{};return t.iconType==="svg"&&t.svg?e.jsx(s,{sx:{width:64,height:64,...x},dangerouslySetInnerHTML:{__html:ci(t.svg)}}):t.iconType==="image"&&t.image?e.jsx(s,{component:"img",src:t.image,sx:{width:64,height:64,objectFit:"none",objectPosition:`-${t.cropX||0}px -${t.cropY||0}px`,...x}}):e.jsx(s,{sx:{width:64,height:64,display:"flex",...x},children:e.jsx(ui,{name:t.name})})}function hi({rallies:t,playDetails:g,playCategories:x,teamAMembers:y,teamBMembers:c,teamAName:r,teamBName:n,serveCategory:D,showRallyIcons:j,locked:h,isMobile:M,isPhone:L,scores:R,scoredTeam:P,showRallyHint:O,onCloseRallyHint:Y,onEditRally:V,onEditSubstitution:Q,onDelete:Z,onDragEnd:w}){const ie=Mt(),{handleTouchEnd:se,setSwiperRef:re,getSwiperRef:f}=Nt(2),te=d.useRef({}),[ee,B]=d.useState({}),[b,k]=d.useState("");d.useLayoutEffect(()=>{const u={};t.forEach(C=>{const z=te.current[C.id];z&&(u[C.id]=z.offsetHeight)}),B(u)},[t]),d.useEffect(()=>{t.forEach(u=>{const C=f(u.id);C&&(C.allowTouchMove=!h,h&&C.slideTo(0))})},[h,t,f]);const U=u=>{if(!u)return;const C=g.find(z=>z.id===u);return x.find(z=>z.id===(C==null?void 0:C.playCategoryId))},X=(u,C)=>{if(!C)return"－";const J=(u==="teamA"?y:c).find(H=>H.id===C);return J?`${J.no}:${J.name}`:"－"},G=u=>{const C=R[u]||{a:0,b:0},z=P[u],J=ie.palette.text.primary,H=ie.palette.mode==="dark"?"#343A42":"#D3D3D3";return e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{color:z==="A"?J:H},children:String(C.a).padStart(2,"0")}),e.jsx("span",{style:{color:H},children:" - "}),e.jsx("span",{style:{color:z==="B"?J:H},children:String(C.b).padStart(2,"0")})]})},xe=(u,C,z)=>{var l;if(!u)return e.jsx(e.Fragment,{});const J=U(u),H=g.find(I=>I.id===u),Ae=z==="A"?y:c,a=(H==null?void 0:H.pointType)==="得点"?ie.palette.success.main:(H==null?void 0:H.pointType)==="失点"?ie.palette.error.main:void 0;return e.jsxs(s,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[J?e.jsx(Ue,{label:J.name,size:"small",variant:"outlined",sx:{bgcolor:"transparent",color:J.color,borderColor:J.color,mb:.5,height:20,fontSize:"0.75rem","& .MuiChip-label":{px:.5}}}):null,H?e.jsx(Ue,{label:H.name,size:"small",sx:{bgcolor:a,color:"common.white",mb:.5,height:20,fontSize:"0.75rem","& .MuiChip-label":{px:.5}}}):null,!L&&e.jsx(Fe,{variant:"caption",noWrap:!0,sx:{width:"100%",textAlign:"center"},children:(H==null?void 0:H.pointUnitType)==="メンバー"&&((l=Ae.find(I=>I.id===C))==null?void 0:l.name)||"－"})]})},le=(u,C,z)=>e.jsx(s,{ref:z.innerRef,...z.draggableProps,"data-index":C,sx:{mb:.5},children:e.jsxs(Ft,{onSwiper:J=>re(u.id,J),threshold:20,slidesPerView:"auto",style:{overflow:"hidden",height:ee[u.id]},onTouchStart:(J,H)=>H.stopPropagation(),onTouchEnd:J=>se(u.id,J),children:[e.jsx(Ve,{style:{width:"100%",flex:"0 0 auto"},children:(()=>{const J=z.dragHandleProps,{onPointerDown:H,...Ae}=J||{},a=Ht(l=>{if(H==null||H(l),!H)return;const I=f(u.id);I&&(I.allowTouchMove=!1),k(u.id)});return e.jsx(s,{ref:l=>{te.current[u.id]=l},...Ae,...a,sx:{display:"grid",gridTemplateColumns:"38% 24% 38%",alignItems:"center",cursor:h?"default":"grab",touchAction:b===u.id?"none":"pan-y",backgroundColor:l=>u.timeoutTeam||u.substitutionTeam?l.palette.mode==="dark"?"#343A42":"#f5f5f5":void 0},children:u.timeoutTeam?e.jsxs(s,{gridColumn:"1 / 4",sx:{...Ke,display:"flex",justifyContent:"center",alignItems:"center",height:"100%",minHeight:44},children:[u.timeoutTeam==="teamA"?r||"チームA":n||"チームB","タイムアウト"]}):u.substitutionTeam?e.jsxs(s,{gridColumn:"1 / 4",sx:{...Ke,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100%"},children:[e.jsxs("span",{children:[u.substitutionTeam==="teamA"?r||"チームA":n||"チームB","選手交代"]}),e.jsxs(s,{sx:{display:"flex",alignItems:"center",mt:.5},children:[e.jsx("span",{children:X(u.substitutionTeam,u.outMember)}),e.jsx(Rt,{fontSize:"small",sx:{mx:1}}),e.jsx("span",{children:X(u.substitutionTeam,u.inMember)})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(s,{children:xe(u.teamAPlayDetail,u.teamAMember,"A")}),e.jsxs(s,{sx:{fontSize:"2em",display:"flex",justifyContent:"center",flexDirection:"column",alignItems:"center"},children:[e.jsx(s,{sx:{whiteSpace:"nowrap"},children:G(C)}),u.serverTeam&&e.jsx(Fs,{sx:{width:"calc(100% - 8px)",height:20,mx:"4px",transform:u.serverTeam==="teamB"?"scaleX(-1)":void 0}})]}),e.jsx(s,{children:xe(u.teamBPlayDetail,u.teamBMember,"B")})]})})})()}),e.jsx(Ve,{style:{width:ut,flex:"0 0 auto"},children:e.jsx(s,{sx:{height:ee[u.id],display:"flex",alignItems:"center",justifyContent:"center",bgcolor:h?"grey.500":"primary.main"},children:e.jsx(De,{size:"small",disabled:h||!!u.timeoutTeam,onClick:h||u.timeoutTeam?void 0:()=>u.substitutionTeam?Q(C):V(C),children:e.jsx(Kt,{fontSize:"small",sx:{color:"common.white"}})})})}),e.jsx(Ve,{style:{width:ut,flex:"0 0 auto"},children:e.jsx(s,{sx:{height:ee[u.id],display:"flex",alignItems:"center",justifyContent:"center",bgcolor:h?"grey.500":"error.main"},children:e.jsx(De,{size:"small",disabled:h,onClick:h?void 0:()=>Z(C),children:e.jsx(st,{fontSize:"small",sx:{color:"common.white"}})})})})]})}),he=(u,C)=>{var z;return e.jsxs(s,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[j&&(D?e.jsx(xi,{category:D}):e.jsxs("svg",{width:64,height:64,children:[e.jsx("rect",{width:64,height:64,fill:"none",stroke:"currentColor"}),e.jsx("text",{x:"50%",y:"50%",textAnchor:"middle",dominantBaseline:"central",fontSize:"12",children:"サーブ"})]})),e.jsx(Fe,{variant:"caption",noWrap:!0,sx:{width:"100%",textAlign:"center"},children:((z=(u==="teamA"?y:c).find(J=>J.id===C))==null?void 0:z.name)||"－"})]})},ye=(u,C,z)=>e.jsx(s,{ref:z.innerRef,...z.draggableProps,"data-index":C,sx:{mb:.5},children:e.jsxs(Ft,{onSwiper:J=>re(u.id,J),threshold:20,slidesPerView:"auto",style:{overflow:"hidden",height:ee[u.id]},onTouchStart:(J,H)=>H.stopPropagation(),onTouchEnd:J=>se(u.id,J),children:[e.jsx(Ve,{style:{width:"100%",flex:"0 0 auto"},children:(()=>{const J=z.dragHandleProps,{onPointerDown:H,...Ae}=J||{},a=Ht(l=>{if(H==null||H(l),!H)return;const I=f(u.id);I&&(I.allowTouchMove=!1),k(u.id)});return e.jsx(s,{ref:l=>{te.current[u.id]=l},...Ae,...a,sx:{display:"grid",gridTemplateColumns:"16% 22% 24% 22% 16%",alignItems:"center",cursor:h?"default":"grab",touchAction:b===u.id?"none":"pan-y",backgroundColor:l=>u.timeoutTeam||u.substitutionTeam?l.palette.mode==="dark"?"#343A42":"#f5f5f5":void 0},children:u.timeoutTeam?e.jsxs(s,{gridColumn:"1 / 6",sx:{...Ke,display:"flex",justifyContent:"center",alignItems:"center",height:"100%",minHeight:44},children:[u.timeoutTeam==="teamA"?r||"チームA":n||"チームB","タイムアウト"]}):u.substitutionTeam?e.jsxs(s,{gridColumn:"1 / 6",sx:{...Ke,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100%"},children:[e.jsxs("span",{children:[u.substitutionTeam==="teamA"?r||"チームA":n||"チームB","選手交代"]}),e.jsxs(s,{sx:{display:"flex",alignItems:"center",mt:.5},children:[e.jsx("span",{children:X(u.substitutionTeam,u.outMember)}),e.jsx(Rt,{fontSize:"small",sx:{mx:1}}),e.jsx("span",{children:X(u.substitutionTeam,u.inMember)})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(s,{children:u.serverTeam==="teamA"?he("teamA",u.server):null}),e.jsx(s,{children:xe(u.teamAPlayDetail,u.teamAMember,"A")}),e.jsx(s,{sx:{fontSize:"2em",display:"flex",justifyContent:"center"},children:G(C)}),e.jsx(s,{children:xe(u.teamBPlayDetail,u.teamBMember,"B")}),e.jsx(s,{children:u.serverTeam==="teamB"?he("teamB",u.server):null})]})})})()}),e.jsx(Ve,{style:{width:ut,flex:"0 0 auto"},children:e.jsx(s,{sx:{height:ee[u.id],display:"flex",alignItems:"center",justifyContent:"center",bgcolor:h?"grey.500":"primary.main"},children:e.jsx(De,{size:"small",disabled:h||!!u.timeoutTeam,onClick:h||u.timeoutTeam?void 0:()=>u.substitutionTeam?Q(C):V(C),children:e.jsx(Kt,{fontSize:"small",sx:{color:"common.white"}})})})}),e.jsx(Ve,{style:{width:ut,flex:"0 0 auto"},children:e.jsx(s,{sx:{height:ee[u.id],display:"flex",alignItems:"center",justifyContent:"center",bgcolor:h?"grey.500":"error.main"},children:e.jsx(De,{size:"small",disabled:h,onClick:h?void 0:()=>Z(C),children:e.jsx(st,{fontSize:"small",sx:{color:"common.white"}})})})})]})}),we=u=>{if(b){const C=f(b);C&&(C.allowTouchMove=!0),k("")}w(u)};return e.jsx(Ee,{open:O&&M,onClose:Y,disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:We,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${ie.palette.text.secondary}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${ie.palette.text.secondary}`}}}},title:e.jsxs(s,{sx:{p:1,maxWidth:260},children:[e.jsx(Fe,{variant:"body2",sx:{whiteSpace:"pre-line"},children:Ze.rallyListRow.text}),e.jsx(s,{sx:{textAlign:"right",mt:1},children:e.jsx(Qe,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem("tutorial-rally-row","1"),Y()},children:"了解した"})})]}),children:e.jsx(s,{children:e.jsxs(It,{onDragEnd:we,children:[M&&e.jsx(xt,{component:et,storageKey:"set-tab",children:e.jsxs(s,{children:[e.jsx(s,{sx:{display:"grid",gridTemplateColumns:L?"38% 24% 38%":"16% 22% 24% 22% 16%",textAlign:"center",alignItems:"center",...Ke},children:L?e.jsxs(e.Fragment,{children:[e.jsxs(s,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("span",{children:r||"チームA"}),e.jsx("span",{children:"ラリー結果"})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:"得点"}),e.jsxs(s,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("span",{children:n||"チームB"}),e.jsx("span",{children:"ラリー結果"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(s,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("span",{children:r||"チームA"}),e.jsx("span",{children:"サーブ"})]}),e.jsxs(s,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("span",{children:r||"チームA"}),e.jsx("span",{children:"ラリー結果"})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:"得点"}),e.jsxs(s,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("span",{children:n||"チームB"}),e.jsx("span",{children:"ラリー結果"})]}),e.jsxs(s,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("span",{children:n||"チームB"}),e.jsx("span",{children:"サーブ"})]})]})}),e.jsx(at,{droppableId:"rallies",children:u=>e.jsxs(s,{ref:u.innerRef,...u.droppableProps,children:[t.map((C,z)=>e.jsx(ot,{draggableId:C.id,index:z,isDragDisabled:h,children:J=>(L?le:ye)(C,z,J)},C.id)),u.placeholder]})})]})}),!M&&e.jsx(xt,{component:et,storageKey:"set-tab",children:e.jsxs(jt,{size:"small",sx:{tableLayout:"fixed","& th, & td":{textAlign:"center",verticalAlign:"middle"}},children:[e.jsx(bt,{children:e.jsxs(Oe,{sx:{...Ke},children:[e.jsx(T,{sx:{width:"6%"}}),e.jsx(T,{sx:{width:"16%"},children:e.jsxs(s,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{children:r||"チームA"}),e.jsx("span",{children:"サーブ"})]})}),e.jsx(T,{sx:{width:"18%"},children:e.jsxs(s,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{children:r||"チームA"}),e.jsx("span",{children:"ラリー結果"})]})}),e.jsx(T,{sx:{width:"20%",display:"flex",justifyContent:"center",alignItems:"center"},children:"得点"}),e.jsx(T,{sx:{width:"18%"},children:e.jsxs(s,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{children:n||"チームB"}),e.jsx("span",{children:"ラリー結果"})]})}),e.jsx(T,{sx:{width:"16%"},children:e.jsxs(s,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{children:n||"チームB"}),e.jsx("span",{children:"サーブ"})]})}),e.jsx(T,{sx:{width:"6%"}})]})}),e.jsx(at,{droppableId:"rallies",children:u=>e.jsxs(yt,{ref:u.innerRef,...u.droppableProps,children:[t.map((C,z)=>e.jsx(ot,{draggableId:C.id,index:z,isDragDisabled:h,children:J=>e.jsxs(Oe,{ref:J.innerRef,...J.draggableProps,"data-index":z,onClick:()=>{h||(C.substitutionTeam?Q(z):C.timeoutTeam||V(z))},sx:{cursor:h||C.timeoutTeam?"default":"pointer",backgroundColor:H=>C.timeoutTeam||C.substitutionTeam?H.palette.mode==="dark"?"#343A42":"#f5f5f5":void 0},children:[e.jsx(T,{padding:"checkbox",sx:{width:"6%"},children:e.jsx(s,{onClick:H=>H.stopPropagation(),...J.dragHandleProps,sx:{cursor:h?"default":"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:e.jsx(Ot,{fontSize:"small"})})}),C.timeoutTeam?e.jsx(T,{colSpan:5,sx:{width:"88%"},children:e.jsxs(s,{sx:{...Ke,display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:[C.timeoutTeam==="teamA"?r||"チームA":n||"チームB","タイムアウト"]})}):C.substitutionTeam?e.jsx(T,{colSpan:5,sx:{width:"88%"},children:e.jsxs(s,{sx:{...Ke,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100%"},children:[e.jsxs("span",{children:[C.substitutionTeam==="teamA"?r||"チームA":n||"チームB","選手交代"]}),e.jsxs(s,{sx:{display:"flex",alignItems:"center",mt:.5},children:[e.jsx("span",{children:X(C.substitutionTeam,C.outMember)}),e.jsx(Rt,{fontSize:"small",sx:{mx:1}}),e.jsx("span",{children:X(C.substitutionTeam,C.inMember)})]})]})}):e.jsxs(e.Fragment,{children:[e.jsx(T,{sx:{width:"16%"},children:C.serverTeam==="teamA"?he("teamA",C.server):null}),e.jsx(T,{sx:{width:"18%"},children:xe(C.teamAPlayDetail,C.teamAMember,"A")}),e.jsx(T,{sx:{width:"20%",fontSize:"2em",textAlign:"center"},children:G(z)}),e.jsx(T,{sx:{width:"18%"},children:xe(C.teamBPlayDetail,C.teamBMember,"B")}),e.jsx(T,{sx:{width:"16%"},children:C.serverTeam==="teamB"?he("teamB",C.server):null})]}),e.jsx(T,{padding:"checkbox",sx:{width:"6%"},children:e.jsx(s,{onClick:H=>H.stopPropagation(),sx:{width:32,height:32,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:e.jsx(De,{size:"small",onClick:h?void 0:()=>Z(z),disabled:h,sx:{width:24,height:24},children:e.jsx(st,{fontSize:"small",color:h?"disabled":"error"})})})})]})},C.id)),u.placeholder]})})]})})]})})})}function mi({scores:t,consecutive:g,connections:x,rowHeight:y}){const c=t.length*y;return e.jsxs(s,{sx:{flex:"0 0 20%",overflowY:"auto",height:"100%",position:"relative"},children:[t.map((r,n)=>{const D=n===0?{a:0,b:0}:t[n-1],j=r.a!==D.a&&r.a!==0,h=r.b!==D.b&&r.b!==0,M=j&&g[n],L=h&&g[n];return e.jsxs(s,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr 1fr",alignItems:"center",py:.5,height:`${y}px`,position:"relative",zIndex:1},children:[e.jsx(s,{}),e.jsxs(e.Fragment,{children:[e.jsx(s,{sx:{display:"flex",justifyContent:"center"},children:j?e.jsx(s,{sx:{width:32,height:32,border:"1px solid",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:24,borderColor:M?"red":"currentColor",backgroundColor:M?"#ffebee":"#fff",color:"black"},children:r.a}):null}),e.jsx(s,{}),e.jsx(s,{sx:{display:"flex",justifyContent:"center"},children:h?e.jsx(s,{sx:{width:32,height:32,border:"1px solid",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:24,borderColor:L?"red":"currentColor",backgroundColor:L?"#ffebee":"#fff",color:"black"},children:r.b}):null})]}),e.jsx(s,{})]},n)}),e.jsx("svg",{viewBox:`0 0 100 ${c}`,style:{position:"absolute",left:0,top:0,width:"100%",height:c,zIndex:0},preserveAspectRatio:"none",pointerEvents:"none",children:x.map(r=>{const n=r.index*y+y/2,D=(r.index+1)*y+y/2,j=r.from==="A"?30:70,h=r.from==="A"?70:30;return e.jsx("line",{x1:j,y1:n,x2:h,y2:D,stroke:"currentColor",strokeWidth:1},r.index)})})]})}function pi({setScore:t,playDetails:g,playCategories:x,teamAMembers:y,teamBMembers:c,teamAName:r,teamBName:n,onChange:D,locked:j=!1,scoreInputSetting:h,themeSetting:M,showSnackbar:L}){const[R,P]=d.useState(!1),[O,Y]=d.useState(!1),{addRally:V,deleteRally:Q,calculateScores:Z}=Hn(t,g,D),w=d.useRef(null),ie=d.useRef(null),se=dt("md"),re=dt("sm"),f=!re&&h.showRallyIcons,te=!se&&h.showScoreProgressArea,ee=se&&h.showScoreProgressArea,[B,b]=d.useState(!1),k=x.find(p=>p.id==="init-serve"),U=t.rallies.filter(p=>p.timeoutTeam==="teamA").length,X=t.rallies.filter(p=>p.timeoutTeam==="teamB").length,G=U>=2,xe=X>=2,le=p=>{if(!p.destination||j)return;const A=Array.from(t.rallies),[W]=A.splice(p.source.index,1);A.splice(p.destination.index,0,W);const pe={...t,rallies:A};Z(pe),D(pe)},he=p=>{if(j)return;const A={...t,rallies:[...t.rallies]};Q(p),L("ラリーを削除しました","success",{actionLabel:"元に戻す",onAction:()=>{const W={...A,rallies:[...A.rallies]};Z(W),D(W)},autoHideDuration:5e3})},ye=p=>{const A=!localStorage.getItem("tutorial-rally-row");V(p),se&&A&&P(!0)},we=(p,A)=>{const W=[...t.rallies];W[p]=A;const pe={...t,rallies:W};Z(pe),D(pe)},u=p=>{if(j||p==="teamA"&&G||p==="teamB"&&xe)return;const A=!localStorage.getItem("tutorial-rally-row");V({id:crypto.randomUUID(),timeoutTeam:p}),se&&A&&P(!0)},C=p=>{var A;j||(A=w.current)==null||A.openAddDialog(p)},z=p=>{var W;if(j)return;const A=t.rallies[p];A.substitutionTeam&&((W=w.current)==null||W.openEditDialog(p,A.substitutionTeam,A.outMember||"",A.inMember||""))},J=(p,A,W,pe)=>{const Se=!localStorage.getItem("tutorial-rally-row"),v=[...t.rallies];pe!==null?v[pe]={...v[pe],substitutionTeam:p,outMember:A,inMember:W}:v.push({id:crypto.randomUUID(),substitutionTeam:p,outMember:A,inMember:W});const S={...t,rallies:v};Z(S),D(S),se&&Se&&P(!0)},H=[],Ae=[],a=[],l=[];let I=0,E=0,F=0,_=0;t.rallies.forEach(p=>{const A=g.find(Se=>Se.id===p.teamAPlayDetail),W=g.find(Se=>Se.id===p.teamBPlayDetail);let pe=null;(A==null?void 0:A.pointType)==="得点"||(W==null?void 0:W.pointType)==="失点"?(I+=1,F+=1,pe="A"):((W==null?void 0:W.pointType)==="得点"||(A==null?void 0:A.pointType)==="失点")&&(E+=1,_+=1,pe="B"),!p.timeoutTeam&&!p.substitutionTeam&&(l.push(pe),a.push({a:F,b:_})),Ae.push(p.timeoutTeam||p.substitutionTeam?null:pe),H.push({a:I,b:E})});const me=40,i=[];for(let p=0;p<l.length-1;p++){const A=l[p],W=l[p+1];A&&W&&A!==W&&i.push({from:A,index:p})}const m=l.map((p,A)=>p!==null&&A>0&&p===l[A-1]);return e.jsxs(s,{sx:{position:"relative",display:"flex",flexDirection:"column",height:"100%"},children:[e.jsxs(s,{sx:{display:"flex",gap:2,flex:1,minHeight:0},children:[te&&e.jsx(mi,{scores:a,consecutive:m,connections:i,rowHeight:me}),e.jsx(s,{sx:{flex:1,overflowY:"auto",height:"100%",maxWidth:1024,width:"100%",mx:"auto",mb:2},children:e.jsx(hi,{rallies:t.rallies,playDetails:g,playCategories:x,teamAMembers:y,teamBMembers:c,teamAName:r,teamBName:n,serveCategory:k,showRallyIcons:f,locked:j,isMobile:se,isPhone:re,scores:H,scoredTeam:Ae,showRallyHint:R,onCloseRallyHint:()=>P(!1),onEditRally:p=>{var A;return(A=ie.current)==null?void 0:A.openEditDialog(p)},onEditSubstitution:z,onDelete:he,onDragEnd:le})})]}),ee&&e.jsx(qn,{open:B,onClose:()=>b(!1),scores:a,consecutive:m,connections:i,rowHeight:me}),e.jsx(ni,{isMobile:se,openActionMenu:O,onOpenActionMenu:()=>Y(!0),onCloseActionMenu:()=>Y(!1),teamAName:r,teamBName:n,disableTimeoutA:G,disableTimeoutB:xe,showScoreProgressButton:h.showScoreProgressArea,onShowScoreProgress:()=>b(!0),onSubstitution:C,onTimeout:u,onAddRally:()=>{var p;return(p=ie.current)==null?void 0:p.openAddDialog()},locked:j}),e.jsx(Ln,{ref:ie,setScore:t,playDetails:g,playCategories:x,teamAMembers:y,teamBMembers:c,teamAName:r,teamBName:n,scoreInputSetting:h,themeSetting:M,locked:j,onAdd:ye,onEdit:we}),e.jsx(Vn,{ref:w,teamAMembers:y,teamBMembers:c,onSave:J})]})}const fi=()=>typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():Math.random().toString(36).slice(2)+Date.now().toString(36);function gi({statsSettings:t,onChange:g,playCategories:x,playDetails:y,rallyCategoryTags:c,rallyDetailTags:r,disabled:n,showSnackbar:D}){const j=a=>{if(ye){const E=he(ye);E&&(E.allowTouchMove=!0),we("")}if(!a.destination)return;const l=Array.from(t),[I]=l.splice(a.source.index,1);l.splice(a.destination.index,0,I),g(l)},h=a=>{var l;return((l=x.find(I=>I.id===a))==null?void 0:l.name)||""},M=a=>{var l;return((l=y.find(I=>I.id===a))==null?void 0:l.name)||""},L=a=>{const l=a.playCategoryId?h(a.playCategoryId):a.playCategoryTags?a.playCategoryTags.map(me=>{var i;return((i=c.find(m=>m.id===me))==null?void 0:i.name)||me}).join(", "):"",I=a.playDetailId?M(a.playDetailId):a.playDetailTags?a.playDetailTags.map(me=>{var i;return((i=r.find(m=>m.id===me))==null?void 0:i.name)||me}).join(", "):"",E=a.pointType||"",F=a.pointUnitType||"",_=a.aggregateType||"合算";return[l,I,E,F,_].filter(me=>me).join(", ")},[R,P]=d.useState(!1),[O,Y]=d.useState(null),[V,Q]=d.useState(""),[Z,w]=d.useState(""),[ie,se]=d.useState([]),[re,f]=d.useState([]),[te,ee]=d.useState(""),[B,b]=d.useState(""),[k,U]=d.useState("合算"),X=dt("md"),G=dt("sm"),{handleTouchEnd:xe,setSwiperRef:le,getSwiperRef:he}=Nt(2),[ye,we]=d.useState(""),u=()=>{n||(Y(-1),Q(""),w(""),se([]),f([]),ee(""),b(""),U("合算"),P(!0))},C=a=>{if(n)return;const l=t[a];Y(a),Q(l.playCategoryId||""),w(l.playDetailId||""),se(l.playCategoryTags||[]),f(l.playDetailTags||[]),ee(l.pointType||""),b(l.pointUnitType||""),U(l.aggregateType||"合算"),P(!0)},z=()=>{const a=V!=="",l=Z!=="",I=ie.length>0,E=re.length>0,F=te!=="",_=B!=="";return a&&!l&&!I&&!E&&!F&&!_||a&&l&&!I&&!E&&!F&&!_||a&&!l&&!I&&!E&&F&&!_||a&&!l&&!I&&!E&&!F&&_||a&&!l&&!I&&!E&&F&&_||!a&&!l&&!I&&!E&&F&&!_||!a&&!l&&!I&&!E&&F&&_||!a&&!l&&!I&&!E&&!F&&_||I&&!a&&!l&&!E&&!F&&!_||I&&E&&!a&&!l&&!F&&!_||I&&E&&!a&&!l&&F&&!_||I&&E&&!a&&!l&&!F&&_||I&&E&&!a&&!l&&F&&_||I&&!a&&!l&&F&&!_||I&&!a&&!l&&!F&&_||I&&!a&&!l&&F&&_||E&&!a&&!l&&!I&&!F&&!_||E&&!a&&!l&&!I&&F&&!_||E&&!a&&!l&&!I&&!F&&_||E&&!a&&!l&&!I&&F&&_},J=()=>{const a={id:O===-1?fi():t[O].id,playCategoryId:V||void 0,playDetailId:Z||void 0,playCategoryTags:V===""&&ie.length>0?ie:void 0,playDetailTags:Z===""&&re.length>0?re:void 0,pointType:Z?void 0:te||void 0,pointUnitType:Z?void 0:B||void 0,aggregateType:k};O===-1?g([...t,a]):O!==null&&g(t.map((l,I)=>I===O?a:l)),P(!1)},H=()=>{P(!1)},Ae=a=>{if(n)return;const l=[...t];g(t.filter((I,E)=>E!==a)),D("スタッツ設定を削除しました","success",{actionLabel:"元に戻す",onAction:()=>g(l),autoHideDuration:5e3})};return e.jsxs(s,{children:[e.jsxs(s,{sx:{maxWidth:1024,mx:"auto",display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(s,{sx:{fontWeight:"bold"},children:"スタッツ設定"}),e.jsx(ue,{onClick:u,variant:"contained",size:"medium",startIcon:e.jsx(Lt,{}),disabled:n,children:"追加"})]}),e.jsx(xt,{component:et,storageKey:"match-stats-grid",sx:{maxWidth:1024,mx:"auto"},children:X?e.jsx(It,{onDragEnd:j,children:e.jsx(at,{droppableId:"stats-settings",children:a=>e.jsxs(s,{ref:a.innerRef,...a.droppableProps,children:[e.jsx(s,{sx:{display:"grid",gridTemplateColumns:G?"1fr":"150px 1fr 110px 130px 110px",alignItems:"center",height:50,px:1,borderBottom:1,borderColor:"divider",...Ke},children:G?e.jsx(s,{children:"分析項目"}):e.jsxs(e.Fragment,{children:[e.jsx(s,{children:"プレー区分"}),e.jsx(s,{children:"プレー詳細"}),e.jsx(s,{children:"得点区分"}),e.jsx(s,{children:"得失点単位区分"}),e.jsx(s,{children:"集計方法"})]})}),t.map((l,I)=>e.jsx(ot,{draggableId:l.id,index:I,isDragDisabled:n,children:E=>{const F=E.dragHandleProps,{onPointerDown:_,...me}=F||{},i=Ht(m=>{_==null||_(m);const p=he(l.id);p&&(p.allowTouchMove=!1),we(l.id)});return e.jsx(s,{ref:E.innerRef,...E.draggableProps,style:E.draggableProps.style,children:e.jsxs(Ft,{onSwiper:m=>le(l.id,m),threshold:20,slidesPerView:"auto",style:{overflow:"hidden"},onTouchStart:(m,p)=>p.stopPropagation(),onTouchEnd:m=>xe(l.id,m),children:[e.jsx(Ve,{style:{width:"100%",flex:"0 0 auto"},children:e.jsx(s,{...me,...i,sx:{display:"grid",gridTemplateColumns:G?"1fr":"150px 1fr 110px 130px 110px",alignItems:"center",height:50,px:1,borderBottom:1,borderColor:"divider",bgcolor:"background.paper",cursor:n?"default":"grab",touchAction:ye===l.id?"none":"pan-y"},children:G?e.jsx(s,{children:L(l)}):e.jsxs(e.Fragment,{children:[e.jsx(s,{sx:{pr:1},children:l.playCategoryId?h(l.playCategoryId):l.playCategoryTags&&l.playCategoryTags.length>0?e.jsx(s,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:l.playCategoryTags.map(m=>{const p=c.find(A=>A.id===m);return e.jsx(Ue,{label:(p==null?void 0:p.name)||m,size:"small",sx:{backgroundColor:(p==null?void 0:p.color)||Je,color:"#fff"}},m)})}):""}),e.jsx(s,{sx:{pr:1},children:l.playDetailId?M(l.playDetailId):l.playDetailTags&&l.playDetailTags.length>0?e.jsx(s,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:l.playDetailTags.map(m=>{const p=r.find(A=>A.id===m);return e.jsx(Ue,{label:(p==null?void 0:p.name)||m,size:"small",sx:{backgroundColor:(p==null?void 0:p.color)||Je,color:"#fff"}},m)})}):""}),e.jsx(s,{sx:{pr:1},children:l.pointType||""}),e.jsx(s,{sx:{pr:1},children:l.pointUnitType||""}),e.jsx(s,{children:l.aggregateType||"合算"})]})})}),e.jsx(Ve,{style:{width:ut,flex:"0 0 auto"},children:e.jsx(s,{sx:{height:50,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"error.main"},children:e.jsx(De,{size:"small",onClick:()=>Ae(I),disabled:n,children:e.jsx(st,{fontSize:"small",sx:{color:"common.white"}})})})}),e.jsx(Ve,{style:{width:ut,flex:"0 0 auto"},children:e.jsx(s,{sx:{height:50,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"primary.main"},children:e.jsx(De,{size:"small",onClick:()=>C(I),disabled:n,children:e.jsx(Kt,{fontSize:"small",sx:{color:"common.white"}})})})})]})})}},l.id)),a.placeholder]})})}):e.jsxs(jt,{size:"small",children:[e.jsx(bt,{children:e.jsxs(Oe,{sx:{backgroundColor:a=>a.palette.mode==="dark"?"#343A42":"#f5f5f5",height:50},children:[e.jsx(T,{}),e.jsx(T,{children:"プレー区分"}),e.jsx(T,{children:"プレー詳細"}),e.jsx(T,{children:"得点区分"}),e.jsx(T,{children:"得失点単位区分"}),e.jsx(T,{children:"集計方法"}),e.jsx(T,{})]})}),e.jsx(It,{onDragEnd:j,children:e.jsx(at,{droppableId:"stats-settings",children:a=>e.jsxs(yt,{ref:a.innerRef,...a.droppableProps,children:[t.map((l,I)=>e.jsx(ot,{draggableId:l.id,index:I,isDragDisabled:n,children:E=>e.jsxs(Oe,{ref:E.innerRef,...E.draggableProps,onClick:()=>C(I),sx:{cursor:n?"default":"pointer",height:50},children:[e.jsx(T,{padding:"checkbox",sx:{width:48},children:e.jsx(s,{...E.dragHandleProps,onClick:F=>F.stopPropagation(),sx:{cursor:n?"default":"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:e.jsx(Ot,{})})}),e.jsx(T,{children:l.playCategoryId?h(l.playCategoryId):l.playCategoryTags&&l.playCategoryTags.length>0?e.jsx(s,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:l.playCategoryTags.map(F=>{const _=c.find(me=>me.id===F);return e.jsx(Ue,{label:(_==null?void 0:_.name)||F,size:"small",sx:{backgroundColor:(_==null?void 0:_.color)||Je,color:"#fff"}},F)})}):""}),e.jsx(T,{children:l.playDetailId?M(l.playDetailId):l.playDetailTags&&l.playDetailTags.length>0?e.jsx(s,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:l.playDetailTags.map(F=>{const _=r.find(me=>me.id===F);return e.jsx(Ue,{label:(_==null?void 0:_.name)||F,size:"small",sx:{backgroundColor:(_==null?void 0:_.color)||Je,color:"#fff"}},F)})}):""}),e.jsx(T,{children:l.pointType||""}),e.jsx(T,{children:l.pointUnitType||""}),e.jsx(T,{children:l.aggregateType||"合算"}),e.jsx(T,{padding:"checkbox",children:e.jsx(De,{size:"small",onClick:F=>{F.stopPropagation(),Ae(I)},disabled:n,children:e.jsx(st,{fontSize:"small"})})})]})},l.id)),a.placeholder]})})})]})}),e.jsxs(At,{open:R,onClose:H,children:[e.jsxs(it,{children:["スタッツ設定",O===-1?"追加":"編集"]}),e.jsxs(rt,{children:[e.jsxs(_e,{fullWidth:!0,margin:"dense",children:[e.jsx(Re,{id:"stat-category-label",children:"プレー区分"}),e.jsxs(ze,{labelId:"stat-category-label",value:V,label:"プレー区分",onChange:a=>{Q(a.target.value),w(""),se([]),f([])},disabled:ie.length>0||re.length>0,children:[e.jsx(oe,{value:"",children:"なし"}),x.map(a=>e.jsx(oe,{value:a.id,children:a.name},a.id))]})]}),e.jsxs(_e,{fullWidth:!0,margin:"dense",children:[e.jsx(Re,{id:"stat-detail-label",children:"プレー詳細"}),e.jsxs(ze,{labelId:"stat-detail-label",value:Z,label:"プレー詳細",onChange:a=>{w(a.target.value),ee(""),b(""),se([]),f([])},disabled:te!==""||B!==""||ie.length>0||re.length>0,children:[e.jsx(oe,{value:"",children:"なし"}),y.filter(a=>a.playCategoryId===V).map(a=>e.jsx(oe,{value:a.id,children:a.name},a.id))]})]}),e.jsx(qt,{multiple:!0,options:c,getOptionLabel:a=>a.name,value:c.filter(a=>ie.includes(a.id)),onChange:(a,l)=>{se(l.map(I=>I.id)),l.length>0&&(Q(""),w(""))},disabled:V!==""||Z!=="",renderTags:(a,l)=>a.map((I,E)=>{const{key:F,..._}=l({index:E});return e.jsx(Ue,{..._,label:I.name,size:"small",sx:{backgroundColor:I.color||Je,color:"#fff"}},F)}),renderInput:a=>e.jsx(Ce,{...a,label:"プレー区分タグ",margin:"dense"}),fullWidth:!0}),e.jsx(qt,{multiple:!0,options:r,getOptionLabel:a=>a.name,value:r.filter(a=>re.includes(a.id)),onChange:(a,l)=>{f(l.map(I=>I.id)),l.length>0&&(Q(""),w(""))},disabled:V!==""||Z!=="",renderTags:(a,l)=>a.map((I,E)=>{const{key:F,..._}=l({index:E});return e.jsx(Ue,{..._,label:I.name,size:"small",sx:{backgroundColor:I.color||Je,color:"#fff"}},F)}),renderInput:a=>e.jsx(Ce,{...a,label:"プレー詳細タグ",margin:"dense"}),fullWidth:!0}),e.jsxs(s,{children:[e.jsxs(_e,{fullWidth:!0,margin:"dense",children:[e.jsx(Re,{id:"stat-point-label",children:"得点区分"}),e.jsxs(ze,{labelId:"stat-point-label",value:te,label:"得点区分",onChange:a=>{ee(a.target.value),a.target.value!==""&&w("")},disabled:Z!=="",children:[e.jsx(oe,{value:"",children:"なし"}),e.jsx(oe,{value:"得点",children:"得点"}),e.jsx(oe,{value:"失点",children:"失点"})]})]}),e.jsxs(_e,{fullWidth:!0,margin:"dense",children:[e.jsx(Re,{id:"stat-unit-label",children:"得失点単位区分"}),e.jsxs(ze,{labelId:"stat-unit-label",value:B,label:"得失点単位区分",onChange:a=>{b(a.target.value),a.target.value!==""&&w("")},disabled:Z!=="",children:[e.jsx(oe,{value:"",children:"なし"}),e.jsx(oe,{value:"メンバー",children:"メンバー"}),e.jsx(oe,{value:"チーム",children:"チーム"})]})]})]}),e.jsxs(_e,{fullWidth:!0,margin:"dense",children:[e.jsx(Re,{id:"stat-aggregate-label",children:"集計方法"}),e.jsxs(ze,{labelId:"stat-aggregate-label",value:k,label:"集計方法",onChange:a=>U(a.target.value),children:[e.jsx(oe,{value:"合算",children:"合算"}),e.jsx(oe,{value:"セット平均",children:"セット平均"})]})]})]}),e.jsxs(lt,{children:[e.jsx(ue,{onClick:H,color:"inherit",startIcon:e.jsx(tt,{}),children:"キャンセル"}),e.jsx(ue,{onClick:J,disabled:!z(),startIcon:e.jsx(Ne,{}),children:"OK"})]})]})]})}function gs(t,g,x){var c,r;if(!t)return!1;const y=g.get(t.playCategoryId);return!(x.playDetailId&&t.id!==x.playDetailId||x.playCategoryId&&t.playCategoryId!==x.playCategoryId||x.playCategoryTags&&x.playCategoryTags.length>0&&!((c=y==null?void 0:y.tags)!=null&&c.some(n=>x.playCategoryTags.includes(n)))||x.playDetailTags&&x.playDetailTags.length>0&&!((r=t.tags)!=null&&r.some(n=>x.playDetailTags.includes(n)))||x.pointType&&t.pointType!==x.pointType||x.pointUnitType&&t.pointUnitType!==x.pointUnitType)}function js(t,g,x,y){const c=y.map(()=>({teamA:0,teamB:0}));return t.forEach(r=>{r.rallies.forEach(n=>{y.forEach((D,j)=>{const h=n.teamAPlayDetail?g.get(n.teamAPlayDetail):void 0;gs(h,x,D)&&(c[j].teamA+=1);const M=n.teamBPlayDetail?g.get(n.teamBPlayDetail):void 0;gs(M,x,D)&&(c[j].teamB+=1)})})}),c}function ji(t,g){const x=[];let y=0,c=0,r=0,n=0;return t.forEach(j=>{let h=0,M=0,L=0,R=0;j.rallies.forEach(P=>{if(P.timeoutTeam||P.substitutionTeam||!P.serverTeam)return;const O=P.teamAPlayDetail?g.get(P.teamAPlayDetail):void 0,Y=P.teamBPlayDetail?g.get(P.teamBPlayDetail):void 0;P.serverTeam==="teamA"?(M+=1,(O&&O.pointType==="得点"||Y&&Y.pointType==="失点")&&(h+=1)):(R+=1,(Y&&Y.pointType==="得点"||O&&O.pointType==="失点")&&(L+=1))}),y+=h,c+=M,r+=L,n+=R,x.push({teamA:M?`${Math.round(h/M*100)}%`:"-",teamB:R?`${Math.round(L/R*100)}%`:"-"})}),{overall:{teamA:c?`${Math.round(y/c*100)}%`:"-",teamB:n?`${Math.round(r/n*100)}%`:"-"},perSet:x}}function bi(t,g){const x=[];let y=0,c=0,r=0,n=0;return t.forEach(j=>{let h=0,M=0,L=0,R=0;j.rallies.forEach(P=>{if(P.timeoutTeam||P.substitutionTeam||!P.serverTeam)return;const O=P.teamAPlayDetail?g.get(P.teamAPlayDetail):void 0,Y=P.teamBPlayDetail?g.get(P.teamBPlayDetail):void 0;P.serverTeam==="teamB"?(M+=1,(O&&O.pointType==="得点"||Y&&Y.pointType==="失点")&&(h+=1)):(R+=1,(Y&&Y.pointType==="得点"||O&&O.pointType==="失点")&&(L+=1))}),y+=h,c+=M,r+=L,n+=R,x.push({teamA:M?`${Math.round(h/M*100)}%`:"-",teamB:R?`${Math.round(L/R*100)}%`:"-"})}),{overall:{teamA:c?`${Math.round(y/c*100)}%`:"-",teamB:n?`${Math.round(r/n*100)}%`:"-"},perSet:x}}function yi({sets:t,playDetails:g,playCategories:x,statsSettings:y,matchStatsSettings:c,onMatchStatsSettingsChange:r,rallyCategoryTags:n,rallyDetailTags:D,teamAName:j,teamBName:h,locked:M,showSnackbar:L}){const R=new Map(g.map(B=>[B.id,B])),P=new Map(x.map(B=>[B.id,B])),O=B=>{var b;return((b=x.find(k=>k.id===B))==null?void 0:b.name)||""},Y=B=>{var b;return((b=g.find(k=>k.id===B))==null?void 0:b.name)||""},V=[...y,...c],Q=js(t,R,P,V),Z=t.map(B=>js([B],R,P,V)),w=Q.map((B,b)=>{if(V[b].aggregateType==="セット平均"){const U=t.length||1;return{teamA:(B.teamA/U).toFixed(1),teamB:(B.teamB/U).toFixed(1)}}return B}),ie=Z.map(B=>V.reduce((b,k,U)=>(k.aggregateType!=="セット平均"&&b.push(B[U]),b),[])),se=V.filter(B=>B.aggregateType!=="セット平均"),re=ji(t,R),f=bi(t,R),te=B=>{const b=[];B.playCategoryId?b.push(e.jsx("span",{children:O(B.playCategoryId)},"cat")):B.playCategoryTags&&B.playCategoryTags.length>0&&b.push(e.jsx(s,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center",mt:.5},children:B.playCategoryTags.map(U=>{const X=n.find(G=>G.id===U);return e.jsx(Ue,{label:(X==null?void 0:X.name)||U,size:"small",sx:{mr:.5,mb:.5,backgroundColor:(X==null?void 0:X.color)||Je,color:"#fff"}},U)})},"catTags")),B.playDetailId?b.push(e.jsx("span",{children:Y(B.playDetailId)},"detail")):B.playDetailTags&&B.playDetailTags.length>0&&b.push(e.jsx(s,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center",mt:.5},children:B.playDetailTags.map(U=>{const X=D.find(G=>G.id===U);return e.jsx(Ue,{label:(X==null?void 0:X.name)||U,size:"small",sx:{mr:.5,mb:.5,backgroundColor:(X==null?void 0:X.color)||Je,color:"#fff"}},U)})},"detailTags"));const k=[];return B.pointType&&k.push(B.pointType),B.pointUnitType&&k.push(B.pointUnitType),k.length>0&&b.push(e.jsx("span",{children:k.join(",")},"point")),b.push(e.jsxs("span",{children:["(",B.aggregateType||"合算",")"]},"agg")),e.jsx(s,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:b.map((U,X)=>e.jsx(s,{sx:{display:"flex",justifyContent:"center"},children:U},X))})},ee=(B,b,k,U,X)=>e.jsx(xt,{component:et,storageKey:X,sx:{mb:2},children:e.jsxs(jt,{size:"small",sx:{"& th, & td":{textAlign:"center",verticalAlign:"middle"}},children:[e.jsx(bt,{children:e.jsxs(Oe,{sx:{backgroundColor:G=>G.palette.mode==="dark"?"#343A42":"#f5f5f5",height:50},children:[e.jsx(T,{children:j||"チームA"}),e.jsx(T,{children:"項目"}),e.jsx(T,{children:h||"チームB"})]})}),e.jsxs(yt,{children:[e.jsxs(Oe,{sx:{height:50},children:[e.jsx(T,{children:b.teamA}),e.jsx(T,{children:"ブレイク率"}),e.jsx(T,{children:b.teamB})]},"break-rate"),e.jsxs(Oe,{sx:{height:50},children:[e.jsx(T,{children:k.teamA}),e.jsx(T,{children:"サイドアウト率"}),e.jsx(T,{children:k.teamB})]},"sideout-rate"),U.map((G,xe)=>e.jsxs(Oe,{sx:{height:50},children:[e.jsx(T,{children:B[xe].teamA}),e.jsx(T,{children:te(G)}),e.jsx(T,{children:B[xe].teamB})]},G.id))]})]})});return e.jsxs(s,{sx:{display:"grid",gap:2,gridTemplateColumns:{xs:"1fr",md:"repeat(2, 1fr)"},maxWidth:1024,width:"100%",mx:"auto"},children:[e.jsxs(s,{children:[e.jsx(Fe,{variant:"h6",sx:{mb:1},children:"試合全体のスタッツ"}),ee(w,re.overall,f.overall,V,"stats-overall")]}),t.map((B,b)=>e.jsxs(s,{children:[e.jsx(Fe,{variant:"h6",sx:{mb:1},children:`${b+1}セット目(${B.my}-${B.opponent})のスタッツ`}),ee(ie[b],re.perSet[b],f.perSet[b],se,`stats-set-${b}`)]},B.id)),e.jsxs(s,{sx:{gridColumn:"1 / -1"},children:[e.jsx(gi,{statsSettings:c,onChange:r,playCategories:x,playDetails:g,rallyCategoryTags:n,rallyDetailTags:D,disabled:M,showSnackbar:L}),e.jsxs(vs,{severity:"info",sx:{mt:1},children:["本設定は試合内のみでの設定となります",e.jsx("br",{}),"各試合共通でのスタッツ項目の設定は設定＞スタッツメニューから設定してください"]})]})]})}var xs={},vi=Ie;Object.defineProperty(xs,"__esModule",{value:!0});var Jt=xs.default=void 0,Ci=vi(Me()),Si=e;Jt=xs.default=(0,Ci.default)((0,Si.jsx)("path",{d:"M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m-9-2V7H4v3H1v2h3v3h2v-3h3v-2zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"PersonAdd");const Ti=()=>typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():Math.random().toString(36).slice(2)+Date.now().toString(36);function wi({match:t,setMatch:g,teamAName:x,teamBName:y,teamMembers:c,onAddMember:r,locked:n,showSnackbar:D}){const j=Mt(),h=dt("md"),M=dt("sm"),{handleTouchEnd:L,setSwiperRef:R,getSwiperRef:P}=Nt(),O={tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${j.palette.text.secondary}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${j.palette.text.secondary}`}}}},Y=(v,S,N)=>e.jsxs(s,{sx:{p:1,maxWidth:260},children:[e.jsx(Fe,{variant:"body2",sx:{whiteSpace:"pre-line"},children:Ze[v].text}),e.jsx(s,{sx:{textAlign:"right",mt:1},children:e.jsx(Qe,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem(S,"1"),N()},children:"了解した"})})]}),[V,Q]=d.useState(""),Z="tutorial-member-select",[w,ie]=d.useState(()=>!localStorage.getItem(Z)),se="tutorial-member-row",[re,f]=d.useState(null),[te,ee]=d.useState(!1),[B,b]=d.useState(!1),[k,U]=d.useState(""),[X,G]=d.useState(""),[xe,le]=d.useState([]),[he,ye]=d.useState("teamA"),[we,u]=d.useState([]),C="tutorial-member-select-add",z="tutorial-member-select-list",[J,H]=d.useState(!1),[Ae,a]=d.useState(!1);d.useEffect(()=>{if(te){const v=window.setTimeout(()=>{H(!localStorage.getItem(C)),a(!localStorage.getItem(z))},300);return()=>window.clearTimeout(v)}H(!1),a(!1)},[te]);const l=v=>{if(V){const ae=P(V);ae&&(ae.allowTouchMove=!0),Q("")}if(!v.destination||v.source.droppableId!==v.destination.droppableId||n)return;const S=v.source.droppableId==="teamA"?"teamAMembers":"teamBMembers",N=Array.from(t[S]),[de]=N.splice(v.source.index,1);N.splice(v.destination.index,0,de),g(ae=>({...ae,[S]:N}))},I=d.useMemo(()=>{const v=he==="teamA"?t.teamA:t.teamB,S=c[v]||[],N=he==="teamA"?t.teamAMembers:t.teamBMembers;return S.filter(de=>de.visible!==!1&&!N.some(ae=>ae.id===de.id))},[he,t,c]);d.useEffect(()=>{[...t.teamAMembers.map(S=>`teamA-${S.id}`),...t.teamBMembers.map(S=>`teamB-${S.id}`)].forEach(S=>{const N=P(S);N&&(N.allowTouchMove=!n,n&&N.slideTo(0))})},[n,t.teamAMembers,t.teamBMembers,P]);const E=v=>{ye(v),u([]),ee(!0)},F=v=>{u(S=>S.some(de=>de.id===v.id)?S.filter(de=>de.id!==v.id):[...S,v])},_=()=>{const v=!localStorage.getItem(se);g(he==="teamA"?S=>({...S,teamAMembers:[...S.teamAMembers,...we.map(N=>({...N,statuses:Array(S.sets.length).fill("")}))]}):S=>({...S,teamBMembers:[...S.teamBMembers,...we.map(N=>({...N,statuses:Array(S.sets.length).fill("")}))]})),ee(!1),v&&f(he)},me=()=>{ee(!1)},i=(v,S)=>{if(n)return;let N;const de=v==="teamA"?"teamAMembers":"teamBMembers";g(ae=>{const K=[...ae[de]];N=K[S];const fe=K.filter((Te,be)=>be!==S);return{...ae,[de]:fe}}),D("メンバーを削除しました","success",{actionLabel:"元に戻す",onAction:()=>{N&&g(ae=>{const K=[...ae[de]];return K.splice(S,0,N),{...ae,[de]:K}})},autoHideDuration:5e3})},m=()=>{n||(U(""),G(""),le([]),b(!0))},p=()=>{const v=he==="teamA"?t.teamA:t.teamB;v&&r(v,{id:Ti(),no:Number(k),name:X,positions:xe}),b(!1)},A=()=>{b(!1)},W=(v,S,N)=>{n||g(de=>{const ae=v==="teamA"?"teamAMembers":"teamBMembers",K=[...de[ae]],fe={...K[S]},Te=[...fe.statuses||Array(de.sets.length).fill("")],be=Te[N]||"";let Be="";return be===""?Be="starter":be==="starter"?Be="libero":Be="",Te[N]=Be,fe.statuses=Te,K[S]=fe,{...de,[ae]:K}})},pe=()=>Y(h?"matchMembersRowMobile":"matchMembersRowDesktop",se,()=>f(null)),Se=v=>{const S=v==="teamA"?t.teamAMembers:t.teamBMembers,N=v,de=M?"50px 1fr":`40px 1fr ${t.sets.map(()=>"70px").join(" ")}`;return e.jsxs(s,{sx:{maxWidth:1024,mx:"auto",overflowX:"auto"},children:[e.jsxs(s,{sx:{display:"grid",gridTemplateColumns:de,alignItems:"center",height:50,px:1,borderBottom:1,borderColor:"divider",...Ke},children:[e.jsx(s,{children:"番号"}),e.jsx(s,{children:"名前"}),!M&&t.sets.map((ae,K)=>e.jsx(s,{textAlign:"center",children:K+1},K))]}),e.jsx(at,{droppableId:N,children:ae=>e.jsxs(s,{ref:ae.innerRef,...ae.droppableProps,children:[S.map((K,fe)=>e.jsx(ot,{draggableId:`${N}-${K.id}`,index:fe,isDragDisabled:n,children:Te=>{const be=`${N}-${K.id}`,Be=Te.dragHandleProps,{onPointerDown:He,...Ge}=Be||{},nt=Ht(Pe=>{He==null||He(Pe);const ke=P(be);ke&&(ke.allowTouchMove=!1),Q(be)});return e.jsx(s,{ref:Te.innerRef,...Te.draggableProps,children:e.jsxs(Ft,{onSwiper:Pe=>R(be,Pe),threshold:20,slidesPerView:"auto",style:{overflow:"hidden"},onTouchStart:(Pe,ke)=>ke.stopPropagation(),onTouchEnd:Pe=>L(be,Pe),children:[e.jsx(Ve,{style:{width:"100%",flex:"0 0 auto"},children:e.jsxs(s,{...Ge,...nt,sx:{display:"grid",gridTemplateColumns:de,alignItems:"center",height:50,px:1,borderBottom:1,borderColor:"divider",backgroundColor:"background.paper",cursor:n?"default":"grab",touchAction:V===be?"none":"pan-y"},children:[e.jsx(s,{children:K.no}),e.jsx(s,{children:K.name}),!M&&t.sets.map((Pe,ke)=>{var Dt,Bt,vt,ht,Pt,Ct;return e.jsx(s,{sx:{textAlign:"center"},children:e.jsx(ue,{size:"small",variant:(Dt=K.statuses)!=null&&Dt[ke]?"contained":"outlined",color:((Bt=K.statuses)==null?void 0:Bt[ke])==="starter"?"primary":void 0,sx:{minWidth:32,width:32,p:0,...((vt=K.statuses)==null?void 0:vt[ke])==="starter"?{backgroundColor:"primary.main",color:"#fff","&:hover":{backgroundColor:"primary.main"}}:((ht=K.statuses)==null?void 0:ht[ke])==="libero"?{backgroundColor:"#FF9933",color:"#fff","&:hover":{backgroundColor:"#FF9933"},"&.Mui-focusVisible":{outline:"2px solid #FF9933"}}:{}},onClick:()=>W(v,fe,ke),disabled:n,children:((Pt=K.statuses)==null?void 0:Pt[ke])==="starter"?"出":((Ct=K.statuses)==null?void 0:Ct[ke])==="libero"?"リ":"不"})},ke)})]})}),e.jsx(Ve,{style:{width:ut,flex:"0 0 auto"},children:e.jsx(s,{sx:{height:50,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:n?"grey.500":"error.main"},children:e.jsx(De,{size:"small",disabled:n,onClick:n?void 0:()=>i(v,fe),children:e.jsx(st,{fontSize:"small",sx:{color:"common.white"}})})})})]})})}},K.id)),ae.placeholder]})})]})};return e.jsxs(It,{onDragEnd:l,children:[e.jsxs(wt,{container:!0,spacing:2,children:[e.jsxs(wt,{item:!0,xs:12,children:[e.jsxs(s,{sx:{maxWidth:1024,mx:"auto"},children:[e.jsx(Fe,{variant:"h6",sx:{mb:1},children:x}),e.jsx(ue,{variant:"contained",size:"medium",sx:{mb:1},onClick:()=>E("teamA"),disabled:n,startIcon:e.jsx(Jt,{}),children:"メンバー登録"})]}),e.jsx(Ee,{open:w,onClose:()=>ie(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:We,slotProps:O,title:Y("matchMembersSelect",Z,()=>ie(!1)),children:e.jsx(s,{children:e.jsx(Ee,{open:re==="teamA",onClose:()=>f(null),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:We,slotProps:O,title:pe(),children:e.jsx(s,{children:h?Se("teamA"):e.jsx(xt,{component:et,storageKey:"members-teamA",sx:{maxWidth:1024,mx:"auto"},children:e.jsxs(jt,{size:"small",children:[e.jsx(bt,{children:e.jsxs(Oe,{sx:{backgroundColor:v=>v.palette.mode==="dark"?"#343A42":"#f5f5f5",height:50},children:[e.jsx(T,{}),e.jsx(T,{children:"番号"}),e.jsx(T,{children:"名前"}),e.jsx(T,{children:"ポジション"}),t.sets.map((v,S)=>e.jsx(T,{align:"center",children:S+1},S)),e.jsx(T,{})]})}),e.jsx(at,{droppableId:"teamA",children:v=>e.jsxs(yt,{ref:v.innerRef,...v.droppableProps,children:[t.teamAMembers.map((S,N)=>e.jsx(ot,{draggableId:`teamA-${S.id}`,index:N,isDragDisabled:n,children:de=>e.jsxs(Oe,{ref:de.innerRef,...de.draggableProps,"data-index":N,sx:{cursor:n?"default":"pointer",height:50},children:[e.jsx(T,{padding:"checkbox",children:e.jsx(s,{onClick:ae=>ae.stopPropagation(),...de.dragHandleProps,sx:{cursor:n?"default":"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:e.jsx(Ot,{})})}),e.jsx(T,{children:S.no}),e.jsx(T,{children:S.name}),e.jsx(T,{children:(S.positions||[]).join(", ")}),t.sets.map((ae,K)=>{var fe,Te,be,Be,He,Ge;return e.jsx(T,{padding:"checkbox",align:"center",children:e.jsx(ue,{size:"small",variant:(fe=S.statuses)!=null&&fe[K]?"contained":"outlined",color:((Te=S.statuses)==null?void 0:Te[K])==="starter"?"primary":void 0,sx:{minWidth:32,width:32,p:0,...((be=S.statuses)==null?void 0:be[K])==="starter"?{backgroundColor:"primary.main",color:"#fff","&:hover":{backgroundColor:"primary.main"}}:((Be=S.statuses)==null?void 0:Be[K])==="libero"?{backgroundColor:"#FF9933",color:"#fff","&:hover":{backgroundColor:"#FF9933"},"&.Mui-focusVisible":{outline:"2px solid #FF9933"}}:{}},onClick:()=>W("teamA",N,K),disabled:n,children:((He=S.statuses)==null?void 0:He[K])==="starter"?"出":((Ge=S.statuses)==null?void 0:Ge[K])==="libero"?"リ":"不"})},K)}),e.jsx(T,{padding:"checkbox",children:e.jsx(s,{onClick:ae=>ae.stopPropagation(),sx:{width:32,height:32,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:e.jsx(De,{size:"small",onClick:n?void 0:()=>i("teamA",N),disabled:n,sx:{width:24,height:24},children:e.jsx(st,{fontSize:"small",color:n?"disabled":"error"})})})})]})},S.id)),v.placeholder]})})]})})})})})})]}),e.jsxs(wt,{item:!0,xs:12,children:[e.jsxs(s,{sx:{maxWidth:1024,mx:"auto"},children:[e.jsx(Fe,{variant:"h6",sx:{mb:1},children:y}),e.jsx(ue,{variant:"contained",size:"medium",sx:{mb:1},onClick:()=>E("teamB"),disabled:n,startIcon:e.jsx(Jt,{}),children:"メンバー登録"})]}),e.jsx(Ee,{open:re==="teamB",onClose:()=>f(null),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:We,slotProps:O,title:pe(),children:e.jsx(s,{children:h?Se("teamB"):e.jsx(xt,{component:et,storageKey:"members-teamB",sx:{maxWidth:1024,mx:"auto"},children:e.jsxs(jt,{size:"small",children:[e.jsx(bt,{children:e.jsxs(Oe,{sx:{backgroundColor:v=>v.palette.mode==="dark"?"#343A42":"#f5f5f5",height:50},children:[e.jsx(T,{}),e.jsx(T,{children:"番号"}),e.jsx(T,{children:"名前"}),e.jsx(T,{children:"ポジション"}),t.sets.map((v,S)=>e.jsx(T,{align:"center",children:S+1},S)),e.jsx(T,{})]})}),e.jsx(at,{droppableId:"teamB",children:v=>e.jsxs(yt,{ref:v.innerRef,...v.droppableProps,children:[t.teamBMembers.map((S,N)=>e.jsx(ot,{draggableId:`teamB-${S.id}`,index:N,isDragDisabled:n,children:de=>e.jsxs(Oe,{ref:de.innerRef,...de.draggableProps,"data-index":N,sx:{cursor:n?"default":"pointer",height:50},children:[e.jsx(T,{padding:"checkbox",children:e.jsx(s,{onClick:ae=>ae.stopPropagation(),...de.dragHandleProps,sx:{cursor:n?"default":"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:e.jsx(Ot,{})})}),e.jsx(T,{children:S.no}),e.jsx(T,{children:S.name}),e.jsx(T,{children:(S.positions||[]).join(", ")}),t.sets.map((ae,K)=>{var fe,Te,be,Be,He,Ge;return e.jsx(T,{padding:"checkbox",align:"center",children:e.jsx(ue,{size:"small",variant:(fe=S.statuses)!=null&&fe[K]?"contained":"outlined",color:((Te=S.statuses)==null?void 0:Te[K])==="starter"?"primary":void 0,sx:{minWidth:32,width:32,p:0,...((be=S.statuses)==null?void 0:be[K])==="starter"?{backgroundColor:"primary.main",color:"#fff","&:hover":{backgroundColor:"primary.main"}}:((Be=S.statuses)==null?void 0:Be[K])==="libero"?{backgroundColor:"#FF9933",color:"#fff","&:hover":{backgroundColor:"#FF9933"},"&.Mui-focusVisible":{outline:"2px solid #FF9933"}}:{}},onClick:()=>W("teamB",N,K),disabled:n,children:((He=S.statuses)==null?void 0:He[K])==="starter"?"出":((Ge=S.statuses)==null?void 0:Ge[K])==="libero"?"リ":"不"})},K)}),e.jsx(T,{padding:"checkbox",children:e.jsx(s,{onClick:ae=>ae.stopPropagation(),sx:{width:32,height:32,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:e.jsx(De,{size:"small",onClick:n?void 0:()=>i("teamB",N),disabled:n,sx:{width:24,height:24},children:e.jsx(st,{fontSize:"small",color:n?"disabled":"error"})})})})]})},S.id)),v.placeholder]})})]})})})})]})]}),e.jsxs(At,{open:te,onClose:me,children:[e.jsx(it,{children:"メンバー選択"}),e.jsxs(rt,{children:[e.jsx(s,{sx:{display:"flex",justifyContent:"flex-end",mb:1},children:e.jsx(Ee,{open:J,onClose:()=>H(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom-start",TransitionComponent:We,slotProps:{...O,popper:{disablePortal:!0,sx:{zIndex:v=>v.zIndex.tooltip}}},title:Y("memberSelectAdd",C,()=>H(!1)),children:e.jsx("span",{children:e.jsx(ue,{onClick:m,variant:"contained",startIcon:e.jsx(Lt,{}),disabled:n||!(he==="teamA"?t.teamA:t.teamB),children:"追加"})})})}),e.jsx(Ee,{open:Ae,onClose:()=>a(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:We,slotProps:{...O,popper:{disablePortal:!0,sx:{zIndex:v=>v.zIndex.tooltip}}},title:Y("memberSelectList",z,()=>a(!1)),children:e.jsx(xt,{component:et,storageKey:`members-select-${he}`,children:e.jsxs(jt,{size:"small",children:[e.jsx(bt,{children:e.jsxs(Oe,{sx:{backgroundColor:v=>v.palette.mode==="dark"?"#343A42":"#f5f5f5",height:50},children:[e.jsx(T,{padding:"checkbox"}),!M&&e.jsx(T,{children:"番号"}),e.jsx(T,{children:"名前"}),!M&&e.jsx(T,{children:"ポジション"})]})}),e.jsx(yt,{children:I.map(v=>{const S=we.some(N=>N.id===v.id);return e.jsxs(Oe,{sx:{cursor:"pointer",height:50},onClick:()=>F(v),children:[e.jsx(T,{padding:"checkbox",onClick:N=>N.stopPropagation(),children:e.jsx(Js,{checked:S,onChange:()=>F(v)})}),!M&&e.jsx(T,{children:v.no}),e.jsx(T,{children:v.name}),!M&&e.jsx(T,{children:(v.positions||[]).join(", ")})]},v.id)})})]})})})]}),e.jsxs(lt,{children:[e.jsx(ue,{onClick:me,startIcon:e.jsx(tt,{}),color:"inherit",children:"キャンセル"}),e.jsx(ue,{onClick:_,disabled:we.length===0,startIcon:e.jsx(Ne,{}),children:"OK"})]})]}),e.jsxs(At,{open:B,onClose:A,children:[e.jsx(it,{children:"メンバー追加"}),e.jsxs(rt,{children:[e.jsx(Ce,{label:"番号",type:"number",value:k,onChange:v=>U(v.target.value),fullWidth:!0,margin:"dense"}),e.jsx(Ce,{label:"名前",value:X,onChange:v=>G(v.target.value),fullWidth:!0,margin:"dense"}),e.jsxs(_e,{fullWidth:!0,margin:"dense",children:[e.jsx(Re,{id:"md-positions-label",children:"ポジション"}),e.jsxs(ze,{labelId:"md-positions-label",multiple:!0,value:xe,label:"ポジション",onChange:v=>le(typeof v.target.value=="string"?v.target.value.split(","):v.target.value),renderValue:v=>v.join(", "),children:[e.jsx(oe,{value:"レフト",children:"レフト"}),e.jsx(oe,{value:"センター",children:"センター"}),e.jsx(oe,{value:"ライト",children:"ライト"}),e.jsx(oe,{value:"セッター",children:"セッター"}),e.jsx(oe,{value:"リベロ",children:"リベロ"})]})]})]}),e.jsxs(lt,{children:[e.jsx(ue,{onClick:A,startIcon:e.jsx(tt,{}),color:"inherit",children:"キャンセル"}),e.jsx(ue,{onClick:p,disabled:k==="",startIcon:e.jsx(Ne,{}),children:"OK"})]})]})]})}function Ai({match:t,setMatch:g,tags:x,onAddTag:y,locked:c}){return e.jsx(s,{sx:{maxWidth:1024,mx:"auto"},children:e.jsx(wt,{container:!0,spacing:2,children:e.jsx(wt,{item:!0,xs:12,children:e.jsxs(et,{elevation:0,sx:{},children:[e.jsx(Ce,{label:"試合日付",type:"date",InputLabelProps:{shrink:!0},value:t.date,onChange:r=>g(n=>({...n,date:r.target.value})),fullWidth:!0,margin:"dense",disabled:c,sx:{"& .MuiOutlinedInput-root":{height:56},"& .MuiOutlinedInput-input":{padding:"0 14px",height:"100%",lineHeight:"56px",fontSize:"1rem",textAlign:"left"},'& input[type="date"]':{WebkitAppearance:"none"}}}),e.jsx(Ce,{label:"試合名",value:t.matchName,onChange:r=>g(n=>({...n,matchName:r.target.value})),fullWidth:!0,margin:"dense",disabled:c}),e.jsx(qt,{multiple:!0,freeSolo:!0,options:x,getOptionLabel:r=>typeof r=="string"?r:r.name,value:t.tags.map(r=>x.find(n=>n.id===r)).filter(Boolean),onChange:(r,n)=>{const D=[];n.forEach(j=>{if(typeof j=="string"){const h={id:crypto.randomUUID(),name:j,color:Je};y(h),D.push(h.id)}else D.push(j.id)}),g(j=>({...j,tags:D}))},renderTags:(r,n)=>r.map((D,j)=>{const{key:h,...M}=n({index:j});return e.jsx(Ue,{...M,label:D.name,sx:{backgroundColor:D.color||Je,color:"#fff",mr:.5,mb:.5}},h)}),renderInput:r=>e.jsx(Ce,{...r,label:"タグ",margin:"dense"}),fullWidth:!0,disabled:c}),e.jsxs(vs,{severity:"info",sx:{mt:1},children:["試合タグは上記項目にて直接入力するか、設定＞タグメニューにて追加できます",e.jsx("br",{}),"試合にタグを設定することにより、試合を横串で集計することが可能となります"]}),e.jsx(Ce,{label:"場所",value:t.location,onChange:r=>g(n=>({...n,location:r.target.value})),fullWidth:!0,margin:"dense",disabled:c}),e.jsx(Ce,{label:"主審",value:t.mainReferee,onChange:r=>g(n=>({...n,mainReferee:r.target.value})),fullWidth:!0,margin:"dense",disabled:c}),e.jsx(Ce,{label:"副審",value:t.subReferee,onChange:r=>g(n=>({...n,subReferee:r.target.value})),fullWidth:!0,margin:"dense",disabled:c}),e.jsx(Ce,{label:"動画URL",value:t.videoUrl,onChange:r=>g(n=>({...n,videoUrl:r.target.value})),multiline:!0,rows:3,fullWidth:!0,margin:"dense",disabled:c}),e.jsx(Ce,{label:"メモ",value:t.memo,onChange:r=>g(n=>({...n,memo:r.target.value})),multiline:!0,rows:3,fullWidth:!0,margin:"dense",disabled:c})]})})})})}function Ii({match:t,setMatch:g,teams:x,locked:y}){return e.jsxs(et,{elevation:0,sx:{},children:[e.jsxs(_e,{fullWidth:!0,margin:"dense",disabled:y,children:[e.jsx(Re,{id:"teamA-label",children:"チームA"}),e.jsx(ze,{labelId:"teamA-label",value:t.teamA,label:"チームA",onChange:c=>g(r=>({...r,teamA:c.target.value,teamAMembers:[]})),disabled:y,children:x.map(c=>e.jsx(oe,{value:c.id,children:c.name},c.id))})]}),e.jsx(Ce,{label:"チームA監督",value:t.teamAHeadCoach,onChange:c=>g(r=>({...r,teamAHeadCoach:c.target.value})),fullWidth:!0,margin:"dense",disabled:y}),e.jsx(Ce,{label:"チームAコーチ",value:t.teamACoach,onChange:c=>g(r=>({...r,teamACoach:c.target.value})),fullWidth:!0,margin:"dense",disabled:y}),e.jsx(Ce,{label:"チームAマネージャー",value:t.teamAManager,onChange:c=>g(r=>({...r,teamAManager:c.target.value})),fullWidth:!0,margin:"dense",disabled:y}),e.jsx(Ce,{label:"チームAキャプテン",value:t.teamACaptain,onChange:c=>g(r=>({...r,teamACaptain:c.target.value})),fullWidth:!0,margin:"dense",disabled:y}),e.jsxs(_e,{fullWidth:!0,margin:"dense",disabled:y,children:[e.jsx(Re,{id:"teamB-label",children:"チームB"}),e.jsx(ze,{labelId:"teamB-label",value:t.teamB,label:"チームB",onChange:c=>g(r=>({...r,teamB:c.target.value,teamBMembers:[]})),disabled:y,children:x.map(c=>e.jsx(oe,{value:c.id,children:c.name},c.id))})]}),e.jsx(Ce,{label:"チームB監督",value:t.teamBHeadCoach,onChange:c=>g(r=>({...r,teamBHeadCoach:c.target.value})),fullWidth:!0,margin:"dense",disabled:y}),e.jsx(Ce,{label:"チームBコーチ",value:t.teamBCoach,onChange:c=>g(r=>({...r,teamBCoach:c.target.value})),fullWidth:!0,margin:"dense",disabled:y}),e.jsx(Ce,{label:"チームBマネージャー",value:t.teamBManager,onChange:c=>g(r=>({...r,teamBManager:c.target.value})),fullWidth:!0,margin:"dense",disabled:y}),e.jsx(Ce,{label:"チームBキャプテン",value:t.teamBCaptain,onChange:c=>g(r=>({...r,teamBCaptain:c.target.value})),fullWidth:!0,margin:"dense",disabled:y})]})}const Mi=nn.create(s),Di=()=>typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():Math.random().toString(36).slice(2)+Date.now().toString(36);function Li({match:t,onSave:g,teams:x,teamMembers:y,playDetails:c,playCategories:r,statsSettings:n,rallyCategoryTags:D,rallyDetailTags:j,themeSetting:h,scoreInputSetting:M,onAddMember:L,setAppBarAction:R,setAppBarLeftAction:P,onDirtyChange:O,tags:Y,onAddTag:V}){const Q=Qs(),Z=Zs(),[w,ie]=d.useState("info"),se=!1;d.useEffect(()=>{const o=Z.pathname.split("/").filter(Boolean);if(o[0]!=="matches"||o[1]!==t.id)return;const $=o[2]??"info";$==="setinfo"?(ie("info"),Q(`/matches/${t.id}/info`,{replace:!0})):(ie($),o[2]||Q(`/matches/${t.id}/info`,{replace:!0}))},[Z.pathname,Q,t.id,se]);const re=d.useCallback(o=>{const $=o.teamA,q=o.teamB,ne=(ve,je)=>!!je&&(y[ve]||[]).some(ce=>ce.id===je&&ce.visible!==!1),ge=(ve,je)=>je.filter(ce=>ne(ve,ce.id)).map(ce=>{const Le=(y[ve]||[]).find(ct=>ct.id===ce.id);return Le?{...ce,no:Le.no,name:Le.name,positions:Le.positions}:ce});return{...o,teamAMembers:ge($,o.teamAMembers),teamBMembers:ge(q,o.teamBMembers),sets:o.sets.map(ve=>({...ve,rallies:ve.rallies.map(je=>({...je,server:ne(je.serverTeam==="teamA"?$:q,je.server)?je.server:void 0,teamAMember:ne($,je.teamAMember)?je.teamAMember:void 0,teamBMember:ne(q,je.teamBMember)?je.teamBMember:void 0}))}))}},[y]),[f,te]=d.useState(()=>re({...t,tags:t.tags||[],matchStatsSettings:t.matchStatsSettings||[],teamAMembers:t.teamAMembers.map(o=>({...o,statuses:o.statuses??Array(t.sets.length).fill("")})),teamBMembers:t.teamBMembers.map(o=>({...o,statuses:o.statuses??Array(t.sets.length).fill("")}))})),ee=5,B=[Is,Ms,Ds,Bs,Ps],b=!!t.locked,k=Mt(),U=ps(k.breakpoints.up("sm")),X=ps(k.breakpoints.down("sm")),[G,xe]=d.useState(!1),[le,he]=d.useState(!1),ye=200,we=56,[u,C]=d.useState(!1),z=k.palette.text.secondary,J=d.useCallback(()=>{G?(he(!1),xe(!1)):(xe(!0),U||he(!0))},[G,U]),H=d.useCallback(o=>{o.propertyName==="width"&&U&&G&&he(!0)},[U,G]);d.useEffect(()=>{U||(xe(!1),he(!1))},[U]),d.useEffect(()=>(P(e.jsx(Ee,{open:u,onClose:()=>C(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom-end",TransitionComponent:We,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${z}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${z}`}}}},title:e.jsxs(s,{sx:{p:1,maxWidth:260},children:[e.jsxs(Fe,{variant:"body2",sx:{whiteSpace:"pre-line"},children:[e.jsx(fs,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),Ze.setReorder.text]}),e.jsx(s,{sx:{textAlign:"right",mt:1},children:e.jsx(Qe,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem("tutorial-set-reorder","1"),C(!1)},children:"了解した"})})]}),children:e.jsx(De,{color:"inherit",onClick:J,children:e.jsx(fs,{})})})),()=>P(null)),[P,J,u,z]);const[Ae,a]=d.useState(!1),[l,I]=d.useState(!1),[E,F]=d.useState(null),[_,me]=d.useState(!1),[i,m]=d.useState({open:!1,message:"",severity:"success"}),p=(o,$,q)=>{m({open:!0,message:o,severity:$,...q})},A=`matchDraft-${t.id}`,W=d.useRef(!1),[pe,Se]=d.useState(!1),[v,S]=d.useState(!1),[N,de]=d.useState(null),ae=d.useCallback(o=>{de(o.currentTarget)},[]),K=d.useCallback(()=>{de(null)},[]),[fe,Te]=d.useState({}),be=d.useCallback((o,$,q=!0)=>{te(ne=>{const ge=[...ne.sets],ve=ge.findIndex(ce=>ce.id===o);if(ve===-1)return ne;const je=ge[ve];return q&&Te(ce=>{const Le=ce[o]||{undo:[]};return{...ce,[o]:{undo:[...Le.undo,je],redo:[]}}}),ge[ve]=$,{...ne,sets:ge}})},[]),Be=d.useCallback(()=>{if(!/^[0-9]+$/.test(w))return;const o=Number(w)-1,$=f.sets[o],q=fe[$.id];if(!q||q.undo.length===0)return;const ne=q.undo[q.undo.length-1];Te(ge=>({...ge,[$.id]:{undo:q.undo.slice(0,-1),redo:[...q.redo,$]}})),be($.id,ne,!1)},[w,f.sets,fe,be]),He=d.useCallback(()=>{if(!/^[0-9]+$/.test(w))return;const o=Number(w)-1,$=f.sets[o],q=fe[$.id];if(!q||q.redo.length===0)return;const ne=q.redo[q.redo.length-1];Te(ge=>({...ge,[$.id]:{undo:[...q.undo,$],redo:q.redo.slice(0,-1)}})),be($.id,ne,!1)},[w,f.sets,fe,be]),Ge=o=>{if(!o.destination||b)return;const $=o.source.index,q=o.destination.index;if($===q)return;const ne=Array.from(f.sets),[ge]=ne.splice($,1);ne.splice(q,0,ge);const ve=Le=>Le.map(ct=>{const $e=Array.from(ct.statuses||[]),[pt]=$e.splice($,1);return $e.splice(q,0,pt),{...ct,statuses:$e}}),je=ve(f.teamAMembers),ce=ve(f.teamBMembers);te(Le=>({...Le,sets:ne,teamAMembers:je,teamBMembers:ce}))};d.useEffect(()=>{Te(o=>{const $={...o};return Object.keys($).forEach(q=>{f.sets.some(ne=>ne.id===q)||delete $[q]}),$})},[f.sets]),d.useEffect(()=>{te(o=>re(o))},[re]);const nt=o=>{var $;return(($=x.find(q=>q.id===o))==null?void 0:$.name)||""},Pe=d.useMemo(()=>f.date!==t.date||f.matchName!==t.matchName||f.location!==t.location||f.mainReferee!==t.mainReferee||f.subReferee!==t.subReferee||f.videoUrl!==t.videoUrl||f.memo!==t.memo||f.teamA!==t.teamA||f.teamAHeadCoach!==t.teamAHeadCoach||f.teamACoach!==t.teamACoach||f.teamAManager!==t.teamAManager||f.teamACaptain!==t.teamACaptain||f.teamB!==t.teamB||f.teamBHeadCoach!==t.teamBHeadCoach||f.teamBCoach!==t.teamBCoach||f.teamBManager!==t.teamBManager||f.teamBCaptain!==t.teamBCaptain||JSON.stringify(f.tags)!==JSON.stringify(t.tags)||JSON.stringify(f.teamAMembers)!==JSON.stringify(t.teamAMembers)||JSON.stringify(f.teamBMembers)!==JSON.stringify(t.teamBMembers)||JSON.stringify(f.matchStatsSettings||[])!==JSON.stringify(t.matchStatsSettings||[])||JSON.stringify(f.sets)!==JSON.stringify(t.sets),[f,t]);d.useEffect(()=>{const o=localStorage.getItem(A);if(b){o&&localStorage.removeItem(A),me(!1);return}o&&me(!0)},[A,b]),d.useEffect(()=>{if(!W.current){W.current=!0,b&&localStorage.removeItem(A);return}if(b){localStorage.removeItem(A);return}Pe?localStorage.setItem(A,JSON.stringify(f)):localStorage.removeItem(A)},[f,Pe,A,b]);const ke=()=>{if(b||f.sets.length>=ee)return;f.sets.length===1&&!localStorage.getItem("tutorial-set-reorder")&&C(!0);const o={id:Di(),my:0,opponent:0,rallies:[]},$=f.sets.length+1;te(q=>({...q,sets:[...q.sets,o],teamAMembers:q.teamAMembers.map(ne=>({...ne,statuses:[...ne.statuses||[],""]})),teamBMembers:q.teamBMembers.map(ne=>({...ne,statuses:[...ne.statuses||[],""]}))})),ie(String($)),Q(`/matches/${t.id}/${$}`)},Dt=o=>{b||(F(o),I(!0))},Bt=()=>{if(E===null)return;const o=E,$=f.sets.length;let q=[],ne=[],ge=[];const ve=w;let je=w;if(w!=="info"&&w!=="members"&&w!=="stats"&&w!=="setinfo"){const ce=Number(w)-1;ce===o?o>0?(je=String(o),Q(`/matches/${t.id}/${o}`)):$>1?(je="1",Q(`/matches/${t.id}/1`)):(je="info",Q(`/matches/${t.id}/info`)):ce>o&&(je=String(ce),Q(`/matches/${t.id}/${ce}`))}ie(je),te(ce=>{q=ce.sets.map($e=>({...$e})),ne=ce.teamAMembers.map($e=>({...$e,statuses:$e.statuses?[...$e.statuses]:[]})),ge=ce.teamBMembers.map($e=>({...$e,statuses:$e.statuses?[...$e.statuses]:[]}));const Le=ce.sets.filter(($e,pt)=>pt!==o),ct=$e=>$e.map(pt=>({...pt,statuses:(pt.statuses||[]).filter((Pi,Vs)=>Vs!==o)}));return{...ce,sets:Le,teamAMembers:ct(ce.teamAMembers),teamBMembers:ct(ce.teamBMembers)}}),F(null),I(!1),p("セットを削除しました","success",{actionLabel:"元に戻す",onAction:()=>{te(ce=>({...ce,sets:q,teamAMembers:ne,teamBMembers:ge})),ve!=="info"&&ve!=="members"&&ve!=="stats"&&ve!=="setinfo"&&Q(`/matches/${t.id}/${ve}`)},autoHideDuration:5e3})},vt=()=>{F(null),I(!1)},ht=d.useCallback(()=>{a(!0)},[]),Pt=async()=>{const o=re(f);te(o);try{await Promise.resolve(g(o)),localStorage.removeItem(A),p("保存しました","success")}catch{p("保存に失敗しました","error")}a(!1)},Ct=()=>{a(!1)},Os=()=>{m(o=>({...o,open:!1}))},Hs=()=>{const o=localStorage.getItem(A);if(!o){me(!1);return}try{const $=JSON.parse(o),q={...$,tags:$.tags||[],matchStatsSettings:$.matchStatsSettings||[],teamAMembers:$.teamAMembers.map(ge=>({...ge,statuses:ge.statuses??Array($.sets.length).fill("")})),teamBMembers:$.teamBMembers.map(ge=>({...ge,statuses:ge.statuses??Array($.sets.length).fill("")}))},ne=re(q);te(ne),g(ne)}catch{}localStorage.removeItem(A),me(!1)},hs=()=>{localStorage.removeItem(A),me(!1)},Ye=d.useMemo(()=>/^[0-9]+$/.test(w),[w]),mt=d.useMemo(()=>Ye?f.sets[Number(w)-1]:null,[Ye,w,f.sets]),St=d.useMemo(()=>{var o;return!Ye||b||!mt||!((o=fe[mt.id])!=null&&o.undo.length)},[Ye,b,mt,fe]),Tt=d.useMemo(()=>{var o;return!Ye||b||!mt||!((o=fe[mt.id])!=null&&o.redo.length)},[Ye,b,mt,fe]);d.useEffect(()=>{St?Se(!1):localStorage.getItem("tutorial-undo")||Se(!0)},[St]),d.useEffect(()=>{Tt?S(!1):localStorage.getItem("tutorial-redo")||S(!0)},[Tt]),d.useEffect(()=>{if(X){const o=pe?"undo":v?"redo":null;R(e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Ee,{open:!!o,onClose:()=>{o==="undo"?Se(!1):o==="redo"&&S(!1)},disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:We,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${z}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${z}`}}}},title:e.jsx(s,{sx:{p:1,maxWidth:260},children:o==="undo"?e.jsxs(e.Fragment,{children:[e.jsxs(Fe,{variant:"body2",sx:{whiteSpace:"pre-line"},children:["メニューから",e.jsx(kt,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),Ze.undoMobile.text]}),e.jsx(s,{sx:{textAlign:"right",mt:1},children:e.jsx(Qe,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem("tutorial-undo","1"),Se(!1)},children:"了解した"})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(Fe,{variant:"body2",sx:{whiteSpace:"pre-line"},children:["メニューから",e.jsx(_t,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),Ze.redoMobile.text]}),e.jsx(s,{sx:{textAlign:"right",mt:1},children:e.jsx(Qe,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem("tutorial-redo","1"),S(!1)},children:"了解した"})})]})}),children:e.jsx(De,{color:"inherit",onClick:ae,children:e.jsx($s,{})})}),e.jsxs(Ns,{anchorEl:N,open:!!N,onClose:K,MenuListProps:{onClick:K},children:[Ye&&e.jsxs(e.Fragment,{children:[e.jsxs(oe,{onClick:Be,disabled:St,children:[e.jsx(ft,{children:e.jsx(kt,{fontSize:"small"})}),e.jsx(gt,{children:"元に戻す"})]}),e.jsxs(oe,{onClick:He,disabled:Tt,children:[e.jsx(ft,{children:e.jsx(_t,{fontSize:"small"})}),e.jsx(gt,{children:"やり直す"})]})]}),e.jsxs(oe,{onClick:ht,disabled:!Pe||b,children:[e.jsx(ft,{children:e.jsx(Ne,{fontSize:"small"})}),e.jsx(gt,{children:"保存"})]})]})]}))}else R(e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[Ye&&e.jsxs(e.Fragment,{children:[e.jsx(Ee,{open:pe,onClose:()=>Se(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:We,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${z}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${z}`}}}},title:e.jsxs(s,{sx:{p:1,maxWidth:260},children:[e.jsx(Fe,{variant:"body2",sx:{whiteSpace:"pre-line"},children:Ze.undoDesktop.text}),e.jsx(s,{sx:{textAlign:"right",mt:1},children:e.jsx(Qe,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem("tutorial-undo","1"),Se(!1)},children:"了解した"})})]}),children:e.jsx(De,{onClick:Be,disabled:St,color:"inherit",sx:{ml:1},children:e.jsx(kt,{})})}),e.jsx(Ee,{open:v,onClose:()=>S(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:We,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${z}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${z}`}}}},title:e.jsxs(s,{sx:{p:1,maxWidth:260},children:[e.jsx(Fe,{variant:"body2",sx:{whiteSpace:"pre-line"},children:Ze.redoDesktop.text}),e.jsx(s,{sx:{textAlign:"right",mt:1},children:e.jsx(Qe,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem("tutorial-redo","1"),S(!1)},children:"了解した"})})]}),children:e.jsx(De,{onClick:He,disabled:Tt,color:"inherit",sx:{ml:1},children:e.jsx(_t,{})})})]}),e.jsx(ue,{onClick:ht,variant:"contained",disabled:!Pe||b,startIcon:e.jsx(Ne,{}),sx:{ml:1},children:"保存"})]}));return()=>R(null)},[R,X,N,ae,K,Ye,Be,He,ht,Pe,b,St,Tt,pe,v,z]),d.useEffect(()=>(O==null||O(Pe),()=>O==null?void 0:O(!1)),[Pe,O]);const Ls=[{key:"info",label:"試合概要",icon:e.jsx(tn,{})},{key:"team",label:"チーム",icon:e.jsx(As,{})},{key:"members",label:"メンバー登録",icon:e.jsx(Ts,{})},{key:"sep1",divider:!0},{key:"stats",label:"スタッツ",icon:e.jsx(sn,{})},{key:"sep2",divider:!0},{key:"setinfo",label:"セット情報",icon:e.jsx(ws,{})}].filter(o=>o.key!=="setinfo"),Es=f.sets.map((o,$)=>{const q=B[$];return{key:`${$+1}`,icon:e.jsx(q,{}),label:`${o.my}-${o.opponent}`}}),Ws=!b&&f.sets.length<ee?[{key:"add",label:"セット追加",icon:e.jsx(Lt,{})}]:[],Et=o=>{o==="add"?ke():(ie(o),Q(`/matches/${t.id}/${o}`)),U||(he(!1),xe(!1))},Us=e.jsxs(Mi,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},sx:{flexGrow:1,overflowY:"auto",display:"flex",flexDirection:"column"},children:[w==="info"&&e.jsx(Ai,{match:f,setMatch:te,tags:Y,onAddTag:V,locked:b}),w==="members"&&e.jsx(wi,{match:f,setMatch:te,teamAName:nt(f.teamA)||"チームA",teamBName:nt(f.teamB)||"チームB",teamMembers:y,onAddMember:L,locked:b,showSnackbar:p}),w==="stats"&&e.jsx(yi,{sets:f.sets,playDetails:c,playCategories:r,statsSettings:n,matchStatsSettings:f.matchStatsSettings||[],onMatchStatsSettingsChange:o=>te($=>({...$,matchStatsSettings:o})),rallyCategoryTags:D,rallyDetailTags:j,teamAName:nt(f.teamA),teamBName:nt(f.teamB),locked:b,showSnackbar:p}),w==="team"&&e.jsx(s,{sx:{maxWidth:1024,mx:"auto"},children:e.jsx(Ii,{match:f,setMatch:te,teams:x,locked:b})}),se,w!=="info"&&w!=="members"&&w!=="stats"&&w!=="setinfo"&&w!=="team"&&e.jsx(pi,{setScore:f.sets[Number(w)-1],playDetails:c,playCategories:r,teamAMembers:f.teamAMembers,teamBMembers:f.teamBMembers,teamAName:nt(f.teamA),teamBName:nt(f.teamB),locked:b,scoreInputSetting:M,themeSetting:h,onChange:o=>be(o.id,o),showSnackbar:p})]},w);return e.jsxs(s,{sx:{display:"flex",height:"100%"},children:[e.jsx(Gs,{variant:U?"permanent":"temporary",open:U?!0:G,onClose:()=>{he(!1),xe(!1)},PaperProps:{onTransitionEnd:H},ModalProps:{keepMounted:!0,BackdropProps:{sx:{backgroundColor:"rgba(0, 0, 0, 0.5)"}}},sx:{width:U?G?ye:we:ye,flexShrink:0,transition:k.transitions.create("width",{easing:k.transitions.easing.sharp,duration:k.transitions.duration.standard}),...U?{zIndex:k.zIndex.appBar-1}:{},"& .MuiDrawer-paper":{width:U?G?ye:we:ye,boxSizing:"border-box",overflowX:"hidden",transition:k.transitions.create("width",{easing:k.transitions.easing.sharp,duration:k.transitions.duration.standard}),...U?{top:k.mixins.toolbar.minHeight,height:`calc(100% - ${k.mixins.toolbar.minHeight}px)`,zIndex:k.zIndex.appBar-1}:{}}},children:e.jsxs(Ys,{children:[Ls.map(o=>o.divider?e.jsx(Xs,{component:"li"},o.key):e.jsxs(Ut,{selected:w===o.key,onClick:()=>Et(o.key),sx:{minHeight:48,justifyContent:G?"initial":"center",px:2.5},children:[e.jsx(ft,{sx:{minWidth:0,mr:G?3:0,justifyContent:"center"},children:o.icon}),e.jsx(gt,{primary:o.label??`セット${o.key}`,sx:{opacity:le?1:0,display:le?"block":"none",whiteSpace:"nowrap"}})]},o.key)),e.jsx(It,{onDragEnd:Ge,children:e.jsx(at,{droppableId:"drawer-sets",children:o=>e.jsxs(s,{ref:o.innerRef,...o.droppableProps,children:[Es.map(($,q)=>e.jsx(ot,{draggableId:f.sets[q].id,index:q,children:ne=>e.jsxs(Ut,{ref:ne.innerRef,...ne.draggableProps,...ne.dragHandleProps,style:ne.draggableProps.style,selected:w===$.key,onClick:()=>Et($.key),sx:{minHeight:48,justifyContent:G?"initial":"center",px:2.5},children:[e.jsx(ft,{sx:{minWidth:0,mr:G?3:0,justifyContent:"center"},children:$.icon}),e.jsx(gt,{primary:$.label??`セット${$.key}`,sx:{opacity:le?1:0,display:le?"block":"none",whiteSpace:"nowrap"}}),!b&&G&&e.jsx(De,{edge:"end",onClick:ge=>{ge.stopPropagation(),Dt(q)},children:e.jsx(st,{})})]})},f.sets[q].id)),o.placeholder]})})}),Ws.map(o=>e.jsxs(Ut,{selected:w===o.key,onClick:()=>Et(o.key),sx:{minHeight:48,justifyContent:G?"initial":"center",px:2.5},children:[e.jsx(ft,{sx:{minWidth:0,mr:G?3:0,justifyContent:"center"},children:o.icon}),e.jsx(gt,{primary:o.label??`セット${o.key}`,sx:{opacity:le?1:0,display:le?"block":"none",whiteSpace:"nowrap"}})]},o.key))]})}),e.jsxs(s,{sx:{flexGrow:1,display:"flex",flexDirection:"column",width:U?`calc(100% - ${G?ye:we}px)`:"100%",transition:U?k.transitions.create("width",{duration:k.transitions.duration.standard}):void 0},children:[e.jsx(s,{sx:{flexGrow:1,position:"relative",overflowY:"hidden",display:"flex",width:"100%"},children:e.jsx(rn,{mode:"wait",children:Us})}),e.jsxs(Vt,{open:l,onClose:vt,children:[e.jsx(it,{children:"削除確認"}),e.jsx(rt,{sx:{mt:2},children:"このセットを削除しますか？"}),e.jsxs(lt,{children:[e.jsx(ue,{onClick:vt,startIcon:e.jsx(tt,{}),color:"inherit",children:"キャンセル"}),e.jsx(ue,{onClick:Bt,color:"error",startIcon:e.jsx(Ne,{}),children:"OK"})]})]}),e.jsxs(Vt,{open:_,onClose:hs,children:[e.jsx(it,{children:"復元確認"}),e.jsx(rt,{sx:{mt:2},children:"入力途中のデータが存在します。復元しますか？"}),e.jsxs(lt,{children:[e.jsx(ue,{onClick:hs,startIcon:e.jsx(tt,{}),color:"inherit",children:"いいえ"}),e.jsx(ue,{onClick:Hs,startIcon:e.jsx(Ne,{}),children:"はい"})]})]}),e.jsxs(Vt,{open:Ae,onClose:Ct,children:[e.jsx(it,{children:"保存確認"}),e.jsx(rt,{sx:{mt:2},children:"入力内容を保存しますか？"}),e.jsxs(lt,{children:[e.jsx(ue,{onClick:Ct,startIcon:e.jsx(tt,{}),color:"inherit",children:"キャンセル"}),e.jsx(ue,{onClick:Pt,disabled:!Pe||b,startIcon:e.jsx(Ne,{}),children:"OK"})]})]}),e.jsx(en,{open:i.open,message:i.message,severity:i.severity,onClose:Os,actionLabel:i.actionLabel,onAction:i.onAction,autoHideDuration:i.autoHideDuration})]})]})}export{Li as default};
