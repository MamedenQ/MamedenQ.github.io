import{i as Pe,j as e,E as it,G as rt,d as Ye,e as qe,B as t,F as Fe,K as Oe,S as He,M as ce,H as at,r as pe,J as vs,I as _e,L as Js,N as ps,a as Mt,O as Cs,n as Wt,Q as kt,R as We,Z as Ue,y as Ee,U as Ze,V as Ns,f as tt,g as Ct,h as St,k as Je,l as P,m as Tt,C as Qe,W as qt,X as Ie,A as Ss,Y as wt,_ as Gs,b as fs,$ as Xs,a0 as ft,a1 as gt,a2 as Ys,a3 as Qs,a4 as Zs,a5 as Ut,D as Vt}from"./mui-vendor-C85vPdgr.js";import{r as o,f as en,u as tn}from"./react-vendor-QLNaZ7XN.js";import{r as ke,u as dt,R as At,d as st,a as Ge,A as Ts,B as zt,b as ws,S as As,c as Et,e as Gt,f as xt,g as Ke,h as nt,i as Ft,j as Ve,D as ut,k as Ne}from"./index-D8dDU3XF.js";import{u as sn,t as et,P as gs,d as nn,a as rn}from"./PlayDetailChip-CymkIX0g.js";import{d as js}from"./SpaceDashboardOutlined-BDcllM-a.js";import{D as It,C as lt,P as ot,d as Ot,u as Ht,a as Kt}from"./useLongPress-BfGGnZ2z.js";import{m as an,A as ln}from"./motion-vendor-CXcnLVtk.js";import"./chart-vendor-DVL1rbVz.js";var Xt={},on=Pe;Object.defineProperty(Xt,"__esModule",{value:!0});var Is=Xt.default=void 0,dn=on(ke()),cn=e;Is=Xt.default=(0,dn.default)((0,cn.jsx)("path",{d:"M12 5.9c1.16 0 2.1.94 2.1 2.1s-.94 2.1-2.1 2.1S9.9 9.16 9.9 8s.94-2.1 2.1-2.1m0 9c2.97 0 6.1 1.46 6.1 2.1v1.1H5.9V17c0-.64 3.13-2.1 6.1-2.1M12 4C9.79 4 8 5.79 8 8s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4m0 9c-2.67 0-8 1.34-8 4v3h16v-3c0-2.66-5.33-4-8-4"}),"PersonOutlineOutlined");var Yt={},un=Pe;Object.defineProperty(Yt,"__esModule",{value:!0});var Ms=Yt.default=void 0,xn=un(ke()),hn=e;Ms=Yt.default=(0,xn.default)((0,hn.jsx)("path",{d:"M2 17h2v.5H3v1h1v.5H2v1h3v-4H2zm1-9h1V4H2v1h1zm-1 3h1.8L2 13.1v.9h3v-1H3.2L5 10.9V10H2zm5-6v2h14V5zm0 14h14v-2H7zm0-6h14v-2H7z"}),"FormatListNumberedOutlined");var Qt={},mn=Pe;Object.defineProperty(Qt,"__esModule",{value:!0});var Bs=Qt.default=void 0,pn=mn(ke()),fn=e;Bs=Qt.default=(0,pn.default)((0,fn.jsx)("path",{d:"M9 13.75c-2.34 0-7 1.17-7 3.5V19h14v-1.75c0-2.33-4.66-3.5-7-3.5M4.34 17c.84-.58 2.87-1.25 4.66-1.25s3.82.67 4.66 1.25zM9 12c1.93 0 3.5-1.57 3.5-3.5S10.93 5 9 5 5.5 6.57 5.5 8.5 7.07 12 9 12m0-5c.83 0 1.5.67 1.5 1.5S9.83 10 9 10s-1.5-.67-1.5-1.5S8.17 7 9 7m7.04 6.81c1.16.84 1.96 1.96 1.96 3.44V19h4v-1.75c0-2.02-3.5-3.17-5.96-3.44M15 12c1.93 0 3.5-1.57 3.5-3.5S16.93 5 15 5c-.54 0-1.04.13-1.5.35.63.89 1 1.98 1 3.15s-.37 2.26-1 3.15c.46.22.96.35 1.5.35"}),"GroupOutlined");var Zt={},gn=Pe;Object.defineProperty(Zt,"__esModule",{value:!0});var Ds=Zt.default=void 0,jn=gn(ke()),bn=e;Ds=Zt.default=(0,jn.default)((0,bn.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V5h14zm-7-2h2V7h-4v2h2z"}),"LooksOneOutlined");var es={},yn=Pe;Object.defineProperty(es,"__esModule",{value:!0});var Ps=es.default=void 0,vn=yn(ke()),Cn=e;Ps=es.default=(0,vn.default)((0,Cn.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V5h14zm-4-4h-4v-2h2c1.1 0 2-.89 2-2V9c0-1.11-.9-2-2-2H9v2h4v2h-2c-1.1 0-2 .89-2 2v4h6z"}),"LooksTwoOutlined");var ts={},Sn=Pe;Object.defineProperty(ts,"__esModule",{value:!0});var ks=ts.default=void 0,Tn=Sn(ke()),wn=e;ks=ts.default=(0,Tn.default)((0,wn.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V5h14zm-4-4v-1.5c0-.83-.67-1.5-1.5-1.5.83 0 1.5-.67 1.5-1.5V9c0-1.11-.9-2-2-2H9v2h4v2h-2v2h2v2H9v2h4c1.1 0 2-.89 2-2"}),"Looks3Outlined");var ss={},An=Pe;Object.defineProperty(ss,"__esModule",{value:!0});var $s=ss.default=void 0,In=An(ke()),Mn=e;$s=ss.default=(0,In.default)((0,Mn.jsx)("path",{d:"M19.04 3h-14c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16h-14V5h14zm-6-2h2V7h-2v4h-2V7h-2v6h4z"}),"Looks4Outlined");var ns={},Bn=Pe;Object.defineProperty(ns,"__esModule",{value:!0});var Rs=ns.default=void 0,Dn=Bn(ke()),Pn=e;Rs=ns.default=(0,Dn.default)((0,Pn.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V5h14zm-4-4v-2c0-1.11-.9-2-2-2h-2V9h4V7H9v6h4v2H9v2h4c1.1 0 2-.89 2-2"}),"Looks5Outlined");var is={},kn=Pe;Object.defineProperty(is,"__esModule",{value:!0});var $t=is.default=void 0,$n=kn(ke()),Rn=e;$t=is.default=(0,$n.default)((0,Rn.jsx)("path",{d:"M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8"}),"UndoOutlined");var rs={},_n=Pe;Object.defineProperty(rs,"__esModule",{value:!0});var Rt=rs.default=void 0,zn=_n(ke()),Fn=e;Rt=rs.default=(0,zn.default)((0,Fn.jsx)("path",{d:"M18.4 10.6C16.55 8.99 14.15 8 11.5 8c-4.65 0-8.58 3.03-9.96 7.22L3.9 16c1.05-3.19 4.05-5.5 7.6-5.5 1.95 0 3.73.72 5.12 1.88L13 16h9V7z"}),"RedoOutlined");var as={},On=Pe;Object.defineProperty(as,"__esModule",{value:!0});var _s=as.default=void 0,Hn=On(ke()),En=e;_s=as.default=(0,Hn.default)((0,En.jsx)("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreVert");function Ln(s,g,h){const y=o.useCallback(i=>{let M=0,j=0;i.rallies.forEach(m=>{if(m.timeoutTeam||m.substitutionTeam)return;const I=g.find(F=>F.id===m.teamAPlayDetail),L=g.find(F=>F.id===m.teamBPlayDetail);(I==null?void 0:I.pointType)==="得点"||(L==null?void 0:L.pointType)==="失点"?M+=1:((L==null?void 0:L.pointType)==="得点"||(I==null?void 0:I.pointType)==="失点")&&(j+=1)}),i.my=M,i.opponent=j},[g]),x=o.useCallback(i=>{const M=[...s.rallies,i],j={...s,rallies:M};y(j),h(j)},[s,y,h]),r=o.useCallback(i=>{const M=s.rallies.filter((m,I)=>I!==i),j={...s,rallies:M};y(j),h(j)},[s,y,h]);return{addRally:x,deleteRally:r,calculateScores:y}}const Wn=o.forwardRef(function({setScore:g,playDetails:h,playCategories:y,teamAMembers:x,teamBMembers:r,teamAName:i,teamBName:M,scoreInputSetting:j,themeSetting:m,locked:I=!1,onAdd:L,onEdit:F},B){var b,C,V,oe,ne,U,je,Te;const H=dt("sm"),[G,q]=o.useState(!1),[te,se]=o.useState("teamA"),[w,le]=o.useState(""),[X,re]=o.useState(""),[f,Y]=o.useState(""),[E,fe]=o.useState(""),[c,A]=o.useState(""),[J,Q]=o.useState(""),[O,Z]=o.useState(""),[ee,de]=o.useState(""),[Se,De]=o.useState(null),u=o.useRef(!1),[S,k]=o.useState(!1),[N,R]=o.useState("相手側のプレーを自動入力しました"),[$e,l]=o.useState("success"),{autoSourceIds:a,getAllowedCategories:T,getAutoInput:W}=sn({playDetails:h,playCategories:y,opponentPlayInputControlSetting:j.opponentPlayInputControlSetting,playCombinationSetting:j.playCombinationSetting}),_=o.useMemo(()=>new Map(h.map(n=>[n.id,n])),[h]),$=o.useMemo(()=>T(E),[E,T]),he=o.useMemo(()=>T(c),[c,T]);o.useEffect(()=>{f&&!$.some(n=>n.id===f)&&(Y(""),A(""))},[$,f,c]),o.useEffect(()=>{X&&!he.some(n=>n.id===X)&&(re(""),fe(""))},[he,X,E]);const ge=o.useMemo(()=>{const n=_.get(c),p=n?n.pointType==="得点"?"失点":"得点":null;return h.filter(ie=>ie.playCategoryId===X&&ie.visible!==!1&&(!p||ie.pointType===p))},[X,h,c,_]),xe=o.useMemo(()=>{const n=_.get(E),p=n?n.pointType==="得点"?"失点":"得点":null;return h.filter(ie=>ie.playCategoryId===f&&ie.visible!==!1&&(!p||ie.pointType===p))},[f,h,E,_]);o.useEffect(()=>{E&&!ge.some(n=>n.id===E)&&fe("")},[ge,E]),o.useEffect(()=>{c&&!xe.some(n=>n.id===c)&&A("")},[xe,c]);const v=()=>{if(I)return;De(null);const n=[...g.rallies].reverse().find(ie=>!ie.timeoutTeam&&!ie.substitutionTeam);let p="teamA";if(n){const ie=h.find(be=>be.id===n.teamAPlayDetail),we=h.find(be=>be.id===n.teamBPlayDetail);(ie==null?void 0:ie.pointType)==="得点"||(we==null?void 0:we.pointType)==="失点"?p="teamA":((we==null?void 0:we.pointType)==="得点"||(ie==null?void 0:ie.pointType)==="失点")&&(p="teamB")}se(p),le(""),re(""),Y(""),fe(""),A(""),Q(""),Z(""),de(""),q(!0)},D=n=>{var ie,we;if(I)return;const p=g.rallies[n];De(n),se(p.serverTeam||"teamA"),le(p.server&&(p.serverTeam==="teamA"?x.some(be=>be.id===p.server):r.some(be=>be.id===p.server))?p.server:""),re(((ie=h.find(be=>be.id===p.teamAPlayDetail))==null?void 0:ie.playCategoryId)||""),fe(p.teamAPlayDetail||""),Q(x.some(be=>be.id===p.teamAMember)&&p.teamAMember||""),Y(((we=h.find(be=>be.id===p.teamBPlayDetail))==null?void 0:we.playCategoryId)||""),A(p.teamBPlayDetail||""),Z(r.some(be=>be.id===p.teamBMember)&&p.teamBMember||""),de(p.timeoutTeam||""),q(!0)};o.useImperativeHandle(B,()=>({openAddDialog:v,openEditDialog:D})),o.useEffect(()=>{if(u.current){u.current=!1;return}const{detail:n,blocked:p}=W(E);if(n&&!c){if(p){R("相手プレー入力制御機能によって入力が制限されています"),l("warning"),k(!0);return}u.current=!0,Y(n.playCategoryId),A(n.id),R("相手側のプレーを自動入力しました"),l("success"),k(!0)}},[E]),o.useEffect(()=>{if(u.current){u.current=!1;return}const{detail:n,blocked:p}=W(c);if(n&&!E){if(p){R("相手プレー入力制御機能によって入力が制限されています"),l("warning"),k(!0);return}u.current=!0,re(n.playCategoryId),fe(n.id),R("相手側のプレーを自動入力しました"),l("success"),k(!0)}},[c]);const ue=()=>{var be,Me;if(ee)return!0;if(j.rallyMemberRequired&&!w||X&&!E||f&&!c||!!!(X&&E)&&!!!(f&&c))return!1;const ie=(be=h.find(Be=>Be.id===E))==null?void 0:be.pointUnitType;if(j.rallyMemberRequired&&E&&ie==="メンバー"&&!J)return!1;const we=(Me=h.find(Be=>Be.id===c))==null?void 0:Me.pointUnitType;return!(j.rallyMemberRequired&&c&&we==="メンバー"&&!O)},ye=n=>ee?{id:n??crypto.randomUUID(),timeoutTeam:ee}:{id:n??crypto.randomUUID(),serverTeam:te,server:w||void 0,teamAPlayDetail:E||void 0,teamAMember:J||void 0,teamBPlayDetail:c||void 0,teamBMember:O||void 0},Re=()=>{if(Se===null)L(ye());else{const n=g.rallies[Se].id;F(Se,ye(n))}q(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs(At,{open:G,onClose:()=>q(!1),children:[e.jsx(it,{children:Se===null?"ラリー追加":"ラリー編集"}),e.jsxs(rt,{sx:{display:"flex",flexDirection:"column"},children:[e.jsxs(Ye,{exclusive:!0,value:te,onChange:(n,p)=>p&&se(p),fullWidth:!0,disabled:!!ee,sx:{mb:1},children:[e.jsx(qe,{value:"teamA",sx:{flex:1},children:e.jsx(t,{sx:{whiteSpace:"pre-line",textAlign:"center"},children:`${i||"チームA"}
サーブ`})}),e.jsx(qe,{value:"teamB",sx:{flex:1},children:e.jsx(t,{sx:{whiteSpace:"pre-line",textAlign:"center"},children:`${M||"チームB"}
サーブ`})})]}),e.jsxs(Fe,{fullWidth:!0,margin:"dense",required:j.rallyMemberRequired,disabled:!!ee,children:[e.jsx(Oe,{id:"server",children:"サーバー"}),e.jsx(He,{labelId:"server",value:w,label:"サーバー",onChange:n=>le(n.target.value),children:(te==="teamA"?x:r).map(n=>e.jsx(ce,{value:n.id,children:n.name},n.id))})]}),H?e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(t,{sx:{flex:1,display:"flex",flexDirection:"column",gap:1},children:[e.jsxs(t,{sx:{display:"flex",gap:1,mt:2},children:[e.jsx(t,{sx:{flex:1,position:"relative",borderRadius:1},children:e.jsx(Ye,{orientation:"vertical",exclusive:!0,value:X,onChange:(n,p)=>{X===p||p===null?(re(""),fe("")):(re(p),fe(""))},disabled:!!ee,sx:{width:"100%"},children:he.map(n=>e.jsx(qe,{value:n.id,sx:{whiteSpace:"nowrap"},children:n.name},n.id))})}),e.jsx(t,{sx:{flex:1,position:"relative",borderRadius:1},children:e.jsx(Ye,{orientation:"vertical",exclusive:!0,value:E,onChange:(n,p)=>{fe(E===p||p===null?"":p)},disabled:!!ee,sx:{width:"100%"},children:ge.map(n=>{const p=n.pointType==="得点"?m.scoreColor:m.lossColor;return e.jsx(qe,{value:n.id,sx:{whiteSpace:"nowrap",color:p,"&.Mui-selected":{color:p}},children:a.has(n.id)?`${n.name}*`:n.name},n.id)})})})]}),e.jsxs(Fe,{fullWidth:!0,margin:"dense",required:j.rallyMemberRequired&&((b=h.find(n=>n.id===E))==null?void 0:b.pointUnitType)==="メンバー",disabled:!!ee,children:[e.jsx(Oe,{id:"amem",children:`${i||"チームA"}メンバー`}),e.jsxs(He,{labelId:"amem",value:J,label:`${i||"チームA"}メンバー`,onChange:n=>Q(n.target.value),disabled:((C=h.find(n=>n.id===E))==null?void 0:C.pointUnitType)!=="メンバー",children:[e.jsx(ce,{value:"",children:e.jsx("em",{children:"なし"})}),x.map(n=>e.jsx(ce,{value:n.id,children:n.name},n.id))]})]})]}),e.jsxs(t,{sx:{flex:1,display:"flex",flexDirection:"column",gap:1},children:[e.jsxs(t,{sx:{display:"flex",gap:1,mt:2},children:[e.jsx(t,{sx:{flex:1,position:"relative",borderRadius:1},children:e.jsx(Ye,{orientation:"vertical",exclusive:!0,value:f,onChange:(n,p)=>{f===p||p===null?(Y(""),A("")):(Y(p),A(""))},disabled:!!ee,sx:{width:"100%"},children:$.map(n=>e.jsx(qe,{value:n.id,sx:{whiteSpace:"nowrap"},children:n.name},n.id))})}),e.jsx(t,{sx:{flex:1,position:"relative",borderRadius:1},children:e.jsx(Ye,{orientation:"vertical",exclusive:!0,value:c,onChange:(n,p)=>{A(c===p||p===null?"":p)},disabled:!!ee,sx:{width:"100%"},children:xe.map(n=>{const p=n.pointType==="得点"?m.scoreColor:m.lossColor;return e.jsx(qe,{value:n.id,sx:{whiteSpace:"nowrap",color:p,"&.Mui-selected":{color:p}},children:a.has(n.id)?`${n.name}*`:n.name},n.id)})})})]}),e.jsxs(Fe,{fullWidth:!0,margin:"dense",required:j.rallyMemberRequired&&((V=h.find(n=>n.id===c))==null?void 0:V.pointUnitType)==="メンバー",disabled:!!ee,children:[e.jsx(Oe,{id:"bmem",children:`${M||"チームB"}メンバー`}),e.jsxs(He,{labelId:"bmem",value:O,label:`${M||"チームB"}メンバー`,onChange:n=>Z(n.target.value),disabled:((oe=h.find(n=>n.id===c))==null?void 0:oe.pointUnitType)!=="メンバー",children:[e.jsx(ce,{value:"",children:e.jsx("em",{children:"なし"})}),r.map(n=>e.jsx(ce,{value:n.id,children:n.name},n.id))]})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(t,{sx:{display:"flex",gap:2,mt:1},children:[e.jsx(t,{sx:{flex:"1 1 25%",position:"relative",borderRadius:1},children:e.jsx(Ye,{orientation:"vertical",exclusive:!0,value:X,onChange:(n,p)=>{X===p||p===null?(re(""),fe("")):(re(p),fe(""))},disabled:!!ee,sx:{width:"100%"},children:he.map(n=>e.jsx(qe,{value:n.id,sx:{whiteSpace:"nowrap"},children:n.name},n.id))})}),e.jsx(t,{sx:{flex:"1 1 25%",position:"relative",borderRadius:1},children:e.jsx(Ye,{orientation:"vertical",exclusive:!0,value:E,onChange:(n,p)=>{fe(E===p||p===null?"":p)},disabled:!!ee,sx:{width:"100%"},children:ge.map(n=>{const p=n.pointType==="得点"?m.scoreColor:m.lossColor;return e.jsx(qe,{value:n.id,sx:{whiteSpace:"nowrap",color:p,"&.Mui-selected":{color:p}},children:a.has(n.id)?`${n.name}*`:n.name},n.id)})})}),e.jsx(t,{sx:{flex:"1 1 25%",position:"relative",borderRadius:1},children:e.jsx(Ye,{orientation:"vertical",exclusive:!0,value:f,onChange:(n,p)=>{f===p||p===null?(Y(""),A("")):(Y(p),A(""))},disabled:!!ee,sx:{width:"100%"},children:$.map(n=>e.jsx(qe,{value:n.id,sx:{whiteSpace:"nowrap"},children:n.name},n.id))})}),e.jsx(t,{sx:{flex:"1 1 25%",position:"relative",borderRadius:1},children:e.jsx(Ye,{orientation:"vertical",exclusive:!0,value:c,onChange:(n,p)=>{A(c===p||p===null?"":p)},disabled:!!ee,sx:{width:"100%"},children:xe.map(n=>{const p=n.pointType==="得点"?m.scoreColor:m.lossColor;return e.jsx(qe,{value:n.id,sx:{whiteSpace:"nowrap",color:p,"&.Mui-selected":{color:p}},children:a.has(n.id)?`${n.name}*`:n.name},n.id)})})})]}),e.jsxs(t,{sx:{display:"flex",gap:2,mt:1},children:[e.jsxs(Fe,{fullWidth:!0,margin:"dense",required:j.rallyMemberRequired&&((ne=h.find(n=>n.id===E))==null?void 0:ne.pointUnitType)==="メンバー",disabled:!!ee,sx:{flex:1},children:[e.jsx(Oe,{id:"amem",children:`${i||"チームA"}メンバー`}),e.jsxs(He,{labelId:"amem",value:J,label:`${i||"チームA"}メンバー`,onChange:n=>Q(n.target.value),disabled:((U=h.find(n=>n.id===E))==null?void 0:U.pointUnitType)!=="メンバー",children:[e.jsx(ce,{value:"",children:e.jsx("em",{children:"なし"})}),x.map(n=>e.jsx(ce,{value:n.id,children:n.name},n.id))]})]}),e.jsxs(Fe,{fullWidth:!0,margin:"dense",required:j.rallyMemberRequired&&((je=h.find(n=>n.id===c))==null?void 0:je.pointUnitType)==="メンバー",disabled:!!ee,sx:{flex:1},children:[e.jsx(Oe,{id:"bmem",children:`${M||"チームB"}メンバー`}),e.jsxs(He,{labelId:"bmem",value:O,label:`${M||"チームB"}メンバー`,onChange:n=>Z(n.target.value),disabled:((Te=h.find(n=>n.id===c))==null?void 0:Te.pointUnitType)!=="メンバー",children:[e.jsx(ce,{value:"",children:e.jsx("em",{children:"なし"})}),r.map(n=>e.jsx(ce,{value:n.id,children:n.name},n.id))]})]})]})]})]}),e.jsxs(at,{children:[e.jsx(pe,{onClick:()=>q(!1),color:"inherit",startIcon:e.jsx(st,{}),children:"キャンセル"}),e.jsx(pe,{onClick:Re,disabled:!ue(),startIcon:e.jsx(Ge,{}),children:"OK"})]})]}),e.jsx(Ts,{open:S,message:N,severity:$e,onClose:()=>k(!1)})]})});var ls={},Un=Pe;Object.defineProperty(ls,"__esModule",{value:!0});var zs=ls.default=void 0,Vn=Un(ke()),qn=e;zs=ls.default=(0,Vn.default)((0,qn.jsx)("path",{d:"M16 17.01V10h-2v7.01h-3L15 21l4-3.99zM9 3 5 6.99h3V14h2V6.99h3zm7 14.01V10h-2v7.01h-3L15 21l4-3.99zM9 3 5 6.99h3V14h2V6.99h3z"}),"SwapVertOutlined");const Kn=o.forwardRef(function({teamAMembers:g,teamBMembers:h,onSave:y},x){const[r,i]=o.useState(!1),[M,j]=o.useState("teamA"),[m,I]=o.useState(""),[L,F]=o.useState(""),[B,H]=o.useState(null),G=w=>{j(w),I(""),F(""),H(null),i(!0)},q=(w,le,X,re)=>{j(le),I(X),F(re),H(w),i(!0)};o.useImperativeHandle(x,()=>({openAddDialog:G,openEditDialog:q}));const te=()=>{i(!1),H(null)},se=()=>{y(M,m,L,B),i(!1),H(null)};return e.jsxs(At,{open:r,onClose:te,children:[e.jsx(it,{children:"選手交代"}),e.jsx(rt,{children:e.jsxs(t,{component:"form",sx:{mt:2},children:[e.jsxs(Fe,{fullWidth:!0,sx:{mb:2},children:[e.jsx(Oe,{id:"out-member",children:"OUT"}),e.jsx(He,{labelId:"out-member",value:m,label:"OUT",onChange:w=>I(w.target.value),children:(M==="teamA"?g:h).map(w=>e.jsx(ce,{value:w.id,children:`${w.no}:${w.name}`},w.id))})]}),e.jsx(t,{sx:{display:"flex",justifyContent:"center",mb:2},children:e.jsx(zs,{sx:{width:32,height:32}})}),e.jsxs(Fe,{fullWidth:!0,children:[e.jsx(Oe,{id:"in-member",children:"IN"}),e.jsx(He,{labelId:"in-member",value:L,label:"IN",onChange:w=>F(w.target.value),children:(M==="teamA"?g:h).map(w=>e.jsx(ce,{value:w.id,children:`${w.no}:${w.name}`},w.id))})]})]})}),e.jsxs(at,{children:[e.jsx(pe,{onClick:te,color:"inherit",startIcon:e.jsx(st,{}),children:"キャンセル"}),e.jsx(pe,{onClick:se,disabled:!m||!L,startIcon:e.jsx(Ge,{}),children:"OK"})]})]})});function Jn({open:s,onClose:g,scores:h,consecutive:y,connections:x,rowHeight:r}){const i=h.length*r,M=()=>{ws(),g()};return e.jsx(vs,{anchor:"bottom",open:s,onClose:M,onOpen:()=>{},disableSwipeToOpen:!0,sx:{zIndex:j=>j.zIndex.drawer+3},ModalProps:{disableEnforceFocus:!0},PaperProps:{sx:{height:"60vh",borderTopLeftRadius:zt,borderTopRightRadius:zt}},children:e.jsxs(t,{sx:{position:"relative",height:"100%"},children:[e.jsx(t,{sx:{width:40,height:4,bgcolor:"text.secondary",borderRadius:2,position:"absolute",top:8,left:"50%",transform:"translateX(-50%)"}}),e.jsx(_e,{onClick:M,sx:{position:"absolute",top:4,right:4},children:e.jsx(st,{})}),e.jsx(t,{sx:{mt:4,height:"100%",overflowY:"auto"},children:e.jsxs(t,{sx:{flex:"0 0 100%",overflowY:"auto",height:"100%",position:"relative"},children:[h.map((j,m)=>{const I=m===0?{a:0,b:0}:h[m-1],L=j.a!==I.a&&j.a!==0,F=j.b!==I.b&&j.b!==0,B=L&&y[m],H=F&&y[m];return e.jsxs(t,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr 1fr",alignItems:"center",py:.5,height:`${r}px`,position:"relative",zIndex:1},children:[e.jsx(t,{}),e.jsxs(e.Fragment,{children:[e.jsx(t,{sx:{display:"flex",justifyContent:"center"},children:L?e.jsx(t,{sx:{width:32,height:32,border:"1px solid",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:24,borderColor:B?"red":"currentColor",backgroundColor:B?"#ffebee":"#fff",color:"black"},children:j.a}):null}),e.jsx(t,{}),e.jsx(t,{sx:{display:"flex",justifyContent:"center"},children:F?e.jsx(t,{sx:{width:32,height:32,border:"1px solid",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:24,borderColor:H?"red":"currentColor",backgroundColor:H?"#ffebee":"#fff",color:"black"},children:j.b}):null})]}),e.jsx(t,{})]},m)}),e.jsx("svg",{viewBox:`0 0 100 ${i}`,style:{position:"absolute",left:0,top:0,width:"100%",height:i,zIndex:0},preserveAspectRatio:"none",pointerEvents:"none",children:x.map(j=>{const m=j.index*r+r/2,I=(j.index+1)*r+r/2,L=j.from==="A"?30:70,F=j.from==="A"?70:30;return e.jsx("line",{x1:L,y1:m,x2:F,y2:I,stroke:"currentColor",strokeWidth:1},j.index)})})]})})]})})}var os={},Nn=Pe;Object.defineProperty(os,"__esModule",{value:!0});var Fs=os.default=void 0,Gn=Nn(ke()),Xn=e;Fs=os.default=(0,Gn.default)((0,Xn.jsx)("path",{d:"M3 18h18v-2H3zm0-5h18v-2H3zm0-7v2h18V6z"}),"Menu");function Yn({open:s,onClose:g,teamAName:h,teamBName:y,disableTimeoutA:x,disableTimeoutB:r,showScoreProgressButton:i,onShowScoreProgress:M,onSubstitution:j,onTimeout:m,onAddRally:I,locked:L}){const F=()=>{ws(),g()},B=q=>()=>{q(),F()},G=dt("sm")?"vertical":"horizontal";return e.jsx(vs,{anchor:"bottom",open:s,onClose:F,onOpen:()=>{},sx:{zIndex:q=>q.zIndex.drawer+2},ModalProps:{disableEnforceFocus:!0},disableSwipeToOpen:L,PaperProps:{sx:{height:"auto",maxHeight:"80vh",borderTopLeftRadius:zt,borderTopRightRadius:zt}},children:e.jsx(t,{sx:{p:2},children:e.jsxs(Js,{spacing:2,children:[i&&e.jsx(pe,{fullWidth:!0,size:"large",variant:"outlined",onClick:B(M),children:"得点推移表示"}),e.jsxs(ps,{fullWidth:!0,orientation:G,children:[e.jsx(pe,{size:"large",onClick:B(()=>j("teamA")),children:(h||"チームA")+" メンバー交代"}),e.jsx(pe,{size:"large",onClick:B(()=>j("teamB")),children:(y||"チームB")+" メンバー交代"})]}),e.jsxs(ps,{fullWidth:!0,orientation:G,children:[e.jsx(pe,{disabled:x,size:"large",onClick:B(()=>m("teamA")),children:(h||"チームA")+" タイムアウト"}),e.jsx(pe,{disabled:r,size:"large",onClick:B(()=>m("teamB")),children:(y||"チームB")+" タイムアウト"})]}),e.jsx(pe,{fullWidth:!0,variant:"contained",size:"large",onClick:B(I),children:"ラリー結果追加"})]})})})}var ds={},Qn=Pe;Object.defineProperty(ds,"__esModule",{value:!0});var Os=ds.default=void 0,Zn=Qn(ke()),ei=e;Os=ds.default=(0,Zn.default)((0,ei.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8m.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"}),"AccessTimeOutlined");var cs={},ti=Pe;Object.defineProperty(cs,"__esModule",{value:!0});var Hs=cs.default=void 0,si=ti(ke()),ni=e;Hs=cs.default=(0,si.default)((0,ni.jsx)("path",{d:"M6.99 11 3 15l3.99 4v-3H14v-2H6.99zM21 9l-3.99-4v3H10v2h7.01v3z"}),"SwapHorizOutlined");function ii({teamAName:s,teamBName:g,locked:h,disableTimeoutA:y,disableTimeoutB:x,onTimeout:r,onSubstitution:i,onAddRally:M}){const j=Mt(),[m,I]=o.useState(!1),[L,F]=o.useState(!1),B=As,[H,G]=o.useState(()=>!localStorage.getItem(B));return h?null:e.jsxs(Cs,{children:[e.jsxs(Wt,{ariaLabel:"substitution actions",direction:"left",icon:e.jsx(Hs,{}),onOpen:()=>F(!0),onClose:()=>F(!1),open:L,FabProps:{size:"large"},sx:{position:"fixed",right:35,bottom:200,zIndex:q=>q.zIndex.drawer-1},children:[e.jsx(kt,{icon:e.jsx(e.Fragment,{children:g||"チームB"}),tooltipTitle:"",FabProps:{variant:"extended",size:"small"},onClick:()=>{i("teamB"),F(!1)}}),e.jsx(kt,{icon:e.jsx(e.Fragment,{children:s||"チームA"}),tooltipTitle:"",FabProps:{variant:"extended",size:"small"},onClick:()=>{i("teamA"),F(!1)}})]}),e.jsxs(Wt,{ariaLabel:"timeout actions",direction:"left",icon:e.jsx(Os,{}),onOpen:()=>I(!0),onClose:()=>I(!1),open:m,FabProps:{size:"large"},sx:{position:"fixed",right:35,bottom:140,zIndex:q=>q.zIndex.drawer-1},children:[e.jsx(kt,{icon:e.jsx(e.Fragment,{children:g||"チームB"}),tooltipTitle:"",FabProps:{variant:"extended",size:"small",disabled:x},onClick:()=>{r("teamB"),I(!1)}}),e.jsx(kt,{icon:e.jsx(e.Fragment,{children:s||"チームA"}),tooltipTitle:"",FabProps:{variant:"extended",size:"small",disabled:y},onClick:()=>{r("teamA"),I(!1)}})]}),e.jsx(We,{open:H,onClose:()=>G(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"left",TransitionComponent:Ue,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${j.palette.text.secondary}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${j.palette.text.secondary}`}}}},title:e.jsxs(t,{sx:{p:1,maxWidth:260},children:[e.jsx(Ee,{variant:"body2",sx:{whiteSpace:"pre-line"},children:et.addRally.text}),e.jsx(t,{sx:{textAlign:"right",mt:1},children:e.jsx(Ze,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem(B,"1"),G(!1)},children:"了解した"})})]}),children:e.jsx(Wt,{ariaLabel:"rally actions",direction:"left",icon:e.jsx(Et,{}),FabProps:{size:"large",onClick:M},sx:{position:"fixed",right:35,bottom:80,zIndex:q=>q.zIndex.drawer-1}})})]})}function ri({isMobile:s,openActionMenu:g,onOpenActionMenu:h,onCloseActionMenu:y,teamAName:x,teamBName:r,disableTimeoutA:i,disableTimeoutB:M,showScoreProgressButton:j,onShowScoreProgress:m,onSubstitution:I,onTimeout:L,onAddRally:F,locked:B}){const H=Mt(),G=As,[q,te]=o.useState(()=>s&&!localStorage.getItem(G));return e.jsxs(e.Fragment,{children:[!B&&s&&e.jsx(Cs,{children:e.jsx(We,{open:q,onClose:()=>te(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"top-start",TransitionComponent:Ue,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${H.palette.text.secondary}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${H.palette.text.secondary}`}}}},title:e.jsxs(t,{sx:{p:1,maxWidth:260},children:[e.jsx(Ee,{variant:"body2",sx:{whiteSpace:"pre-line"},children:et.addRally.text}),e.jsx(t,{sx:{textAlign:"right",mt:1},children:e.jsx(Ze,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem(G,"1"),te(!1)},children:"了解した"})})]}),children:e.jsx(Ns,{color:"primary",onClick:h,sx:{position:"fixed",right:35,bottom:se=>`calc(${se.spacing(7)} + env(safe-area-inset-bottom) + 16px)`,zIndex:se=>se.zIndex.drawer+2},children:e.jsx(Fs,{})})})}),s?e.jsx(Yn,{open:g,onClose:y,teamAName:x,teamBName:r,disableTimeoutA:i,disableTimeoutB:M,showScoreProgressButton:j,onShowScoreProgress:m,onSubstitution:I,onTimeout:L,onAddRally:F,locked:B}):e.jsx(ii,{teamAName:x,teamBName:r,locked:B,disableTimeoutA:i,disableTimeoutB:M,onSubstitution:I,onTimeout:L,onAddRally:F})]})}var us={},ai=Pe;Object.defineProperty(us,"__esModule",{value:!0});var _t=us.default=void 0,li=ai(ke()),oi=e;_t=us.default=(0,li.default)((0,oi.jsx)("path",{d:"M16.01 11H4v2h12.01v3L20 12l-3.99-4z"}),"ArrowRightAlt");var xs={},di=Pe;Object.defineProperty(xs,"__esModule",{value:!0});var Jt=xs.default=void 0,ci=di(ke()),ui=e;Jt=xs.default=(0,ci.default)((0,ui.jsx)("path",{d:"m12 4-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"}),"ArrowForward");function xi(s){if(typeof window>"u")return s;try{const h=new DOMParser().parseFromString(s,"image/svg+xml"),y=new Set(["svg","g","path","circle","rect","line","polygon","polyline","text","defs","use"]),x=r=>{[...r.children].forEach(i=>{if(y.has(i.tagName))[...i.attributes].forEach(M=>{M.name.startsWith("on")&&i.removeAttribute(M.name)}),x(i);else{const M=document.createTextNode(i.outerHTML);i.replaceWith(M)}})};return x(h.documentElement),h.documentElement.outerHTML}catch{return""}}function hi({name:s}){const g=o.useRef(null),[h,y]=o.useState(1);return o.useEffect(()=>{const x=g.current;if(!x)return;const r=x.getBBox().width;y(r>64?64/r:1)},[s]),e.jsx("svg",{width:64,height:64,children:e.jsx("g",{transform:`scale(${h})`,children:e.jsx("text",{ref:g,x:32/h,y:32/h,textAnchor:"middle",dominantBaseline:"central",fontSize:8,children:s})})})}function mi({category:s,borderColor:g}){const h=g?{border:"1px solid",borderColor:g,boxSizing:"border-box"}:{};return s.iconType==="svg"&&s.svg?e.jsx(t,{sx:{width:64,height:64,...h},dangerouslySetInnerHTML:{__html:xi(s.svg)}}):s.iconType==="image"&&s.image?e.jsx(t,{component:"img",src:s.image,sx:{width:64,height:64,objectFit:"none",objectPosition:`-${s.cropX||0}px -${s.cropY||0}px`,...h}}):e.jsx(t,{sx:{width:64,height:64,display:"flex",...h},children:e.jsx(hi,{name:s.name})})}function pi({rallies:s,playDetails:g,playCategories:h,teamAMembers:y,teamBMembers:x,teamAName:r,teamBName:i,serveCategory:M,showRallyIcons:j,locked:m,isMobile:I,isPhone:L,scores:F,scoredTeam:B,showRallyHint:H,onCloseRallyHint:G,onEditRally:q,onEditSubstitution:te,onDelete:se,onDragEnd:w}){const le=Mt(),{handleTouchEnd:X,setSwiperRef:re,getSwiperRef:f}=Gt(2),Y=o.useRef({}),[E,fe]=o.useState({}),[c,A]=o.useState("");o.useLayoutEffect(()=>{const u={};s.forEach(S=>{const k=Y.current[S.id];k&&(u[S.id]=k.offsetHeight)}),fe(u)},[s]),o.useEffect(()=>{s.forEach(u=>{const S=f(u.id);S&&(S.allowTouchMove=!m,m&&S.slideTo(0))})},[m,s,f]);const J=u=>{if(!u)return;const S=g.find(k=>k.id===u);return h.find(k=>k.id===(S==null?void 0:S.playCategoryId))},Q=(u,S)=>{if(!S)return"－";const N=(u==="teamA"?y:x).find(R=>R.id===S);return N?`${N.no}:${N.name}`:"－"},O=u=>{const S=F[u]||{a:0,b:0},k=B[u],N=le.palette.text.primary,R=le.palette.mode==="dark"?"#343A42":"#D3D3D3";return e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{color:k==="A"?N:R},children:String(S.a).padStart(2,"0")}),e.jsx("span",{style:{color:R},children:" - "}),e.jsx("span",{style:{color:k==="B"?N:R},children:String(S.b).padStart(2,"0")})]})},Z=(u,S,k)=>{var a;if(!u)return e.jsx(e.Fragment,{});const N=J(u),R=g.find(T=>T.id===u),$e=k==="A"?y:x,l=(R==null?void 0:R.pointType)==="得点"?le.palette.success.main:(R==null?void 0:R.pointType)==="失点"?le.palette.error.main:void 0;return e.jsxs(t,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[N?e.jsx(gs,{label:N.name,variant:"outlined",sx:{bgcolor:"transparent",color:N.color,borderColor:N.color,mb:.5}}):null,R?e.jsx(gs,{label:R.name,sx:{bgcolor:l,color:"common.white",mb:.5}}):null,!L&&e.jsx(Ee,{variant:"caption",noWrap:!0,sx:{width:"100%",textAlign:"center"},children:(R==null?void 0:R.pointUnitType)==="メンバー"&&((a=$e.find(T=>T.id===S))==null?void 0:a.name)||"－"})]})},ee=(u,S,k)=>e.jsx(t,{ref:k.innerRef,...k.draggableProps,"data-index":S,sx:{mb:.5},children:e.jsxs(Ft,{onSwiper:N=>re(u.id,N),threshold:20,slidesPerView:"auto",style:{overflow:"hidden",height:E[u.id]},onTouchStart:(N,R)=>R.stopPropagation(),onTouchEnd:N=>X(u.id,N),children:[e.jsx(Ve,{style:{width:"100%",flex:"0 0 auto"},children:(()=>{const N=k.dragHandleProps,{onPointerDown:R,...$e}=N||{},l=Ht(a=>{if(R==null||R(a),!R)return;const T=f(u.id);T&&(T.allowTouchMove=!1),A(u.id)});return e.jsx(t,{ref:a=>{Y.current[u.id]=a},...$e,...l,sx:{display:"grid",gridTemplateColumns:"38% 24% 38%",alignItems:"center",cursor:m?"default":"grab",touchAction:c===u.id?"none":"pan-y",backgroundColor:a=>u.timeoutTeam||u.substitutionTeam?a.palette.mode==="dark"?"#343A42":"#f5f5f5":void 0},children:u.timeoutTeam?e.jsxs(t,{gridColumn:"1 / 4",sx:{...Ke,display:"flex",justifyContent:"center",alignItems:"center",height:"100%",minHeight:44},children:[u.timeoutTeam==="teamA"?r||"チームA":i||"チームB","タイムアウト"]}):u.substitutionTeam?e.jsxs(t,{gridColumn:"1 / 4",sx:{...Ke,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100%"},children:[e.jsxs("span",{children:[u.substitutionTeam==="teamA"?r||"チームA":i||"チームB","選手交代"]}),e.jsxs(t,{sx:{display:"flex",alignItems:"center",mt:.5},children:[e.jsx("span",{children:Q(u.substitutionTeam,u.outMember)}),e.jsx(_t,{fontSize:"small",sx:{mx:1}}),e.jsx("span",{children:Q(u.substitutionTeam,u.inMember)})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(t,{children:Z(u.teamAPlayDetail,u.teamAMember,"A")}),e.jsxs(t,{sx:{fontSize:"2em",display:"flex",justifyContent:"center",flexDirection:"column",alignItems:"center"},children:[e.jsx(t,{sx:{whiteSpace:"nowrap"},children:O(S)}),u.serverTeam&&e.jsx(Jt,{sx:{width:"calc(100% - 8px)",height:20,mx:"4px",transform:u.serverTeam==="teamB"?"scaleX(-1)":void 0}})]}),e.jsx(t,{children:Z(u.teamBPlayDetail,u.teamBMember,"B")})]})})})()}),e.jsx(Ve,{style:{width:ut,flex:"0 0 auto"},children:e.jsx(t,{sx:{height:E[u.id],display:"flex",alignItems:"center",justifyContent:"center",bgcolor:m?"grey.500":"primary.main"},children:e.jsx(_e,{size:"small",disabled:m||!!u.timeoutTeam,onClick:m||u.timeoutTeam?void 0:()=>u.substitutionTeam?te(S):q(S),children:e.jsx(Kt,{fontSize:"small",sx:{color:"common.white"}})})})}),e.jsx(Ve,{style:{width:ut,flex:"0 0 auto"},children:e.jsx(t,{sx:{height:E[u.id],display:"flex",alignItems:"center",justifyContent:"center",bgcolor:m?"grey.500":"error.main"},children:e.jsx(_e,{size:"small",disabled:m,onClick:m?void 0:()=>se(S),children:e.jsx(nt,{fontSize:"small",sx:{color:"common.white"}})})})})]})}),de=(u,S)=>{var k;return e.jsxs(t,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[j&&(M?e.jsx(mi,{category:M}):e.jsxs("svg",{width:64,height:64,children:[e.jsx("rect",{width:64,height:64,fill:"none",stroke:"currentColor"}),e.jsx("text",{x:"50%",y:"50%",textAnchor:"middle",dominantBaseline:"central",fontSize:"12",children:"サーブ"})]})),e.jsx(Ee,{variant:"caption",noWrap:!0,sx:{width:"100%",textAlign:"center"},children:((k=(u==="teamA"?y:x).find(N=>N.id===S))==null?void 0:k.name)||"－"})]})},Se=(u,S,k)=>e.jsx(t,{ref:k.innerRef,...k.draggableProps,"data-index":S,sx:{mb:.5},children:e.jsxs(Ft,{onSwiper:N=>re(u.id,N),threshold:20,slidesPerView:"auto",style:{overflow:"hidden",height:E[u.id]},onTouchStart:(N,R)=>R.stopPropagation(),onTouchEnd:N=>X(u.id,N),children:[e.jsx(Ve,{style:{width:"100%",flex:"0 0 auto"},children:(()=>{const N=k.dragHandleProps,{onPointerDown:R,...$e}=N||{},l=Ht(a=>{if(R==null||R(a),!R)return;const T=f(u.id);T&&(T.allowTouchMove=!1),A(u.id)});return e.jsx(t,{ref:a=>{Y.current[u.id]=a},...$e,...l,sx:{display:"grid",gridTemplateColumns:"16% 22% 24% 22% 16%",alignItems:"center",cursor:m?"default":"grab",touchAction:c===u.id?"none":"pan-y",backgroundColor:a=>u.timeoutTeam||u.substitutionTeam?a.palette.mode==="dark"?"#343A42":"#f5f5f5":void 0},children:u.timeoutTeam?e.jsxs(t,{gridColumn:"1 / 6",sx:{...Ke,display:"flex",justifyContent:"center",alignItems:"center",height:"100%",minHeight:44},children:[u.timeoutTeam==="teamA"?r||"チームA":i||"チームB","タイムアウト"]}):u.substitutionTeam?e.jsxs(t,{gridColumn:"1 / 6",sx:{...Ke,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100%"},children:[e.jsxs("span",{children:[u.substitutionTeam==="teamA"?r||"チームA":i||"チームB","選手交代"]}),e.jsxs(t,{sx:{display:"flex",alignItems:"center",mt:.5},children:[e.jsx("span",{children:Q(u.substitutionTeam,u.outMember)}),e.jsx(_t,{fontSize:"small",sx:{mx:1}}),e.jsx("span",{children:Q(u.substitutionTeam,u.inMember)})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(t,{children:u.serverTeam==="teamA"?de("teamA",u.server):null}),e.jsx(t,{children:Z(u.teamAPlayDetail,u.teamAMember,"A")}),e.jsxs(t,{sx:{fontSize:"2em",display:"flex",justifyContent:"center",flexDirection:"column",alignItems:"center"},children:[e.jsx(t,{sx:{whiteSpace:"nowrap"},children:O(S)}),u.serverTeam&&e.jsx(Jt,{sx:{width:"calc(100% - 8px)",height:20,mx:"4px",transform:u.serverTeam==="teamB"?"scaleX(-1)":void 0}})]}),e.jsx(t,{children:Z(u.teamBPlayDetail,u.teamBMember,"B")}),e.jsx(t,{children:u.serverTeam==="teamB"?de("teamB",u.server):null})]})})})()}),e.jsx(Ve,{style:{width:ut,flex:"0 0 auto"},children:e.jsx(t,{sx:{height:E[u.id],display:"flex",alignItems:"center",justifyContent:"center",bgcolor:m?"grey.500":"primary.main"},children:e.jsx(_e,{size:"small",disabled:m||!!u.timeoutTeam,onClick:m||u.timeoutTeam?void 0:()=>u.substitutionTeam?te(S):q(S),children:e.jsx(Kt,{fontSize:"small",sx:{color:"common.white"}})})})}),e.jsx(Ve,{style:{width:ut,flex:"0 0 auto"},children:e.jsx(t,{sx:{height:E[u.id],display:"flex",alignItems:"center",justifyContent:"center",bgcolor:m?"grey.500":"error.main"},children:e.jsx(_e,{size:"small",disabled:m,onClick:m?void 0:()=>se(S),children:e.jsx(nt,{fontSize:"small",sx:{color:"common.white"}})})})})]})}),De=u=>{if(c){const S=f(c);S&&(S.allowTouchMove=!0),A("")}w(u)};return e.jsx(We,{open:H&&I,onClose:G,disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:Ue,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${le.palette.text.secondary}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${le.palette.text.secondary}`}}}},title:e.jsxs(t,{sx:{p:1,maxWidth:260},children:[e.jsx(Ee,{variant:"body2",sx:{whiteSpace:"pre-line"},children:et.rallyListRow.text}),e.jsx(t,{sx:{textAlign:"right",mt:1},children:e.jsx(Ze,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem("tutorial-rally-row","1"),G()},children:"了解した"})})]}),children:e.jsx(t,{children:e.jsxs(It,{onDragEnd:De,children:[I&&e.jsx(xt,{component:tt,storageKey:"set-tab",children:e.jsxs(t,{children:[e.jsx(t,{sx:{display:"grid",gridTemplateColumns:L?"38% 24% 38%":"16% 22% 24% 22% 16%",textAlign:"center",alignItems:"center",...Ke},children:L?e.jsxs(e.Fragment,{children:[e.jsx(t,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:44},children:e.jsx("span",{children:r||"チームA"})}),e.jsx(t,{sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:"得点"}),e.jsx(t,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:44},children:e.jsx("span",{children:i||"チームB"})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(t,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("span",{children:r||"チームA"}),e.jsx("span",{children:"サーブ"})]}),e.jsxs(t,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("span",{children:r||"チームA"}),e.jsx("span",{children:"ラリー結果"})]}),e.jsx(t,{sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:"得点"}),e.jsxs(t,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("span",{children:i||"チームB"}),e.jsx("span",{children:"ラリー結果"})]}),e.jsxs(t,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx("span",{children:i||"チームB"}),e.jsx("span",{children:"サーブ"})]})]})}),e.jsx(lt,{droppableId:"rallies",children:u=>e.jsxs(t,{ref:u.innerRef,...u.droppableProps,children:[s.map((S,k)=>e.jsx(ot,{draggableId:S.id,index:k,isDragDisabled:m,children:N=>(L?ee:Se)(S,k,N)},S.id)),u.placeholder]})})]})}),!I&&e.jsx(xt,{component:tt,storageKey:"set-tab",children:e.jsxs(Ct,{size:"small",sx:{tableLayout:"fixed","& th, & td":{textAlign:"center",verticalAlign:"middle"}},children:[e.jsx(St,{children:e.jsxs(Je,{sx:{...Ke},children:[e.jsx(P,{sx:{width:"6%"}}),e.jsx(P,{sx:{width:"16%"},children:e.jsxs(t,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{children:r||"チームA"}),e.jsx("span",{children:"サーブ"})]})}),e.jsx(P,{sx:{width:"18%"},children:e.jsxs(t,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{children:r||"チームA"}),e.jsx("span",{children:"ラリー結果"})]})}),e.jsx(P,{sx:{width:"20%",display:"flex",justifyContent:"center",alignItems:"center"},children:"得点"}),e.jsx(P,{sx:{width:"18%"},children:e.jsxs(t,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{children:i||"チームB"}),e.jsx("span",{children:"ラリー結果"})]})}),e.jsx(P,{sx:{width:"16%"},children:e.jsxs(t,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{children:i||"チームB"}),e.jsx("span",{children:"サーブ"})]})}),e.jsx(P,{sx:{width:"6%"}})]})}),e.jsx(lt,{droppableId:"rallies",children:u=>e.jsxs(Tt,{ref:u.innerRef,...u.droppableProps,children:[s.map((S,k)=>e.jsx(ot,{draggableId:S.id,index:k,isDragDisabled:m,children:N=>e.jsxs(Je,{ref:N.innerRef,...N.draggableProps,"data-index":k,onClick:()=>{m||(S.substitutionTeam?te(k):S.timeoutTeam||q(k))},sx:{cursor:m||S.timeoutTeam?"default":"pointer",backgroundColor:R=>S.timeoutTeam||S.substitutionTeam?R.palette.mode==="dark"?"#343A42":"#f5f5f5":void 0},children:[e.jsx(P,{padding:"checkbox",sx:{width:"6%"},children:e.jsx(t,{onClick:R=>R.stopPropagation(),...N.dragHandleProps,sx:{cursor:m?"default":"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:e.jsx(Ot,{fontSize:"small"})})}),S.timeoutTeam?e.jsx(P,{colSpan:5,sx:{width:"88%"},children:e.jsxs(t,{sx:{...Ke,display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:[S.timeoutTeam==="teamA"?r||"チームA":i||"チームB","タイムアウト"]})}):S.substitutionTeam?e.jsx(P,{colSpan:5,sx:{width:"88%"},children:e.jsxs(t,{sx:{...Ke,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100%"},children:[e.jsxs("span",{children:[S.substitutionTeam==="teamA"?r||"チームA":i||"チームB","選手交代"]}),e.jsxs(t,{sx:{display:"flex",alignItems:"center",mt:.5},children:[e.jsx("span",{children:Q(S.substitutionTeam,S.outMember)}),e.jsx(_t,{fontSize:"small",sx:{mx:1}}),e.jsx("span",{children:Q(S.substitutionTeam,S.inMember)})]})]})}):e.jsxs(e.Fragment,{children:[e.jsx(P,{sx:{width:"16%"},children:S.serverTeam==="teamA"?de("teamA",S.server):null}),e.jsx(P,{sx:{width:"18%"},children:Z(S.teamAPlayDetail,S.teamAMember,"A")}),e.jsx(P,{sx:{width:"20%",fontSize:"2em",textAlign:"center"},children:O(k)}),e.jsx(P,{sx:{width:"18%"},children:Z(S.teamBPlayDetail,S.teamBMember,"B")}),e.jsx(P,{sx:{width:"16%"},children:S.serverTeam==="teamB"?de("teamB",S.server):null})]}),e.jsx(P,{padding:"checkbox",sx:{width:"6%"},children:e.jsx(t,{onClick:R=>R.stopPropagation(),sx:{width:32,height:32,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:e.jsx(_e,{size:"small",onClick:m?void 0:()=>se(k),disabled:m,sx:{width:24,height:24},children:e.jsx(nt,{fontSize:"small",color:m?"disabled":"error"})})})})]})},S.id)),u.placeholder]})})]})})]})})})}function fi({scores:s,consecutive:g,connections:h,rowHeight:y}){const x=s.length*y;return e.jsxs(t,{sx:{flex:"0 0 20%",overflowY:"auto",height:"100%",position:"relative"},children:[s.map((r,i)=>{const M=i===0?{a:0,b:0}:s[i-1],j=r.a!==M.a&&r.a!==0,m=r.b!==M.b&&r.b!==0,I=j&&g[i],L=m&&g[i];return e.jsxs(t,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr 1fr",alignItems:"center",py:.5,height:`${y}px`,position:"relative",zIndex:1},children:[e.jsx(t,{}),e.jsxs(e.Fragment,{children:[e.jsx(t,{sx:{display:"flex",justifyContent:"center"},children:j?e.jsx(t,{sx:{width:32,height:32,border:"1px solid",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:24,borderColor:I?"red":"currentColor",backgroundColor:I?"#ffebee":"#fff",color:"black"},children:r.a}):null}),e.jsx(t,{}),e.jsx(t,{sx:{display:"flex",justifyContent:"center"},children:m?e.jsx(t,{sx:{width:32,height:32,border:"1px solid",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:24,borderColor:L?"red":"currentColor",backgroundColor:L?"#ffebee":"#fff",color:"black"},children:r.b}):null})]}),e.jsx(t,{})]},i)}),e.jsx("svg",{viewBox:`0 0 100 ${x}`,style:{position:"absolute",left:0,top:0,width:"100%",height:x,zIndex:0},preserveAspectRatio:"none",pointerEvents:"none",children:h.map(r=>{const i=r.index*y+y/2,M=(r.index+1)*y+y/2,j=r.from==="A"?30:70,m=r.from==="A"?70:30;return e.jsx("line",{x1:j,y1:i,x2:m,y2:M,stroke:"currentColor",strokeWidth:1},r.index)})})]})}function gi({setScore:s,playDetails:g,playCategories:h,teamAMembers:y,teamBMembers:x,teamAName:r,teamBName:i,onChange:M,locked:j=!1,scoreInputSetting:m,themeSetting:I,showSnackbar:L}){const[F,B]=o.useState(!1),[H,G]=o.useState(!1),{addRally:q,deleteRally:te,calculateScores:se}=Ln(s,g,M),w=o.useRef(null),le=o.useRef(null),X=dt("md"),re=dt("sm"),f=!re&&m.showRallyIcons,Y=!X&&m.showScoreProgressArea,E=X&&m.showScoreProgressArea,[fe,c]=o.useState(!1),A=h.find(v=>v.id==="init-serve"),J=s.rallies.filter(v=>v.timeoutTeam==="teamA").length,Q=s.rallies.filter(v=>v.timeoutTeam==="teamB").length,O=J>=2,Z=Q>=2,ee=v=>{if(!v.destination||j)return;const D=Array.from(s.rallies),[ue]=D.splice(v.source.index,1);D.splice(v.destination.index,0,ue);const ye={...s,rallies:D};se(ye),M(ye)},de=v=>{if(j)return;const D={...s,rallies:[...s.rallies]};te(v),L("ラリーを削除しました","success",{actionLabel:"元に戻す",onAction:()=>{const ue={...D,rallies:[...D.rallies]};se(ue),M(ue)},autoHideDuration:5e3})},Se=v=>{const D=!localStorage.getItem("tutorial-rally-row");q(v),X&&D&&B(!0)},De=(v,D)=>{const ue=[...s.rallies];ue[v]=D;const ye={...s,rallies:ue};se(ye),M(ye)},u=v=>{if(j||v==="teamA"&&O||v==="teamB"&&Z)return;const D=!localStorage.getItem("tutorial-rally-row");q({id:crypto.randomUUID(),timeoutTeam:v}),X&&D&&B(!0)},S=v=>{var D;j||(D=w.current)==null||D.openAddDialog(v)},k=v=>{var ue;if(j)return;const D=s.rallies[v];D.substitutionTeam&&((ue=w.current)==null||ue.openEditDialog(v,D.substitutionTeam,D.outMember||"",D.inMember||""))},N=(v,D,ue,ye)=>{const Re=!localStorage.getItem("tutorial-rally-row"),b=[...s.rallies];ye!==null?b[ye]={...b[ye],substitutionTeam:v,outMember:D,inMember:ue}:b.push({id:crypto.randomUUID(),substitutionTeam:v,outMember:D,inMember:ue});const C={...s,rallies:b};se(C),M(C),X&&Re&&B(!0)},R=[],$e=[],l=[],a=[];let T=0,W=0,_=0,$=0;s.rallies.forEach(v=>{const D=g.find(Re=>Re.id===v.teamAPlayDetail),ue=g.find(Re=>Re.id===v.teamBPlayDetail);let ye=null;(D==null?void 0:D.pointType)==="得点"||(ue==null?void 0:ue.pointType)==="失点"?(T+=1,_+=1,ye="A"):((ue==null?void 0:ue.pointType)==="得点"||(D==null?void 0:D.pointType)==="失点")&&(W+=1,$+=1,ye="B"),!v.timeoutTeam&&!v.substitutionTeam&&(a.push(ye),l.push({a:_,b:$})),$e.push(v.timeoutTeam||v.substitutionTeam?null:ye),R.push({a:T,b:W})});const he=40,ge=[];for(let v=0;v<a.length-1;v++){const D=a[v],ue=a[v+1];D&&ue&&D!==ue&&ge.push({from:D,index:v})}const xe=a.map((v,D)=>v!==null&&D>0&&v===a[D-1]);return e.jsxs(t,{sx:{position:"relative",display:"flex",flexDirection:"column",height:"100%"},children:[e.jsxs(t,{sx:{display:"flex",gap:2,flex:1,minHeight:0},children:[Y&&e.jsx(fi,{scores:l,consecutive:xe,connections:ge,rowHeight:he}),e.jsx(t,{sx:{flex:1,overflowY:"auto",height:"100%",maxWidth:1024,width:"100%",mx:"auto",mb:2},children:e.jsx(pi,{rallies:s.rallies,playDetails:g,playCategories:h,teamAMembers:y,teamBMembers:x,teamAName:r,teamBName:i,serveCategory:A,showRallyIcons:f,locked:j,isMobile:X,isPhone:re,scores:R,scoredTeam:$e,showRallyHint:F,onCloseRallyHint:()=>B(!1),onEditRally:v=>{var D;return(D=le.current)==null?void 0:D.openEditDialog(v)},onEditSubstitution:k,onDelete:de,onDragEnd:ee})})]}),E&&e.jsx(Jn,{open:fe,onClose:()=>c(!1),scores:l,consecutive:xe,connections:ge,rowHeight:he}),e.jsx(ri,{isMobile:X,openActionMenu:H,onOpenActionMenu:()=>G(!0),onCloseActionMenu:()=>G(!1),teamAName:r,teamBName:i,disableTimeoutA:O,disableTimeoutB:Z,showScoreProgressButton:m.showScoreProgressArea,onShowScoreProgress:()=>c(!0),onSubstitution:S,onTimeout:u,onAddRally:()=>{var v;return(v=le.current)==null?void 0:v.openAddDialog()},locked:j}),e.jsx(Wn,{ref:le,setScore:s,playDetails:g,playCategories:h,teamAMembers:y,teamBMembers:x,teamAName:r,teamBName:i,scoreInputSetting:m,themeSetting:I,locked:j,onAdd:Se,onEdit:De}),e.jsx(Kn,{ref:w,teamAMembers:y,teamBMembers:x,onSave:N})]})}const ji=()=>typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():Math.random().toString(36).slice(2)+Date.now().toString(36);function bi({statsSettings:s,onChange:g,playCategories:h,playDetails:y,rallyCategoryTags:x,rallyDetailTags:r,disabled:i,showSnackbar:M}){const j=l=>{if(Se){const W=de(Se);W&&(W.allowTouchMove=!0),De("")}if(!l.destination)return;const a=Array.from(s),[T]=a.splice(l.source.index,1);a.splice(l.destination.index,0,T),g(a)},m=l=>{var a;return((a=h.find(T=>T.id===l))==null?void 0:a.name)||""},I=l=>{var a;return((a=y.find(T=>T.id===l))==null?void 0:a.name)||""},L=l=>{const a=l.playCategoryId?m(l.playCategoryId):l.playCategoryTags?l.playCategoryTags.map(he=>{var ge;return((ge=x.find(xe=>xe.id===he))==null?void 0:ge.name)||he}).join(", "):"",T=l.playDetailId?I(l.playDetailId):l.playDetailTags?l.playDetailTags.map(he=>{var ge;return((ge=r.find(xe=>xe.id===he))==null?void 0:ge.name)||he}).join(", "):"",W=l.pointType||"",_=l.pointUnitType||"",$=l.aggregateType||"合算";return[a,T,W,_,$].filter(he=>he).join(", ")},[F,B]=o.useState(!1),[H,G]=o.useState(null),[q,te]=o.useState(""),[se,w]=o.useState(""),[le,X]=o.useState([]),[re,f]=o.useState([]),[Y,E]=o.useState(""),[fe,c]=o.useState(""),[A,J]=o.useState("合算"),Q=dt("md"),O=dt("sm"),{handleTouchEnd:Z,setSwiperRef:ee,getSwiperRef:de}=Gt(2),[Se,De]=o.useState(""),u=()=>{i||(G(-1),te(""),w(""),X([]),f([]),E(""),c(""),J("合算"),B(!0))},S=l=>{if(i)return;const a=s[l];G(l),te(a.playCategoryId||""),w(a.playDetailId||""),X(a.playCategoryTags||[]),f(a.playDetailTags||[]),E(a.pointType||""),c(a.pointUnitType||""),J(a.aggregateType||"合算"),B(!0)},k=()=>{const l=q!=="",a=se!=="",T=le.length>0,W=re.length>0,_=Y!=="",$=fe!=="";return l&&!a&&!T&&!W&&!_&&!$||l&&a&&!T&&!W&&!_&&!$||l&&!a&&!T&&!W&&_&&!$||l&&!a&&!T&&!W&&!_&&$||l&&!a&&!T&&!W&&_&&$||!l&&!a&&!T&&!W&&_&&!$||!l&&!a&&!T&&!W&&_&&$||!l&&!a&&!T&&!W&&!_&&$||T&&!l&&!a&&!W&&!_&&!$||T&&W&&!l&&!a&&!_&&!$||T&&W&&!l&&!a&&_&&!$||T&&W&&!l&&!a&&!_&&$||T&&W&&!l&&!a&&_&&$||T&&!l&&!a&&_&&!$||T&&!l&&!a&&!_&&$||T&&!l&&!a&&_&&$||W&&!l&&!a&&!T&&!_&&!$||W&&!l&&!a&&!T&&_&&!$||W&&!l&&!a&&!T&&!_&&$||W&&!l&&!a&&!T&&_&&$},N=()=>{const l={id:H===-1?ji():s[H].id,playCategoryId:q||void 0,playDetailId:se||void 0,playCategoryTags:q===""&&le.length>0?le:void 0,playDetailTags:se===""&&re.length>0?re:void 0,pointType:se?void 0:Y||void 0,pointUnitType:se?void 0:fe||void 0,aggregateType:A};H===-1?g([...s,l]):H!==null&&g(s.map((a,T)=>T===H?l:a)),B(!1)},R=()=>{B(!1)},$e=l=>{if(i)return;const a=[...s];g(s.filter((T,W)=>W!==l)),M("スタッツ設定を削除しました","success",{actionLabel:"元に戻す",onAction:()=>g(a),autoHideDuration:5e3})};return e.jsxs(t,{children:[e.jsxs(t,{sx:{maxWidth:1024,mx:"auto",display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(t,{sx:{fontWeight:"bold"},children:"スタッツ設定"}),e.jsx(pe,{onClick:u,variant:"contained",size:"medium",startIcon:e.jsx(Et,{}),disabled:i,children:"追加"})]}),e.jsx(xt,{component:tt,storageKey:"match-stats-grid",sx:{maxWidth:1024,mx:"auto",overflowX:"hidden"},children:Q?e.jsx(It,{onDragEnd:j,children:e.jsx(lt,{droppableId:"stats-settings",children:l=>e.jsxs(t,{ref:l.innerRef,...l.droppableProps,children:[e.jsx(t,{sx:{display:"grid",gridTemplateColumns:O?"1fr":"repeat(5, 1fr)",alignItems:"center",height:50,px:1,borderBottom:1,borderColor:"divider",...Ke},children:O?e.jsx(t,{children:"分析項目"}):e.jsxs(e.Fragment,{children:[e.jsx(t,{children:"プレー区分"}),e.jsx(t,{children:"プレー詳細"}),e.jsx(t,{children:"得点区分"}),e.jsx(t,{children:"得失点単位区分"}),e.jsx(t,{children:"集計方法"})]})}),s.map((a,T)=>e.jsx(ot,{draggableId:a.id,index:T,isDragDisabled:i,children:W=>{const _=W.dragHandleProps,{onPointerDown:$,...he}=_||{},ge=Ht(xe=>{$==null||$(xe);const v=de(a.id);v&&(v.allowTouchMove=!1),De(a.id)});return e.jsx(t,{ref:W.innerRef,...W.draggableProps,style:W.draggableProps.style,children:e.jsxs(Ft,{onSwiper:xe=>ee(a.id,xe),threshold:20,slidesPerView:"auto",style:{overflow:"hidden"},onTouchStart:(xe,v)=>v.stopPropagation(),onTouchEnd:xe=>Z(a.id,xe),children:[e.jsx(Ve,{style:{width:"100%",flex:"0 0 auto"},children:e.jsx(t,{...he,...ge,sx:{display:"grid",gridTemplateColumns:O?"1fr":"repeat(5, 1fr)",alignItems:"center",height:50,px:1,borderBottom:1,borderColor:"divider",bgcolor:"background.paper",cursor:i?"default":"grab",touchAction:Se===a.id?"none":"pan-y"},children:O?e.jsx(t,{children:L(a)}):e.jsxs(e.Fragment,{children:[e.jsx(t,{sx:{pr:1},children:a.playCategoryId?m(a.playCategoryId):a.playCategoryTags&&a.playCategoryTags.length>0?e.jsx(t,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:a.playCategoryTags.map(xe=>{const v=x.find(D=>D.id===xe);return e.jsx(Qe,{label:(v==null?void 0:v.name)||xe,size:"small",sx:{backgroundColor:(v==null?void 0:v.color)||Ne,color:"#fff"}},xe)})}):""}),e.jsx(t,{sx:{pr:1},children:a.playDetailId?I(a.playDetailId):a.playDetailTags&&a.playDetailTags.length>0?e.jsx(t,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:a.playDetailTags.map(xe=>{const v=r.find(D=>D.id===xe);return e.jsx(Qe,{label:(v==null?void 0:v.name)||xe,size:"small",sx:{backgroundColor:(v==null?void 0:v.color)||Ne,color:"#fff"}},xe)})}):""}),e.jsx(t,{sx:{pr:1},children:a.pointType||""}),e.jsx(t,{sx:{pr:1},children:a.pointUnitType||""}),e.jsx(t,{children:a.aggregateType||"合算"})]})})}),e.jsx(Ve,{style:{width:ut,flex:"0 0 auto"},children:e.jsx(t,{sx:{height:50,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"primary.main"},children:e.jsx(_e,{size:"small",onClick:()=>S(T),disabled:i,children:e.jsx(Kt,{fontSize:"small",sx:{color:"common.white"}})})})}),e.jsx(Ve,{style:{width:ut,flex:"0 0 auto"},children:e.jsx(t,{sx:{height:50,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"error.main"},children:e.jsx(_e,{size:"small",onClick:()=>$e(T),disabled:i,children:e.jsx(nt,{fontSize:"small",sx:{color:"common.white"}})})})})]})})}},a.id)),l.placeholder]})})}):e.jsxs(Ct,{size:"small",children:[e.jsx(St,{children:e.jsxs(Je,{sx:{backgroundColor:l=>l.palette.mode==="dark"?"#343A42":"#f5f5f5",height:50},children:[e.jsx(P,{}),e.jsx(P,{children:"プレー区分"}),e.jsx(P,{children:"プレー詳細"}),e.jsx(P,{children:"得点区分"}),e.jsx(P,{children:"得失点単位区分"}),e.jsx(P,{children:"集計方法"}),e.jsx(P,{})]})}),e.jsx(It,{onDragEnd:j,children:e.jsx(lt,{droppableId:"stats-settings",children:l=>e.jsxs(Tt,{ref:l.innerRef,...l.droppableProps,children:[s.map((a,T)=>e.jsx(ot,{draggableId:a.id,index:T,isDragDisabled:i,children:W=>e.jsxs(Je,{ref:W.innerRef,...W.draggableProps,onClick:()=>S(T),sx:{cursor:i?"default":"pointer",height:50},children:[e.jsx(P,{padding:"checkbox",sx:{width:48},children:e.jsx(t,{...W.dragHandleProps,onClick:_=>_.stopPropagation(),sx:{cursor:i?"default":"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:e.jsx(Ot,{})})}),e.jsx(P,{children:a.playCategoryId?m(a.playCategoryId):a.playCategoryTags&&a.playCategoryTags.length>0?e.jsx(t,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:a.playCategoryTags.map(_=>{const $=x.find(he=>he.id===_);return e.jsx(Qe,{label:($==null?void 0:$.name)||_,size:"small",sx:{backgroundColor:($==null?void 0:$.color)||Ne,color:"#fff"}},_)})}):""}),e.jsx(P,{children:a.playDetailId?I(a.playDetailId):a.playDetailTags&&a.playDetailTags.length>0?e.jsx(t,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:a.playDetailTags.map(_=>{const $=r.find(he=>he.id===_);return e.jsx(Qe,{label:($==null?void 0:$.name)||_,size:"small",sx:{backgroundColor:($==null?void 0:$.color)||Ne,color:"#fff"}},_)})}):""}),e.jsx(P,{children:a.pointType||""}),e.jsx(P,{children:a.pointUnitType||""}),e.jsx(P,{children:a.aggregateType||"合算"}),e.jsx(P,{padding:"checkbox",children:e.jsx(_e,{size:"small",onClick:_=>{_.stopPropagation(),$e(T)},disabled:i,children:e.jsx(nt,{fontSize:"small",color:"error"})})})]})},a.id)),l.placeholder]})})})]})}),e.jsxs(At,{open:F,onClose:R,children:[e.jsxs(it,{children:["スタッツ設定",H===-1?"追加":"編集"]}),e.jsxs(rt,{children:[e.jsxs(Fe,{fullWidth:!0,margin:"dense",children:[e.jsx(Oe,{id:"stat-category-label",children:"プレー区分"}),e.jsxs(He,{labelId:"stat-category-label",value:q,label:"プレー区分",onChange:l=>{te(l.target.value),w(""),X([]),f([])},disabled:le.length>0||re.length>0,children:[e.jsx(ce,{value:"",children:"なし"}),h.map(l=>e.jsx(ce,{value:l.id,children:l.name},l.id))]})]}),e.jsxs(Fe,{fullWidth:!0,margin:"dense",children:[e.jsx(Oe,{id:"stat-detail-label",children:"プレー詳細"}),e.jsxs(He,{labelId:"stat-detail-label",value:se,label:"プレー詳細",onChange:l=>{w(l.target.value),E(""),c(""),X([]),f([])},disabled:Y!==""||fe!==""||le.length>0||re.length>0,children:[e.jsx(ce,{value:"",children:"なし"}),y.filter(l=>l.playCategoryId===q).map(l=>e.jsx(ce,{value:l.id,children:l.name},l.id))]})]}),e.jsx(qt,{multiple:!0,options:x,getOptionLabel:l=>l.name,value:x.filter(l=>le.includes(l.id)),onChange:(l,a)=>{X(a.map(T=>T.id)),a.length>0&&(te(""),w(""))},disabled:q!==""||se!=="",renderTags:(l,a)=>l.map((T,W)=>{const{key:_,...$}=a({index:W});return e.jsx(Qe,{...$,label:T.name,size:"small",sx:{backgroundColor:T.color||Ne,color:"#fff"}},_)}),renderInput:l=>e.jsx(Ie,{...l,label:"プレー区分タグ",margin:"dense"}),fullWidth:!0}),e.jsx(qt,{multiple:!0,options:r,getOptionLabel:l=>l.name,value:r.filter(l=>re.includes(l.id)),onChange:(l,a)=>{f(a.map(T=>T.id)),a.length>0&&(te(""),w(""))},disabled:q!==""||se!=="",renderTags:(l,a)=>l.map((T,W)=>{const{key:_,...$}=a({index:W});return e.jsx(Qe,{...$,label:T.name,size:"small",sx:{backgroundColor:T.color||Ne,color:"#fff"}},_)}),renderInput:l=>e.jsx(Ie,{...l,label:"プレー詳細タグ",margin:"dense"}),fullWidth:!0}),e.jsxs(t,{children:[e.jsxs(Fe,{fullWidth:!0,margin:"dense",children:[e.jsx(Oe,{id:"stat-point-label",children:"得点区分"}),e.jsxs(He,{labelId:"stat-point-label",value:Y,label:"得点区分",onChange:l=>{E(l.target.value),l.target.value!==""&&w("")},disabled:se!=="",children:[e.jsx(ce,{value:"",children:"なし"}),e.jsx(ce,{value:"得点",children:"得点"}),e.jsx(ce,{value:"失点",children:"失点"})]})]}),e.jsxs(Fe,{fullWidth:!0,margin:"dense",children:[e.jsx(Oe,{id:"stat-unit-label",children:"得失点単位区分"}),e.jsxs(He,{labelId:"stat-unit-label",value:fe,label:"得失点単位区分",onChange:l=>{c(l.target.value),l.target.value!==""&&w("")},disabled:se!=="",children:[e.jsx(ce,{value:"",children:"なし"}),e.jsx(ce,{value:"メンバー",children:"メンバー"}),e.jsx(ce,{value:"チーム",children:"チーム"})]})]})]}),e.jsxs(Fe,{fullWidth:!0,margin:"dense",children:[e.jsx(Oe,{id:"stat-aggregate-label",children:"集計方法"}),e.jsxs(He,{labelId:"stat-aggregate-label",value:A,label:"集計方法",onChange:l=>J(l.target.value),children:[e.jsx(ce,{value:"合算",children:"合算"}),e.jsx(ce,{value:"セット平均",children:"セット平均"})]})]})]}),e.jsxs(at,{children:[e.jsx(pe,{onClick:R,color:"inherit",startIcon:e.jsx(st,{}),children:"キャンセル"}),e.jsx(pe,{onClick:N,disabled:!k(),startIcon:e.jsx(Ge,{}),children:"OK"})]})]})]})}function bs(s,g,h){var x,r;if(!s)return!1;const y=g.get(s.playCategoryId);return!(h.playDetailId&&s.id!==h.playDetailId||h.playCategoryId&&s.playCategoryId!==h.playCategoryId||h.playCategoryTags&&h.playCategoryTags.length>0&&!((x=y==null?void 0:y.tags)!=null&&x.some(i=>h.playCategoryTags.includes(i)))||h.playDetailTags&&h.playDetailTags.length>0&&!((r=s.tags)!=null&&r.some(i=>h.playDetailTags.includes(i)))||h.pointType&&s.pointType!==h.pointType||h.pointUnitType&&s.pointUnitType!==h.pointUnitType)}function ys(s,g,h,y){const x=y.map(()=>({teamA:0,teamB:0}));return s.forEach(r=>{r.rallies.forEach(i=>{y.forEach((M,j)=>{const m=i.teamAPlayDetail?g.get(i.teamAPlayDetail):void 0;bs(m,h,M)&&(x[j].teamA+=1);const I=i.teamBPlayDetail?g.get(i.teamBPlayDetail):void 0;bs(I,h,M)&&(x[j].teamB+=1)})})}),x}function yi(s,g){const h=[];let y=0,x=0,r=0,i=0;return s.forEach(j=>{let m=0,I=0,L=0,F=0;j.rallies.forEach(B=>{if(B.timeoutTeam||B.substitutionTeam||!B.serverTeam)return;const H=B.teamAPlayDetail?g.get(B.teamAPlayDetail):void 0,G=B.teamBPlayDetail?g.get(B.teamBPlayDetail):void 0;B.serverTeam==="teamA"?(I+=1,(H&&H.pointType==="得点"||G&&G.pointType==="失点")&&(m+=1)):(F+=1,(G&&G.pointType==="得点"||H&&H.pointType==="失点")&&(L+=1))}),y+=m,x+=I,r+=L,i+=F,h.push({teamA:I?`${Math.round(m/I*100)}%`:"-",teamB:F?`${Math.round(L/F*100)}%`:"-"})}),{overall:{teamA:x?`${Math.round(y/x*100)}%`:"-",teamB:i?`${Math.round(r/i*100)}%`:"-"},perSet:h}}function vi(s,g){const h=[];let y=0,x=0,r=0,i=0;return s.forEach(j=>{let m=0,I=0,L=0,F=0;j.rallies.forEach(B=>{if(B.timeoutTeam||B.substitutionTeam||!B.serverTeam)return;const H=B.teamAPlayDetail?g.get(B.teamAPlayDetail):void 0,G=B.teamBPlayDetail?g.get(B.teamBPlayDetail):void 0;B.serverTeam==="teamB"?(I+=1,(H&&H.pointType==="得点"||G&&G.pointType==="失点")&&(m+=1)):(F+=1,(G&&G.pointType==="得点"||H&&H.pointType==="失点")&&(L+=1))}),y+=m,x+=I,r+=L,i+=F,h.push({teamA:I?`${Math.round(m/I*100)}%`:"-",teamB:F?`${Math.round(L/F*100)}%`:"-"})}),{overall:{teamA:x?`${Math.round(y/x*100)}%`:"-",teamB:i?`${Math.round(r/i*100)}%`:"-"},perSet:h}}function Ci({sets:s,playDetails:g,playCategories:h,statsSettings:y,matchStatsSettings:x,onMatchStatsSettingsChange:r,rallyCategoryTags:i,rallyDetailTags:M,teamAName:j,teamBName:m,locked:I,showSnackbar:L}){const F=new Map(g.map(c=>[c.id,c])),B=new Map(h.map(c=>[c.id,c])),H=c=>{var A;return((A=h.find(J=>J.id===c))==null?void 0:A.name)||""},G=c=>{var A;return((A=g.find(J=>J.id===c))==null?void 0:A.name)||""},q=[...y,...x],te=ys(s,F,B,q),se=s.map(c=>ys([c],F,B,q)),w=te.map((c,A)=>{if(q[A].aggregateType==="セット平均"){const Q=s.length||1;return{teamA:(c.teamA/Q).toFixed(1),teamB:(c.teamB/Q).toFixed(1)}}return c}),le=se.map(c=>q.reduce((A,J,Q)=>(J.aggregateType!=="セット平均"&&A.push(c[Q]),A),[])),X=q.filter(c=>c.aggregateType!=="セット平均"),re=yi(s,F),f=vi(s,F),Y=c=>{const A=[];c.playCategoryId?A.push(e.jsx("span",{children:H(c.playCategoryId)},"cat")):c.playCategoryTags&&c.playCategoryTags.length>0&&A.push(e.jsx(t,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center",mt:.5},children:c.playCategoryTags.map(Q=>{const O=i.find(Z=>Z.id===Q);return e.jsx(Qe,{label:(O==null?void 0:O.name)||Q,size:"small",sx:{mr:.5,mb:.5,backgroundColor:(O==null?void 0:O.color)||Ne,color:"#fff"}},Q)})},"catTags")),c.playDetailId?A.push(e.jsx("span",{children:G(c.playDetailId)},"detail")):c.playDetailTags&&c.playDetailTags.length>0&&A.push(e.jsx(t,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center",mt:.5},children:c.playDetailTags.map(Q=>{const O=M.find(Z=>Z.id===Q);return e.jsx(Qe,{label:(O==null?void 0:O.name)||Q,size:"small",sx:{mr:.5,mb:.5,backgroundColor:(O==null?void 0:O.color)||Ne,color:"#fff"}},Q)})},"detailTags"));const J=[];return c.pointType&&J.push(c.pointType),c.pointUnitType&&J.push(c.pointUnitType),J.length>0&&A.push(e.jsx("span",{children:J.join(",")},"point")),A.push(e.jsxs("span",{children:["(",c.aggregateType||"合算",")"]},"agg")),e.jsx(t,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:A.map((Q,O)=>e.jsx(t,{sx:{display:"flex",justifyContent:"center"},children:Q},O))})},E={flex:1,display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",whiteSpace:"nowrap"},fe=(c,A,J,Q,O)=>e.jsx(xt,{component:tt,storageKey:O,sx:{mb:2},children:e.jsxs(t,{sx:{display:"flex",flexDirection:"column","& > *":{minHeight:50}},children:[e.jsxs(t,{sx:{display:"flex",backgroundColor:Z=>Z.palette.mode==="dark"?"#343A42":"#f5f5f5"},children:[e.jsx(t,{sx:{...E,fontWeight:"bold"},children:j||"チームA"}),e.jsx(t,{sx:{...E,fontWeight:"bold"},children:"項目"}),e.jsx(t,{sx:{...E,fontWeight:"bold"},children:m||"チームB"})]}),[{key:"break-rate",a:A.teamA,i:"ブレイク率",b:A.teamB,isSetting:!1},{key:"sideout-rate",a:J.teamA,i:"サイドアウト率",b:J.teamB,isSetting:!1},...Q.map((ee,de)=>({key:ee.id,a:c[de].teamA,i:Y(ee),b:c[de].teamB,isSetting:!0}))].map((Z,ee,de)=>e.jsxs(t,{sx:Se=>({display:"flex",borderBottom:ee===de.length-1?"none":`1px solid ${Se.palette.mode==="dark"?"#343A42":"#f5f5f5"}`}),children:[e.jsx(t,{sx:E,children:Z.a}),e.jsx(t,{sx:{...E,whiteSpace:Z.isSetting?"normal":"nowrap"},children:Z.i}),e.jsx(t,{sx:E,children:Z.b})]},Z.key))]})});return e.jsxs(t,{sx:{display:"grid",gap:2,gridTemplateColumns:{xs:"1fr",md:"repeat(2, 1fr)"},maxWidth:1024,width:"100%",mx:"auto"},children:[e.jsxs(t,{children:[e.jsx(Ee,{variant:"h6",sx:{mb:1},children:"試合全体のスタッツ"}),fe(w,re.overall,f.overall,q,"stats-overall")]}),s.map((c,A)=>e.jsxs(t,{children:[e.jsx(Ee,{variant:"h6",sx:{mb:1},children:`${A+1}セット目(${c.my}-${c.opponent})のスタッツ`}),fe(le[A],re.perSet[A],f.perSet[A],X,`stats-set-${A}`)]},c.id)),e.jsxs(t,{sx:{gridColumn:"1 / -1"},children:[e.jsx(bi,{statsSettings:x,onChange:r,playCategories:h,playDetails:g,rallyCategoryTags:i,rallyDetailTags:M,disabled:I,showSnackbar:L}),e.jsxs(Ss,{severity:"info",sx:{mt:1},children:["本設定は試合内のみでの設定となります",e.jsx("br",{}),"各試合共通でのスタッツ項目の設定は設定＞スタッツメニューから設定してください"]})]})]})}var hs={},Si=Pe;Object.defineProperty(hs,"__esModule",{value:!0});var Nt=hs.default=void 0,Ti=Si(ke()),wi=e;Nt=hs.default=(0,Ti.default)((0,wi.jsx)("path",{d:"M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m-9-2V7H4v3H1v2h3v3h2v-3h3v-2zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"PersonAdd");const Ai=()=>typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():Math.random().toString(36).slice(2)+Date.now().toString(36);function Ii({match:s,setMatch:g,teamAName:h,teamBName:y,teamMembers:x,onAddMember:r,locked:i,showSnackbar:M}){const j=Mt(),m=dt("md"),I=dt("sm"),{handleTouchEnd:L,setSwiperRef:F,getSwiperRef:B}=Gt(),H={tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${j.palette.text.secondary}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${j.palette.text.secondary}`}}}},G=(b,C,V)=>e.jsxs(t,{sx:{p:1,maxWidth:260},children:[e.jsx(Ee,{variant:"body2",sx:{whiteSpace:"pre-line"},children:et[b].text}),e.jsx(t,{sx:{textAlign:"right",mt:1},children:e.jsx(Ze,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem(C,"1"),V()},children:"了解した"})})]}),[q,te]=o.useState(""),se="tutorial-member-select",[w,le]=o.useState(()=>!localStorage.getItem(se)),X="tutorial-member-row",[re,f]=o.useState(null),[Y,E]=o.useState(!1),[fe,c]=o.useState(!1),[A,J]=o.useState(""),[Q,O]=o.useState(""),[Z,ee]=o.useState([]),[de,Se]=o.useState("teamA"),[De,u]=o.useState([]),S="tutorial-member-select-add",k="tutorial-member-select-list",[N,R]=o.useState(!1),[$e,l]=o.useState(!1);o.useEffect(()=>{if(Y){const b=window.setTimeout(()=>{R(!localStorage.getItem(S)),l(!localStorage.getItem(k))},300);return()=>window.clearTimeout(b)}R(!1),l(!1)},[Y]);const a=b=>{if(q){const ne=B(q);ne&&(ne.allowTouchMove=!0),te("")}if(!b.destination||b.source.droppableId!==b.destination.droppableId||i)return;const C=b.source.droppableId==="teamA"?"teamAMembers":"teamBMembers",V=Array.from(s[C]),[oe]=V.splice(b.source.index,1);V.splice(b.destination.index,0,oe),g(ne=>({...ne,[C]:V}))},T=o.useMemo(()=>{const b=de==="teamA"?s.teamA:s.teamB,C=x[b]||[],V=de==="teamA"?s.teamAMembers:s.teamBMembers;return C.filter(oe=>oe.visible!==!1&&!V.some(ne=>ne.id===oe.id))},[de,s,x]);o.useEffect(()=>{[...s.teamAMembers.map(C=>`teamA-${C.id}`),...s.teamBMembers.map(C=>`teamB-${C.id}`)].forEach(C=>{const V=B(C);V&&(V.allowTouchMove=!i,i&&V.slideTo(0))})},[i,s.teamAMembers,s.teamBMembers,B]);const W=b=>{Se(b),u([]),E(!0)},_=b=>{u(C=>C.some(oe=>oe.id===b.id)?C.filter(oe=>oe.id!==b.id):[...C,b])},$=()=>{const b=!localStorage.getItem(X);g(de==="teamA"?C=>({...C,teamAMembers:[...C.teamAMembers,...De.map(V=>({...V,statuses:Array(C.sets.length).fill("")}))]}):C=>({...C,teamBMembers:[...C.teamBMembers,...De.map(V=>({...V,statuses:Array(C.sets.length).fill("")}))]})),E(!1),b&&f(de)},he=()=>{E(!1)},ge=(b,C)=>{if(i)return;let V;const oe=b==="teamA"?"teamAMembers":"teamBMembers";g(ne=>{const U=[...ne[oe]];V=U[C];const je=U.filter((Te,n)=>n!==C);return{...ne,[oe]:je}}),M("メンバーを削除しました","success",{actionLabel:"元に戻す",onAction:()=>{V&&g(ne=>{const U=[...ne[oe]];return U.splice(C,0,V),{...ne,[oe]:U}})},autoHideDuration:5e3})},xe=()=>{i||(J(""),O(""),ee([]),c(!0))},v=()=>{const b=de==="teamA"?s.teamA:s.teamB;b&&r(b,{id:Ai(),no:Number(A),name:Q,positions:Z}),c(!1)},D=()=>{c(!1)},ue=(b,C,V)=>{i||g(oe=>{const ne=b==="teamA"?"teamAMembers":"teamBMembers",U=[...oe[ne]],je={...U[C]},Te=[...je.statuses||Array(oe.sets.length).fill("")],n=Te[V]||"";let p="";return n===""?p="starter":n==="starter"?p="libero":p="",Te[V]=p,je.statuses=Te,U[C]=je,{...oe,[ne]:U}})},ye=()=>G(m?"matchMembersRowMobile":"matchMembersRowDesktop",X,()=>f(null)),Re=b=>{const C=b==="teamA"?s.teamAMembers:s.teamBMembers,V=b,oe=I?"50px 1fr":`40px 1fr ${s.sets.map(()=>"70px").join(" ")}`;return e.jsxs(t,{sx:{maxWidth:1024,mx:"auto",overflowX:"auto"},children:[e.jsxs(t,{sx:{display:"grid",gridTemplateColumns:oe,alignItems:"center",height:50,px:1,borderBottom:1,borderColor:"divider",...Ke},children:[e.jsx(t,{children:"番号"}),e.jsx(t,{children:"名前"}),!I&&s.sets.map((ne,U)=>e.jsx(t,{textAlign:"center",children:U+1},U))]}),e.jsx(lt,{droppableId:V,children:ne=>e.jsxs(t,{ref:ne.innerRef,...ne.droppableProps,children:[C.map((U,je)=>e.jsx(ot,{draggableId:`${V}-${U.id}`,index:je,isDragDisabled:i,children:Te=>{const n=`${V}-${U.id}`,p=Te.dragHandleProps,{onPointerDown:ie,...we}=p||{},be=Ht(Me=>{ie==null||ie(Me);const Be=B(n);Be&&(Be.allowTouchMove=!1),te(n)});return e.jsx(t,{ref:Te.innerRef,...Te.draggableProps,children:e.jsxs(Ft,{onSwiper:Me=>F(n,Me),threshold:20,slidesPerView:"auto",style:{overflow:"hidden"},onTouchStart:(Me,Be)=>Be.stopPropagation(),onTouchEnd:Me=>L(n,Me),children:[e.jsx(Ve,{style:{width:"100%",flex:"0 0 auto"},children:e.jsxs(t,{...we,...be,sx:{display:"grid",gridTemplateColumns:oe,alignItems:"center",height:50,px:1,borderBottom:1,borderColor:"divider",backgroundColor:"background.paper",cursor:i?"default":"grab",touchAction:q===n?"none":"pan-y"},children:[e.jsx(t,{children:U.no}),e.jsx(t,{children:U.name}),!I&&s.sets.map((Me,Be)=>{var Bt,Dt,jt,ht,Pt,bt;return e.jsx(t,{sx:{textAlign:"center"},children:e.jsx(pe,{size:"small",variant:(Bt=U.statuses)!=null&&Bt[Be]?"contained":"outlined",color:((Dt=U.statuses)==null?void 0:Dt[Be])==="starter"?"primary":void 0,sx:{minWidth:32,width:32,p:0,...((jt=U.statuses)==null?void 0:jt[Be])==="starter"?{backgroundColor:"primary.main",color:"#fff","&:hover":{backgroundColor:"primary.main"}}:((ht=U.statuses)==null?void 0:ht[Be])==="libero"?{backgroundColor:"#FF9933",color:"#fff","&:hover":{backgroundColor:"#FF9933"},"&.Mui-focusVisible":{outline:"2px solid #FF9933"}}:{}},onClick:()=>ue(b,je,Be),disabled:i,children:((Pt=U.statuses)==null?void 0:Pt[Be])==="starter"?"出":((bt=U.statuses)==null?void 0:bt[Be])==="libero"?"リ":"不"})},Be)})]})}),e.jsx(Ve,{style:{width:ut,flex:"0 0 auto"},children:e.jsx(t,{sx:{height:50,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:i?"grey.500":"error.main"},children:e.jsx(_e,{size:"small",disabled:i,onClick:i?void 0:()=>ge(b,je),children:e.jsx(nt,{fontSize:"small",sx:{color:"common.white"}})})})})]})})}},U.id)),ne.placeholder]})})]})};return e.jsxs(It,{onDragEnd:a,children:[e.jsxs(wt,{container:!0,spacing:2,children:[e.jsxs(wt,{item:!0,xs:12,children:[e.jsxs(t,{sx:{maxWidth:1024,mx:"auto"},children:[e.jsx(Ee,{variant:"h6",sx:{mb:1},children:h}),e.jsx(pe,{variant:"contained",size:"medium",sx:{mb:1},onClick:()=>W("teamA"),disabled:i,startIcon:e.jsx(Nt,{}),children:"メンバー登録"})]}),e.jsx(We,{open:w,onClose:()=>le(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:Ue,slotProps:H,title:G("matchMembersSelect",se,()=>le(!1)),children:e.jsx(t,{children:e.jsx(We,{open:re==="teamA",onClose:()=>f(null),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:Ue,slotProps:H,title:ye(),children:e.jsx(t,{children:m?Re("teamA"):e.jsx(xt,{component:tt,storageKey:"members-teamA",sx:{maxWidth:1024,mx:"auto"},children:e.jsxs(Ct,{size:"small",children:[e.jsx(St,{children:e.jsxs(Je,{sx:{backgroundColor:b=>b.palette.mode==="dark"?"#343A42":"#f5f5f5",height:50},children:[e.jsx(P,{}),e.jsx(P,{children:"番号"}),e.jsx(P,{children:"名前"}),e.jsx(P,{children:"ポジション"}),s.sets.map((b,C)=>e.jsx(P,{align:"center",children:C+1},C)),e.jsx(P,{})]})}),e.jsx(lt,{droppableId:"teamA",children:b=>e.jsxs(Tt,{ref:b.innerRef,...b.droppableProps,children:[s.teamAMembers.map((C,V)=>e.jsx(ot,{draggableId:`teamA-${C.id}`,index:V,isDragDisabled:i,children:oe=>e.jsxs(Je,{ref:oe.innerRef,...oe.draggableProps,"data-index":V,sx:{cursor:i?"default":"pointer",height:50},children:[e.jsx(P,{padding:"checkbox",children:e.jsx(t,{onClick:ne=>ne.stopPropagation(),...oe.dragHandleProps,sx:{cursor:i?"default":"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:e.jsx(Ot,{})})}),e.jsx(P,{children:C.no}),e.jsx(P,{children:C.name}),e.jsx(P,{children:(C.positions||[]).join(", ")}),s.sets.map((ne,U)=>{var je,Te,n,p,ie,we;return e.jsx(P,{padding:"checkbox",align:"center",children:e.jsx(pe,{size:"small",variant:(je=C.statuses)!=null&&je[U]?"contained":"outlined",color:((Te=C.statuses)==null?void 0:Te[U])==="starter"?"primary":void 0,sx:{minWidth:32,width:32,p:0,...((n=C.statuses)==null?void 0:n[U])==="starter"?{backgroundColor:"primary.main",color:"#fff","&:hover":{backgroundColor:"primary.main"}}:((p=C.statuses)==null?void 0:p[U])==="libero"?{backgroundColor:"#FF9933",color:"#fff","&:hover":{backgroundColor:"#FF9933"},"&.Mui-focusVisible":{outline:"2px solid #FF9933"}}:{}},onClick:()=>ue("teamA",V,U),disabled:i,children:((ie=C.statuses)==null?void 0:ie[U])==="starter"?"出":((we=C.statuses)==null?void 0:we[U])==="libero"?"リ":"不"})},U)}),e.jsx(P,{padding:"checkbox",children:e.jsx(t,{onClick:ne=>ne.stopPropagation(),sx:{width:32,height:32,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:e.jsx(_e,{size:"small",onClick:i?void 0:()=>ge("teamA",V),disabled:i,sx:{width:24,height:24},children:e.jsx(nt,{fontSize:"small",color:i?"disabled":"error"})})})})]})},C.id)),b.placeholder]})})]})})})})})})]}),e.jsxs(wt,{item:!0,xs:12,children:[e.jsxs(t,{sx:{maxWidth:1024,mx:"auto"},children:[e.jsx(Ee,{variant:"h6",sx:{mb:1},children:y}),e.jsx(pe,{variant:"contained",size:"medium",sx:{mb:1},onClick:()=>W("teamB"),disabled:i,startIcon:e.jsx(Nt,{}),children:"メンバー登録"})]}),e.jsx(We,{open:re==="teamB",onClose:()=>f(null),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:Ue,slotProps:H,title:ye(),children:e.jsx(t,{children:m?Re("teamB"):e.jsx(xt,{component:tt,storageKey:"members-teamB",sx:{maxWidth:1024,mx:"auto"},children:e.jsxs(Ct,{size:"small",children:[e.jsx(St,{children:e.jsxs(Je,{sx:{backgroundColor:b=>b.palette.mode==="dark"?"#343A42":"#f5f5f5",height:50},children:[e.jsx(P,{}),e.jsx(P,{children:"番号"}),e.jsx(P,{children:"名前"}),e.jsx(P,{children:"ポジション"}),s.sets.map((b,C)=>e.jsx(P,{align:"center",children:C+1},C)),e.jsx(P,{})]})}),e.jsx(lt,{droppableId:"teamB",children:b=>e.jsxs(Tt,{ref:b.innerRef,...b.droppableProps,children:[s.teamBMembers.map((C,V)=>e.jsx(ot,{draggableId:`teamB-${C.id}`,index:V,isDragDisabled:i,children:oe=>e.jsxs(Je,{ref:oe.innerRef,...oe.draggableProps,"data-index":V,sx:{cursor:i?"default":"pointer",height:50},children:[e.jsx(P,{padding:"checkbox",children:e.jsx(t,{onClick:ne=>ne.stopPropagation(),...oe.dragHandleProps,sx:{cursor:i?"default":"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:e.jsx(Ot,{})})}),e.jsx(P,{children:C.no}),e.jsx(P,{children:C.name}),e.jsx(P,{children:(C.positions||[]).join(", ")}),s.sets.map((ne,U)=>{var je,Te,n,p,ie,we;return e.jsx(P,{padding:"checkbox",align:"center",children:e.jsx(pe,{size:"small",variant:(je=C.statuses)!=null&&je[U]?"contained":"outlined",color:((Te=C.statuses)==null?void 0:Te[U])==="starter"?"primary":void 0,sx:{minWidth:32,width:32,p:0,...((n=C.statuses)==null?void 0:n[U])==="starter"?{backgroundColor:"primary.main",color:"#fff","&:hover":{backgroundColor:"primary.main"}}:((p=C.statuses)==null?void 0:p[U])==="libero"?{backgroundColor:"#FF9933",color:"#fff","&:hover":{backgroundColor:"#FF9933"},"&.Mui-focusVisible":{outline:"2px solid #FF9933"}}:{}},onClick:()=>ue("teamB",V,U),disabled:i,children:((ie=C.statuses)==null?void 0:ie[U])==="starter"?"出":((we=C.statuses)==null?void 0:we[U])==="libero"?"リ":"不"})},U)}),e.jsx(P,{padding:"checkbox",children:e.jsx(t,{onClick:ne=>ne.stopPropagation(),sx:{width:32,height:32,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:e.jsx(_e,{size:"small",onClick:i?void 0:()=>ge("teamB",V),disabled:i,sx:{width:24,height:24},children:e.jsx(nt,{fontSize:"small",color:i?"disabled":"error"})})})})]})},C.id)),b.placeholder]})})]})})})})]})]}),e.jsxs(At,{open:Y,onClose:he,children:[e.jsx(it,{children:"メンバー選択"}),e.jsxs(rt,{children:[e.jsx(t,{sx:{display:"flex",justifyContent:"flex-end",mb:1},children:e.jsx(We,{open:N,onClose:()=>R(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom-start",TransitionComponent:Ue,slotProps:{...H,popper:{disablePortal:!0,sx:{zIndex:b=>b.zIndex.tooltip}}},title:G("memberSelectAdd",S,()=>R(!1)),children:e.jsx("span",{children:e.jsx(pe,{onClick:xe,variant:"contained",startIcon:e.jsx(Et,{}),disabled:i||!(de==="teamA"?s.teamA:s.teamB),children:"追加"})})})}),e.jsx(We,{open:$e,onClose:()=>l(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:Ue,slotProps:{...H,popper:{disablePortal:!0,sx:{zIndex:b=>b.zIndex.tooltip}}},title:G("memberSelectList",k,()=>l(!1)),children:e.jsx(xt,{component:tt,storageKey:`members-select-${de}`,children:e.jsxs(Ct,{size:"small",children:[e.jsx(St,{children:e.jsxs(Je,{sx:{backgroundColor:b=>b.palette.mode==="dark"?"#343A42":"#f5f5f5",height:50},children:[e.jsx(P,{padding:"checkbox"}),!I&&e.jsx(P,{children:"番号"}),e.jsx(P,{children:"名前"}),!I&&e.jsx(P,{children:"ポジション"})]})}),e.jsx(Tt,{children:T.map(b=>{const C=De.some(V=>V.id===b.id);return e.jsxs(Je,{sx:{cursor:"pointer",height:50},onClick:()=>_(b),children:[e.jsx(P,{padding:"checkbox",onClick:V=>V.stopPropagation(),children:e.jsx(Gs,{checked:C,onChange:()=>_(b)})}),!I&&e.jsx(P,{children:b.no}),e.jsx(P,{children:b.name}),!I&&e.jsx(P,{children:(b.positions||[]).join(", ")})]},b.id)})})]})})})]}),e.jsxs(at,{children:[e.jsx(pe,{onClick:he,startIcon:e.jsx(st,{}),color:"inherit",children:"キャンセル"}),e.jsx(pe,{onClick:$,disabled:De.length===0,startIcon:e.jsx(Ge,{}),children:"OK"})]})]}),e.jsxs(At,{open:fe,onClose:D,children:[e.jsx(it,{children:"メンバー追加"}),e.jsxs(rt,{children:[e.jsx(Ie,{label:"番号",type:"number",value:A,onChange:b=>J(b.target.value),fullWidth:!0,margin:"dense"}),e.jsx(Ie,{label:"名前",value:Q,onChange:b=>O(b.target.value),fullWidth:!0,margin:"dense"}),e.jsxs(Fe,{fullWidth:!0,margin:"dense",children:[e.jsx(Oe,{id:"md-positions-label",children:"ポジション"}),e.jsxs(He,{labelId:"md-positions-label",multiple:!0,value:Z,label:"ポジション",onChange:b=>ee(typeof b.target.value=="string"?b.target.value.split(","):b.target.value),renderValue:b=>b.join(", "),children:[e.jsx(ce,{value:"レフト",children:"レフト"}),e.jsx(ce,{value:"センター",children:"センター"}),e.jsx(ce,{value:"ライト",children:"ライト"}),e.jsx(ce,{value:"セッター",children:"セッター"}),e.jsx(ce,{value:"リベロ",children:"リベロ"})]})]})]}),e.jsxs(at,{children:[e.jsx(pe,{onClick:D,startIcon:e.jsx(st,{}),color:"inherit",children:"キャンセル"}),e.jsx(pe,{onClick:v,disabled:A==="",startIcon:e.jsx(Ge,{}),children:"OK"})]})]})]})}function Mi({match:s,setMatch:g,tags:h,onAddTag:y,locked:x}){return e.jsx(t,{sx:{maxWidth:1024,mx:"auto"},children:e.jsx(wt,{container:!0,spacing:2,children:e.jsx(wt,{item:!0,xs:12,children:e.jsxs(tt,{elevation:0,sx:{},children:[e.jsx(Ie,{label:"試合日付",type:"date",InputLabelProps:{shrink:!0},value:s.date,onChange:r=>g(i=>({...i,date:r.target.value})),fullWidth:!0,margin:"dense",disabled:x,sx:{"& .MuiOutlinedInput-root":{height:56},"& .MuiOutlinedInput-input":{padding:"0 14px",height:"100%",lineHeight:"56px",fontSize:"1rem",textAlign:"left"},'& input[type="date"]':{WebkitAppearance:"none"}}}),e.jsx(Ie,{label:"試合名",value:s.matchName,onChange:r=>g(i=>({...i,matchName:r.target.value})),fullWidth:!0,margin:"dense",disabled:x}),e.jsx(qt,{multiple:!0,freeSolo:!0,options:h,getOptionLabel:r=>typeof r=="string"?r:r.name,value:s.tags.map(r=>h.find(i=>i.id===r)).filter(Boolean),onChange:(r,i)=>{const M=[];i.forEach(j=>{if(typeof j=="string"){const m={id:crypto.randomUUID(),name:j,color:Ne};y(m),M.push(m.id)}else M.push(j.id)}),g(j=>({...j,tags:M}))},renderTags:(r,i)=>r.map((M,j)=>{const{key:m,...I}=i({index:j});return e.jsx(Qe,{...I,label:M.name,sx:{backgroundColor:M.color||Ne,color:"#fff",mr:.5,mb:.5}},m)}),renderInput:r=>e.jsx(Ie,{...r,label:"タグ",margin:"dense"}),fullWidth:!0,disabled:x}),e.jsxs(Ss,{severity:"info",sx:{mt:1},children:["試合タグは上記項目にて直接入力するか、設定＞タグメニューにて追加できます",e.jsx("br",{}),"試合にタグを設定することにより、試合を横串で集計することが可能となります"]}),e.jsx(Ie,{label:"場所",value:s.location,onChange:r=>g(i=>({...i,location:r.target.value})),fullWidth:!0,margin:"dense",disabled:x}),e.jsx(Ie,{label:"主審",value:s.mainReferee,onChange:r=>g(i=>({...i,mainReferee:r.target.value})),fullWidth:!0,margin:"dense",disabled:x}),e.jsx(Ie,{label:"副審",value:s.subReferee,onChange:r=>g(i=>({...i,subReferee:r.target.value})),fullWidth:!0,margin:"dense",disabled:x}),e.jsx(Ie,{label:"動画URL",value:s.videoUrl,onChange:r=>g(i=>({...i,videoUrl:r.target.value})),multiline:!0,rows:3,fullWidth:!0,margin:"dense",disabled:x}),e.jsx(Ie,{label:"メモ",value:s.memo,onChange:r=>g(i=>({...i,memo:r.target.value})),multiline:!0,rows:3,fullWidth:!0,margin:"dense",disabled:x})]})})})})}function Bi({match:s,setMatch:g,teams:h,locked:y}){return e.jsxs(tt,{elevation:0,sx:{},children:[e.jsxs(Fe,{fullWidth:!0,margin:"dense",disabled:y,children:[e.jsx(Oe,{id:"teamA-label",children:"チームA"}),e.jsx(He,{labelId:"teamA-label",value:s.teamA,label:"チームA",onChange:x=>g(r=>({...r,teamA:x.target.value,teamAMembers:[]})),disabled:y,children:h.map(x=>e.jsx(ce,{value:x.id,children:x.name},x.id))})]}),e.jsx(Ie,{label:"チームA監督",value:s.teamAHeadCoach,onChange:x=>g(r=>({...r,teamAHeadCoach:x.target.value})),fullWidth:!0,margin:"dense",disabled:y}),e.jsx(Ie,{label:"チームAコーチ",value:s.teamACoach,onChange:x=>g(r=>({...r,teamACoach:x.target.value})),fullWidth:!0,margin:"dense",disabled:y}),e.jsx(Ie,{label:"チームAマネージャー",value:s.teamAManager,onChange:x=>g(r=>({...r,teamAManager:x.target.value})),fullWidth:!0,margin:"dense",disabled:y}),e.jsx(Ie,{label:"チームAキャプテン",value:s.teamACaptain,onChange:x=>g(r=>({...r,teamACaptain:x.target.value})),fullWidth:!0,margin:"dense",disabled:y}),e.jsxs(Fe,{fullWidth:!0,margin:"dense",disabled:y,children:[e.jsx(Oe,{id:"teamB-label",children:"チームB"}),e.jsx(He,{labelId:"teamB-label",value:s.teamB,label:"チームB",onChange:x=>g(r=>({...r,teamB:x.target.value,teamBMembers:[]})),disabled:y,children:h.map(x=>e.jsx(ce,{value:x.id,children:x.name},x.id))})]}),e.jsx(Ie,{label:"チームB監督",value:s.teamBHeadCoach,onChange:x=>g(r=>({...r,teamBHeadCoach:x.target.value})),fullWidth:!0,margin:"dense",disabled:y}),e.jsx(Ie,{label:"チームBコーチ",value:s.teamBCoach,onChange:x=>g(r=>({...r,teamBCoach:x.target.value})),fullWidth:!0,margin:"dense",disabled:y}),e.jsx(Ie,{label:"チームBマネージャー",value:s.teamBManager,onChange:x=>g(r=>({...r,teamBManager:x.target.value})),fullWidth:!0,margin:"dense",disabled:y}),e.jsx(Ie,{label:"チームBキャプテン",value:s.teamBCaptain,onChange:x=>g(r=>({...r,teamBCaptain:x.target.value})),fullWidth:!0,margin:"dense",disabled:y})]})}const Di=an.create(t),Pi=()=>typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():Math.random().toString(36).slice(2)+Date.now().toString(36);function Wi({match:s,onSave:g,teams:h,teamMembers:y,playDetails:x,playCategories:r,statsSettings:i,rallyCategoryTags:M,rallyDetailTags:j,themeSetting:m,scoreInputSetting:I,onAddMember:L,setAppBarAction:F,setAppBarLeftAction:B,onDirtyChange:H,tags:G,onAddTag:q}){const te=en(),se=tn(),[w,le]=o.useState("info"),X=!1;o.useEffect(()=>{const d=se.pathname.split("/").filter(Boolean);if(d[0]!=="matches"||d[1]!==s.id)return;const z=d[2]??"info";z==="setinfo"?(le("info"),te(`/matches/${s.id}/info`,{replace:!0})):(le(z),d[2]||te(`/matches/${s.id}/info`,{replace:!0}))},[se.pathname,te,s.id,X]);const re=o.useCallback(d=>{const z=d.teamA,K=d.teamB,ae=(Ae,Ce)=>!!Ce&&(y[Ae]||[]).some(me=>me.id===Ce&&me.visible!==!1),ve=(Ae,Ce)=>Ce.filter(me=>ae(Ae,me.id)).map(me=>{const Le=(y[Ae]||[]).find(ct=>ct.id===me.id);return Le?{...me,no:Le.no,name:Le.name,positions:Le.positions}:me});return{...d,teamAMembers:ve(z,d.teamAMembers),teamBMembers:ve(K,d.teamBMembers),sets:d.sets.map(Ae=>({...Ae,rallies:Ae.rallies.map(Ce=>({...Ce,server:ae(Ce.serverTeam==="teamA"?z:K,Ce.server)?Ce.server:void 0,teamAMember:ae(z,Ce.teamAMember)?Ce.teamAMember:void 0,teamBMember:ae(K,Ce.teamBMember)?Ce.teamBMember:void 0}))}))}},[y]),[f,Y]=o.useState(()=>re({...s,tags:s.tags||[],matchStatsSettings:s.matchStatsSettings||[],teamAMembers:s.teamAMembers.map(d=>({...d,statuses:d.statuses??Array(s.sets.length).fill("")})),teamBMembers:s.teamBMembers.map(d=>({...d,statuses:d.statuses??Array(s.sets.length).fill("")}))})),E=5,fe=[Ds,Ps,ks,$s,Rs],c=!!s.locked,A=Mt(),J=fs(A.breakpoints.up("sm")),Q=fs(A.breakpoints.down("sm")),[O,Z]=o.useState(!1),[ee,de]=o.useState(!1),Se=200,De=56,[u,S]=o.useState(!1),k=A.palette.text.secondary,N=o.useCallback(()=>{O?(de(!1),Z(!1)):(Z(!0),J||de(!0))},[O,J]),R=o.useCallback(d=>{d.propertyName==="width"&&J&&O&&de(!0)},[J,O]);o.useEffect(()=>{J||(Z(!1),de(!1))},[J]),o.useEffect(()=>(B(e.jsx(We,{open:u,onClose:()=>S(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom-end",TransitionComponent:Ue,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${k}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${k}`}}}},title:e.jsxs(t,{sx:{p:1,maxWidth:260},children:[e.jsxs(Ee,{variant:"body2",sx:{whiteSpace:"pre-line"},children:[e.jsx(js,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),et.setReorder.text]}),e.jsx(t,{sx:{textAlign:"right",mt:1},children:e.jsx(Ze,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem("tutorial-set-reorder","1"),S(!1)},children:"了解した"})})]}),children:e.jsx(_e,{color:"inherit",onClick:N,children:e.jsx(js,{})})})),()=>B(null)),[B,N,u,k]);const[$e,l]=o.useState(!1),[a,T]=o.useState(!1),[W,_]=o.useState(null),[$,he]=o.useState(!1),[ge,xe]=o.useState({open:!1,message:"",severity:"success"}),v=(d,z,K)=>{xe({open:!0,message:d,severity:z,...K})},D=`matchDraft-${s.id}`,ue=o.useRef(!1),[ye,Re]=o.useState(!1),[b,C]=o.useState(!1),[V,oe]=o.useState(null),ne=o.useCallback(d=>{oe(d.currentTarget)},[]),U=o.useCallback(()=>{oe(null)},[]),[je,Te]=o.useState({}),n=o.useCallback((d,z,K=!0)=>{Y(ae=>{const ve=[...ae.sets],Ae=ve.findIndex(me=>me.id===d);if(Ae===-1)return ae;const Ce=ve[Ae];return K&&Te(me=>{const Le=me[d]||{undo:[]};return{...me,[d]:{undo:[...Le.undo,Ce],redo:[]}}}),ve[Ae]=z,{...ae,sets:ve}})},[]),p=o.useCallback(()=>{if(!/^[0-9]+$/.test(w))return;const d=Number(w)-1,z=f.sets[d],K=je[z.id];if(!K||K.undo.length===0)return;const ae=K.undo[K.undo.length-1];Te(ve=>({...ve,[z.id]:{undo:K.undo.slice(0,-1),redo:[...K.redo,z]}})),n(z.id,ae,!1)},[w,f.sets,je,n]),ie=o.useCallback(()=>{if(!/^[0-9]+$/.test(w))return;const d=Number(w)-1,z=f.sets[d],K=je[z.id];if(!K||K.redo.length===0)return;const ae=K.redo[K.redo.length-1];Te(ve=>({...ve,[z.id]:{undo:[...K.undo,z],redo:K.redo.slice(0,-1)}})),n(z.id,ae,!1)},[w,f.sets,je,n]),we=d=>{if(!d.destination||c)return;const z=d.source.index,K=d.destination.index;if(z===K)return;const ae=Array.from(f.sets),[ve]=ae.splice(z,1);ae.splice(K,0,ve);const Ae=Le=>Le.map(ct=>{const ze=Array.from(ct.statuses||[]),[pt]=ze.splice(z,1);return ze.splice(K,0,pt),{...ct,statuses:ze}}),Ce=Ae(f.teamAMembers),me=Ae(f.teamBMembers);Y(Le=>({...Le,sets:ae,teamAMembers:Ce,teamBMembers:me}))};o.useEffect(()=>{Te(d=>{const z={...d};return Object.keys(z).forEach(K=>{f.sets.some(ae=>ae.id===K)||delete z[K]}),z})},[f.sets]),o.useEffect(()=>{Y(d=>re(d))},[re]);const be=d=>{var z;return((z=h.find(K=>K.id===d))==null?void 0:z.name)||""},Me=o.useMemo(()=>f.date!==s.date||f.matchName!==s.matchName||f.location!==s.location||f.mainReferee!==s.mainReferee||f.subReferee!==s.subReferee||f.videoUrl!==s.videoUrl||f.memo!==s.memo||f.teamA!==s.teamA||f.teamAHeadCoach!==s.teamAHeadCoach||f.teamACoach!==s.teamACoach||f.teamAManager!==s.teamAManager||f.teamACaptain!==s.teamACaptain||f.teamB!==s.teamB||f.teamBHeadCoach!==s.teamBHeadCoach||f.teamBCoach!==s.teamBCoach||f.teamBManager!==s.teamBManager||f.teamBCaptain!==s.teamBCaptain||JSON.stringify(f.tags)!==JSON.stringify(s.tags)||JSON.stringify(f.teamAMembers)!==JSON.stringify(s.teamAMembers)||JSON.stringify(f.teamBMembers)!==JSON.stringify(s.teamBMembers)||JSON.stringify(f.matchStatsSettings||[])!==JSON.stringify(s.matchStatsSettings||[])||JSON.stringify(f.sets)!==JSON.stringify(s.sets),[f,s]);o.useEffect(()=>{const d=localStorage.getItem(D);if(c){d&&localStorage.removeItem(D),he(!1);return}d&&he(!0)},[D,c]),o.useEffect(()=>{if(!ue.current){ue.current=!0,c&&localStorage.removeItem(D);return}if(c){localStorage.removeItem(D);return}Me?localStorage.setItem(D,JSON.stringify(f)):localStorage.removeItem(D)},[f,Me,D,c]);const Be=()=>{if(c||f.sets.length>=E)return;f.sets.length===1&&!localStorage.getItem("tutorial-set-reorder")&&S(!0);const d={id:Pi(),my:0,opponent:0,rallies:[]},z=f.sets.length+1;Y(K=>({...K,sets:[...K.sets,d],teamAMembers:K.teamAMembers.map(ae=>({...ae,statuses:[...ae.statuses||[],""]})),teamBMembers:K.teamBMembers.map(ae=>({...ae,statuses:[...ae.statuses||[],""]}))})),le(String(z)),te(`/matches/${s.id}/${z}`)},Bt=d=>{c||(_(d),T(!0))},Dt=()=>{if(W===null)return;const d=W,z=f.sets.length;let K=[],ae=[],ve=[];const Ae=w;let Ce=w;if(w!=="info"&&w!=="members"&&w!=="stats"&&w!=="setinfo"){const me=Number(w)-1;me===d?d>0?(Ce=String(d),te(`/matches/${s.id}/${d}`)):z>1?(Ce="1",te(`/matches/${s.id}/1`)):(Ce="info",te(`/matches/${s.id}/info`)):me>d&&(Ce=String(me),te(`/matches/${s.id}/${me}`))}le(Ce),Y(me=>{K=me.sets.map(ze=>({...ze})),ae=me.teamAMembers.map(ze=>({...ze,statuses:ze.statuses?[...ze.statuses]:[]})),ve=me.teamBMembers.map(ze=>({...ze,statuses:ze.statuses?[...ze.statuses]:[]}));const Le=me.sets.filter((ze,pt)=>pt!==d),ct=ze=>ze.map(pt=>({...pt,statuses:(pt.statuses||[]).filter(($i,Ks)=>Ks!==d)}));return{...me,sets:Le,teamAMembers:ct(me.teamAMembers),teamBMembers:ct(me.teamBMembers)}}),_(null),T(!1),v("セットを削除しました","success",{actionLabel:"元に戻す",onAction:()=>{Y(me=>({...me,sets:K,teamAMembers:ae,teamBMembers:ve})),Ae!=="info"&&Ae!=="members"&&Ae!=="stats"&&Ae!=="setinfo"&&te(`/matches/${s.id}/${Ae}`)},autoHideDuration:5e3})},jt=()=>{_(null),T(!1)},ht=o.useCallback(()=>{l(!0)},[]),Pt=async()=>{const d=re(f);Y(d);try{await Promise.resolve(g(d)),localStorage.removeItem(D),v("保存しました","success")}catch{v("保存に失敗しました","error")}l(!1)},bt=()=>{l(!1)},Es=()=>{xe(d=>({...d,open:!1}))},Ls=()=>{const d=localStorage.getItem(D);if(!d){he(!1);return}try{const z=JSON.parse(d),K={...z,tags:z.tags||[],matchStatsSettings:z.matchStatsSettings||[],teamAMembers:z.teamAMembers.map(ve=>({...ve,statuses:ve.statuses??Array(z.sets.length).fill("")})),teamBMembers:z.teamBMembers.map(ve=>({...ve,statuses:ve.statuses??Array(z.sets.length).fill("")}))},ae=re(K);Y(ae),g(ae)}catch{}localStorage.removeItem(D),he(!1)},ms=()=>{localStorage.removeItem(D),he(!1)},Xe=o.useMemo(()=>/^[0-9]+$/.test(w),[w]),mt=o.useMemo(()=>Xe?f.sets[Number(w)-1]:null,[Xe,w,f.sets]),yt=o.useMemo(()=>{var d;return!Xe||c||!mt||!((d=je[mt.id])!=null&&d.undo.length)},[Xe,c,mt,je]),vt=o.useMemo(()=>{var d;return!Xe||c||!mt||!((d=je[mt.id])!=null&&d.redo.length)},[Xe,c,mt,je]);o.useEffect(()=>{yt?Re(!1):localStorage.getItem("tutorial-undo")||Re(!0)},[yt]),o.useEffect(()=>{vt?C(!1):localStorage.getItem("tutorial-redo")||C(!0)},[vt]),o.useEffect(()=>{if(Q){const d=ye?"undo":b?"redo":null;F(e.jsxs(t,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(We,{open:!!d,onClose:()=>{d==="undo"?Re(!1):d==="redo"&&C(!1)},disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:Ue,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${k}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${k}`}}}},title:e.jsx(t,{sx:{p:1,maxWidth:260},children:d==="undo"?e.jsxs(e.Fragment,{children:[e.jsxs(Ee,{variant:"body2",sx:{whiteSpace:"pre-line"},children:["メニューから",e.jsx($t,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),et.undoMobile.text]}),e.jsx(t,{sx:{textAlign:"right",mt:1},children:e.jsx(Ze,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem("tutorial-undo","1"),Re(!1)},children:"了解した"})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(Ee,{variant:"body2",sx:{whiteSpace:"pre-line"},children:["メニューから",e.jsx(Rt,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),et.redoMobile.text]}),e.jsx(t,{sx:{textAlign:"right",mt:1},children:e.jsx(Ze,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem("tutorial-redo","1"),C(!1)},children:"了解した"})})]})}),children:e.jsx(_e,{color:"inherit",onClick:ne,children:e.jsx(_s,{})})}),e.jsxs(Xs,{anchorEl:V,open:!!V,onClose:U,MenuListProps:{onClick:U},children:[Xe&&e.jsxs(e.Fragment,{children:[e.jsxs(ce,{onClick:p,disabled:yt,children:[e.jsx(ft,{children:e.jsx($t,{fontSize:"small"})}),e.jsx(gt,{children:"元に戻す"})]}),e.jsxs(ce,{onClick:ie,disabled:vt,children:[e.jsx(ft,{children:e.jsx(Rt,{fontSize:"small"})}),e.jsx(gt,{children:"やり直す"})]})]}),e.jsxs(ce,{onClick:ht,disabled:!Me||c,children:[e.jsx(ft,{children:e.jsx(Ge,{fontSize:"small"})}),e.jsx(gt,{children:"保存"})]})]})]}))}else F(e.jsxs(t,{sx:{display:"flex",alignItems:"center"},children:[Xe&&e.jsxs(e.Fragment,{children:[e.jsx(We,{open:ye,onClose:()=>Re(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:Ue,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${k}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${k}`}}}},title:e.jsxs(t,{sx:{p:1,maxWidth:260},children:[e.jsx(Ee,{variant:"body2",sx:{whiteSpace:"pre-line"},children:et.undoDesktop.text}),e.jsx(t,{sx:{textAlign:"right",mt:1},children:e.jsx(Ze,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem("tutorial-undo","1"),Re(!1)},children:"了解した"})})]}),children:e.jsx(_e,{onClick:p,disabled:yt,color:"inherit",sx:{ml:1},children:e.jsx($t,{})})}),e.jsx(We,{open:b,onClose:()=>C(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:Ue,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${k}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${k}`}}}},title:e.jsxs(t,{sx:{p:1,maxWidth:260},children:[e.jsx(Ee,{variant:"body2",sx:{whiteSpace:"pre-line"},children:et.redoDesktop.text}),e.jsx(t,{sx:{textAlign:"right",mt:1},children:e.jsx(Ze,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem("tutorial-redo","1"),C(!1)},children:"了解した"})})]}),children:e.jsx(_e,{onClick:ie,disabled:vt,color:"inherit",sx:{ml:1},children:e.jsx(Rt,{})})})]}),e.jsx(pe,{onClick:ht,variant:"contained",disabled:!Me||c,startIcon:e.jsx(Ge,{}),sx:{ml:1},children:"保存"})]}));return()=>F(null)},[F,Q,V,ne,U,Xe,p,ie,ht,Me,c,yt,vt,ye,b,k]),o.useEffect(()=>(H==null||H(Me),()=>H==null?void 0:H(!1)),[Me,H]);const Ws=[{key:"info",label:"試合概要",icon:e.jsx(nn,{})},{key:"team",label:"チーム",icon:e.jsx(Bs,{})},{key:"members",label:"メンバー登録",icon:e.jsx(Is,{})},{key:"sep1",divider:!0},{key:"stats",label:"スタッツ",icon:e.jsx(rn,{})},{key:"sep2",divider:!0},{key:"setinfo",label:"セット情報",icon:e.jsx(Ms,{})}].filter(d=>d.key!=="setinfo"),Us=f.sets.map((d,z)=>{const K=fe[z];return{key:`${z+1}`,icon:e.jsx(K,{}),label:`${d.my}-${d.opponent}`}}),Vs=!c&&f.sets.length<E?[{key:"add",label:"セット追加",icon:e.jsx(Et,{})}]:[],Lt=d=>{d==="add"?Be():(le(d),te(`/matches/${s.id}/${d}`)),J||(de(!1),Z(!1))},qs=e.jsxs(Di,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},sx:{flexGrow:1,overflowY:"auto",display:"flex",flexDirection:"column"},children:[w==="info"&&e.jsx(Mi,{match:f,setMatch:Y,tags:G,onAddTag:q,locked:c}),w==="members"&&e.jsx(Ii,{match:f,setMatch:Y,teamAName:be(f.teamA)||"チームA",teamBName:be(f.teamB)||"チームB",teamMembers:y,onAddMember:L,locked:c,showSnackbar:v}),w==="stats"&&e.jsx(Ci,{sets:f.sets,playDetails:x,playCategories:r,statsSettings:i,matchStatsSettings:f.matchStatsSettings||[],onMatchStatsSettingsChange:d=>Y(z=>({...z,matchStatsSettings:d})),rallyCategoryTags:M,rallyDetailTags:j,teamAName:be(f.teamA),teamBName:be(f.teamB),locked:c,showSnackbar:v}),w==="team"&&e.jsx(t,{sx:{maxWidth:1024,mx:"auto"},children:e.jsx(Bi,{match:f,setMatch:Y,teams:h,locked:c})}),X,w!=="info"&&w!=="members"&&w!=="stats"&&w!=="setinfo"&&w!=="team"&&e.jsx(gi,{setScore:f.sets[Number(w)-1],playDetails:x,playCategories:r,teamAMembers:f.teamAMembers,teamBMembers:f.teamBMembers,teamAName:be(f.teamA),teamBName:be(f.teamB),locked:c,scoreInputSetting:I,themeSetting:m,onChange:d=>n(d.id,d),showSnackbar:v})]},w);return e.jsxs(t,{sx:{display:"flex",height:"100%"},children:[e.jsx(Ys,{variant:J?"permanent":"temporary",open:J?!0:O,onClose:()=>{de(!1),Z(!1)},PaperProps:{onTransitionEnd:R},ModalProps:{keepMounted:!0,BackdropProps:{sx:{backgroundColor:"rgba(0, 0, 0, 0.5)"}}},sx:{width:J?O?Se:De:Se,flexShrink:0,transition:A.transitions.create("width",{easing:A.transitions.easing.sharp,duration:A.transitions.duration.standard}),...J?{zIndex:A.zIndex.appBar-1}:{},"& .MuiDrawer-paper":{width:J?O?Se:De:Se,boxSizing:"border-box",overflowX:"hidden",transition:A.transitions.create("width",{easing:A.transitions.easing.sharp,duration:A.transitions.duration.standard}),...J?{top:A.mixins.toolbar.minHeight,height:`calc(100% - ${A.mixins.toolbar.minHeight}px)`,zIndex:A.zIndex.appBar-1}:{}}},children:e.jsxs(Qs,{children:[Ws.map(d=>d.divider?e.jsx(Zs,{component:"li"},d.key):e.jsxs(Ut,{selected:w===d.key,onClick:()=>Lt(d.key),sx:{minHeight:48,justifyContent:O?"initial":"center",px:2.5},children:[e.jsx(ft,{sx:{minWidth:0,mr:O?3:0,justifyContent:"center"},children:d.icon}),e.jsx(gt,{primary:d.label??`セット${d.key}`,sx:{opacity:ee?1:0,display:ee?"block":"none",whiteSpace:"nowrap"}})]},d.key)),e.jsx(It,{onDragEnd:we,children:e.jsx(lt,{droppableId:"drawer-sets",children:d=>e.jsxs(t,{ref:d.innerRef,...d.droppableProps,children:[Us.map((z,K)=>e.jsx(ot,{draggableId:f.sets[K].id,index:K,children:ae=>e.jsxs(Ut,{ref:ae.innerRef,...ae.draggableProps,...ae.dragHandleProps,style:ae.draggableProps.style,selected:w===z.key,onClick:()=>Lt(z.key),sx:{minHeight:48,justifyContent:O?"initial":"center",px:2.5},children:[e.jsx(ft,{sx:{minWidth:0,mr:O?3:0,justifyContent:"center"},children:z.icon}),e.jsx(gt,{primary:z.label??`セット${z.key}`,sx:{opacity:ee?1:0,display:ee?"block":"none",whiteSpace:"nowrap"}}),!c&&O&&e.jsx(_e,{edge:"end",onClick:ve=>{ve.stopPropagation(),Bt(K)},children:e.jsx(nt,{})})]})},f.sets[K].id)),d.placeholder]})})}),Vs.map(d=>e.jsxs(Ut,{selected:w===d.key,onClick:()=>Lt(d.key),sx:{minHeight:48,justifyContent:O?"initial":"center",px:2.5},children:[e.jsx(ft,{sx:{minWidth:0,mr:O?3:0,justifyContent:"center"},children:d.icon}),e.jsx(gt,{primary:d.label??`セット${d.key}`,sx:{opacity:ee?1:0,display:ee?"block":"none",whiteSpace:"nowrap"}})]},d.key))]})}),e.jsxs(t,{sx:{flexGrow:1,display:"flex",flexDirection:"column",width:J?`calc(100% - ${O?Se:De}px)`:"100%",transition:J?A.transitions.create("width",{duration:A.transitions.duration.standard}):void 0},children:[e.jsx(t,{sx:{flexGrow:1,position:"relative",overflowY:"hidden",display:"flex",width:"100%"},children:e.jsx(ln,{mode:"wait",children:qs})}),e.jsxs(Vt,{open:a,onClose:jt,children:[e.jsx(it,{children:"削除確認"}),e.jsx(rt,{sx:{mt:2},children:"このセットを削除しますか？"}),e.jsxs(at,{children:[e.jsx(pe,{onClick:jt,startIcon:e.jsx(st,{}),color:"inherit",children:"キャンセル"}),e.jsx(pe,{onClick:Dt,color:"error",startIcon:e.jsx(Ge,{}),children:"OK"})]})]}),e.jsxs(Vt,{open:$,onClose:ms,children:[e.jsx(it,{children:"復元確認"}),e.jsx(rt,{sx:{mt:2},children:"入力途中のデータが存在します。復元しますか？"}),e.jsxs(at,{children:[e.jsx(pe,{onClick:ms,startIcon:e.jsx(st,{}),color:"inherit",children:"いいえ"}),e.jsx(pe,{onClick:Ls,startIcon:e.jsx(Ge,{}),children:"はい"})]})]}),e.jsxs(Vt,{open:$e,onClose:bt,children:[e.jsx(it,{children:"保存確認"}),e.jsx(rt,{sx:{mt:2},children:"入力内容を保存しますか？"}),e.jsxs(at,{children:[e.jsx(pe,{onClick:bt,startIcon:e.jsx(st,{}),color:"inherit",children:"キャンセル"}),e.jsx(pe,{onClick:Pt,disabled:!Me||c,startIcon:e.jsx(Ge,{}),children:"OK"})]})]}),e.jsx(Ts,{open:ge.open,message:ge.message,severity:ge.severity,onClose:Es,actionLabel:ge.actionLabel,onAction:ge.onAction,autoHideDuration:ge.autoHideDuration})]})]})}export{Wi as default};
