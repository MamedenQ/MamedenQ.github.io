const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/GraphDialog-BYjWf4Lu.js","assets/mui-vendor-0BmcROP4.js","assets/react-vendor-QLNaZ7XN.js","assets/index-DvZwjNoh.js","assets/motion-vendor-CtLLg_49.js","assets/index-DqrEpDIH.css","assets/chart-vendor-BtE8BaVf.js"])))=>i.map(i=>d[i]);
import{R as Ds,D as re,a as ws,S as Ss,d as ks,b as He,c as _s,r as Je,i as Ws,_ as Fs}from"./index-DvZwjNoh.js";import{j as s,n as qe,o as Ke,U as be,F as fe,Q as he,S as pe,M as E,R as Ve,C as ie,q as Z,A as Gs,f as Ms,g as Rs,h as Es,k as De,l as v,m as Ls,a9 as Ns,B as z,I as Qe,p as Xe,i as Ze,a as Hs,b as qs,G as Cs,aa as Ne,L as Ts,X as Ks,Y as Vs,$ as Qs,a0 as Xs,a1 as Ys,d as Is,e as Re,D as Js}from"./mui-vendor-0BmcROP4.js";import{r as n}from"./react-vendor-QLNaZ7XN.js";import{D as Zs,C as et,P as st,d as tt}from"./DragIndicator-Bik0IU_S.js";import{d as lt}from"./SpaceDashboardOutlined-YVRIy-Dh.js";import{m as nt,A as at}from"./motion-vendor-CtLLg_49.js";import"./chart-vendor-BtE8BaVf.js";function rt({open:S,playCategories:u,playDetails:g,rallyCategoryTags:y,rallyDetailTags:b,initialData:c,onCancel:D,onSave:m}){const[h,T]=n.useState(""),[j,K]=n.useState(""),[G,$]=n.useState([]),[I,U]=n.useState([]),[k,P]=n.useState(""),[C,ge]=n.useState(""),[M,oe]=n.useState(""),[o,me]=n.useState("合算"),[V,ee]=n.useState([]),Ee=t=>{if(!t.destination)return;const a=Array.from(V),[x]=a.splice(t.source.index,1);a.splice(t.destination.index,0,x),ee(a)};n.useEffect(()=>{S&&(T((c==null?void 0:c.name)||""),ee((c==null?void 0:c.items)||[]),K(""),$([]),U([]),P(""),ge(""),oe(""),me("合算"))},[S,c]);const se=j!=="",te=G.length>0,de=k!=="",we=I.length>0,ce=C!=="",Se=M!=="",je=se?te||we?!1:de?!ce&&!Se:!0:te||we?!(se||de):de?!1:!!(ce||Se),Le=()=>{if(!o||!je)return;const t={id:crypto.randomUUID(),method:o};j?t.playCategoryId=j:G.length>0&&(t.playCategoryTags=G),k&&(t.playDetailId=k),I.length>0&&(t.playDetailTags=I),C&&(t.pointType=C),M&&(t.pointUnitType=M),ee(a=>[...a,t]),K(""),$([]),P(""),U([]),ge(""),oe("")},ke=t=>{ee(a=>a.filter(x=>x.id!==t))},Oe=()=>{if(!h||V.length===0)return;const t={id:(c==null?void 0:c.id)||crypto.randomUUID(),name:h,items:V};m(t)},_e=j?g.filter(t=>t.playCategoryId===j&&t.visible!==!1):[],Ae=t=>g.filter(a=>{var Q,H;const x=u.find(q=>q.id===a.playCategoryId);return!(a.visible===!1||(x==null?void 0:x.visible)===!1||t.playCategoryId&&a.playCategoryId!==t.playCategoryId||t.playCategoryTags&&t.playCategoryTags.length>0&&!((Q=x==null?void 0:x.tags)!=null&&Q.some(q=>{var B;return(B=t.playCategoryTags)==null?void 0:B.includes(q)}))||t.playDetailId&&a.id!==t.playDetailId||t.playDetailTags&&t.playDetailTags.length>0&&!((H=a.tags)!=null&&H.some(q=>{var B;return(B=t.playDetailTags)==null?void 0:B.includes(q)}))||t.pointType&&a.pointType!==t.pointType||t.pointUnitType&&a.pointUnitType!==t.pointUnitType)}),ve=t=>Ae(t).length===0,L=V.some(ve);return s.jsxs(Ds,{open:S,onClose:D,children:[s.jsx(qe,{children:"カスタム分析追加"}),s.jsxs(Ke,{sx:{display:"flex",flexDirection:"column",gap:2,mt:2},children:[s.jsx(be,{label:"カスタム分析名",margin:"dense",value:h,onChange:t=>T(t.target.value),fullWidth:!0}),s.jsxs(s.Fragment,{children:[s.jsxs(fe,{fullWidth:!0,sx:{mt:1},disabled:G.length>0||I.length>0,children:[s.jsx(he,{id:"category",children:"プレー区分"}),s.jsxs(pe,{labelId:"category",value:j,label:"プレー区分",onChange:t=>{const a=t.target.value;K(a),P(""),U([]),a&&$([])},children:[s.jsx(E,{value:"",children:"指定なし"}),u.filter(t=>t.visible!==!1).map(t=>s.jsx(E,{value:t.id,children:t.name},t.id))]})]}),s.jsxs(fe,{fullWidth:!0,sx:{mt:1},disabled:!!C||!!M||G.length>0||I.length>0,children:[s.jsx(he,{id:"detail",children:"プレー詳細"}),s.jsxs(pe,{labelId:"detail",value:k,label:"プレー詳細",onChange:t=>{P(t.target.value),t.target.value&&(ge(""),oe(""),$([]),U([]))},children:[s.jsx(E,{value:"",children:"指定なし"}),_e.map(t=>s.jsx(E,{value:t.id,children:t.name},t.id))]})]}),s.jsx(Ve,{multiple:!0,options:y,getOptionLabel:t=>t.name,value:y.filter(t=>G.includes(t.id)),onChange:(t,a)=>{$(a.map(x=>x.id)),a.length>0&&(K(""),P(""))},renderTags:(t,a)=>t.map((x,Q)=>n.createElement(ie,{...a({index:Q}),key:x.id,label:x.name,size:"small",sx:{backgroundColor:x.color||re,color:"#fff"}})),renderInput:t=>s.jsx(be,{...t,label:"プレー区分タグ",margin:"dense"}),disabled:!!j||!!k,fullWidth:!0}),s.jsx(Ve,{multiple:!0,options:b,getOptionLabel:t=>t.name,value:b.filter(t=>I.includes(t.id)),onChange:(t,a)=>{U(a.map(x=>x.id)),a.length>0&&(K(""),P(""))},renderTags:(t,a)=>t.map((x,Q)=>n.createElement(ie,{...a({index:Q}),key:x.id,label:x.name,size:"small",sx:{backgroundColor:x.color||re,color:"#fff"}})),renderInput:t=>s.jsx(be,{...t,label:"プレー詳細タグ",margin:"dense"}),disabled:!!j||!!k,fullWidth:!0}),s.jsxs(fe,{fullWidth:!0,disabled:!!k,children:[s.jsx(he,{id:"ptype",children:"得失点区分"}),s.jsxs(pe,{labelId:"ptype",value:C,label:"得失点区分",onChange:t=>{ge(t.target.value),t.target.value&&P("")},children:[s.jsx(E,{value:"",children:"指定なし"}),s.jsx(E,{value:"得点",children:"得点"}),s.jsx(E,{value:"失点",children:"失点"})]})]}),s.jsxs(fe,{fullWidth:!0,disabled:!!k,children:[s.jsx(he,{id:"punittype",children:"得失点単位区分"}),s.jsxs(pe,{labelId:"punittype",value:M,label:"得失点単位区分",onChange:t=>{oe(t.target.value),t.target.value&&P("")},children:[s.jsx(E,{value:"",children:"指定なし"}),s.jsx(E,{value:"メンバー",children:"メンバー"}),s.jsx(E,{value:"チーム",children:"チーム"})]})]}),s.jsxs(fe,{fullWidth:!0,children:[s.jsx(he,{id:"method",children:"集計方法"}),s.jsxs(pe,{labelId:"method",value:o,label:"集計方法",onChange:t=>me(t.target.value),children:[s.jsx(E,{value:"合算",children:"合算"}),s.jsx(E,{value:"試合平均",children:"試合平均"}),s.jsx(E,{value:"セット平均",children:"セット平均"})]})]}),s.jsx(Z,{variant:"contained",onClick:Le,size:"small",disabled:!je,fullWidth:!0,startIcon:s.jsx(ws,{}),children:"追加"})]}),V.length>0&&s.jsxs(s.Fragment,{children:[L&&s.jsx(Gs,{severity:"error",sx:{mb:1},children:"分析条件に合致するプレー区分、または、プレー詳細が存在しません（赤背景行）"}),s.jsx(Ss,{component:Ms,storageKey:"custom-analysis-dialog",children:s.jsxs(Rs,{size:"small",sx:{"& .MuiTableRow-root":{height:50}},children:[s.jsx(Es,{children:s.jsxs(De,{sx:{backgroundColor:t=>t.palette.mode==="dark"?"#343A42":"#f5f5f5"},children:[s.jsx(v,{}),s.jsx(v,{children:"プレー区分"}),s.jsx(v,{children:"プレー詳細"}),s.jsx(v,{children:"得失点区分"}),s.jsx(v,{children:"得失点単位区分"}),s.jsx(v,{children:"集計方法"}),s.jsx(v,{})]})}),s.jsx(Zs,{onDragEnd:Ee,children:s.jsx(et,{droppableId:"custom-analysis-items",children:t=>s.jsxs(Ls,{ref:t.innerRef,...t.droppableProps,children:[V.map((a,x)=>{const Q=ve(a);return s.jsx(st,{draggableId:a.id,index:x,children:H=>{var q,B;return s.jsxs(De,{ref:H.innerRef,...H.draggableProps,sx:{backgroundColor:Q?_=>Ns(_.palette.error.main,.1):void 0},children:[s.jsx(v,{padding:"checkbox",children:s.jsx(z,{...H.dragHandleProps,sx:{cursor:"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:s.jsx(tt,{fontSize:"small"})})}),s.jsx(v,{children:a.playCategoryTags&&a.playCategoryTags.length>0?a.playCategoryTags.map(_=>{const O=y.find(ue=>ue.id===_),le=(O==null?void 0:O.color)||re;return s.jsx(ie,{label:(O==null?void 0:O.name)||_,size:"small",sx:{mr:.5,mb:.5,backgroundColor:le,color:"#fff"}},_)}):(q=u.find(_=>_.id===a.playCategoryId))==null?void 0:q.name}),s.jsx(v,{children:a.playDetailTags&&a.playDetailTags.length>0?a.playDetailTags.map(_=>{const O=b.find(ue=>ue.id===_),le=(O==null?void 0:O.color)||re;return s.jsx(ie,{label:(O==null?void 0:O.name)||_,size:"small",sx:{mr:.5,mb:.5,backgroundColor:le,color:"#fff"}},_)}):a.playDetailId?(B=g.find(_=>_.id===a.playDetailId))==null?void 0:B.name:""}),s.jsx(v,{children:a.pointType||""}),s.jsx(v,{children:a.pointUnitType||""}),s.jsx(v,{children:a.method}),s.jsx(v,{children:s.jsx(Qe,{size:"small",onClick:()=>ke(a.id),children:s.jsx(ks,{fontSize:"small",color:"error"})})})]})}},a.id)}),t.placeholder]})})})]})})]})]}),s.jsxs(Xe,{children:[s.jsx(Z,{onClick:D,startIcon:s.jsx(He,{}),color:"inherit",children:"キャンセル"}),s.jsx(Z,{onClick:Oe,disabled:!h||V.length===0,startIcon:s.jsx(_s,{}),children:"OK"})]})]})}var es={},it=Ze;Object.defineProperty(es,"__esModule",{value:!0});var Ye=es.default=void 0,ot=it(Je()),dt=s;Ye=es.default=(0,ot.default)((0,dt.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search");var ss={},ct=Ze;Object.defineProperty(ss,"__esModule",{value:!0});var Os=ss.default=void 0,ut=ct(Je()),ft=s;Os=ss.default=(0,ut.default)((0,ft.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit");var ts={},ht=Ze;Object.defineProperty(ts,"__esModule",{value:!0});var As=ts.default=void 0,pt=ht(Je()),xt=s;As=ts.default=(0,pt.default)((0,xt.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Clear");const gt=n.lazy(()=>Fs(()=>import("./GraphDialog-BYjWf4Lu.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),xe="__TEAM__",mt=nt.create(z);function jt(S,u){let g=0,y=0,b=0,c=0;return S.sets.forEach(D=>{const m=u==="teamA"?D.my:D.opponent,h=u==="teamA"?D.opponent:D.my;b+=m,c+=h,m>h?g+=1:m<h&&(y+=1)}),g>y?"win":g<y?"lose":b>c?"win":b<c?"lose":"draw"}function yt(S,u,g,y,b,c,D){return S.filter(m=>{if(u!=="ALL"){if(!(m.teamA===u||m.teamB===u)||g&&!(m.teamA===u&&m.teamB===g||m.teamA===g&&m.teamB===u))return!1;if(c){const T=m.teamA===u?"teamA":"teamB";if(jt(m,T)!==c)return!1}}else if(g&&m.teamA!==g&&m.teamB!==g)return!1;return!(y&&m.date!==y||b&&!m.matchName.includes(b)||D&&D.length>0&&!D.every(h=>m.tags.includes(h)))})}function bt(S,u){const g=u==="teamA"?S.my:S.opponent,y=u==="teamA"?S.opponent:S.my;return g>y?"win":g<y?"lose":"draw"}function vt(S,u,g,y,b){const c={},D=(h,T,j)=>{c[h]||(c[h]={}),c[h][T]||(c[h][T]={}),c[h][T][j]=(c[h][T][j]||0)+1},m=(h,T)=>!!T&&(y[h]||[]).some(j=>j.id===T&&j.visible!==!1);return S.forEach(h=>{const T=(j,K)=>{h.sets.forEach(G=>{b&&bt(G,K)!==b||G.rallies.forEach($=>{const I=K==="teamA"?$.teamAPlayDetail:$.teamBPlayDetail,U=K==="teamA"?$.teamAMember:$.teamBMember;if(!I)return;const k=g.get(I);(k==null?void 0:k.pointUnitType)==="チーム"?D(j,xe,I):(k==null?void 0:k.pointUnitType)==="メンバー"&&(m(j,U)?D(j,U,I):D(j,xe,I))})})};u==="ALL"?(h.teamA&&T(h.teamA,"teamA"),h.teamB&&T(h.teamB,"teamB")):h.teamA===u?T(u,"teamA"):h.teamB===u&&T(u,"teamB")}),c}function _t({matches:S,teams:u,teamMembers:g,playCategories:y,playDetails:b,customAnalyses:c,onCustomAnalysesChange:D,tags:m,rallyCategoryTags:h,rallyDetailTags:T,themeSetting:j,showSnackbar:K,setAppBarAction:G,setAppBarLeftAction:$}){var vs;const I=((vs=u[0])==null?void 0:vs.id)||"",[U,k]=n.useState(0),P=e=>{k(e)},[C,ge]=n.useState("member"),[M,oe]=n.useState("asc"),[o,me]=n.useState({left:I,right:"",date:"",name:"",tags:[]}),[V,ee]=n.useState(!1),[Ee,se]=n.useState(!1),[te,de]=n.useState(null),[we,ce]=n.useState(!1),[Se,je]=n.useState(!1),[Le,ke]=n.useState(""),[Oe,_e]=n.useState([]),[Ae,ve]=n.useState(""),L=Hs(),t=qs(L.breakpoints.up("sm")),[a,x]=n.useState(!1),[Q,H]=n.useState(!1),q=56,B=200,_=n.useCallback(()=>{a?(H(!1),x(!1)):(x(!0),t||H(!0))},[a,t]),O=n.useCallback(e=>{e.target===e.currentTarget&&(a?H(!0):(x(!1),H(!1)))},[a]),[le,ue]=n.useState(u.length>0?u[0].id:""),[ls,ns]=n.useState(""),[as,rs]=n.useState(""),[is,os]=n.useState(""),[ds,cs]=n.useState(""),[us,fs]=n.useState(""),[hs,ps]=n.useState([]),xs=n.useMemo(()=>new Map(b.map(e=>[e.id,e])),[b]),zs=n.useCallback(()=>{me({left:I,right:"",date:"",name:"",tags:[],matchResult:void 0,setResult:void 0})},[I]);n.useEffect(()=>{!o.left&&I&&me(e=>({...e,left:I})),!le&&I&&ue(I)},[I,o.left,le]),n.useEffect(()=>{V&&(ue(o.left),ns(o.right),rs(o.date),os(o.name),cs(o.matchResult||""),fs(o.setResult||""),ps(o.tags))},[V,o]),n.useEffect(()=>(G(s.jsx(Z,{color:"inherit",startIcon:s.jsx(Ye,{}),onClick:()=>ee(!0),children:"詳細検索"})),()=>G(null)),[G]),n.useEffect(()=>($(s.jsx(Qe,{color:"inherit",onClick:_,children:s.jsx(lt,{})})),()=>$(null)),[$,_]);const Me=n.useMemo(()=>yt(S,o.left,o.right,o.date,o.name,o.matchResult,o.tags),[S,o]),X=n.useMemo(()=>{const e=o.setResult;return vt(Me,o.left,xs,g,e)},[Me,o,xs,g]),ze=Me.length,$e=Me.reduce((e,l)=>e+l.sets.length,0),A=o.left,gs=n.useMemo(()=>A==="ALL"?u.map(e=>e.id):[A],[A,u]),ne=n.useMemo(()=>y.filter(e=>e.visible!==!1),[y]),N=U>=ne.length,Ue=N?U-ne.length:-1,W=N?c[Ue]:null,Ce=N?void 0:ne[U],ye=N?[]:b.filter(e=>e.playCategoryId===(Ce==null?void 0:Ce.id)&&e.visible!==!1),$s=!N&&ye.length>0&&ye.every(e=>e.pointUnitType==="チーム"),Pe=n.useMemo(()=>[...ne.map(e=>({key:e.id,label:e.name})),...c.map(e=>({key:e.id,label:e.name})),{key:"add",label:"分析追加"}],[ne,c]),Be=n.useCallback(e=>{var l;return((l=u.find(r=>r.id===e))==null?void 0:l.name)||""},[u]),Te=n.useCallback(e=>b.filter(l=>{var d,i;const r=y.find(f=>f.id===l.playCategoryId);return!(l.visible===!1||(r==null?void 0:r.visible)===!1||e.playCategoryId&&l.playCategoryId!==e.playCategoryId||e.playCategoryTags&&e.playCategoryTags.length>0&&!((d=r==null?void 0:r.tags)!=null&&d.some(f=>{var p;return(p=e.playCategoryTags)==null?void 0:p.includes(f)}))||e.playDetailId&&l.id!==e.playDetailId||e.playDetailTags&&e.playDetailTags.length>0&&!((i=l.tags)!=null&&i.some(f=>{var p;return(p=e.playDetailTags)==null?void 0:p.includes(f)}))||e.pointType&&l.pointType!==e.pointType||e.pointUnitType&&l.pointUnitType!==e.pointUnitType)}),[b,y]),ae=n.useCallback((e,l,r)=>{let d=0;return Te(r).forEach(f=>{var p,F;d+=((F=(p=X[e])==null?void 0:p[l])==null?void 0:F[f.id])||0}),r.method==="試合平均"?d=ze?d/ze:0:r.method==="セット平均"&&(d=$e?d/$e:0),d},[X,ze,$e,Te]),ms=e=>{const l=Te(e);return l.length>0&&l.every(r=>r.pointUnitType==="チーム")},js=e=>{var d,i;const l=[];e.playCategoryId?l.push(((d=y.find(f=>f.id===e.playCategoryId))==null?void 0:d.name)||""):e.playCategoryTags&&e.playCategoryTags.length>0&&l.push(e.playCategoryTags.join(",")),e.playDetailId?l.push(((i=b.find(f=>f.id===e.playDetailId))==null?void 0:i.name)||""):e.playDetailTags&&e.playDetailTags.length>0&&l.push(e.playDetailTags.join(","));const r=[e.pointType,e.pointUnitType].filter(Boolean).join(",");return r&&l.push(r),l.length>0?`${l.join(" / ")} (${e.method})`:`(${e.method})`},ys=n.useMemo(()=>gs.flatMap(e=>(g[e]||[]).filter(l=>l.visible!==!1).map(l=>({teamId:e,member:l}))),[gs,g]),Us=n.useMemo(()=>{const e=[],l=o.left==="ALL"?"全チーム":Be(o.left);e.push(`分析対象チーム：${l}`),o.left!=="ALL"&&o.right&&o.right!==""&&e.push(`対戦相手チーム：${Be(o.right)}`),o.date&&e.push(`試合日付：${o.date}`),o.name&&e.push(`試合名：${o.name}`),o.matchResult==="win"?e.push("勝ち試合"):o.matchResult==="lose"&&e.push("負け試合"),o.setResult==="win"?e.push("勝ちセット"):o.setResult==="lose"&&e.push("負けセット");const r=e.join("、");return o.tags.length>0?s.jsxs(s.Fragment,{children:[r,"、タグ：",o.tags.map(d=>{const i=m.find(p=>p.id===d),f=(i==null?void 0:i.color)||re;return s.jsx(ie,{label:(i==null?void 0:i.name)||d,size:"small",sx:{ml:.5,backgroundColor:f,color:"#fff"}},d)})]}):r},[o,m,Be]),Ie=n.useMemo(()=>{const e=new Map;return c.forEach(l=>{l.items.forEach(r=>{Te(r).length>0&&e.set(r.id,r)})}),e},[c,Te]),Y=n.useMemo(()=>W?W.items.filter(e=>Ie.has(e.id)):[],[W,Ie]),Ps=n.useMemo(()=>{const e=[...ys];return e.sort((l,r)=>{var f,p,F,w;let d="",i="";if(C==="member")d=l.member.name,i=r.member.name;else if(Ie.has(C)){const R=Ie.get(C);d=ae(l.teamId,l.member.id,R),i=ae(r.teamId,r.member.id,R)}else d=((p=(f=X[l.teamId])==null?void 0:f[l.member.id])==null?void 0:p[C])||0,i=((w=(F=X[r.teamId])==null?void 0:F[r.member.id])==null?void 0:w[C])||0;return d<i?M==="asc"?-1:1:d>i?M==="asc"?1:-1:0}),e},[ys,C,M,X,Ie,ae]),J=n.useMemo(()=>{var d;if(A==="ALL")return null;if(N&&W){const i={};return Y.forEach(p=>{i[p.id]=0}),(g[A]||[]).filter(p=>p.visible!==!1).forEach(p=>{Y.forEach(F=>{i[F.id]+=ae(A,p.id,F)})}),Y.forEach(p=>{i[p.id]+=ae(A,xe,p)}),i}const e={};(g[A]||[]).filter(i=>i.visible!==!1).forEach(i=>{var p;const f=((p=X[A])==null?void 0:p[i.id])||{};Object.entries(f).forEach(([F,w])=>{e[F]=(e[F]||0)+w})});const r=((d=X[A])==null?void 0:d[xe])||{};return Object.entries(r).forEach(([i,f])=>{e[i]=(e[i]||0)+f}),e},[A,g,X,N,W,Y,ae]),We=e=>{C===e?oe(M==="asc"?"desc":"asc"):(ge(e),oe("asc"))},bs=(e,l,r)=>{var d;if(N&&W){let i=[];l===xe&&e===A&&J?i=Y.map(f=>({label:js(f),value:J[f.id]||0})):i=Y.map(f=>({label:js(f),value:ae(e,l,f)})),ke(r),ve(W.name),_e(i),je(!0)}else if(Ce){let i={};l===xe&&e===A&&J?i=J:i=((d=X[e])==null?void 0:d[l])||{};const f=ye.map(p=>({label:p.name,value:i[p.id]||0}));ke(r),ve(Ce.name),_e(f),je(!0)}},Bs=s.jsxs(mt,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},sx:{display:"flex",flexDirection:"column",flexGrow:1},children:[s.jsxs(z,{sx:{display:"flex",alignItems:"center",mb:2},children:[s.jsx(z,{sx:{display:"flex",alignItems:"center",gap:1,flexGrow:1,minWidth:0,overflow:"hidden"},children:s.jsx(Cs,{component:"div",variant:"body2",noWrap:!0,sx:{overflow:"hidden",textOverflow:"ellipsis"},children:Us})}),s.jsx(Qe,{size:"small",onClick:zs,children:s.jsx(As,{})})]}),N&&s.jsxs(z,{sx:{display:"flex",alignItems:"center",mb:1,gap:1},children:[s.jsx(Cs,{sx:{flexGrow:1,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:W==null?void 0:W.name}),s.jsx(Z,{variant:"contained",size:"small",onClick:()=>{de(Ue),se(!0)},startIcon:s.jsx(Os,{}),children:"編集"}),s.jsx(Z,{variant:"contained",size:"small",color:"error",onClick:()=>ce(!0),startIcon:s.jsx(ks,{}),children:"削除"})]}),s.jsx(Ss,{component:Ms,storageKey:"analysis-list",sx:{flexGrow:1},children:s.jsxs(Rs,{size:"small",sx:{"& th, & td":{textAlign:"center",verticalAlign:"middle"},"& .MuiTableRow-root":{height:50}},children:[s.jsx(Es,{children:s.jsxs(De,{sx:{backgroundColor:e=>e.palette.mode==="dark"?"#343A42":"#f5f5f5"},children:[s.jsx(v,{align:"center",sortDirection:C==="member"?M:!1,children:s.jsx(Ne,{active:C==="member",direction:C==="member"?M:"asc",onClick:()=>We("member"),children:"メンバー"})}),N&&W?Y.map(e=>{var f,p,F;const l=e.playCategoryId&&((f=y.find(w=>w.id===e.playCategoryId))==null?void 0:f.name)||"",r=e.playDetailId&&((p=b.find(w=>w.id===e.playDetailId))==null?void 0:p.name)||"",d=e.playDetailId?(F=b.find(w=>w.id===e.playDetailId))==null?void 0:F.pointType:void 0,i=[e.pointType,e.pointUnitType].filter(Boolean).join(",");return s.jsx(v,{align:"center",sortDirection:C===e.id?M:!1,children:s.jsx(Ne,{active:C===e.id,direction:C===e.id?M:"asc",onClick:()=>We(e.id),children:s.jsxs(z,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.playCategoryTags&&e.playCategoryTags.length>0?s.jsx(z,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center"},children:e.playCategoryTags.map(w=>{const R=h.find(Ge=>Ge.id===w),Fe=(R==null?void 0:R.color)||re;return s.jsx(ie,{label:(R==null?void 0:R.name)||w,size:"small",sx:{mr:.5,mb:.5,backgroundColor:Fe,color:"#fff"}},w)})}):l&&s.jsx("span",{children:l}),e.playDetailTags&&e.playDetailTags.length>0?s.jsx(z,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center"},children:e.playDetailTags.map(w=>{const R=T.find(Ge=>Ge.id===w),Fe=(R==null?void 0:R.color)||re;return s.jsx(ie,{label:(R==null?void 0:R.name)||w,size:"small",sx:{mr:.5,mb:.5,backgroundColor:Fe,color:"#fff"}},w)})}):r&&s.jsx(z,{component:"span",sx:{color:d==="得点"?j.scoreColor:d==="失点"?j.lossColor:void 0},children:r}),i&&s.jsx("span",{children:i}),s.jsxs("span",{children:["(",e.method,")"]})]})})},e.id)}):ye.map(e=>s.jsx(v,{align:"center",sortDirection:C===e.id?M:!1,sx:{color:e.pointType==="得点"?j.scoreColor:e.pointType==="失点"?j.lossColor:"inherit"},children:s.jsx(Ne,{active:C===e.id,direction:C===e.id?M:"asc",onClick:()=>We(e.id),children:e.name})},e.id))]})}),s.jsxs(Ls,{children:[A!=="ALL"&&s.jsxs(De,{children:[s.jsx(v,{align:"center",children:s.jsx(Ts,{component:"button",underline:"hover",onClick:()=>bs(A,xe,"チーム集計"),children:"チーム集計"})}),N&&W?Y.map(e=>s.jsx(v,{align:"center",children:(J==null?void 0:J[e.id])||0},e.id)):ye.map(e=>s.jsx(v,{align:"center",children:(J==null?void 0:J[e.id])||0},e.id))]}),(N&&W?Y.some(e=>!ms(e)):!$s)&&Ps.map(({teamId:e,member:l})=>s.jsxs(De,{children:[s.jsx(v,{align:"center",children:s.jsx(Ts,{component:"button",underline:"hover",onClick:()=>bs(e,l.id,l.name),children:l.name})}),N&&W?Y.map(r=>s.jsx(v,{align:"center",children:ms(r)?"－":ae(e,l.id,r)},r.id)):ye.map(r=>{var d,i;return s.jsx(v,{align:"center",children:r.pointUnitType==="チーム"?"－":((i=(d=X[e])==null?void 0:d[l.id])==null?void 0:i[r.id])||0},r.id)})]},`${e}-${l.id}`))]})]})})]},U);return s.jsxs(z,{sx:{display:"flex",height:"100%"},children:[s.jsx(Ks,{variant:t?"permanent":"temporary",open:t?!0:a,onClose:()=>{H(!1),x(!1)},PaperProps:{onTransitionEnd:O},ModalProps:{keepMounted:!0,BackdropProps:{sx:{backgroundColor:"rgba(0, 0, 0, 0.5)"}}},sx:{width:t?a?B:q:B,flexShrink:0,transition:L.transitions.create("width",{easing:L.transitions.easing.sharp,duration:L.transitions.duration.standard}),...t?{zIndex:L.zIndex.appBar-1}:{},"& .MuiDrawer-paper":{width:t?a?B:q:B,boxSizing:"border-box",overflowX:"hidden",transition:L.transitions.create("width",{easing:L.transitions.easing.sharp,duration:L.transitions.duration.standard}),...t?{top:L.mixins.toolbar.minHeight,height:`calc(100% - ${L.mixins.toolbar.minHeight}px)`,zIndex:L.zIndex.appBar-1}:{}}},children:s.jsx(Vs,{children:Pe.map((e,l)=>s.jsxs(Qs,{selected:l===U,onClick:()=>{l===Pe.length-1?(de(null),se(!0)):P(l),t||_()},sx:{minHeight:48,justifyContent:a?"initial":"center",px:2.5},children:[s.jsx(Xs,{sx:{minWidth:0,mr:a?3:0,justifyContent:"center"},children:l===Pe.length-1?s.jsx(ws,{}):s.jsx(Ws,{})}),s.jsx(Ys,{primary:e.label,sx:{opacity:Q?1:0,display:Q?"block":"none",whiteSpace:"nowrap"}})]},e.key))})}),s.jsxs(z,{sx:{flexGrow:1,display:"flex",flexDirection:"column",width:t?`calc(100% - ${a?B:q}px)`:"100%",transition:t?L.transitions.create("width",{duration:L.transitions.duration.standard}):void 0},children:[s.jsx(at,{mode:"wait",children:Bs}),s.jsxs(Ds,{open:V,onClose:()=>ee(!1),children:[s.jsx(qe,{children:"詳細検索"}),s.jsxs(Ke,{sx:{display:"flex",flexDirection:"column",gap:2},children:[s.jsxs(z,{sx:{display:"flex",gap:2},children:[s.jsxs(fe,{fullWidth:!0,sx:{flex:1,mt:3},children:[s.jsx(he,{id:"dlg-left",children:"分析チーム"}),s.jsx(pe,{labelId:"dlg-left",value:le,label:"分析チーム",onChange:e=>{const l=e.target.value;ue(l)},children:u.map(e=>s.jsx(E,{value:e.id,children:e.name},e.id))})]}),s.jsxs(fe,{fullWidth:!0,sx:{flex:1,mt:3},children:[s.jsx(he,{id:"dlg-right",children:"対戦相手"}),s.jsxs(pe,{labelId:"dlg-right",value:ls,label:"対戦相手",onChange:e=>ns(e.target.value),children:[s.jsx(E,{value:"",children:"指定なし"}),u.map(e=>s.jsx(E,{value:e.id,children:e.name},e.id))]})]})]}),s.jsxs(z,{sx:{display:"flex",gap:2},children:[s.jsx(be,{type:"date",label:"試合日付",margin:"dense",value:as,onChange:e=>rs(e.target.value),InputLabelProps:{shrink:!0},fullWidth:!0,sx:{flex:1,"& .MuiOutlinedInput-root":{height:56},"& .MuiOutlinedInput-input":{padding:"0 14px",height:"100%",lineHeight:"56px",fontSize:"1rem",textAlign:"left"},'& input[type="date"]':{WebkitAppearance:"none"}}}),s.jsx(be,{label:"試合名",margin:"dense",value:is,onChange:e=>os(e.target.value),fullWidth:!0,sx:{flex:1}})]}),s.jsxs(z,{sx:{display:"flex",gap:2,flexDirection:"column"},children:[s.jsxs(Is,{exclusive:!0,value:ds,onChange:(e,l)=>cs(l),fullWidth:!0,sx:{width:"100%"},children:[s.jsx(Re,{value:"win",sx:{whiteSpace:"nowrap"},children:"勝ち試合"}),s.jsx(Re,{value:"lose",sx:{whiteSpace:"nowrap"},children:"負け試合"})]}),s.jsxs(Is,{exclusive:!0,value:us,onChange:(e,l)=>fs(l),fullWidth:!0,sx:{width:"100%"},children:[s.jsx(Re,{value:"win",sx:{whiteSpace:"nowrap"},children:"勝ちセット"}),s.jsx(Re,{value:"lose",sx:{whiteSpace:"nowrap"},children:"負けセット"})]})]}),s.jsx(z,{sx:{display:"flex",gap:2},children:s.jsx(Ve,{multiple:!0,options:m,getOptionLabel:e=>e.name,value:m.filter(e=>hs.includes(e.id)),onChange:(e,l)=>ps(l.map(r=>r.id)),renderTags:(e,l)=>e.map((r,d)=>s.jsx(ie,{...l({index:d}),label:r.name,size:"small",sx:{backgroundColor:r.color||re,color:"#fff"}})),renderInput:e=>s.jsx(be,{...e,label:"タグ",margin:"dense"}),fullWidth:!0})})]}),s.jsxs(Xe,{children:[s.jsx(Z,{onClick:()=>ee(!1),color:"inherit",startIcon:s.jsx(He,{}),children:"キャンセル"}),s.jsx(Z,{onClick:()=>{me({left:le,right:ls,date:as,name:is,tags:hs,matchResult:ds||void 0,setResult:us||void 0}),ee(!1)},startIcon:s.jsx(Ye,{}),children:"検索"})]})]}),s.jsxs(Js,{open:we,onClose:()=>ce(!1),children:[s.jsx(qe,{children:"削除確認"}),s.jsx(Ke,{sx:{mt:2},children:"このカスタム分析を削除しますか？"}),s.jsxs(Xe,{children:[s.jsx(Z,{onClick:()=>ce(!1),color:"inherit",startIcon:s.jsx(He,{}),children:"キャンセル"}),s.jsx(Z,{onClick:()=>{const e=Ue,l=c[e];D(c.filter((r,d)=>d!==e)),P(0),ce(!1),K("カスタム分析を削除しました","success",{actionLabel:"元に戻す",onAction:()=>{D(r=>{const d=[...r];return d.splice(e,0,l),d}),P(ne.length+e)},autoHideDuration:5e3})},color:"error",startIcon:s.jsx(_s,{}),children:"OK"})]})]}),s.jsx(rt,{open:Ee,playCategories:y,playDetails:b,rallyCategoryTags:h,rallyDetailTags:T,initialData:te!==null?c[te]:void 0,onCancel:()=>se(!1),onSave:e=>{te!==null?(D(c.map((l,r)=>r===te?e:l)),P(ne.length+te)):(D([...c,e]),P(ne.length+c.length)),se(!1)}}),s.jsx(n.Suspense,{fallback:null,children:s.jsx(gt,{open:Se,onClose:()=>je(!1),memberName:Le,tabName:Ae,data:Oe})})]})]})}export{_t as default};
