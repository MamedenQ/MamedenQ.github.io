const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/GraphDialog-CRSUkXJm.js","assets/mui-vendor-B7aVoM1I.js","assets/react-vendor-QLNaZ7XN.js","assets/index-CccdOtHa.js","assets/motion-vendor-BTNqdYSb.js","assets/index-DqrEpDIH.css","assets/ResponsiveDialog-DnTfKSCb.js","assets/chart-vendor-CPAiRuUQ.js"])))=>i.map(i=>d[i]);
import{D as ie,a as Nl,S as _l,d as kl,b as He,c as Ml,r as Ae,u as Gl,_ as ql}from"./index-CccdOtHa.js";import{j as l,n as Ke,o as Ve,N as je,F as H,K,S as V,M as C,L as Je,C as oe,q as F,A as Hl,f as El,g as wl,h as Ll,k as Se,l as v,m as Rl,a6 as Kl,B as L,I as Al,p as Qe,i as ze,a7 as qe,U as Il,a8 as Vl,a9 as Jl,aa as Ql,d as Dl,e as Le,D as Xl}from"./mui-vendor-B7aVoM1I.js";import{r as a}from"./react-vendor-QLNaZ7XN.js";import{R as zl,D as Yl,C as Zl,P as en,d as ln}from"./ResponsiveDialog-DnTfKSCb.js";import{m as nn,A as sn}from"./motion-vendor-BTNqdYSb.js";import"./chart-vendor-CPAiRuUQ.js";function tn({open:R,playCategories:u,playDetails:p,rallyCategoryTags:b,rallyDetailTags:y,initialData:f,onCancel:_,onSave:m}){const[x,I]=a.useState(""),[j,N]=a.useState(""),[B,k]=a.useState([]),[E,O]=a.useState([]),[D,$]=a.useState(""),[ce,G]=a.useState(""),[T,he]=a.useState(""),[U,be]=a.useState("合算"),[o,te]=a.useState([]),ye=s=>{if(!s.destination)return;const i=Array.from(o),[g]=i.splice(s.source.index,1);i.splice(s.destination.index,0,g),te(i)};a.useEffect(()=>{R&&(I((f==null?void 0:f.name)||""),te((f==null?void 0:f.items)||[]),N(""),k([]),O([]),$(""),G(""),he(""),be("合算"))},[R,f]);const ee=j!=="",_e=B.length>0,J=D!=="",ae=E.length>0,xe=ce!=="",ke=T!=="",de=ee?_e||ae?!1:J?!xe&&!ke:!0:_e||ae?!(ee||J):J?!1:!!(xe||ke),Be=()=>{if(!U||!de)return;const s={id:crypto.randomUUID(),method:U};j?s.playCategoryId=j:B.length>0&&(s.playCategoryTags=B),D&&(s.playDetailId=D),E.length>0&&(s.playDetailTags=E),ce&&(s.pointType=ce),T&&(s.pointUnitType=T),te(i=>[...i,s]),N(""),k([]),$(""),O([]),G(""),he("")},ve=s=>{te(i=>i.filter(g=>g.id!==s))},Oe=()=>{if(!x||o.length===0)return;const s={id:(f==null?void 0:f.id)||crypto.randomUUID(),name:x,items:o};m(s)},Me=j?p.filter(s=>s.playCategoryId===j&&s.visible!==!1):[],$e=s=>p.filter(i=>{var Q,le;const g=u.find(q=>q.id===i.playCategoryId);return!(i.visible===!1||(g==null?void 0:g.visible)===!1||s.playCategoryId&&i.playCategoryId!==s.playCategoryId||s.playCategoryTags&&s.playCategoryTags.length>0&&!((Q=g==null?void 0:g.tags)!=null&&Q.some(q=>{var X;return(X=s.playCategoryTags)==null?void 0:X.includes(q)}))||s.playDetailId&&i.id!==s.playDetailId||s.playDetailTags&&s.playDetailTags.length>0&&!((le=i.tags)!=null&&le.some(q=>{var X;return(X=s.playDetailTags)==null?void 0:X.includes(q)}))||s.pointType&&i.pointType!==s.pointType||s.pointUnitType&&i.pointUnitType!==s.pointUnitType)}),Ce=s=>$e(s).length===0,Ue=o.some(Ce);return l.jsxs(zl,{open:R,onClose:_,children:[l.jsx(Ke,{children:"カスタム分析追加"}),l.jsxs(Ve,{sx:{display:"flex",flexDirection:"column",gap:2,mt:2},children:[l.jsx(je,{label:"カスタム分析名",margin:"dense",value:x,onChange:s=>I(s.target.value),fullWidth:!0}),l.jsxs(l.Fragment,{children:[l.jsxs(H,{fullWidth:!0,sx:{mt:1},disabled:B.length>0||E.length>0,children:[l.jsx(K,{id:"category",children:"プレー区分"}),l.jsxs(V,{labelId:"category",value:j,label:"プレー区分",onChange:s=>{const i=s.target.value;N(i),$(""),O([]),i&&k([])},children:[l.jsx(C,{value:"",children:"指定なし"}),u.filter(s=>s.visible!==!1).map(s=>l.jsx(C,{value:s.id,children:s.name},s.id))]})]}),l.jsxs(H,{fullWidth:!0,sx:{mt:1},disabled:!!ce||!!T||B.length>0||E.length>0,children:[l.jsx(K,{id:"detail",children:"プレー詳細"}),l.jsxs(V,{labelId:"detail",value:D,label:"プレー詳細",onChange:s=>{$(s.target.value),s.target.value&&(G(""),he(""),k([]),O([]))},children:[l.jsx(C,{value:"",children:"指定なし"}),Me.map(s=>l.jsx(C,{value:s.id,children:s.name},s.id))]})]}),l.jsx(Je,{multiple:!0,options:b,getOptionLabel:s=>s.name,value:b.filter(s=>B.includes(s.id)),onChange:(s,i)=>{k(i.map(g=>g.id)),i.length>0&&(N(""),$(""))},renderTags:(s,i)=>s.map((g,Q)=>a.createElement(oe,{...i({index:Q}),key:g.id,label:g.name,size:"small",sx:{backgroundColor:g.color||ie,color:"#fff"}})),renderInput:s=>l.jsx(je,{...s,label:"プレー区分タグ",margin:"dense"}),disabled:!!j||!!D,fullWidth:!0}),l.jsx(Je,{multiple:!0,options:y,getOptionLabel:s=>s.name,value:y.filter(s=>E.includes(s.id)),onChange:(s,i)=>{O(i.map(g=>g.id)),i.length>0&&(N(""),$(""))},renderTags:(s,i)=>s.map((g,Q)=>a.createElement(oe,{...i({index:Q}),key:g.id,label:g.name,size:"small",sx:{backgroundColor:g.color||ie,color:"#fff"}})),renderInput:s=>l.jsx(je,{...s,label:"プレー詳細タグ",margin:"dense"}),disabled:!!j||!!D,fullWidth:!0}),l.jsxs(H,{fullWidth:!0,disabled:!!D,children:[l.jsx(K,{id:"ptype",children:"得失点区分"}),l.jsxs(V,{labelId:"ptype",value:ce,label:"得失点区分",onChange:s=>{G(s.target.value),s.target.value&&$("")},children:[l.jsx(C,{value:"",children:"指定なし"}),l.jsx(C,{value:"得点",children:"得点"}),l.jsx(C,{value:"失点",children:"失点"})]})]}),l.jsxs(H,{fullWidth:!0,disabled:!!D,children:[l.jsx(K,{id:"punittype",children:"得失点単位区分"}),l.jsxs(V,{labelId:"punittype",value:T,label:"得失点単位区分",onChange:s=>{he(s.target.value),s.target.value&&$("")},children:[l.jsx(C,{value:"",children:"指定なし"}),l.jsx(C,{value:"メンバー",children:"メンバー"}),l.jsx(C,{value:"チーム",children:"チーム"})]})]}),l.jsxs(H,{fullWidth:!0,children:[l.jsx(K,{id:"method",children:"集計方法"}),l.jsxs(V,{labelId:"method",value:U,label:"集計方法",onChange:s=>be(s.target.value),children:[l.jsx(C,{value:"合算",children:"合算"}),l.jsx(C,{value:"試合平均",children:"試合平均"}),l.jsx(C,{value:"セット平均",children:"セット平均"})]})]}),l.jsx(F,{variant:"contained",onClick:Be,size:"small",disabled:!de,fullWidth:!0,startIcon:l.jsx(Nl,{}),children:"追加"})]}),o.length>0&&l.jsxs(l.Fragment,{children:[Ue&&l.jsx(Hl,{severity:"error",sx:{mb:1},children:"分析条件に合致するプレー区分、または、プレー詳細が存在しません（赤背景行）"}),l.jsx(_l,{component:El,storageKey:"custom-analysis-dialog",children:l.jsxs(wl,{size:"small",sx:{"& .MuiTableRow-root":{height:50}},children:[l.jsx(Ll,{children:l.jsxs(Se,{sx:{backgroundColor:"#f5f5f5"},children:[l.jsx(v,{}),l.jsx(v,{children:"プレー区分"}),l.jsx(v,{children:"プレー詳細"}),l.jsx(v,{children:"得失点区分"}),l.jsx(v,{children:"得失点単位区分"}),l.jsx(v,{children:"集計方法"}),l.jsx(v,{})]})}),l.jsx(Yl,{onDragEnd:ye,children:l.jsx(Zl,{droppableId:"custom-analysis-items",children:s=>l.jsxs(Rl,{ref:s.innerRef,...s.droppableProps,children:[o.map((i,g)=>{const Q=Ce(i);return l.jsx(en,{draggableId:i.id,index:g,children:le=>{var q,X;return l.jsxs(Se,{ref:le.innerRef,...le.draggableProps,sx:{backgroundColor:Q?A=>Kl(A.palette.error.main,.1):void 0},children:[l.jsx(v,{padding:"checkbox",children:l.jsx(L,{...le.dragHandleProps,sx:{cursor:"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:l.jsx(ln,{fontSize:"small"})})}),l.jsx(v,{children:i.playCategoryTags&&i.playCategoryTags.length>0?i.playCategoryTags.map(A=>{const z=b.find(pe=>pe.id===A),ue=(z==null?void 0:z.color)||ie;return l.jsx(oe,{label:(z==null?void 0:z.name)||A,size:"small",sx:{mr:.5,mb:.5,backgroundColor:ue,color:"#fff"}},A)}):(q=u.find(A=>A.id===i.playCategoryId))==null?void 0:q.name}),l.jsx(v,{children:i.playDetailTags&&i.playDetailTags.length>0?i.playDetailTags.map(A=>{const z=y.find(pe=>pe.id===A),ue=(z==null?void 0:z.color)||ie;return l.jsx(oe,{label:(z==null?void 0:z.name)||A,size:"small",sx:{mr:.5,mb:.5,backgroundColor:ue,color:"#fff"}},A)}):i.playDetailId?(X=p.find(A=>A.id===i.playDetailId))==null?void 0:X.name:""}),l.jsx(v,{children:i.pointType||""}),l.jsx(v,{children:i.pointUnitType||""}),l.jsx(v,{children:i.method}),l.jsx(v,{children:l.jsx(Al,{size:"small",onClick:()=>ve(i.id),children:l.jsx(kl,{fontSize:"small",color:"error"})})})]})}},i.id)}),s.placeholder]})})})]})})]})]}),l.jsxs(Qe,{children:[l.jsx(F,{onClick:_,startIcon:l.jsx(He,{}),color:"inherit",children:"キャンセル"}),l.jsx(F,{onClick:Oe,disabled:!x||o.length===0,startIcon:l.jsx(Ml,{}),children:"OK"})]})]})}var Ye={},an=ze;Object.defineProperty(Ye,"__esModule",{value:!0});var Bl=Ye.default=void 0,rn=an(Ae()),on=l;Bl=Ye.default=(0,rn.default)((0,on.jsx)("path",{d:"M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreHoriz");var Ze={},cn=ze;Object.defineProperty(Ze,"__esModule",{value:!0});var Re=Ze.default=void 0,dn=cn(Ae()),un=l;Re=Ze.default=(0,dn.default)((0,un.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search");var el={},fn=ze;Object.defineProperty(el,"__esModule",{value:!0});var Ol=el.default=void 0,hn=fn(Ae()),xn=l;Ol=el.default=(0,hn.default)((0,xn.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit");var ll={},pn=ze;Object.defineProperty(ll,"__esModule",{value:!0});var Xe=ll.default=void 0,gn=pn(Ae()),mn=l;Xe=ll.default=(0,gn.default)((0,mn.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Clear");const jn=a.lazy(()=>ql(()=>import("./GraphDialog-CRSUkXJm.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),fe="__TEAM__",bn=nn.create(L);function yn(R,u){let p=0,b=0,y=0,f=0;return R.sets.forEach(_=>{const m=u==="teamA"?_.my:_.opponent,x=u==="teamA"?_.opponent:_.my;y+=m,f+=x,m>x?p+=1:m<x&&(b+=1)}),p>b?"win":p<b?"lose":y>f?"win":y<f?"lose":"draw"}function Sl(R,u,p,b,y,f,_){return R.filter(m=>{if(u!=="ALL"){if(!(m.teamA===u||m.teamB===u)||p&&!(m.teamA===u&&m.teamB===p||m.teamA===p&&m.teamB===u))return!1;if(f){const I=m.teamA===u?"teamA":"teamB";if(yn(m,I)!==f)return!1}}else if(p&&m.teamA!==p&&m.teamB!==p)return!1;return!(b&&m.date!==b||y&&!m.matchName.includes(y)||_&&_.length>0&&!_.every(x=>m.tags.includes(x)))})}function vn(R,u){const p=u==="teamA"?R.my:R.opponent,b=u==="teamA"?R.opponent:R.my;return p>b?"win":p<b?"lose":"draw"}function Cn(R,u,p,b,y){const f={},_=(x,I,j)=>{f[x]||(f[x]={}),f[x][I]||(f[x][I]={}),f[x][I][j]=(f[x][I][j]||0)+1},m=(x,I)=>!!I&&(b[x]||[]).some(j=>j.id===I&&j.visible!==!1);return R.forEach(x=>{const I=(j,N)=>{x.sets.forEach(B=>{y&&vn(B,N)!==y||B.rallies.forEach(k=>{const E=N==="teamA"?k.teamAPlayDetail:k.teamBPlayDetail,O=N==="teamA"?k.teamAMember:k.teamBMember;if(!E)return;const D=p.get(E);(D==null?void 0:D.pointUnitType)==="チーム"?_(j,fe,E):(D==null?void 0:D.pointUnitType)==="メンバー"&&(m(j,O)?_(j,O,E):_(j,fe,E))})})};u==="ALL"?(x.teamA&&I(x.teamA,"teamA"),x.teamB&&I(x.teamB,"teamB")):x.teamA===u?I(u,"teamA"):x.teamB===u&&I(u,"teamB")}),f}function Mn({matches:R,teams:u,teamMembers:p,playCategories:b,playDetails:y,customAnalyses:f,onCustomAnalysesChange:_,tags:m,rallyCategoryTags:x,rallyDetailTags:I,themeSetting:j,showSnackbar:N}){var Tl;const B=((Tl=u[0])==null?void 0:Tl.id)||"",[k,E]=a.useState(u.length>0?u[0].id:""),[O,D]=a.useState(""),[$,ce]=a.useState(0),G=e=>{ce(e)},[T,he]=a.useState("member"),[U,be]=a.useState("asc"),[o,te]=a.useState(null),[ye,ee]=a.useState(!1),[_e,J]=a.useState(!1),[ae,xe]=a.useState(null),[ke,de]=a.useState(!1),[Be,ve]=a.useState(!1),[Oe,Me]=a.useState(""),[$e,Ce]=a.useState([]),[Ue,s]=a.useState(""),i=a.useRef(null),[g,Q]=a.useState([]),[le,q]=a.useState(null),X=Gl("sm"),[A,z]=a.useState(u.length>0?u[0].id:""),[ue,pe]=a.useState(""),[nl,sl]=a.useState(""),[tl,al]=a.useState(""),[rl,il]=a.useState(""),[ol,cl]=a.useState(""),[dl,ul]=a.useState([]),fl=a.useMemo(()=>new Map(y.map(e=>[e.id,e])),[y]);a.useEffect(()=>{!k&&B&&E(B),!A&&B&&z(B)},[u]),a.useEffect(()=>{if(ye){const e=o||{left:k,right:O,date:"",name:"",tags:[]};z(e.left),pe(e.right),sl(e.date),al(e.name),il(e.matchResult||""),cl(e.setResult||""),ul(e.tags)}},[ye]);const Ee=a.useMemo(()=>o?Sl(R,o.left,o.right,o.date,o.name,o.matchResult,o.tags):Sl(R,k,O,"","",void 0,void 0),[R,k,O,o]),ne=a.useMemo(()=>{const e=o?o.left:k,n=o==null?void 0:o.setResult;return Cn(Ee,e,fl,p,n)},[Ee,o,k,fl,p]),hl=Ee.length,xl=Ee.reduce((e,n)=>e+n.sets.length,0),W=o?o.left:k,pl=W==="ALL"?u.map(e=>e.id):[W],re=a.useMemo(()=>b.filter(e=>e.visible!==!1),[b]),P=$>=re.length,We=P?$-re.length:-1,Y=P?f[We]:null,Te=P?void 0:re[$],ge=P?[]:y.filter(e=>e.playCategoryId===(Te==null?void 0:Te.id)&&e.visible!==!1),$l=!P&&ge.length>0&&ge.every(e=>e.pointUnitType==="チーム"),Ie=a.useMemo(()=>[...re.map(e=>({key:e.id,label:e.name})),...f.map(e=>({key:e.id,label:e.name})),{key:"add",label:"分析追加"}],[re,f]),De=a.useCallback(()=>{const e=i.current;if(!e)return;const n=e.querySelectorAll('[role="tab"]'),t=e.scrollLeft,c=t+e.clientWidth,r=[];n.forEach((d,h)=>{if(d.offsetLeft<t||d.offsetLeft+d.offsetWidth>c){const M=Ie[h];M&&r.push({index:h,label:M.label})}}),Q(d=>d.length===r.length&&d.every((h,M)=>{var S,w;return h.index===((S=r[M])==null?void 0:S.index)&&h.label===((w=r[M])==null?void 0:w.label)})?d:r)},[Ie]);a.useEffect(()=>{De();const e=()=>De(),n=i.current;return n==null||n.addEventListener("scroll",De,{passive:!0}),window.addEventListener("resize",e),()=>{n==null||n.removeEventListener("scroll",De),window.removeEventListener("resize",e)}},[De]);const Ul=e=>{q(e.currentTarget)},gl=()=>{q(null)},Wl=e=>{e===Ie.length-1?(xe(null),J(!0)):G(e);const n=i.current;if(n){const t=n.querySelectorAll('[role="tab"]')[e];t==null||t.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})}gl()},ml=e=>{var n;return((n=u.find(t=>t.id===e))==null?void 0:n.name)||""},Pe=e=>y.filter(n=>{var c,r;const t=b.find(d=>d.id===n.playCategoryId);return!(n.visible===!1||(t==null?void 0:t.visible)===!1||e.playCategoryId&&n.playCategoryId!==e.playCategoryId||e.playCategoryTags&&e.playCategoryTags.length>0&&!((c=t==null?void 0:t.tags)!=null&&c.some(d=>{var h;return(h=e.playCategoryTags)==null?void 0:h.includes(d)}))||e.playDetailId&&n.id!==e.playDetailId||e.playDetailTags&&e.playDetailTags.length>0&&!((r=n.tags)!=null&&r.some(d=>{var h;return(h=e.playDetailTags)==null?void 0:h.includes(d)}))||e.pointType&&n.pointType!==e.pointType||e.pointUnitType&&n.pointUnitType!==e.pointUnitType)}),me=(e,n,t)=>{let c=0;return Pe(t).forEach(d=>{var h,M;c+=((M=(h=ne[e])==null?void 0:h[n])==null?void 0:M[d.id])||0}),t.method==="試合平均"?c=hl?c/hl:0:t.method==="セット平均"&&(c=xl?c/xl:0),c},jl=e=>{const n=Pe(e);return n.length>0&&n.every(t=>t.pointUnitType==="チーム")},bl=e=>{var c,r;const n=[];e.playCategoryId?n.push(((c=b.find(d=>d.id===e.playCategoryId))==null?void 0:c.name)||""):e.playCategoryTags&&e.playCategoryTags.length>0&&n.push(e.playCategoryTags.join(",")),e.playDetailId?n.push(((r=y.find(d=>d.id===e.playDetailId))==null?void 0:r.name)||""):e.playDetailTags&&e.playDetailTags.length>0&&n.push(e.playDetailTags.join(","));const t=[e.pointType,e.pointUnitType].filter(Boolean).join(",");return t&&n.push(t),n.length>0?`${n.join(" / ")} (${e.method})`:`(${e.method})`},yl=a.useMemo(()=>pl.flatMap(e=>(p[e]||[]).filter(n=>n.visible!==!1).map(n=>({teamId:e,member:n}))),[pl,p]),vl=a.useMemo(()=>{if(!o)return"";const e=[],n=o.left==="ALL"?"全チーム":ml(o.left);e.push(`分析対象チーム：${n}`),o.left!=="ALL"&&o.right&&o.right!==""&&e.push(`対戦相手チーム：${ml(o.right)}`),o.date&&e.push(`試合日付：${o.date}`),o.name&&e.push(`試合名：${o.name}`),o.matchResult==="win"?e.push("勝ち試合"):o.matchResult==="lose"&&e.push("負け試合"),o.setResult==="win"?e.push("勝ちセット"):o.setResult==="lose"&&e.push("負けセット");const t=e.join("、");return o.tags.length>0?l.jsxs(l.Fragment,{children:[t,"、タグ：",o.tags.map(c=>{const r=m.find(h=>h.id===c),d=(r==null?void 0:r.color)||ie;return l.jsx(oe,{label:(r==null?void 0:r.name)||c,size:"small",sx:{ml:.5,backgroundColor:d,color:"#fff"}},c)})]}):t},[o,u,m]),we=a.useMemo(()=>{const e=new Map;return f.forEach(n=>{n.items.forEach(t=>{Pe(t).length>0&&e.set(t.id,t)})}),e},[f,b,y]),se=Y?Y.items.filter(e=>we.has(e.id)):[],Pl=a.useMemo(()=>{const e=[...yl];return e.sort((n,t)=>{var d,h,M,S;let c="",r="";if(T==="member")c=n.member.name,r=t.member.name;else if(we.has(T)){const w=we.get(T);c=me(n.teamId,n.member.id,w),r=me(t.teamId,t.member.id,w)}else c=((h=(d=ne[n.teamId])==null?void 0:d[n.member.id])==null?void 0:h[T])||0,r=((S=(M=ne[t.teamId])==null?void 0:M[t.member.id])==null?void 0:S[T])||0;return c<r?U==="asc"?-1:1:c>r?U==="asc"?1:-1:0}),e},[yl,T,U,ne,we]),Z=a.useMemo(()=>{var c;if(W==="ALL")return null;if(P&&Y){const r={};return se.forEach(h=>{r[h.id]=0}),(p[W]||[]).filter(h=>h.visible!==!1).forEach(h=>{se.forEach(M=>{r[M.id]+=me(W,h.id,M)})}),se.forEach(h=>{r[h.id]+=me(W,fe,h)}),r}const e={};(p[W]||[]).filter(r=>r.visible!==!1).forEach(r=>{var h;const d=((h=ne[W])==null?void 0:h[r.id])||{};Object.entries(d).forEach(([M,S])=>{e[M]=(e[M]||0)+S})});const t=((c=ne[W])==null?void 0:c[fe])||{};return Object.entries(t).forEach(([r,d])=>{e[r]=(e[r]||0)+d}),e},[W,p,ne,P,Y]),Fe=e=>{T===e?be(U==="asc"?"desc":"asc"):(he(e),be("asc"))},Cl=(e,n,t)=>{var c;if(P&&Y){let r=[];n===fe&&e===W&&Z?r=se.map(d=>({label:bl(d),value:Z[d.id]||0})):r=se.map(d=>({label:bl(d),value:me(e,n,d)})),Me(t),s(Y.name),Ce(r),ve(!0)}else if(Te){let r={};n===fe&&e===W&&Z?r=Z:r=((c=ne[e])==null?void 0:c[n])||{};const d=ge.map(h=>({label:h.name,value:r[h.id]||0}));Me(t),s(Te.name),Ce(d),ve(!0)}},Fl=l.jsxs(bn,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},sx:{display:"flex",flexDirection:"column",flexGrow:1},children:[P&&l.jsxs(L,{sx:{display:"flex",justifyContent:"flex-end",mb:1,gap:1},children:[l.jsx(F,{variant:"contained",size:"small",onClick:()=>{xe(We),J(!0)},startIcon:l.jsx(Ol,{}),children:"編集"}),l.jsx(F,{variant:"contained",size:"small",color:"error",onClick:()=>de(!0),startIcon:l.jsx(kl,{}),children:"削除"})]}),l.jsx(_l,{component:El,storageKey:"analysis-list",sx:{flexGrow:1},children:l.jsxs(wl,{size:"small",sx:{"& th, & td":{textAlign:"center",verticalAlign:"middle"},"& .MuiTableRow-root":{height:50}},children:[l.jsx(Ll,{children:l.jsxs(Se,{sx:{backgroundColor:"#f5f5f5"},children:[l.jsx(v,{align:"center",sortDirection:T==="member"?U:!1,children:l.jsx(qe,{active:T==="member",direction:T==="member"?U:"asc",onClick:()=>Fe("member"),children:"メンバー"})}),P&&Y?se.map(e=>{var d,h,M;const n=e.playCategoryId&&((d=b.find(S=>S.id===e.playCategoryId))==null?void 0:d.name)||"",t=e.playDetailId&&((h=y.find(S=>S.id===e.playDetailId))==null?void 0:h.name)||"",c=e.playDetailId?(M=y.find(S=>S.id===e.playDetailId))==null?void 0:M.pointType:void 0,r=[e.pointType,e.pointUnitType].filter(Boolean).join(",");return l.jsx(v,{align:"center",sortDirection:T===e.id?U:!1,children:l.jsx(qe,{active:T===e.id,direction:T===e.id?U:"asc",onClick:()=>Fe(e.id),children:l.jsxs(L,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.playCategoryTags&&e.playCategoryTags.length>0?l.jsx(L,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center"},children:e.playCategoryTags.map(S=>{const w=x.find(Ge=>Ge.id===S),Ne=(w==null?void 0:w.color)||ie;return l.jsx(oe,{label:(w==null?void 0:w.name)||S,size:"small",sx:{mr:.5,mb:.5,backgroundColor:Ne,color:"#fff"}},S)})}):n&&l.jsx("span",{children:n}),e.playDetailTags&&e.playDetailTags.length>0?l.jsx(L,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center"},children:e.playDetailTags.map(S=>{const w=I.find(Ge=>Ge.id===S),Ne=(w==null?void 0:w.color)||ie;return l.jsx(oe,{label:(w==null?void 0:w.name)||S,size:"small",sx:{mr:.5,mb:.5,backgroundColor:Ne,color:"#fff"}},S)})}):t&&l.jsx(L,{component:"span",sx:{color:c==="得点"?j.scoreColor:c==="失点"?j.lossColor:void 0},children:t}),r&&l.jsx("span",{children:r}),l.jsxs("span",{children:["(",e.method,")"]})]})})},e.id)}):ge.map(e=>l.jsx(v,{align:"center",sortDirection:T===e.id?U:!1,sx:{color:e.pointType==="得点"?j.scoreColor:e.pointType==="失点"?j.lossColor:"inherit"},children:l.jsx(qe,{active:T===e.id,direction:T===e.id?U:"asc",onClick:()=>Fe(e.id),children:e.name})},e.id))]})}),l.jsxs(Rl,{children:[W!=="ALL"&&l.jsxs(Se,{sx:{backgroundColor:"#F2E3D5"},children:[l.jsx(v,{align:"center",children:l.jsx(Il,{component:"button",underline:"hover",onClick:()=>Cl(W,fe,"チーム集計"),children:"チーム集計"})}),P&&Y?se.map(e=>l.jsx(v,{align:"center",children:(Z==null?void 0:Z[e.id])||0},e.id)):ge.map(e=>l.jsx(v,{align:"center",children:(Z==null?void 0:Z[e.id])||0},e.id))]}),(P&&Y?se.some(e=>!jl(e)):!$l)&&Pl.map(({teamId:e,member:n})=>l.jsxs(Se,{children:[l.jsx(v,{align:"center",children:l.jsx(Il,{component:"button",underline:"hover",onClick:()=>Cl(e,n.id,n.name),children:n.name})}),P&&Y?se.map(t=>l.jsx(v,{align:"center",children:jl(t)?"－":me(e,n.id,t)},t.id)):ge.map(t=>{var c,r;return l.jsx(v,{align:"center",children:t.pointUnitType==="チーム"?"－":((r=(c=ne[e])==null?void 0:c[n.id])==null?void 0:r[t.id])||0},t.id)})]},`${e}-${n.id}`))]})]})})]},$);return l.jsxs(L,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[X?l.jsxs(l.Fragment,{children:[l.jsx(L,{sx:{display:"flex",gap:2,mb:1,alignItems:"center"},children:o?l.jsx(L,{sx:{flexGrow:1,display:"flex",alignItems:"center",flexWrap:"wrap"},children:vl}):l.jsxs(l.Fragment,{children:[l.jsxs(H,{sx:{flex:1},children:[l.jsx(K,{id:"left-team-label",children:"分析チーム"}),l.jsx(V,{labelId:"left-team-label",value:k,label:"分析チーム",onChange:e=>{const n=e.target.value;E(n)},children:u.map(e=>l.jsx(C,{value:e.id,children:e.name},e.id))})]}),l.jsxs(H,{sx:{flex:1},children:[l.jsx(K,{id:"right-team-label",children:"対戦相手"}),l.jsxs(V,{labelId:"right-team-label",value:O,label:"対戦相手",onChange:e=>D(e.target.value),children:[l.jsx(C,{value:"",children:"指定なし"}),u.map(e=>l.jsx(C,{value:e.id,children:e.name},e.id))]})]})]})}),l.jsxs(L,{sx:{display:"flex",gap:1,mb:2},children:[l.jsx(F,{variant:"contained",size:"small",onClick:()=>ee(!0),sx:{flex:1},startIcon:l.jsx(Re,{}),children:"詳細検索"}),l.jsx(F,{variant:"contained",size:"small",onClick:()=>{o&&te(null),E(B),D("")},sx:{flex:1},startIcon:l.jsx(Xe,{}),children:"クリア"})]})]}):l.jsxs(L,{sx:{display:"flex",gap:2,mb:2,alignItems:"center"},children:[o?l.jsx(L,{sx:{flexGrow:1,display:"flex",alignItems:"center",flexWrap:"wrap"},children:vl}):l.jsxs(l.Fragment,{children:[l.jsxs(H,{sx:{minWidth:160},children:[l.jsx(K,{id:"left-team-label",children:"分析チーム"}),l.jsx(V,{labelId:"left-team-label",value:k,label:"分析チーム",onChange:e=>{const n=e.target.value;E(n)},children:u.map(e=>l.jsx(C,{value:e.id,children:e.name},e.id))})]}),l.jsxs(H,{sx:{minWidth:160},children:[l.jsx(K,{id:"right-team-label",children:"対戦相手"}),l.jsxs(V,{labelId:"right-team-label",value:O,label:"対戦相手",onChange:e=>D(e.target.value),children:[l.jsx(C,{value:"",children:"指定なし"}),u.map(e=>l.jsx(C,{value:e.id,children:e.name},e.id))]})]})]}),l.jsxs(L,{sx:{display:"flex",gap:1,ml:"auto"},children:[l.jsx(F,{variant:"contained",size:"small",onClick:()=>ee(!0),startIcon:l.jsx(Re,{}),children:"詳細検索"}),l.jsx(F,{variant:"contained",size:"small",onClick:()=>{o&&te(null),E(B),D("")},startIcon:l.jsx(Xe,{}),children:"クリア"})]})]}),l.jsxs(L,{sx:{display:"flex",alignItems:"center",mb:2},children:[l.jsx(Vl,{ref:i,value:$,onChange:(e,n)=>{n===Ie.length-1?(xe(null),J(!0)):G(n)},variant:"scrollable",scrollButtons:"auto",allowScrollButtonsMobile:!0,sx:{flexGrow:1},children:Ie.map(e=>l.jsx(Jl,{label:e.label},e.key))}),g.length>0&&l.jsxs(l.Fragment,{children:[l.jsx(Al,{onClick:Ul,size:"small",children:l.jsx(Bl,{})}),l.jsx(Ql,{anchorEl:le,open:!!le,onClose:gl,children:g.map(e=>l.jsx(C,{onClick:()=>Wl(e.index),children:e.label},e.index))})]})]}),l.jsx(sn,{mode:"wait",children:Fl}),l.jsxs(zl,{open:ye,onClose:()=>ee(!1),children:[l.jsx(Ke,{children:"詳細検索"}),l.jsxs(Ve,{sx:{display:"flex",flexDirection:"column",gap:2},children:[l.jsxs(L,{sx:{display:"flex",gap:2},children:[l.jsxs(H,{fullWidth:!0,sx:{flex:1,mt:3},children:[l.jsx(K,{id:"dlg-left",children:"分析チーム"}),l.jsx(V,{labelId:"dlg-left",value:A,label:"分析チーム",onChange:e=>{const n=e.target.value;z(n)},children:u.map(e=>l.jsx(C,{value:e.id,children:e.name},e.id))})]}),l.jsxs(H,{fullWidth:!0,sx:{flex:1,mt:3},children:[l.jsx(K,{id:"dlg-right",children:"対戦相手"}),l.jsxs(V,{labelId:"dlg-right",value:ue,label:"対戦相手",onChange:e=>pe(e.target.value),children:[l.jsx(C,{value:"",children:"指定なし"}),u.map(e=>l.jsx(C,{value:e.id,children:e.name},e.id))]})]})]}),l.jsxs(L,{sx:{display:"flex",gap:2},children:[l.jsx(je,{type:"date",label:"試合日付",margin:"dense",value:nl,onChange:e=>sl(e.target.value),InputLabelProps:{shrink:!0},fullWidth:!0,sx:{flex:1,"& .MuiOutlinedInput-root":{height:56},"& .MuiOutlinedInput-input":{padding:"0 14px",height:"100%",lineHeight:"56px",fontSize:"1rem",textAlign:"left"},'& input[type="date"]':{WebkitAppearance:"none"}}}),l.jsx(je,{label:"試合名",margin:"dense",value:tl,onChange:e=>al(e.target.value),fullWidth:!0,sx:{flex:1}})]}),l.jsxs(L,{sx:{display:"flex",gap:2,flexDirection:"column"},children:[l.jsxs(Dl,{exclusive:!0,value:rl,onChange:(e,n)=>il(n),fullWidth:!0,sx:{width:"100%"},children:[l.jsx(Le,{value:"win",sx:{whiteSpace:"nowrap"},children:"勝ち試合"}),l.jsx(Le,{value:"lose",sx:{whiteSpace:"nowrap"},children:"負け試合"})]}),l.jsxs(Dl,{exclusive:!0,value:ol,onChange:(e,n)=>cl(n),fullWidth:!0,sx:{width:"100%"},children:[l.jsx(Le,{value:"win",sx:{whiteSpace:"nowrap"},children:"勝ちセット"}),l.jsx(Le,{value:"lose",sx:{whiteSpace:"nowrap"},children:"負けセット"})]})]}),l.jsx(L,{sx:{display:"flex",gap:2},children:l.jsx(Je,{multiple:!0,options:m,getOptionLabel:e=>e.name,value:m.filter(e=>dl.includes(e.id)),onChange:(e,n)=>ul(n.map(t=>t.id)),renderTags:(e,n)=>e.map((t,c)=>l.jsx(oe,{...n({index:c}),label:t.name,size:"small",sx:{backgroundColor:t.color||ie,color:"#fff"}})),renderInput:e=>l.jsx(je,{...e,label:"タグ",margin:"dense"}),fullWidth:!0})})]}),l.jsxs(Qe,{children:[l.jsx(F,{onClick:()=>ee(!1),color:"inherit",startIcon:l.jsx(He,{}),children:"キャンセル"}),l.jsx(F,{onClick:()=>{te({left:A,right:ue,date:nl,name:tl,tags:dl,matchResult:rl||void 0,setResult:ol||void 0}),E(A),D(ue),ee(!1)},startIcon:l.jsx(Re,{}),children:"検索"})]})]}),l.jsxs(Xl,{open:ke,onClose:()=>de(!1),children:[l.jsx(Ke,{children:"削除確認"}),l.jsx(Ve,{sx:{mt:2},children:"このカスタム分析を削除しますか？"}),l.jsxs(Qe,{children:[l.jsx(F,{onClick:()=>de(!1),color:"inherit",startIcon:l.jsx(He,{}),children:"キャンセル"}),l.jsx(F,{onClick:()=>{const e=We,n=f[e];_(f.filter((t,c)=>c!==e)),G(0),de(!1),N("カスタム分析を削除しました","success",{actionLabel:"元に戻す",onAction:()=>{_(t=>{const c=[...t];return c.splice(e,0,n),c}),G(re.length+e)},autoHideDuration:5e3})},color:"error",startIcon:l.jsx(Ml,{}),children:"OK"})]})]}),l.jsx(tn,{open:_e,playCategories:b,playDetails:y,rallyCategoryTags:x,rallyDetailTags:I,initialData:ae!==null?f[ae]:void 0,onCancel:()=>J(!1),onSave:e=>{ae!==null?(_(f.map((n,t)=>t===ae?e:n)),G(re.length+ae)):(_([...f,e]),G(re.length+f.length)),J(!1)}}),l.jsx(a.Suspense,{fallback:null,children:l.jsx(jn,{open:Be,onClose:()=>ve(!1),memberName:Oe,tabName:Ue,data:$e})})]})}export{Mn as default};
