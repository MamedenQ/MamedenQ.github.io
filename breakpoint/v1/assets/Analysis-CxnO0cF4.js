const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/GraphDialog-CPLUqa-t.js","assets/mui-vendor-ZDpZWGIz.js","assets/react-vendor-QLNaZ7XN.js","assets/index-Cn5cO1ka.js","assets/motion-vendor-dPyzewEM.js","assets/index-DZWGvWwf.css","assets/chart-vendor-CRzMDpO4.js"])))=>i.map(i=>d[i]);
import{u as Dn,c as Yn,R as zn,i as oe,b as On,S as $n,e as Zn,g as es,h as wn,D as ns,f as ln,d as an,a as Pn,A as ss,r as Ge,m as ts,_ as ls}from"./index-Cn5cO1ka.js";import{j as e,v as rn,w as on,U as _e,F as pe,z as xe,S as ge,M as U,R as dn,C as de,m as se,A as as,f as Un,B as f,a9 as Sn,I as Ne,J as Bn,K as Wn,N as Ue,O as I,Q as Fn,x as cn,i as qe,a as rs,b as is,s as kn,aa as tn,L as _n,X as os,Y as ds,$ as cs,a0 as us,a1 as fs,d as Rn,e as He,D as hs}from"./mui-vendor-ZDpZWGIz.js";import{r as a}from"./react-vendor-QLNaZ7XN.js";import{D as Mn,C as En,P as Ln,d as An}from"./DragIndicator-DvNqw2ai.js";import{d as ps}from"./SpaceDashboardOutlined-9ILAlm33.js";import{m as xs,A as gs}from"./motion-vendor-dPyzewEM.js";import"./chart-vendor-CRzMDpO4.js";function ms({open:M,playCategories:h,playDetails:m,rallyCategoryTags:y,rallyDetailTags:b,initialData:u,onCancel:k,onSave:j}){const[x,S]=a.useState(""),[v,J]=a.useState(""),[q,W]=a.useState([]),[T,F]=a.useState([]),[E,H]=a.useState(""),[D,je]=a.useState(""),[L,ce]=a.useState(""),[i,ye]=a.useState("合算"),[Q,Y]=a.useState([]),[le,ue]=a.useState({open:!1,message:"",severity:"success"}),fe=Dn("md"),ae=Dn("sm"),{handleTouchEnd:Ve,setSwiperRef:be}=Yn(),Ke=()=>{ue(s=>({...s,open:!1}))},ve=s=>{if(!s.destination)return;const l=Array.from(Q),[d]=l.splice(s.source.index,1);l.splice(s.destination.index,0,d),Y(l)};a.useEffect(()=>{M&&(S((u==null?void 0:u.name)||""),Y((u==null?void 0:u.items)||[]),J(""),W([]),F([]),H(""),je(""),ce(""),ye("合算"))},[M,u]);const Re=v!=="",Me=q.length>0,Te=E!=="",Ee=T.length>0,Be=D!=="",Le=L!=="",A=Re?Me||Ee?!1:Te?!Be&&!Le:!0:Me||Ee?!(Re||Te):Te?!1:!!(Be||Le),V=()=>{if(!i||!A)return;const s={id:crypto.randomUUID(),method:i};v?s.playCategoryId=v:q.length>0&&(s.playCategoryTags=q),E&&(s.playDetailId=E),T.length>0&&(s.playDetailTags=T),D&&(s.pointType=D),L&&(s.pointUnitType=L),Y(l=>[...l,s]),J(""),W([]),H(""),F([]),je(""),ce("")},K=s=>{Y(l=>{const d=l.findIndex(C=>C.id===s);if(d===-1)return l;const w=[...l],[_]=w.splice(d,1);return ue({open:!0,message:"項目を削除しました",severity:"success",actionLabel:"元に戻す",onAction:()=>{Y(C=>{const z=[...C];return z.splice(d,0,_),z})},autoHideDuration:5e3}),w})},Ce=()=>{if(!x||Q.length===0)return;const s={id:(u==null?void 0:u.id)||crypto.randomUUID(),name:x,items:Q};j(s)},We=v?m.filter(s=>s.playCategoryId===v&&s.visible!==!1):[],he=s=>m.filter(l=>{var w,_;const d=h.find(C=>C.id===l.playCategoryId);return!(l.visible===!1||(d==null?void 0:d.visible)===!1||s.playCategoryId&&l.playCategoryId!==s.playCategoryId||s.playCategoryTags&&s.playCategoryTags.length>0&&!((w=d==null?void 0:d.tags)!=null&&w.some(C=>{var z;return(z=s.playCategoryTags)==null?void 0:z.includes(C)}))||s.playDetailId&&l.id!==s.playDetailId||s.playDetailTags&&s.playDetailTags.length>0&&!((_=l.tags)!=null&&_.some(C=>{var z;return(z=s.playDetailTags)==null?void 0:z.includes(C)}))||s.pointType&&l.pointType!==s.pointType||s.pointUnitType&&l.pointUnitType!==s.pointUnitType)}),Ie=s=>{var l;return s.playCategoryTags&&s.playCategoryTags.length>0?s.playCategoryTags.map(d=>{var w;return((w=y.find(_=>_.id===d))==null?void 0:w.name)||d}).join(","):((l=h.find(d=>d.id===s.playCategoryId))==null?void 0:l.name)||""},re=s=>{var l;return s.playDetailTags&&s.playDetailTags.length>0?s.playDetailTags.map(d=>{var w;return((w=b.find(_=>_.id===d))==null?void 0:w.name)||d}).join(","):s.playDetailId&&((l=m.find(d=>d.id===s.playDetailId))==null?void 0:l.name)||""},Ae=s=>[Ie(s),re(s),s.pointType||"",s.pointUnitType||"",s.method].join(","),ze=s=>he(s).length===0,De=Q.some(ze);return e.jsxs(e.Fragment,{children:[e.jsxs(zn,{open:M,onClose:k,children:[e.jsx(rn,{children:"カスタム分析追加"}),e.jsxs(on,{children:[e.jsx(_e,{label:"カスタム分析名",margin:"dense",value:x,onChange:s=>S(s.target.value),fullWidth:!0}),e.jsxs(pe,{fullWidth:!0,margin:"dense",disabled:q.length>0||T.length>0,children:[e.jsx(xe,{id:"category",children:"プレー区分"}),e.jsxs(ge,{labelId:"category",value:v,label:"プレー区分",onChange:s=>{const l=s.target.value;J(l),H(""),F([]),l&&W([])},children:[e.jsx(U,{value:"",children:"指定なし"}),h.filter(s=>s.visible!==!1).map(s=>e.jsx(U,{value:s.id,children:s.name},s.id))]})]}),e.jsxs(pe,{fullWidth:!0,margin:"dense",disabled:!!D||!!L||q.length>0||T.length>0,children:[e.jsx(xe,{id:"detail",children:"プレー詳細"}),e.jsxs(ge,{labelId:"detail",value:E,label:"プレー詳細",onChange:s=>{H(s.target.value),s.target.value&&(je(""),ce(""),W([]),F([]))},children:[e.jsx(U,{value:"",children:"指定なし"}),We.map(s=>e.jsx(U,{value:s.id,children:s.name},s.id))]})]}),e.jsx(dn,{multiple:!0,options:y,getOptionLabel:s=>s.name,value:y.filter(s=>q.includes(s.id)),onChange:(s,l)=>{W(l.map(d=>d.id)),l.length>0&&(J(""),H(""))},renderTags:(s,l)=>s.map((d,w)=>a.createElement(de,{...l({index:w}),key:d.id,label:d.name,size:"small",sx:{backgroundColor:d.color||oe,color:"#fff"}})),renderInput:s=>e.jsx(_e,{...s,label:"プレー区分タグ",margin:"dense"}),disabled:!!v||!!E,fullWidth:!0}),e.jsx(dn,{multiple:!0,options:b,getOptionLabel:s=>s.name,value:b.filter(s=>T.includes(s.id)),onChange:(s,l)=>{F(l.map(d=>d.id)),l.length>0&&(J(""),H(""))},renderTags:(s,l)=>s.map((d,w)=>a.createElement(de,{...l({index:w}),key:d.id,label:d.name,size:"small",sx:{backgroundColor:d.color||oe,color:"#fff"}})),renderInput:s=>e.jsx(_e,{...s,label:"プレー詳細タグ",margin:"dense"}),disabled:!!v||!!E,fullWidth:!0}),e.jsxs(pe,{fullWidth:!0,disabled:!!E,margin:"dense",children:[e.jsx(xe,{id:"ptype",children:"得失点区分"}),e.jsxs(ge,{labelId:"ptype",value:D,label:"得失点区分",onChange:s=>{je(s.target.value),s.target.value&&H("")},children:[e.jsx(U,{value:"",children:"指定なし"}),e.jsx(U,{value:"得点",children:"得点"}),e.jsx(U,{value:"失点",children:"失点"})]})]}),e.jsxs(pe,{fullWidth:!0,disabled:!!E,margin:"dense",children:[e.jsx(xe,{id:"punittype",children:"得失点単位区分"}),e.jsxs(ge,{labelId:"punittype",value:L,label:"得失点単位区分",onChange:s=>{ce(s.target.value),s.target.value&&H("")},children:[e.jsx(U,{value:"",children:"指定なし"}),e.jsx(U,{value:"メンバー",children:"メンバー"}),e.jsx(U,{value:"チーム",children:"チーム"})]})]}),e.jsxs(pe,{fullWidth:!0,margin:"dense",children:[e.jsx(xe,{id:"method",children:"集計方法"}),e.jsxs(ge,{labelId:"method",value:i,label:"集計方法",onChange:s=>ye(s.target.value),children:[e.jsx(U,{value:"合算",children:"合算"}),e.jsx(U,{value:"試合平均",children:"試合平均"}),e.jsx(U,{value:"セット平均",children:"セット平均"})]})]}),e.jsx(se,{variant:"contained",onClick:V,size:"medium",disabled:!A,fullWidth:!0,startIcon:e.jsx(On,{}),sx:{mt:1},children:"追加"}),Q.length>0&&e.jsxs(e.Fragment,{children:[De&&e.jsx(as,{severity:"error",sx:{mb:1},children:"分析条件に合致するプレー区分、または、プレー詳細が存在しません（赤背景行）"}),e.jsx($n,{component:Un,storageKey:"custom-analysis-dialog",children:fe?e.jsx(Mn,{onDragEnd:ve,children:e.jsx(En,{droppableId:"custom-analysis-items",children:s=>e.jsxs(f,{ref:s.innerRef,...s.droppableProps,children:[e.jsx(f,{sx:{display:"grid",gridTemplateColumns:ae?"32px 1fr":"50px 150px 1fr 110px 130px 110px",alignItems:"center",height:50,px:1,borderBottom:1,borderColor:"divider",...Zn,lineHeight:1},children:ae?e.jsxs(e.Fragment,{children:[e.jsx(f,{sx:{width:32}}),e.jsx(f,{children:"分析項目"})]}):e.jsxs(e.Fragment,{children:[e.jsx(f,{sx:{width:50}}),e.jsx(f,{children:"プレー区分"}),e.jsx(f,{children:"プレー詳細"}),e.jsx(f,{children:"得点区分"}),e.jsx(f,{children:"得失点単位区分"}),e.jsx(f,{children:"集計方法"})]})}),Q.map((l,d)=>{const w=ze(l);return e.jsx(Ln,{draggableId:l.id,index:d,children:_=>e.jsx(f,{ref:_.innerRef,..._.draggableProps,style:_.draggableProps.style,children:e.jsxs(es,{onSwiper:C=>be(l.id,C),threshold:20,slidesPerView:"auto",style:{overflow:"hidden"},onTouchStart:(C,z)=>z.stopPropagation(),onTouchEnd:C=>Ve(l.id,C),children:[e.jsx(wn,{style:{width:"100%",flex:"0 0 auto"},children:e.jsxs(f,{sx:{display:"grid",gridTemplateColumns:ae?"32px 1fr":"50px 150px 1fr 110px 130px 110px",alignItems:"center",height:50,px:1,borderBottom:1,borderColor:"divider",bgcolor:C=>w?Sn(C.palette.error.main,.1):C.palette.background.paper,lineHeight:1},children:[e.jsx(f,{..._.dragHandleProps,sx:{cursor:"grab",display:"flex",touchAction:"none",width:ae?32:50,height:32,alignItems:"center",justifyContent:"center"},children:e.jsx(An,{fontSize:"small"})}),ae?e.jsx(f,{children:Ae(l)}):e.jsxs(e.Fragment,{children:[e.jsx(f,{sx:{pr:1},children:Ie(l)}),e.jsx(f,{sx:{pr:1},children:re(l)}),e.jsx(f,{sx:{pr:1},children:l.pointType||""}),e.jsx(f,{sx:{pr:1},children:l.pointUnitType||""}),e.jsx(f,{children:l.method})]})]})}),e.jsx(wn,{style:{width:ns,flex:"0 0 auto"},children:e.jsx(f,{sx:{height:50,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"error.main"},children:e.jsx(Ne,{size:"small",onClick:()=>K(l.id),children:e.jsx(ln,{fontSize:"small",sx:{color:"common.white"}})})})})]})})},l.id)}),s.placeholder]})})}):e.jsxs(Bn,{size:"small",sx:{"& .MuiTableRow-root":{height:50}},children:[e.jsx(Wn,{children:e.jsxs(Ue,{sx:{backgroundColor:s=>s.palette.mode==="dark"?"#343A42":"#f5f5f5"},children:[e.jsx(I,{}),e.jsx(I,{children:"プレー区分"}),e.jsx(I,{children:"プレー詳細"}),e.jsx(I,{children:"得失点区分"}),e.jsx(I,{children:"得失点単位区分"}),e.jsx(I,{children:"集計方法"}),e.jsx(I,{})]})}),e.jsx(Mn,{onDragEnd:ve,children:e.jsx(En,{droppableId:"custom-analysis-items",children:s=>e.jsxs(Fn,{ref:s.innerRef,...s.droppableProps,children:[Q.map((l,d)=>{const w=ze(l);return e.jsx(Ln,{draggableId:l.id,index:d,children:_=>{var C,z;return e.jsxs(Ue,{ref:_.innerRef,..._.draggableProps,sx:{backgroundColor:w?O=>Sn(O.palette.error.main,.1):void 0},children:[e.jsx(I,{padding:"checkbox",children:e.jsx(f,{..._.dragHandleProps,sx:{cursor:"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:e.jsx(An,{fontSize:"small"})})}),e.jsx(I,{children:l.playCategoryTags&&l.playCategoryTags.length>0?l.playCategoryTags.map(O=>{const $=y.find(Se=>Se.id===O),we=($==null?void 0:$.color)||oe;return e.jsx(de,{label:($==null?void 0:$.name)||O,size:"small",sx:{mr:.5,mb:.5,backgroundColor:we,color:"#fff"}},O)}):(C=h.find(O=>O.id===l.playCategoryId))==null?void 0:C.name}),e.jsx(I,{children:l.playDetailTags&&l.playDetailTags.length>0?l.playDetailTags.map(O=>{const $=b.find(Se=>Se.id===O),we=($==null?void 0:$.color)||oe;return e.jsx(de,{label:($==null?void 0:$.name)||O,size:"small",sx:{mr:.5,mb:.5,backgroundColor:we,color:"#fff"}},O)}):l.playDetailId?(z=m.find(O=>O.id===l.playDetailId))==null?void 0:z.name:""}),e.jsx(I,{children:l.pointType||""}),e.jsx(I,{children:l.pointUnitType||""}),e.jsx(I,{children:l.method}),e.jsx(I,{children:e.jsx(Ne,{size:"small",onClick:()=>K(l.id),children:e.jsx(ln,{fontSize:"small",color:"error"})})})]})}},l.id)}),s.placeholder]})})})]})})]})]}),e.jsxs(cn,{children:[e.jsx(se,{onClick:k,startIcon:e.jsx(an,{}),color:"inherit",children:"キャンセル"}),e.jsx(se,{onClick:Ce,disabled:!x||Q.length===0,startIcon:e.jsx(Pn,{}),children:"OK"})]})]}),e.jsx(ss,{open:le.open,message:le.message,severity:le.severity,actionLabel:le.actionLabel,onAction:le.onAction,autoHideDuration:le.autoHideDuration,onClose:Ke})]})}var fn={},js=qe;Object.defineProperty(fn,"__esModule",{value:!0});var un=fn.default=void 0,ys=js(Ge()),bs=e;un=fn.default=(0,ys.default)((0,bs.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search");var hn={},vs=qe;Object.defineProperty(hn,"__esModule",{value:!0});var Hn=hn.default=void 0,Ts=vs(Ge()),Cs=e;Hn=hn.default=(0,Ts.default)((0,Cs.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit");var pn={},Is=qe;Object.defineProperty(pn,"__esModule",{value:!0});var Nn=pn.default=void 0,Ds=Is(Ge()),ws=e;Nn=pn.default=(0,Ds.default)((0,ws.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Clear");var xn={},Ss=qe;Object.defineProperty(xn,"__esModule",{value:!0});var Gn=xn.default=void 0,ks=Ss(Ge()),_s=e;Gn=xn.default=(0,ks.default)((0,_s.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM5.92 19H5v-.92l9.06-9.06.92.92zM20.71 5.63l-2.34-2.34c-.2-.2-.45-.29-.71-.29s-.51.1-.7.29l-1.83 1.83 3.75 3.75 1.83-1.83c.39-.39.39-1.02 0-1.41"}),"CreateOutlined");const Rs=a.lazy(()=>ls(()=>import("./GraphDialog-CPLUqa-t.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),me="__TEAM__",Ms=xs.create(f);function Es(M,h){let m=0,y=0,b=0,u=0;return M.sets.forEach(k=>{const j=h==="teamA"?k.my:k.opponent,x=h==="teamA"?k.opponent:k.my;b+=j,u+=x,j>x?m+=1:j<x&&(y+=1)}),m>y?"win":m<y?"lose":b>u?"win":b<u?"lose":"draw"}function Ls(M,h,m,y,b,u,k){return M.filter(j=>{if(h!=="ALL"){if(!(j.teamA===h||j.teamB===h)||m&&!(j.teamA===h&&j.teamB===m||j.teamA===m&&j.teamB===h))return!1;if(u){const S=j.teamA===h?"teamA":"teamB";if(Es(j,S)!==u)return!1}}else if(m&&j.teamA!==m&&j.teamB!==m)return!1;return!(y&&j.date!==y||b&&!j.matchName.includes(b)||k&&k.length>0&&!k.every(x=>j.tags.includes(x)))})}function As(M,h){const m=h==="teamA"?M.my:M.opponent,y=h==="teamA"?M.opponent:M.my;return m>y?"win":m<y?"lose":"draw"}function zs(M,h,m,y,b){const u={},k=(x,S,v)=>{u[x]||(u[x]={}),u[x][S]||(u[x][S]={}),u[x][S][v]=(u[x][S][v]||0)+1},j=(x,S)=>!!S&&(y[x]||[]).some(v=>v.id===S&&v.visible!==!1);return M.forEach(x=>{const S=(v,J)=>{x.sets.forEach(q=>{b&&As(q,J)!==b||q.rallies.forEach(W=>{const T=J==="teamA"?W.teamAPlayDetail:W.teamBPlayDetail,F=J==="teamA"?W.teamAMember:W.teamBMember;if(!T)return;const E=m.get(T);(E==null?void 0:E.pointUnitType)==="チーム"?k(v,me,T):(E==null?void 0:E.pointUnitType)==="メンバー"&&(j(v,F)?k(v,F,T):k(v,me,T))})})};h==="ALL"?(x.teamA&&S(x.teamA,"teamA"),x.teamB&&S(x.teamB,"teamB")):x.teamA===h?S(h,"teamA"):x.teamB===h&&S(h,"teamB")}),u}function Hs({matches:M,teams:h,teamMembers:m,playCategories:y,playDetails:b,customAnalyses:u,onCustomAnalysesChange:k,tags:j,rallyCategoryTags:x,rallyDetailTags:S,themeSetting:v,showSnackbar:J,setAppBarAction:q,setAppBarLeftAction:W}){var In;const T=((In=h[0])==null?void 0:In.id)||"",[F,E]=a.useState(0),H=n=>{E(n)},[D,je]=a.useState("member"),[L,ce]=a.useState("asc"),[i,ye]=a.useState({left:T,right:"",date:"",name:"",tags:[]}),[Q,Y]=a.useState(!1),[le,ue]=a.useState(!1),[fe,ae]=a.useState(null),[Ve,be]=a.useState(!1),[Ke,ve]=a.useState(!1),[Re,Me]=a.useState(""),[Te,Ee]=a.useState([]),[Be,Le]=a.useState(""),A=rs(),V=is(A.breakpoints.up("sm")),[K,Ce]=a.useState(!1),[We,he]=a.useState(!1),Ie=56,re=200,Ae=a.useCallback(()=>{K?(he(!1),Ce(!1)):(Ce(!0),V||he(!0))},[K,V]),ze=a.useCallback(n=>{n.target===n.currentTarget&&(K?he(!0):(Ce(!1),he(!1)))},[K]),[De,s]=a.useState(h.length>0?h[0].id:""),[l,d]=a.useState(""),[w,_]=a.useState(""),[C,z]=a.useState(""),[O,$]=a.useState(""),[we,Se]=a.useState(""),[gn,mn]=a.useState([]),jn=a.useMemo(()=>new Map(b.map(n=>[n.id,n])),[b]),qn=a.useCallback(()=>{ye({left:T,right:"",date:"",name:"",tags:[],matchResult:void 0,setResult:void 0})},[T]),Vn=a.useMemo(()=>i.left===T&&i.right===""&&i.date===""&&i.name===""&&i.tags.length===0&&i.matchResult===void 0&&i.setResult===void 0,[i,T]);a.useEffect(()=>{!i.left&&T&&ye(n=>({...n,left:T})),!De&&T&&s(T)},[T,i.left,De]),a.useEffect(()=>{Q&&(s(i.left),d(i.right),_(i.date),z(i.name),$(i.matchResult||""),Se(i.setResult||""),mn(i.tags))},[Q,i]),a.useEffect(()=>(q(e.jsx(se,{color:"inherit",startIcon:e.jsx(un,{}),onClick:()=>Y(!0),children:"詳細検索"})),()=>q(null)),[q]),a.useEffect(()=>(W(e.jsx(Ne,{color:"inherit",onClick:Ae,children:e.jsx(ps,{})})),()=>W(null)),[W,Ae]);const Fe=a.useMemo(()=>Ls(M,i.left,i.right,i.date,i.name,i.matchResult,i.tags),[M,i]),Z=a.useMemo(()=>{const n=i.setResult;return zs(Fe,i.left,jn,m,n)},[Fe,i,jn,m]),Xe=Fe.length,Qe=Fe.reduce((n,t)=>n+t.sets.length,0),B=i.left,yn=a.useMemo(()=>B==="ALL"?h.map(n=>n.id):[B],[B,h]),te=a.useMemo(()=>y.filter(n=>n.visible!==!1),[y]),X=F>=te.length,Je=X?F-te.length:-1,N=X?u[Je]:null,Oe=X?void 0:te[F],ke=X?[]:b.filter(n=>n.playCategoryId===(Oe==null?void 0:Oe.id)&&n.visible!==!1),Kn=!X&&ke.length>0&&ke.every(n=>n.pointUnitType==="チーム"),Ye=a.useMemo(()=>[...te.map(n=>({key:n.id,label:n.name})),...u.map(n=>({key:n.id,label:n.name})),{key:"add",label:"分析追加"}],[te,u]),Ze=a.useCallback(n=>{var t;return((t=h.find(r=>r.id===n))==null?void 0:t.name)||""},[h]),$e=a.useCallback(n=>b.filter(t=>{var c,o;const r=y.find(p=>p.id===t.playCategoryId);return!(t.visible===!1||(r==null?void 0:r.visible)===!1||n.playCategoryId&&t.playCategoryId!==n.playCategoryId||n.playCategoryTags&&n.playCategoryTags.length>0&&!((c=r==null?void 0:r.tags)!=null&&c.some(p=>{var g;return(g=n.playCategoryTags)==null?void 0:g.includes(p)}))||n.playDetailId&&t.id!==n.playDetailId||n.playDetailTags&&n.playDetailTags.length>0&&!((o=t.tags)!=null&&o.some(p=>{var g;return(g=n.playDetailTags)==null?void 0:g.includes(p)}))||n.pointType&&t.pointType!==n.pointType||n.pointUnitType&&t.pointUnitType!==n.pointUnitType)}),[b,y]),ie=a.useCallback((n,t,r)=>{let c=0;return $e(r).forEach(p=>{var g,G;c+=((G=(g=Z[n])==null?void 0:g[t])==null?void 0:G[p.id])||0}),r.method==="試合平均"?c=Xe?c/Xe:0:r.method==="セット平均"&&(c=Qe?c/Qe:0),c},[Z,Xe,Qe,$e]),bn=n=>{const t=$e(n);return t.length>0&&t.every(r=>r.pointUnitType==="チーム")},vn=n=>{var c,o;const t=[];n.playCategoryId?t.push(((c=y.find(p=>p.id===n.playCategoryId))==null?void 0:c.name)||""):n.playCategoryTags&&n.playCategoryTags.length>0&&t.push(n.playCategoryTags.join(",")),n.playDetailId?t.push(((o=b.find(p=>p.id===n.playDetailId))==null?void 0:o.name)||""):n.playDetailTags&&n.playDetailTags.length>0&&t.push(n.playDetailTags.join(","));const r=[n.pointType,n.pointUnitType].filter(Boolean).join(",");return r&&t.push(r),t.length>0?`${t.join(" / ")} (${n.method})`:`(${n.method})`},Tn=a.useMemo(()=>yn.flatMap(n=>(m[n]||[]).filter(t=>t.visible!==!1).map(t=>({teamId:n,member:t}))),[yn,m]),Xn=a.useMemo(()=>{const n=[],t=i.left==="ALL"?"全チーム":Ze(i.left);n.push(`分析対象チーム：${t}`),i.left!=="ALL"&&i.right&&i.right!==""&&n.push(`対戦相手チーム：${Ze(i.right)}`),i.date&&n.push(`試合日付：${i.date}`),i.name&&n.push(`試合名：${i.name}`),i.matchResult==="win"?n.push("勝ち試合"):i.matchResult==="lose"&&n.push("負け試合"),i.setResult==="win"?n.push("勝ちセット"):i.setResult==="lose"&&n.push("負けセット");const r=n.join("、");return i.tags.length>0?e.jsxs(e.Fragment,{children:[r,"、タグ：",i.tags.map(c=>{const o=j.find(g=>g.id===c),p=(o==null?void 0:o.color)||oe;return e.jsx(de,{label:(o==null?void 0:o.name)||c,size:"small",sx:{ml:.5,backgroundColor:p,color:"#fff"}},c)})]}):r},[i,j,Ze]),Pe=a.useMemo(()=>{const n=new Map;return u.forEach(t=>{t.items.forEach(r=>{$e(r).length>0&&n.set(r.id,r)})}),n},[u,$e]),ee=a.useMemo(()=>N?N.items.filter(n=>Pe.has(n.id)):[],[N,Pe]),Qn=a.useMemo(()=>{const n=[...Tn];return n.sort((t,r)=>{var p,g,G,R;let c="",o="";if(D==="member")c=t.member.name,o=r.member.name;else if(Pe.has(D)){const P=Pe.get(D);c=ie(t.teamId,t.member.id,P),o=ie(r.teamId,r.member.id,P)}else c=((g=(p=Z[t.teamId])==null?void 0:p[t.member.id])==null?void 0:g[D])||0,o=((R=(G=Z[r.teamId])==null?void 0:G[r.member.id])==null?void 0:R[D])||0;return c<o?L==="asc"?-1:1:c>o?L==="asc"?1:-1:0}),n},[Tn,D,L,Z,Pe,ie]),ne=a.useMemo(()=>{var c;if(B==="ALL")return null;if(X&&N){const o={};return ee.forEach(g=>{o[g.id]=0}),(m[B]||[]).filter(g=>g.visible!==!1).forEach(g=>{ee.forEach(G=>{o[G.id]+=ie(B,g.id,G)})}),ee.forEach(g=>{o[g.id]+=ie(B,me,g)}),o}const n={};(m[B]||[]).filter(o=>o.visible!==!1).forEach(o=>{var g;const p=((g=Z[B])==null?void 0:g[o.id])||{};Object.entries(p).forEach(([G,R])=>{n[G]=(n[G]||0)+R})});const r=((c=Z[B])==null?void 0:c[me])||{};return Object.entries(r).forEach(([o,p])=>{n[o]=(n[o]||0)+p}),n},[B,m,Z,X,N,ee,ie]),en=n=>{D===n?ce(L==="asc"?"desc":"asc"):(je(n),ce("asc"))},Cn=(n,t,r)=>{var c;if(X&&N){let o=[];t===me&&n===B&&ne?o=ee.map(p=>({label:vn(p),value:ne[p.id]||0})):o=ee.map(p=>({label:vn(p),value:ie(n,t,p)})),Me(r),Le(N.name),Ee(o),ve(!0)}else if(Oe){let o={};t===me&&n===B&&ne?o=ne:o=((c=Z[n])==null?void 0:c[t])||{};const p=ke.map(g=>({label:g.name,value:o[g.id]||0}));Me(r),Le(Oe.name),Ee(p),ve(!0)}},Jn=e.jsxs(Ms,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},sx:{display:"flex",flexDirection:"column",flexGrow:1},children:[e.jsxs(f,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(f,{sx:{display:"flex",alignItems:"center",gap:1,flexGrow:1,minWidth:0,overflow:"hidden"},children:e.jsx(kn,{component:"div",variant:"body2",noWrap:!0,sx:{overflow:"hidden",textOverflow:"ellipsis"},children:Xn})}),e.jsx(Ne,{size:"small",onClick:qn,disabled:Vn,children:e.jsx(Nn,{})})]}),X&&e.jsxs(f,{sx:{display:"flex",alignItems:"center",mb:1,gap:1},children:[e.jsx(kn,{sx:{flexGrow:1,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:N==null?void 0:N.name}),e.jsx(se,{variant:"contained",size:"medium",onClick:()=>{ae(Je),ue(!0)},startIcon:e.jsx(Hn,{}),children:"編集"}),e.jsx(se,{variant:"contained",size:"medium",color:"error",onClick:()=>be(!0),startIcon:e.jsx(ln,{}),children:"削除"})]}),e.jsx($n,{component:Un,storageKey:"analysis-list",sx:{flexGrow:1},children:e.jsxs(Bn,{size:"small",sx:{"& th, & td":{textAlign:"center",verticalAlign:"middle"},"& .MuiTableRow-root":{height:50}},children:[e.jsx(Wn,{children:e.jsxs(Ue,{sx:{backgroundColor:n=>n.palette.mode==="dark"?"#343A42":"#f5f5f5"},children:[e.jsx(I,{align:"center",sortDirection:D==="member"?L:!1,children:e.jsx(tn,{active:D==="member",direction:D==="member"?L:"asc",onClick:()=>en("member"),children:"メンバー"})}),X&&N?ee.map(n=>{var p,g,G;const t=n.playCategoryId&&((p=y.find(R=>R.id===n.playCategoryId))==null?void 0:p.name)||"",r=n.playDetailId&&((g=b.find(R=>R.id===n.playDetailId))==null?void 0:g.name)||"",c=n.playDetailId?(G=b.find(R=>R.id===n.playDetailId))==null?void 0:G.pointType:void 0,o=[n.pointType,n.pointUnitType].filter(Boolean).join(",");return e.jsx(I,{align:"center",sortDirection:D===n.id?L:!1,children:e.jsx(tn,{active:D===n.id,direction:D===n.id?L:"asc",onClick:()=>en(n.id),children:e.jsxs(f,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[n.playCategoryTags&&n.playCategoryTags.length>0?e.jsx(f,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center"},children:n.playCategoryTags.map(R=>{const P=x.find(sn=>sn.id===R),nn=(P==null?void 0:P.color)||oe;return e.jsx(de,{label:(P==null?void 0:P.name)||R,size:"small",sx:{mr:.5,mb:.5,backgroundColor:nn,color:"#fff"}},R)})}):t&&e.jsx("span",{children:t}),n.playDetailTags&&n.playDetailTags.length>0?e.jsx(f,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center"},children:n.playDetailTags.map(R=>{const P=S.find(sn=>sn.id===R),nn=(P==null?void 0:P.color)||oe;return e.jsx(de,{label:(P==null?void 0:P.name)||R,size:"small",sx:{mr:.5,mb:.5,backgroundColor:nn,color:"#fff"}},R)})}):r&&e.jsx(f,{component:"span",sx:{color:c==="得点"?v.scoreColor:c==="失点"?v.lossColor:void 0},children:r}),o&&e.jsx("span",{children:o}),e.jsxs("span",{children:["(",n.method,")"]})]})})},n.id)}):ke.map(n=>e.jsx(I,{align:"center",sortDirection:D===n.id?L:!1,sx:{color:n.pointType==="得点"?v.scoreColor:n.pointType==="失点"?v.lossColor:"inherit"},children:e.jsx(tn,{active:D===n.id,direction:D===n.id?L:"asc",onClick:()=>en(n.id),children:n.name})},n.id))]})}),e.jsxs(Fn,{children:[B!=="ALL"&&e.jsxs(Ue,{children:[e.jsx(I,{align:"center",children:e.jsx(_n,{component:"button",underline:"hover",onClick:()=>Cn(B,me,"チーム集計"),children:"チーム集計"})}),X&&N?ee.map(n=>e.jsx(I,{align:"center",children:(ne==null?void 0:ne[n.id])||0},n.id)):ke.map(n=>e.jsx(I,{align:"center",children:(ne==null?void 0:ne[n.id])||0},n.id))]}),(X&&N?ee.some(n=>!bn(n)):!Kn)&&Qn.map(({teamId:n,member:t})=>e.jsxs(Ue,{children:[e.jsx(I,{align:"center",children:e.jsx(_n,{component:"button",underline:"hover",onClick:()=>Cn(n,t.id,t.name),children:t.name})}),X&&N?ee.map(r=>e.jsx(I,{align:"center",children:bn(r)?"－":ie(n,t.id,r)},r.id)):ke.map(r=>{var c,o;return e.jsx(I,{align:"center",children:r.pointUnitType==="チーム"?"－":((o=(c=Z[n])==null?void 0:c[t.id])==null?void 0:o[r.id])||0},r.id)})]},`${n}-${t.id}`))]})]})})]},F);return e.jsxs(f,{sx:{display:"flex",height:"100%"},children:[e.jsx(os,{variant:V?"permanent":"temporary",open:V?!0:K,onClose:()=>{he(!1),Ce(!1)},PaperProps:{onTransitionEnd:ze},ModalProps:{keepMounted:!0,BackdropProps:{sx:{backgroundColor:"rgba(0, 0, 0, 0.5)"}}},sx:{width:V?K?re:Ie:re,flexShrink:0,transition:A.transitions.create("width",{easing:A.transitions.easing.sharp,duration:A.transitions.duration.standard}),...V?{zIndex:A.zIndex.appBar-1}:{},"& .MuiDrawer-paper":{width:V?K?re:Ie:re,boxSizing:"border-box",overflowX:"hidden",transition:A.transitions.create("width",{easing:A.transitions.easing.sharp,duration:A.transitions.duration.standard}),...V?{top:A.mixins.toolbar.minHeight,height:`calc(100% - ${A.mixins.toolbar.minHeight}px)`,zIndex:A.zIndex.appBar-1}:{}}},children:e.jsx(ds,{children:Ye.map((n,t)=>e.jsxs(cs,{selected:t===F,onClick:()=>{t===Ye.length-1?(ae(null),ue(!0)):H(t),V||Ae()},sx:{minHeight:48,justifyContent:K?"initial":"center",px:2.5},children:[e.jsx(us,{sx:{minWidth:0,mr:K?3:0,justifyContent:"center"},children:t===Ye.length-1?e.jsx(On,{}):t>=te.length?e.jsx(Gn,{}):e.jsx(ts,{})}),e.jsx(fs,{primary:n.label,sx:{opacity:We?1:0,display:We?"block":"none",whiteSpace:"nowrap"}})]},n.key))})}),e.jsxs(f,{sx:{flexGrow:1,display:"flex",flexDirection:"column",width:V?`calc(100% - ${K?re:Ie}px)`:"100%",transition:V?A.transitions.create("width",{duration:A.transitions.duration.standard}):void 0},children:[e.jsx(gs,{mode:"wait",children:Jn}),e.jsxs(zn,{open:Q,onClose:()=>Y(!1),children:[e.jsx(rn,{children:"詳細検索"}),e.jsxs(on,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(f,{sx:{display:"flex",gap:2},children:[e.jsxs(pe,{fullWidth:!0,sx:{flex:1},margin:"dense",children:[e.jsx(xe,{id:"dlg-left",children:"分析チーム"}),e.jsx(ge,{labelId:"dlg-left",value:De,label:"分析チーム",onChange:n=>{const t=n.target.value;s(t)},children:h.map(n=>e.jsx(U,{value:n.id,children:n.name},n.id))})]}),e.jsxs(pe,{fullWidth:!0,sx:{flex:1},margin:"dense",children:[e.jsx(xe,{id:"dlg-right",children:"対戦相手"}),e.jsxs(ge,{labelId:"dlg-right",value:l,label:"対戦相手",onChange:n=>d(n.target.value),children:[e.jsx(U,{value:"",children:"指定なし"}),h.map(n=>e.jsx(U,{value:n.id,children:n.name},n.id))]})]})]}),e.jsxs(f,{sx:{display:"flex",gap:2},children:[e.jsx(_e,{type:"date",label:"試合日付",margin:"dense",value:w,onChange:n=>_(n.target.value),InputLabelProps:{shrink:!0},fullWidth:!0,sx:{flex:1,"& .MuiOutlinedInput-root":{height:56},"& .MuiOutlinedInput-input":{padding:"0 14px",height:"100%",lineHeight:"56px",fontSize:"1rem",textAlign:"left"},'& input[type="date"]':{WebkitAppearance:"none"}}}),e.jsx(_e,{label:"試合名",margin:"dense",value:C,onChange:n=>z(n.target.value),fullWidth:!0,sx:{flex:1}})]}),e.jsxs(f,{sx:{display:"flex",gap:2,flexDirection:"column"},children:[e.jsxs(Rn,{exclusive:!0,value:O,onChange:(n,t)=>$(t),fullWidth:!0,sx:{width:"100%"},children:[e.jsx(He,{value:"win",sx:{whiteSpace:"nowrap"},children:"勝ち試合"}),e.jsx(He,{value:"lose",sx:{whiteSpace:"nowrap"},children:"負け試合"})]}),e.jsxs(Rn,{exclusive:!0,value:we,onChange:(n,t)=>Se(t),fullWidth:!0,sx:{width:"100%"},children:[e.jsx(He,{value:"win",sx:{whiteSpace:"nowrap"},children:"勝ちセット"}),e.jsx(He,{value:"lose",sx:{whiteSpace:"nowrap"},children:"負けセット"})]})]}),e.jsx(f,{sx:{display:"flex",gap:2},children:e.jsx(dn,{multiple:!0,options:j,getOptionLabel:n=>n.name,value:j.filter(n=>gn.includes(n.id)),onChange:(n,t)=>mn(t.map(r=>r.id)),renderTags:(n,t)=>n.map((r,c)=>e.jsx(de,{...t({index:c}),label:r.name,size:"small",sx:{backgroundColor:r.color||oe,color:"#fff"}})),renderInput:n=>e.jsx(_e,{...n,label:"タグ",margin:"dense"}),fullWidth:!0})})]}),e.jsxs(cn,{children:[e.jsx(se,{onClick:()=>Y(!1),color:"inherit",startIcon:e.jsx(an,{}),children:"キャンセル"}),e.jsx(se,{onClick:()=>{ye({left:De,right:l,date:w,name:C,tags:gn,matchResult:O||void 0,setResult:we||void 0}),Y(!1)},startIcon:e.jsx(un,{}),children:"検索"})]})]}),e.jsxs(hs,{open:Ve,onClose:()=>be(!1),children:[e.jsx(rn,{children:"削除確認"}),e.jsx(on,{sx:{mt:2},children:"このカスタム分析を削除しますか？"}),e.jsxs(cn,{children:[e.jsx(se,{onClick:()=>be(!1),color:"inherit",startIcon:e.jsx(an,{}),children:"キャンセル"}),e.jsx(se,{onClick:()=>{const n=Je,t=u[n];k(u.filter((r,c)=>c!==n)),H(0),be(!1),J("カスタム分析を削除しました","success",{actionLabel:"元に戻す",onAction:()=>{k(r=>{const c=[...r];return c.splice(n,0,t),c}),H(te.length+n)},autoHideDuration:5e3})},color:"error",startIcon:e.jsx(Pn,{}),children:"OK"})]})]}),e.jsx(ms,{open:le,playCategories:y,playDetails:b,rallyCategoryTags:x,rallyDetailTags:S,initialData:fe!==null?u[fe]:void 0,onCancel:()=>ue(!1),onSave:n=>{fe!==null?(k(u.map((t,r)=>r===fe?n:t)),H(te.length+fe)):(k([...u,n]),H(te.length+u.length)),ue(!1)}}),e.jsx(a.Suspense,{fallback:null,children:e.jsx(Rs,{open:Ke,onClose:()=>ve(!1),memberName:Re,tabName:Be,data:Te})})]})]})}export{Hs as default};
