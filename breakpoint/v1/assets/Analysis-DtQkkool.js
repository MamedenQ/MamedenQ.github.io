const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/GraphDialog-DDYZhMbJ.js","assets/mui-vendor-CWczK8Oe.js","assets/react-vendor-QLNaZ7XN.js","assets/index-Y3gFGuf5.js","assets/motion-vendor-DXKcITea.js","assets/index-DqrEpDIH.css","assets/chart-vendor-DYaT3_Rb.js"])))=>i.map(i=>d[i]);
import{R as kl,D as oe,a as Gl,S as _l,d as Ml,b as Qe,c as El,r as ze,u as Nl,_ as ql}from"./index-Y3gFGuf5.js";import{j as l,n as Je,o as Xe,U as je,F as V,Q as K,S as Q,M as C,R as Ye,C as ce,q as F,A as Hl,f as Rl,g as wl,h as Ll,k as _e,l as v,m as Al,a9 as Vl,B as L,I as zl,p as Ze,i as Be,aa as Ke,L as Il,ab as Kl,ac as Ql,ad as Jl,d as Dl,e as Le,D as Xl}from"./mui-vendor-CWczK8Oe.js";import{r as a}from"./react-vendor-QLNaZ7XN.js";import{D as Yl,C as Zl,P as en,d as ln}from"./DragIndicator-DKM6fWF3.js";import{m as nn,A as sn}from"./motion-vendor-DXKcITea.js";import"./chart-vendor-DYaT3_Rb.js";function tn({open:A,playCategories:u,playDetails:x,rallyCategoryTags:b,rallyDetailTags:y,initialData:f,onCancel:_,onSave:m}){const[p,D]=a.useState(""),[j,G]=a.useState(""),[z,T]=a.useState([]),[E,O]=a.useState([]),[S,U]=a.useState(""),[de,N]=a.useState(""),[I,pe]=a.useState(""),[W,be]=a.useState("合算"),[o,te]=a.useState([]),ye=s=>{if(!s.destination)return;const i=Array.from(o),[g]=i.splice(s.source.index,1);i.splice(s.destination.index,0,g),te(i)};a.useEffect(()=>{A&&(D((f==null?void 0:f.name)||""),te((f==null?void 0:f.items)||[]),G(""),T([]),O([]),U(""),N(""),pe(""),be("合算"))},[A,f]);const ne=j!=="",Me=z.length>0,J=S!=="",ae=E.length>0,xe=de!=="",Ee=I!=="",ue=ne?Me||ae?!1:J?!xe&&!Ee:!0:Me||ae?!(ne||J):J?!1:!!(xe||Ee),Oe=()=>{if(!W||!ue)return;const s={id:crypto.randomUUID(),method:W};j?s.playCategoryId=j:z.length>0&&(s.playCategoryTags=z),S&&(s.playDetailId=S),E.length>0&&(s.playDetailTags=E),de&&(s.pointType=de),I&&(s.pointUnitType=I),te(i=>[...i,s]),G(""),T([]),U(""),O([]),N(""),pe("")},ve=s=>{te(i=>i.filter(g=>g.id!==s))},$e=()=>{if(!p||o.length===0)return;const s={id:(f==null?void 0:f.id)||crypto.randomUUID(),name:p,items:o};m(s)},Re=j?x.filter(s=>s.playCategoryId===j&&s.visible!==!1):[],Ue=s=>x.filter(i=>{var X,se;const g=u.find(q=>q.id===i.playCategoryId);return!(i.visible===!1||(g==null?void 0:g.visible)===!1||s.playCategoryId&&i.playCategoryId!==s.playCategoryId||s.playCategoryTags&&s.playCategoryTags.length>0&&!((X=g==null?void 0:g.tags)!=null&&X.some(q=>{var Y;return(Y=s.playCategoryTags)==null?void 0:Y.includes(q)}))||s.playDetailId&&i.id!==s.playDetailId||s.playDetailTags&&s.playDetailTags.length>0&&!((se=i.tags)!=null&&se.some(q=>{var Y;return(Y=s.playDetailTags)==null?void 0:Y.includes(q)}))||s.pointType&&i.pointType!==s.pointType||s.pointUnitType&&i.pointUnitType!==s.pointUnitType)}),Ce=s=>Ue(s).length===0,We=o.some(Ce);return l.jsxs(kl,{open:A,onClose:_,children:[l.jsx(Je,{children:"カスタム分析追加"}),l.jsxs(Xe,{sx:{display:"flex",flexDirection:"column",gap:2,mt:2},children:[l.jsx(je,{label:"カスタム分析名",margin:"dense",value:p,onChange:s=>D(s.target.value),fullWidth:!0}),l.jsxs(l.Fragment,{children:[l.jsxs(V,{fullWidth:!0,sx:{mt:1},disabled:z.length>0||E.length>0,children:[l.jsx(K,{id:"category",children:"プレー区分"}),l.jsxs(Q,{labelId:"category",value:j,label:"プレー区分",onChange:s=>{const i=s.target.value;G(i),U(""),O([]),i&&T([])},children:[l.jsx(C,{value:"",children:"指定なし"}),u.filter(s=>s.visible!==!1).map(s=>l.jsx(C,{value:s.id,children:s.name},s.id))]})]}),l.jsxs(V,{fullWidth:!0,sx:{mt:1},disabled:!!de||!!I||z.length>0||E.length>0,children:[l.jsx(K,{id:"detail",children:"プレー詳細"}),l.jsxs(Q,{labelId:"detail",value:S,label:"プレー詳細",onChange:s=>{U(s.target.value),s.target.value&&(N(""),pe(""),T([]),O([]))},children:[l.jsx(C,{value:"",children:"指定なし"}),Re.map(s=>l.jsx(C,{value:s.id,children:s.name},s.id))]})]}),l.jsx(Ye,{multiple:!0,options:b,getOptionLabel:s=>s.name,value:b.filter(s=>z.includes(s.id)),onChange:(s,i)=>{T(i.map(g=>g.id)),i.length>0&&(G(""),U(""))},renderTags:(s,i)=>s.map((g,X)=>a.createElement(ce,{...i({index:X}),key:g.id,label:g.name,size:"small",sx:{backgroundColor:g.color||oe,color:"#fff"}})),renderInput:s=>l.jsx(je,{...s,label:"プレー区分タグ",margin:"dense"}),disabled:!!j||!!S,fullWidth:!0}),l.jsx(Ye,{multiple:!0,options:y,getOptionLabel:s=>s.name,value:y.filter(s=>E.includes(s.id)),onChange:(s,i)=>{O(i.map(g=>g.id)),i.length>0&&(G(""),U(""))},renderTags:(s,i)=>s.map((g,X)=>a.createElement(ce,{...i({index:X}),key:g.id,label:g.name,size:"small",sx:{backgroundColor:g.color||oe,color:"#fff"}})),renderInput:s=>l.jsx(je,{...s,label:"プレー詳細タグ",margin:"dense"}),disabled:!!j||!!S,fullWidth:!0}),l.jsxs(V,{fullWidth:!0,disabled:!!S,children:[l.jsx(K,{id:"ptype",children:"得失点区分"}),l.jsxs(Q,{labelId:"ptype",value:de,label:"得失点区分",onChange:s=>{N(s.target.value),s.target.value&&U("")},children:[l.jsx(C,{value:"",children:"指定なし"}),l.jsx(C,{value:"得点",children:"得点"}),l.jsx(C,{value:"失点",children:"失点"})]})]}),l.jsxs(V,{fullWidth:!0,disabled:!!S,children:[l.jsx(K,{id:"punittype",children:"得失点単位区分"}),l.jsxs(Q,{labelId:"punittype",value:I,label:"得失点単位区分",onChange:s=>{pe(s.target.value),s.target.value&&U("")},children:[l.jsx(C,{value:"",children:"指定なし"}),l.jsx(C,{value:"メンバー",children:"メンバー"}),l.jsx(C,{value:"チーム",children:"チーム"})]})]}),l.jsxs(V,{fullWidth:!0,children:[l.jsx(K,{id:"method",children:"集計方法"}),l.jsxs(Q,{labelId:"method",value:W,label:"集計方法",onChange:s=>be(s.target.value),children:[l.jsx(C,{value:"合算",children:"合算"}),l.jsx(C,{value:"試合平均",children:"試合平均"}),l.jsx(C,{value:"セット平均",children:"セット平均"})]})]}),l.jsx(F,{variant:"contained",onClick:Oe,size:"small",disabled:!ue,fullWidth:!0,startIcon:l.jsx(Gl,{}),children:"追加"})]}),o.length>0&&l.jsxs(l.Fragment,{children:[We&&l.jsx(Hl,{severity:"error",sx:{mb:1},children:"分析条件に合致するプレー区分、または、プレー詳細が存在しません（赤背景行）"}),l.jsx(_l,{component:Rl,storageKey:"custom-analysis-dialog",children:l.jsxs(wl,{size:"small",sx:{"& .MuiTableRow-root":{height:50}},children:[l.jsx(Ll,{children:l.jsxs(_e,{sx:{backgroundColor:s=>s.palette.mode==="dark"?"#343A42":"#f5f5f5"},children:[l.jsx(v,{}),l.jsx(v,{children:"プレー区分"}),l.jsx(v,{children:"プレー詳細"}),l.jsx(v,{children:"得失点区分"}),l.jsx(v,{children:"得失点単位区分"}),l.jsx(v,{children:"集計方法"}),l.jsx(v,{})]})}),l.jsx(Yl,{onDragEnd:ye,children:l.jsx(Zl,{droppableId:"custom-analysis-items",children:s=>l.jsxs(Al,{ref:s.innerRef,...s.droppableProps,children:[o.map((i,g)=>{const X=Ce(i);return l.jsx(en,{draggableId:i.id,index:g,children:se=>{var q,Y;return l.jsxs(_e,{ref:se.innerRef,...se.draggableProps,sx:{backgroundColor:X?R=>Vl(R.palette.error.main,.1):void 0},children:[l.jsx(v,{padding:"checkbox",children:l.jsx(L,{...se.dragHandleProps,sx:{cursor:"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:l.jsx(ln,{fontSize:"small"})})}),l.jsx(v,{children:i.playCategoryTags&&i.playCategoryTags.length>0?i.playCategoryTags.map(R=>{const B=b.find(ge=>ge.id===R),fe=(B==null?void 0:B.color)||oe;return l.jsx(ce,{label:(B==null?void 0:B.name)||R,size:"small",sx:{mr:.5,mb:.5,backgroundColor:fe,color:"#fff"}},R)}):(q=u.find(R=>R.id===i.playCategoryId))==null?void 0:q.name}),l.jsx(v,{children:i.playDetailTags&&i.playDetailTags.length>0?i.playDetailTags.map(R=>{const B=y.find(ge=>ge.id===R),fe=(B==null?void 0:B.color)||oe;return l.jsx(ce,{label:(B==null?void 0:B.name)||R,size:"small",sx:{mr:.5,mb:.5,backgroundColor:fe,color:"#fff"}},R)}):i.playDetailId?(Y=x.find(R=>R.id===i.playDetailId))==null?void 0:Y.name:""}),l.jsx(v,{children:i.pointType||""}),l.jsx(v,{children:i.pointUnitType||""}),l.jsx(v,{children:i.method}),l.jsx(v,{children:l.jsx(zl,{size:"small",onClick:()=>ve(i.id),children:l.jsx(Ml,{fontSize:"small",color:"error"})})})]})}},i.id)}),s.placeholder]})})})]})})]})]}),l.jsxs(Ze,{children:[l.jsx(F,{onClick:_,startIcon:l.jsx(Qe,{}),color:"inherit",children:"キャンセル"}),l.jsx(F,{onClick:$e,disabled:!p||o.length===0,startIcon:l.jsx(El,{}),children:"OK"})]})]})}var ll={},an=Be;Object.defineProperty(ll,"__esModule",{value:!0});var Bl=ll.default=void 0,rn=an(ze()),on=l;Bl=ll.default=(0,rn.default)((0,on.jsx)("path",{d:"M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreHoriz");var nl={},cn=Be;Object.defineProperty(nl,"__esModule",{value:!0});var Ae=nl.default=void 0,dn=cn(ze()),un=l;Ae=nl.default=(0,dn.default)((0,un.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search");var sl={},fn=Be;Object.defineProperty(sl,"__esModule",{value:!0});var Ol=sl.default=void 0,hn=fn(ze()),pn=l;Ol=sl.default=(0,hn.default)((0,pn.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit");var tl={},xn=Be;Object.defineProperty(tl,"__esModule",{value:!0});var el=tl.default=void 0,gn=xn(ze()),mn=l;el=tl.default=(0,gn.default)((0,mn.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Clear");const jn=a.lazy(()=>ql(()=>import("./GraphDialog-DDYZhMbJ.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),he="__TEAM__",bn=nn.create(L);function yn(A,u){let x=0,b=0,y=0,f=0;return A.sets.forEach(_=>{const m=u==="teamA"?_.my:_.opponent,p=u==="teamA"?_.opponent:_.my;y+=m,f+=p,m>p?x+=1:m<p&&(b+=1)}),x>b?"win":x<b?"lose":y>f?"win":y<f?"lose":"draw"}function Sl(A,u,x,b,y,f,_){return A.filter(m=>{if(u!=="ALL"){if(!(m.teamA===u||m.teamB===u)||x&&!(m.teamA===u&&m.teamB===x||m.teamA===x&&m.teamB===u))return!1;if(f){const D=m.teamA===u?"teamA":"teamB";if(yn(m,D)!==f)return!1}}else if(x&&m.teamA!==x&&m.teamB!==x)return!1;return!(b&&m.date!==b||y&&!m.matchName.includes(y)||_&&_.length>0&&!_.every(p=>m.tags.includes(p)))})}function vn(A,u){const x=u==="teamA"?A.my:A.opponent,b=u==="teamA"?A.opponent:A.my;return x>b?"win":x<b?"lose":"draw"}function Cn(A,u,x,b,y){const f={},_=(p,D,j)=>{f[p]||(f[p]={}),f[p][D]||(f[p][D]={}),f[p][D][j]=(f[p][D][j]||0)+1},m=(p,D)=>!!D&&(b[p]||[]).some(j=>j.id===D&&j.visible!==!1);return A.forEach(p=>{const D=(j,G)=>{p.sets.forEach(z=>{y&&vn(z,G)!==y||z.rallies.forEach(T=>{const E=G==="teamA"?T.teamAPlayDetail:T.teamBPlayDetail,O=G==="teamA"?T.teamAMember:T.teamBMember;if(!E)return;const S=x.get(E);(S==null?void 0:S.pointUnitType)==="チーム"?_(j,he,E):(S==null?void 0:S.pointUnitType)==="メンバー"&&(m(j,O)?_(j,O,E):_(j,he,E))})})};u==="ALL"?(p.teamA&&D(p.teamA,"teamA"),p.teamB&&D(p.teamB,"teamB")):p.teamA===u?D(u,"teamA"):p.teamB===u&&D(u,"teamB")}),f}function Mn({matches:A,teams:u,teamMembers:x,playCategories:b,playDetails:y,customAnalyses:f,onCustomAnalysesChange:_,tags:m,rallyCategoryTags:p,rallyDetailTags:D,themeSetting:j,showSnackbar:G}){var Tl;const z=((Tl=u[0])==null?void 0:Tl.id)||"",[T,E]=a.useState(u.length>0?u[0].id:""),[O,S]=a.useState(""),[U,de]=a.useState(0),N=e=>{de(e)},[I,pe]=a.useState("member"),[W,be]=a.useState("asc"),[o,te]=a.useState(null),[ye,ne]=a.useState(!1),[Me,J]=a.useState(!1),[ae,xe]=a.useState(null),[Ee,ue]=a.useState(!1),[Oe,ve]=a.useState(!1),[$e,Re]=a.useState(""),[Ue,Ce]=a.useState([]),[We,s]=a.useState(""),i=a.useRef(null),[g,X]=a.useState([]),[se,q]=a.useState(null),Y=Nl("sm"),[R,B]=a.useState(u.length>0?u[0].id:""),[fe,ge]=a.useState(""),[al,rl]=a.useState(""),[il,ol]=a.useState(""),[cl,dl]=a.useState(""),[ul,fl]=a.useState(""),[hl,pl]=a.useState([]),xl=a.useMemo(()=>new Map(y.map(e=>[e.id,e])),[y]);a.useEffect(()=>{!T&&z&&E(z),!R&&z&&B(z)},[u,z,T,R]),a.useEffect(()=>{if(ye){const e=o||{left:T,right:O,date:"",name:"",tags:[]};B(e.left),ge(e.right),rl(e.date),ol(e.name),dl(e.matchResult||""),fl(e.setResult||""),pl(e.tags)}},[ye,o,T,O]);const we=a.useMemo(()=>o?Sl(A,o.left,o.right,o.date,o.name,o.matchResult,o.tags):Sl(A,T,O,"","",void 0,void 0),[A,T,O,o]),Z=a.useMemo(()=>{const e=o?o.left:T,n=o==null?void 0:o.setResult;return Cn(we,e,xl,x,n)},[we,o,T,xl,x]),Pe=we.length,Fe=we.reduce((e,n)=>e+n.sets.length,0),$=o?o.left:T,gl=a.useMemo(()=>$==="ALL"?u.map(e=>e.id):[$],[$,u]),re=a.useMemo(()=>b.filter(e=>e.visible!==!1),[b]),P=U>=re.length,Ge=P?U-re.length:-1,H=P?f[Ge]:null,Te=P?void 0:re[U],me=P?[]:y.filter(e=>e.playCategoryId===(Te==null?void 0:Te.id)&&e.visible!==!1),$l=!P&&me.length>0&&me.every(e=>e.pointUnitType==="チーム"),Ie=a.useMemo(()=>[...re.map(e=>({key:e.id,label:e.name})),...f.map(e=>({key:e.id,label:e.name})),{key:"add",label:"分析追加"}],[re,f]),De=a.useCallback(()=>{const e=i.current;if(!e)return;const n=e.querySelectorAll('[role="tab"]'),t=e.scrollLeft,c=t+e.clientWidth,r=[];n.forEach((d,h)=>{if(d.offsetLeft<t||d.offsetLeft+d.offsetWidth>c){const M=Ie[h];M&&r.push({index:h,label:M.label})}}),X(d=>d.length===r.length&&d.every((h,M)=>{var k,w;return h.index===((k=r[M])==null?void 0:k.index)&&h.label===((w=r[M])==null?void 0:w.label)})?d:r)},[Ie]);a.useEffect(()=>{De();const e=()=>De(),n=i.current;return n==null||n.addEventListener("scroll",De,{passive:!0}),window.addEventListener("resize",e),()=>{n==null||n.removeEventListener("scroll",De),window.removeEventListener("resize",e)}},[De]);const Ul=e=>{q(e.currentTarget)},ml=()=>{q(null)},Wl=e=>{e===Ie.length-1?(xe(null),J(!0)):N(e);const n=i.current;if(n){const t=n.querySelectorAll('[role="tab"]')[e];t==null||t.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})}ml()},Ne=a.useCallback(e=>{var n;return((n=u.find(t=>t.id===e))==null?void 0:n.name)||""},[u]),Se=a.useCallback(e=>y.filter(n=>{var c,r;const t=b.find(d=>d.id===n.playCategoryId);return!(n.visible===!1||(t==null?void 0:t.visible)===!1||e.playCategoryId&&n.playCategoryId!==e.playCategoryId||e.playCategoryTags&&e.playCategoryTags.length>0&&!((c=t==null?void 0:t.tags)!=null&&c.some(d=>{var h;return(h=e.playCategoryTags)==null?void 0:h.includes(d)}))||e.playDetailId&&n.id!==e.playDetailId||e.playDetailTags&&e.playDetailTags.length>0&&!((r=n.tags)!=null&&r.some(d=>{var h;return(h=e.playDetailTags)==null?void 0:h.includes(d)}))||e.pointType&&n.pointType!==e.pointType||e.pointUnitType&&n.pointUnitType!==e.pointUnitType)}),[y,b]),ie=a.useCallback((e,n,t)=>{let c=0;return Se(t).forEach(d=>{var h,M;c+=((M=(h=Z[e])==null?void 0:h[n])==null?void 0:M[d.id])||0}),t.method==="試合平均"?c=Pe?c/Pe:0:t.method==="セット平均"&&(c=Fe?c/Fe:0),c},[Z,Pe,Fe,Se]),jl=e=>{const n=Se(e);return n.length>0&&n.every(t=>t.pointUnitType==="チーム")},bl=e=>{var c,r;const n=[];e.playCategoryId?n.push(((c=b.find(d=>d.id===e.playCategoryId))==null?void 0:c.name)||""):e.playCategoryTags&&e.playCategoryTags.length>0&&n.push(e.playCategoryTags.join(",")),e.playDetailId?n.push(((r=y.find(d=>d.id===e.playDetailId))==null?void 0:r.name)||""):e.playDetailTags&&e.playDetailTags.length>0&&n.push(e.playDetailTags.join(","));const t=[e.pointType,e.pointUnitType].filter(Boolean).join(",");return t&&n.push(t),n.length>0?`${n.join(" / ")} (${e.method})`:`(${e.method})`},yl=a.useMemo(()=>gl.flatMap(e=>(x[e]||[]).filter(n=>n.visible!==!1).map(n=>({teamId:e,member:n}))),[gl,x]),vl=a.useMemo(()=>{if(!o)return"";const e=[],n=o.left==="ALL"?"全チーム":Ne(o.left);e.push(`分析対象チーム：${n}`),o.left!=="ALL"&&o.right&&o.right!==""&&e.push(`対戦相手チーム：${Ne(o.right)}`),o.date&&e.push(`試合日付：${o.date}`),o.name&&e.push(`試合名：${o.name}`),o.matchResult==="win"?e.push("勝ち試合"):o.matchResult==="lose"&&e.push("負け試合"),o.setResult==="win"?e.push("勝ちセット"):o.setResult==="lose"&&e.push("負けセット");const t=e.join("、");return o.tags.length>0?l.jsxs(l.Fragment,{children:[t,"、タグ：",o.tags.map(c=>{const r=m.find(h=>h.id===c),d=(r==null?void 0:r.color)||oe;return l.jsx(ce,{label:(r==null?void 0:r.name)||c,size:"small",sx:{ml:.5,backgroundColor:d,color:"#fff"}},c)})]}):t},[o,m,Ne]),ke=a.useMemo(()=>{const e=new Map;return f.forEach(n=>{n.items.forEach(t=>{Se(t).length>0&&e.set(t.id,t)})}),e},[f,Se]),ee=a.useMemo(()=>H?H.items.filter(e=>ke.has(e.id)):[],[H,ke]),Pl=a.useMemo(()=>{const e=[...yl];return e.sort((n,t)=>{var d,h,M,k;let c="",r="";if(I==="member")c=n.member.name,r=t.member.name;else if(ke.has(I)){const w=ke.get(I);c=ie(n.teamId,n.member.id,w),r=ie(t.teamId,t.member.id,w)}else c=((h=(d=Z[n.teamId])==null?void 0:d[n.member.id])==null?void 0:h[I])||0,r=((k=(M=Z[t.teamId])==null?void 0:M[t.member.id])==null?void 0:k[I])||0;return c<r?W==="asc"?-1:1:c>r?W==="asc"?1:-1:0}),e},[yl,I,W,Z,ke,ie]),le=a.useMemo(()=>{var c;if($==="ALL")return null;if(P&&H){const r={};return ee.forEach(h=>{r[h.id]=0}),(x[$]||[]).filter(h=>h.visible!==!1).forEach(h=>{ee.forEach(M=>{r[M.id]+=ie($,h.id,M)})}),ee.forEach(h=>{r[h.id]+=ie($,he,h)}),r}const e={};(x[$]||[]).filter(r=>r.visible!==!1).forEach(r=>{var h;const d=((h=Z[$])==null?void 0:h[r.id])||{};Object.entries(d).forEach(([M,k])=>{e[M]=(e[M]||0)+k})});const t=((c=Z[$])==null?void 0:c[he])||{};return Object.entries(t).forEach(([r,d])=>{e[r]=(e[r]||0)+d}),e},[$,x,Z,P,H,ee,ie]),qe=e=>{I===e?be(W==="asc"?"desc":"asc"):(pe(e),be("asc"))},Cl=(e,n,t)=>{var c;if(P&&H){let r=[];n===he&&e===$&&le?r=ee.map(d=>({label:bl(d),value:le[d.id]||0})):r=ee.map(d=>({label:bl(d),value:ie(e,n,d)})),Re(t),s(H.name),Ce(r),ve(!0)}else if(Te){let r={};n===he&&e===$&&le?r=le:r=((c=Z[e])==null?void 0:c[n])||{};const d=me.map(h=>({label:h.name,value:r[h.id]||0}));Re(t),s(Te.name),Ce(d),ve(!0)}},Fl=l.jsxs(bn,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},sx:{display:"flex",flexDirection:"column",flexGrow:1},children:[P&&l.jsxs(L,{sx:{display:"flex",justifyContent:"flex-end",mb:1,gap:1},children:[l.jsx(F,{variant:"contained",size:"small",onClick:()=>{xe(Ge),J(!0)},startIcon:l.jsx(Ol,{}),children:"編集"}),l.jsx(F,{variant:"contained",size:"small",color:"error",onClick:()=>ue(!0),startIcon:l.jsx(Ml,{}),children:"削除"})]}),l.jsx(_l,{component:Rl,storageKey:"analysis-list",sx:{flexGrow:1},children:l.jsxs(wl,{size:"small",sx:{"& th, & td":{textAlign:"center",verticalAlign:"middle"},"& .MuiTableRow-root":{height:50}},children:[l.jsx(Ll,{children:l.jsxs(_e,{sx:{backgroundColor:e=>e.palette.mode==="dark"?"#343A42":"#f5f5f5"},children:[l.jsx(v,{align:"center",sortDirection:I==="member"?W:!1,children:l.jsx(Ke,{active:I==="member",direction:I==="member"?W:"asc",onClick:()=>qe("member"),children:"メンバー"})}),P&&H?ee.map(e=>{var d,h,M;const n=e.playCategoryId&&((d=b.find(k=>k.id===e.playCategoryId))==null?void 0:d.name)||"",t=e.playDetailId&&((h=y.find(k=>k.id===e.playDetailId))==null?void 0:h.name)||"",c=e.playDetailId?(M=y.find(k=>k.id===e.playDetailId))==null?void 0:M.pointType:void 0,r=[e.pointType,e.pointUnitType].filter(Boolean).join(",");return l.jsx(v,{align:"center",sortDirection:I===e.id?W:!1,children:l.jsx(Ke,{active:I===e.id,direction:I===e.id?W:"asc",onClick:()=>qe(e.id),children:l.jsxs(L,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.playCategoryTags&&e.playCategoryTags.length>0?l.jsx(L,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center"},children:e.playCategoryTags.map(k=>{const w=p.find(Ve=>Ve.id===k),He=(w==null?void 0:w.color)||oe;return l.jsx(ce,{label:(w==null?void 0:w.name)||k,size:"small",sx:{mr:.5,mb:.5,backgroundColor:He,color:"#fff"}},k)})}):n&&l.jsx("span",{children:n}),e.playDetailTags&&e.playDetailTags.length>0?l.jsx(L,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center"},children:e.playDetailTags.map(k=>{const w=D.find(Ve=>Ve.id===k),He=(w==null?void 0:w.color)||oe;return l.jsx(ce,{label:(w==null?void 0:w.name)||k,size:"small",sx:{mr:.5,mb:.5,backgroundColor:He,color:"#fff"}},k)})}):t&&l.jsx(L,{component:"span",sx:{color:c==="得点"?j.scoreColor:c==="失点"?j.lossColor:void 0},children:t}),r&&l.jsx("span",{children:r}),l.jsxs("span",{children:["(",e.method,")"]})]})})},e.id)}):me.map(e=>l.jsx(v,{align:"center",sortDirection:I===e.id?W:!1,sx:{color:e.pointType==="得点"?j.scoreColor:e.pointType==="失点"?j.lossColor:"inherit"},children:l.jsx(Ke,{active:I===e.id,direction:I===e.id?W:"asc",onClick:()=>qe(e.id),children:e.name})},e.id))]})}),l.jsxs(Al,{children:[$!=="ALL"&&l.jsxs(_e,{children:[l.jsx(v,{align:"center",children:l.jsx(Il,{component:"button",underline:"hover",onClick:()=>Cl($,he,"チーム集計"),children:"チーム集計"})}),P&&H?ee.map(e=>l.jsx(v,{align:"center",children:(le==null?void 0:le[e.id])||0},e.id)):me.map(e=>l.jsx(v,{align:"center",children:(le==null?void 0:le[e.id])||0},e.id))]}),(P&&H?ee.some(e=>!jl(e)):!$l)&&Pl.map(({teamId:e,member:n})=>l.jsxs(_e,{children:[l.jsx(v,{align:"center",children:l.jsx(Il,{component:"button",underline:"hover",onClick:()=>Cl(e,n.id,n.name),children:n.name})}),P&&H?ee.map(t=>l.jsx(v,{align:"center",children:jl(t)?"－":ie(e,n.id,t)},t.id)):me.map(t=>{var c,r;return l.jsx(v,{align:"center",children:t.pointUnitType==="チーム"?"－":((r=(c=Z[e])==null?void 0:c[n.id])==null?void 0:r[t.id])||0},t.id)})]},`${e}-${n.id}`))]})]})})]},U);return l.jsxs(L,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[Y?l.jsxs(l.Fragment,{children:[l.jsx(L,{sx:{display:"flex",gap:2,mb:1,alignItems:"center"},children:o?l.jsx(L,{sx:{flexGrow:1,display:"flex",alignItems:"center",flexWrap:"wrap"},children:vl}):l.jsxs(l.Fragment,{children:[l.jsxs(V,{sx:{flex:1},children:[l.jsx(K,{id:"left-team-label",children:"分析チーム"}),l.jsx(Q,{labelId:"left-team-label",value:T,label:"分析チーム",onChange:e=>{const n=e.target.value;E(n)},children:u.map(e=>l.jsx(C,{value:e.id,children:e.name},e.id))})]}),l.jsxs(V,{sx:{flex:1},children:[l.jsx(K,{id:"right-team-label",children:"対戦相手"}),l.jsxs(Q,{labelId:"right-team-label",value:O,label:"対戦相手",onChange:e=>S(e.target.value),children:[l.jsx(C,{value:"",children:"指定なし"}),u.map(e=>l.jsx(C,{value:e.id,children:e.name},e.id))]})]})]})}),l.jsxs(L,{sx:{display:"flex",gap:1,mb:2},children:[l.jsx(F,{variant:"contained",size:"small",onClick:()=>ne(!0),sx:{flex:1},startIcon:l.jsx(Ae,{}),children:"詳細検索"}),l.jsx(F,{variant:"contained",size:"small",onClick:()=>{o&&te(null),E(z),S("")},sx:{flex:1},startIcon:l.jsx(el,{}),children:"クリア"})]})]}):l.jsxs(L,{sx:{display:"flex",gap:2,mb:2,alignItems:"center"},children:[o?l.jsx(L,{sx:{flexGrow:1,display:"flex",alignItems:"center",flexWrap:"wrap"},children:vl}):l.jsxs(l.Fragment,{children:[l.jsxs(V,{sx:{minWidth:160},children:[l.jsx(K,{id:"left-team-label",children:"分析チーム"}),l.jsx(Q,{labelId:"left-team-label",value:T,label:"分析チーム",onChange:e=>{const n=e.target.value;E(n)},children:u.map(e=>l.jsx(C,{value:e.id,children:e.name},e.id))})]}),l.jsxs(V,{sx:{minWidth:160},children:[l.jsx(K,{id:"right-team-label",children:"対戦相手"}),l.jsxs(Q,{labelId:"right-team-label",value:O,label:"対戦相手",onChange:e=>S(e.target.value),children:[l.jsx(C,{value:"",children:"指定なし"}),u.map(e=>l.jsx(C,{value:e.id,children:e.name},e.id))]})]})]}),l.jsxs(L,{sx:{display:"flex",gap:1,ml:"auto"},children:[l.jsx(F,{variant:"contained",size:"small",onClick:()=>ne(!0),startIcon:l.jsx(Ae,{}),children:"詳細検索"}),l.jsx(F,{variant:"contained",size:"small",onClick:()=>{o&&te(null),E(z),S("")},startIcon:l.jsx(el,{}),children:"クリア"})]})]}),l.jsxs(L,{sx:{display:"flex",alignItems:"center",mb:2},children:[l.jsx(Kl,{ref:i,value:U,onChange:(e,n)=>{n===Ie.length-1?(xe(null),J(!0)):N(n)},variant:"scrollable",scrollButtons:"auto",allowScrollButtonsMobile:!0,sx:{flexGrow:1},children:Ie.map(e=>l.jsx(Ql,{label:e.label},e.key))}),g.length>0&&l.jsxs(l.Fragment,{children:[l.jsx(zl,{onClick:Ul,size:"small",children:l.jsx(Bl,{})}),l.jsx(Jl,{anchorEl:se,open:!!se,onClose:ml,children:g.map(e=>l.jsx(C,{onClick:()=>Wl(e.index),children:e.label},e.index))})]})]}),l.jsx(sn,{mode:"wait",children:Fl}),l.jsxs(kl,{open:ye,onClose:()=>ne(!1),children:[l.jsx(Je,{children:"詳細検索"}),l.jsxs(Xe,{sx:{display:"flex",flexDirection:"column",gap:2},children:[l.jsxs(L,{sx:{display:"flex",gap:2},children:[l.jsxs(V,{fullWidth:!0,sx:{flex:1,mt:3},children:[l.jsx(K,{id:"dlg-left",children:"分析チーム"}),l.jsx(Q,{labelId:"dlg-left",value:R,label:"分析チーム",onChange:e=>{const n=e.target.value;B(n)},children:u.map(e=>l.jsx(C,{value:e.id,children:e.name},e.id))})]}),l.jsxs(V,{fullWidth:!0,sx:{flex:1,mt:3},children:[l.jsx(K,{id:"dlg-right",children:"対戦相手"}),l.jsxs(Q,{labelId:"dlg-right",value:fe,label:"対戦相手",onChange:e=>ge(e.target.value),children:[l.jsx(C,{value:"",children:"指定なし"}),u.map(e=>l.jsx(C,{value:e.id,children:e.name},e.id))]})]})]}),l.jsxs(L,{sx:{display:"flex",gap:2},children:[l.jsx(je,{type:"date",label:"試合日付",margin:"dense",value:al,onChange:e=>rl(e.target.value),InputLabelProps:{shrink:!0},fullWidth:!0,sx:{flex:1,"& .MuiOutlinedInput-root":{height:56},"& .MuiOutlinedInput-input":{padding:"0 14px",height:"100%",lineHeight:"56px",fontSize:"1rem",textAlign:"left"},'& input[type="date"]':{WebkitAppearance:"none"}}}),l.jsx(je,{label:"試合名",margin:"dense",value:il,onChange:e=>ol(e.target.value),fullWidth:!0,sx:{flex:1}})]}),l.jsxs(L,{sx:{display:"flex",gap:2,flexDirection:"column"},children:[l.jsxs(Dl,{exclusive:!0,value:cl,onChange:(e,n)=>dl(n),fullWidth:!0,sx:{width:"100%"},children:[l.jsx(Le,{value:"win",sx:{whiteSpace:"nowrap"},children:"勝ち試合"}),l.jsx(Le,{value:"lose",sx:{whiteSpace:"nowrap"},children:"負け試合"})]}),l.jsxs(Dl,{exclusive:!0,value:ul,onChange:(e,n)=>fl(n),fullWidth:!0,sx:{width:"100%"},children:[l.jsx(Le,{value:"win",sx:{whiteSpace:"nowrap"},children:"勝ちセット"}),l.jsx(Le,{value:"lose",sx:{whiteSpace:"nowrap"},children:"負けセット"})]})]}),l.jsx(L,{sx:{display:"flex",gap:2},children:l.jsx(Ye,{multiple:!0,options:m,getOptionLabel:e=>e.name,value:m.filter(e=>hl.includes(e.id)),onChange:(e,n)=>pl(n.map(t=>t.id)),renderTags:(e,n)=>e.map((t,c)=>l.jsx(ce,{...n({index:c}),label:t.name,size:"small",sx:{backgroundColor:t.color||oe,color:"#fff"}})),renderInput:e=>l.jsx(je,{...e,label:"タグ",margin:"dense"}),fullWidth:!0})})]}),l.jsxs(Ze,{children:[l.jsx(F,{onClick:()=>ne(!1),color:"inherit",startIcon:l.jsx(Qe,{}),children:"キャンセル"}),l.jsx(F,{onClick:()=>{te({left:R,right:fe,date:al,name:il,tags:hl,matchResult:cl||void 0,setResult:ul||void 0}),E(R),S(fe),ne(!1)},startIcon:l.jsx(Ae,{}),children:"検索"})]})]}),l.jsxs(Xl,{open:Ee,onClose:()=>ue(!1),children:[l.jsx(Je,{children:"削除確認"}),l.jsx(Xe,{sx:{mt:2},children:"このカスタム分析を削除しますか？"}),l.jsxs(Ze,{children:[l.jsx(F,{onClick:()=>ue(!1),color:"inherit",startIcon:l.jsx(Qe,{}),children:"キャンセル"}),l.jsx(F,{onClick:()=>{const e=Ge,n=f[e];_(f.filter((t,c)=>c!==e)),N(0),ue(!1),G("カスタム分析を削除しました","success",{actionLabel:"元に戻す",onAction:()=>{_(t=>{const c=[...t];return c.splice(e,0,n),c}),N(re.length+e)},autoHideDuration:5e3})},color:"error",startIcon:l.jsx(El,{}),children:"OK"})]})]}),l.jsx(tn,{open:Me,playCategories:b,playDetails:y,rallyCategoryTags:p,rallyDetailTags:D,initialData:ae!==null?f[ae]:void 0,onCancel:()=>J(!1),onSave:e=>{ae!==null?(_(f.map((n,t)=>t===ae?e:n)),N(re.length+ae)):(_([...f,e]),N(re.length+f.length)),J(!1)}}),l.jsx(a.Suspense,{fallback:null,children:l.jsx(jn,{open:Oe,onClose:()=>ve(!1),memberName:$e,tabName:We,data:Ue})})]})}export{Mn as default};
