const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/GraphDialog-B8TosO0i.js","assets/mui-vendor-0BmcROP4.js","assets/react-vendor-QLNaZ7XN.js","assets/index-DW43Q9OP.js","assets/motion-vendor-CtLLg_49.js","assets/index-DqrEpDIH.css","assets/chart-vendor-BtE8BaVf.js"])))=>i.map(i=>d[i]);
import{R as wn,D as re,a as Sn,S as kn,d as _n,b as Ve,c as Mn,A as Fn,r as nn,i as Gn,_ as Nn}from"./index-DW43Q9OP.js";import{j as e,n as Qe,o as Xe,U as Ie,F as fe,Q as he,S as pe,M as O,R as Ye,C as ie,q as se,A as Hn,f as Rn,g as Ln,h as En,k as Me,l as v,m as An,a9 as qn,B as U,I as Je,p as Ze,i as sn,a as Kn,b as Vn,G as Tn,aa as Ke,L as In,X as Qn,Y as Xn,$ as Yn,a0 as Jn,a1 as Zn,d as Dn,e as $e,D as es}from"./mui-vendor-0BmcROP4.js";import{r as l}from"./react-vendor-QLNaZ7XN.js";import{D as ns,C as ss,P as ts,d as ls}from"./DragIndicator-BB1EOart.js";import{d as as}from"./SpaceDashboardOutlined-DSdjNSwP.js";import{m as rs,A as is}from"./motion-vendor-CtLLg_49.js";import"./chart-vendor-BtE8BaVf.js";function os({open:S,playCategories:u,playDetails:g,rallyCategoryTags:y,rallyDetailTags:b,initialData:c,onCancel:D,onSave:m}){const[h,T]=l.useState(""),[j,X]=l.useState(""),[H,P]=l.useState([]),[I,B]=l.useState([]),[k,W]=l.useState(""),[C,ge]=l.useState(""),[R,oe]=l.useState(""),[o,me]=l.useState("合算"),[Y,J]=l.useState([]),[te,de]=l.useState({open:!1,message:"",severity:"success"}),ce=()=>{de(s=>({...s,open:!1}))},Re=s=>{if(!s.destination)return;const r=Array.from(Y),[x]=r.splice(s.source.index,1);r.splice(s.destination.index,0,x),J(r)};l.useEffect(()=>{S&&(T((c==null?void 0:c.name)||""),J((c==null?void 0:c.items)||[]),X(""),P([]),B([]),W(""),ge(""),oe(""),me("合算"))},[S,c]);const De=j!=="",ue=H.length>0,je=k!=="",ye=I.length>0,Le=C!=="",we=R!=="",Ee=De?ue||ye?!1:je?!Le&&!we:!0:ue||ye?!(De||je):je?!1:!!(Le||we),Ae=()=>{if(!o||!Ee)return;const s={id:crypto.randomUUID(),method:o};j?s.playCategoryId=j:H.length>0&&(s.playCategoryTags=H),k&&(s.playDetailId=k),I.length>0&&(s.playDetailTags=I),C&&(s.pointType=C),R&&(s.pointUnitType=R),J(r=>[...r,s]),X(""),P([]),W(""),B([]),ge(""),oe("")},Ue=s=>{J(r=>{const x=r.findIndex(F=>F.id===s);if(x===-1)return r;const _=[...r],[Q]=_.splice(x,1);return de({open:!0,message:"項目を削除しました",severity:"success",actionLabel:"元に戻す",onAction:()=>{J(F=>{const L=[...F];return L.splice(x,0,Q),L})},autoHideDuration:5e3}),_})},Oe=()=>{if(!h||Y.length===0)return;const s={id:(c==null?void 0:c.id)||crypto.randomUUID(),name:h,items:Y};m(s)},z=j?g.filter(s=>s.playCategoryId===j&&s.visible!==!1):[],q=s=>g.filter(r=>{var _,Q;const x=u.find(F=>F.id===r.playCategoryId);return!(r.visible===!1||(x==null?void 0:x.visible)===!1||s.playCategoryId&&r.playCategoryId!==s.playCategoryId||s.playCategoryTags&&s.playCategoryTags.length>0&&!((_=x==null?void 0:x.tags)!=null&&_.some(F=>{var L;return(L=s.playCategoryTags)==null?void 0:L.includes(F)}))||s.playDetailId&&r.id!==s.playDetailId||s.playDetailTags&&s.playDetailTags.length>0&&!((Q=r.tags)!=null&&Q.some(F=>{var L;return(L=s.playDetailTags)==null?void 0:L.includes(F)}))||s.pointType&&r.pointType!==s.pointType||s.pointUnitType&&r.pointUnitType!==s.pointUnitType)}),K=s=>q(s).length===0,be=Y.some(K);return e.jsxs(e.Fragment,{children:[e.jsxs(wn,{open:S,onClose:D,children:[e.jsx(Qe,{children:"カスタム分析追加"}),e.jsxs(Xe,{children:[e.jsx(Ie,{label:"カスタム分析名",margin:"dense",value:h,onChange:s=>T(s.target.value),fullWidth:!0}),e.jsxs(fe,{fullWidth:!0,margin:"dense",disabled:H.length>0||I.length>0,children:[e.jsx(he,{id:"category",children:"プレー区分"}),e.jsxs(pe,{labelId:"category",value:j,label:"プレー区分",onChange:s=>{const r=s.target.value;X(r),W(""),B([]),r&&P([])},children:[e.jsx(O,{value:"",children:"指定なし"}),u.filter(s=>s.visible!==!1).map(s=>e.jsx(O,{value:s.id,children:s.name},s.id))]})]}),e.jsxs(fe,{fullWidth:!0,margin:"dense",disabled:!!C||!!R||H.length>0||I.length>0,children:[e.jsx(he,{id:"detail",children:"プレー詳細"}),e.jsxs(pe,{labelId:"detail",value:k,label:"プレー詳細",onChange:s=>{W(s.target.value),s.target.value&&(ge(""),oe(""),P([]),B([]))},children:[e.jsx(O,{value:"",children:"指定なし"}),z.map(s=>e.jsx(O,{value:s.id,children:s.name},s.id))]})]}),e.jsx(Ye,{multiple:!0,options:y,getOptionLabel:s=>s.name,value:y.filter(s=>H.includes(s.id)),onChange:(s,r)=>{P(r.map(x=>x.id)),r.length>0&&(X(""),W(""))},renderTags:(s,r)=>s.map((x,_)=>l.createElement(ie,{...r({index:_}),key:x.id,label:x.name,size:"small",sx:{backgroundColor:x.color||re,color:"#fff"}})),renderInput:s=>e.jsx(Ie,{...s,label:"プレー区分タグ",margin:"dense"}),disabled:!!j||!!k,fullWidth:!0}),e.jsx(Ye,{multiple:!0,options:b,getOptionLabel:s=>s.name,value:b.filter(s=>I.includes(s.id)),onChange:(s,r)=>{B(r.map(x=>x.id)),r.length>0&&(X(""),W(""))},renderTags:(s,r)=>s.map((x,_)=>l.createElement(ie,{...r({index:_}),key:x.id,label:x.name,size:"small",sx:{backgroundColor:x.color||re,color:"#fff"}})),renderInput:s=>e.jsx(Ie,{...s,label:"プレー詳細タグ",margin:"dense"}),disabled:!!j||!!k,fullWidth:!0}),e.jsxs(fe,{fullWidth:!0,disabled:!!k,margin:"dense",children:[e.jsx(he,{id:"ptype",children:"得失点区分"}),e.jsxs(pe,{labelId:"ptype",value:C,label:"得失点区分",onChange:s=>{ge(s.target.value),s.target.value&&W("")},children:[e.jsx(O,{value:"",children:"指定なし"}),e.jsx(O,{value:"得点",children:"得点"}),e.jsx(O,{value:"失点",children:"失点"})]})]}),e.jsxs(fe,{fullWidth:!0,disabled:!!k,margin:"dense",children:[e.jsx(he,{id:"punittype",children:"得失点単位区分"}),e.jsxs(pe,{labelId:"punittype",value:R,label:"得失点単位区分",onChange:s=>{oe(s.target.value),s.target.value&&W("")},children:[e.jsx(O,{value:"",children:"指定なし"}),e.jsx(O,{value:"メンバー",children:"メンバー"}),e.jsx(O,{value:"チーム",children:"チーム"})]})]}),e.jsxs(fe,{fullWidth:!0,margin:"dense",children:[e.jsx(he,{id:"method",children:"集計方法"}),e.jsxs(pe,{labelId:"method",value:o,label:"集計方法",onChange:s=>me(s.target.value),children:[e.jsx(O,{value:"合算",children:"合算"}),e.jsx(O,{value:"試合平均",children:"試合平均"}),e.jsx(O,{value:"セット平均",children:"セット平均"})]})]}),e.jsx(se,{variant:"contained",onClick:Ae,size:"medium",disabled:!Ee,fullWidth:!0,startIcon:e.jsx(Sn,{}),sx:{mt:1},children:"追加"}),Y.length>0&&e.jsxs(e.Fragment,{children:[be&&e.jsx(Hn,{severity:"error",sx:{mb:1},children:"分析条件に合致するプレー区分、または、プレー詳細が存在しません（赤背景行）"}),e.jsx(kn,{component:Rn,storageKey:"custom-analysis-dialog",children:e.jsxs(Ln,{size:"small",sx:{"& .MuiTableRow-root":{height:50}},children:[e.jsx(En,{children:e.jsxs(Me,{sx:{backgroundColor:s=>s.palette.mode==="dark"?"#343A42":"#f5f5f5"},children:[e.jsx(v,{}),e.jsx(v,{children:"プレー区分"}),e.jsx(v,{children:"プレー詳細"}),e.jsx(v,{children:"得失点区分"}),e.jsx(v,{children:"得失点単位区分"}),e.jsx(v,{children:"集計方法"}),e.jsx(v,{})]})}),e.jsx(ns,{onDragEnd:Re,children:e.jsx(ss,{droppableId:"custom-analysis-items",children:s=>e.jsxs(An,{ref:s.innerRef,...s.droppableProps,children:[Y.map((r,x)=>{const _=K(r);return e.jsx(ts,{draggableId:r.id,index:x,children:Q=>{var F,L;return e.jsxs(Me,{ref:Q.innerRef,...Q.draggableProps,sx:{backgroundColor:_?M=>qn(M.palette.error.main,.1):void 0},children:[e.jsx(v,{padding:"checkbox",children:e.jsx(U,{...Q.dragHandleProps,sx:{cursor:"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:e.jsx(ls,{fontSize:"small"})})}),e.jsx(v,{children:r.playCategoryTags&&r.playCategoryTags.length>0?r.playCategoryTags.map(M=>{const E=y.find(Ce=>Ce.id===M),ve=(E==null?void 0:E.color)||re;return e.jsx(ie,{label:(E==null?void 0:E.name)||M,size:"small",sx:{mr:.5,mb:.5,backgroundColor:ve,color:"#fff"}},M)}):(F=u.find(M=>M.id===r.playCategoryId))==null?void 0:F.name}),e.jsx(v,{children:r.playDetailTags&&r.playDetailTags.length>0?r.playDetailTags.map(M=>{const E=b.find(Ce=>Ce.id===M),ve=(E==null?void 0:E.color)||re;return e.jsx(ie,{label:(E==null?void 0:E.name)||M,size:"small",sx:{mr:.5,mb:.5,backgroundColor:ve,color:"#fff"}},M)}):r.playDetailId?(L=g.find(M=>M.id===r.playDetailId))==null?void 0:L.name:""}),e.jsx(v,{children:r.pointType||""}),e.jsx(v,{children:r.pointUnitType||""}),e.jsx(v,{children:r.method}),e.jsx(v,{children:e.jsx(Je,{size:"small",onClick:()=>Ue(r.id),children:e.jsx(_n,{fontSize:"small",color:"error"})})})]})}},r.id)}),s.placeholder]})})})]})})]})]}),e.jsxs(Ze,{children:[e.jsx(se,{onClick:D,startIcon:e.jsx(Ve,{}),color:"inherit",children:"キャンセル"}),e.jsx(se,{onClick:Oe,disabled:!h||Y.length===0,startIcon:e.jsx(Mn,{}),children:"OK"})]})]}),e.jsx(Fn,{open:te.open,message:te.message,severity:te.severity,actionLabel:te.actionLabel,onAction:te.onAction,autoHideDuration:te.autoHideDuration,onClose:ce})]})}var tn={},ds=sn;Object.defineProperty(tn,"__esModule",{value:!0});var en=tn.default=void 0,cs=ds(nn()),us=e;en=tn.default=(0,cs.default)((0,us.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search");var ln={},fs=sn;Object.defineProperty(ln,"__esModule",{value:!0});var On=ln.default=void 0,hs=fs(nn()),ps=e;On=ln.default=(0,hs.default)((0,ps.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit");var an={},xs=sn;Object.defineProperty(an,"__esModule",{value:!0});var zn=an.default=void 0,gs=xs(nn()),ms=e;zn=an.default=(0,gs.default)((0,ms.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Clear");const js=l.lazy(()=>Nn(()=>import("./GraphDialog-B8TosO0i.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),xe="__TEAM__",ys=rs.create(U);function bs(S,u){let g=0,y=0,b=0,c=0;return S.sets.forEach(D=>{const m=u==="teamA"?D.my:D.opponent,h=u==="teamA"?D.opponent:D.my;b+=m,c+=h,m>h?g+=1:m<h&&(y+=1)}),g>y?"win":g<y?"lose":b>c?"win":b<c?"lose":"draw"}function vs(S,u,g,y,b,c,D){return S.filter(m=>{if(u!=="ALL"){if(!(m.teamA===u||m.teamB===u)||g&&!(m.teamA===u&&m.teamB===g||m.teamA===g&&m.teamB===u))return!1;if(c){const T=m.teamA===u?"teamA":"teamB";if(bs(m,T)!==c)return!1}}else if(g&&m.teamA!==g&&m.teamB!==g)return!1;return!(y&&m.date!==y||b&&!m.matchName.includes(b)||D&&D.length>0&&!D.every(h=>m.tags.includes(h)))})}function Cs(S,u){const g=u==="teamA"?S.my:S.opponent,y=u==="teamA"?S.opponent:S.my;return g>y?"win":g<y?"lose":"draw"}function Ts(S,u,g,y,b){const c={},D=(h,T,j)=>{c[h]||(c[h]={}),c[h][T]||(c[h][T]={}),c[h][T][j]=(c[h][T][j]||0)+1},m=(h,T)=>!!T&&(y[h]||[]).some(j=>j.id===T&&j.visible!==!1);return S.forEach(h=>{const T=(j,X)=>{h.sets.forEach(H=>{b&&Cs(H,X)!==b||H.rallies.forEach(P=>{const I=X==="teamA"?P.teamAPlayDetail:P.teamBPlayDetail,B=X==="teamA"?P.teamAMember:P.teamBMember;if(!I)return;const k=g.get(I);(k==null?void 0:k.pointUnitType)==="チーム"?D(j,xe,I):(k==null?void 0:k.pointUnitType)==="メンバー"&&(m(j,B)?D(j,B,I):D(j,xe,I))})})};u==="ALL"?(h.teamA&&T(h.teamA,"teamA"),h.teamB&&T(h.teamB,"teamB")):h.teamA===u?T(u,"teamA"):h.teamB===u&&T(u,"teamB")}),c}function Rs({matches:S,teams:u,teamMembers:g,playCategories:y,playDetails:b,customAnalyses:c,onCustomAnalysesChange:D,tags:m,rallyCategoryTags:h,rallyDetailTags:T,themeSetting:j,showSnackbar:X,setAppBarAction:H,setAppBarLeftAction:P}){var Cn;const I=((Cn=u[0])==null?void 0:Cn.id)||"",[B,k]=l.useState(0),W=n=>{k(n)},[C,ge]=l.useState("member"),[R,oe]=l.useState("asc"),[o,me]=l.useState({left:I,right:"",date:"",name:"",tags:[]}),[Y,J]=l.useState(!1),[te,de]=l.useState(!1),[ce,Re]=l.useState(null),[De,ue]=l.useState(!1),[je,ye]=l.useState(!1),[Le,we]=l.useState(""),[Ee,Ae]=l.useState([]),[Ue,Oe]=l.useState(""),z=Kn(),q=Vn(z.breakpoints.up("sm")),[K,be]=l.useState(!1),[s,r]=l.useState(!1),x=56,_=200,Q=l.useCallback(()=>{K?(r(!1),be(!1)):(be(!0),q||r(!0))},[K,q]),F=l.useCallback(n=>{n.target===n.currentTarget&&(K?r(!0):(be(!1),r(!1)))},[K]),[L,M]=l.useState(u.length>0?u[0].id:""),[E,ve]=l.useState(""),[Ce,rn]=l.useState(""),[on,dn]=l.useState(""),[cn,un]=l.useState(""),[fn,hn]=l.useState(""),[pn,xn]=l.useState([]),gn=l.useMemo(()=>new Map(b.map(n=>[n.id,n])),[b]),$n=l.useCallback(()=>{me({left:I,right:"",date:"",name:"",tags:[],matchResult:void 0,setResult:void 0})},[I]);l.useEffect(()=>{!o.left&&I&&me(n=>({...n,left:I})),!L&&I&&M(I)},[I,o.left,L]),l.useEffect(()=>{Y&&(M(o.left),ve(o.right),rn(o.date),dn(o.name),un(o.matchResult||""),hn(o.setResult||""),xn(o.tags))},[Y,o]),l.useEffect(()=>(H(e.jsx(se,{color:"inherit",startIcon:e.jsx(en,{}),onClick:()=>J(!0),children:"詳細検索"})),()=>H(null)),[H]),l.useEffect(()=>(P(e.jsx(Je,{color:"inherit",onClick:Q,children:e.jsx(as,{})})),()=>P(null)),[P,Q]);const ze=l.useMemo(()=>vs(S,o.left,o.right,o.date,o.name,o.matchResult,o.tags),[S,o]),Z=l.useMemo(()=>{const n=o.setResult;return Ts(ze,o.left,gn,g,n)},[ze,o,gn,g]),Pe=ze.length,Be=ze.reduce((n,t)=>n+t.sets.length,0),$=o.left,mn=l.useMemo(()=>$==="ALL"?u.map(n=>n.id):[$],[$,u]),le=l.useMemo(()=>y.filter(n=>n.visible!==!1),[y]),V=B>=le.length,We=V?B-le.length:-1,G=V?c[We]:null,Se=V?void 0:le[B],Te=V?[]:b.filter(n=>n.playCategoryId===(Se==null?void 0:Se.id)&&n.visible!==!1),Un=!V&&Te.length>0&&Te.every(n=>n.pointUnitType==="チーム"),Fe=l.useMemo(()=>[...le.map(n=>({key:n.id,label:n.name})),...c.map(n=>({key:n.id,label:n.name})),{key:"add",label:"分析追加"}],[le,c]),Ge=l.useCallback(n=>{var t;return((t=u.find(a=>a.id===n))==null?void 0:t.name)||""},[u]),ke=l.useCallback(n=>b.filter(t=>{var d,i;const a=y.find(f=>f.id===t.playCategoryId);return!(t.visible===!1||(a==null?void 0:a.visible)===!1||n.playCategoryId&&t.playCategoryId!==n.playCategoryId||n.playCategoryTags&&n.playCategoryTags.length>0&&!((d=a==null?void 0:a.tags)!=null&&d.some(f=>{var p;return(p=n.playCategoryTags)==null?void 0:p.includes(f)}))||n.playDetailId&&t.id!==n.playDetailId||n.playDetailTags&&n.playDetailTags.length>0&&!((i=t.tags)!=null&&i.some(f=>{var p;return(p=n.playDetailTags)==null?void 0:p.includes(f)}))||n.pointType&&t.pointType!==n.pointType||n.pointUnitType&&t.pointUnitType!==n.pointUnitType)}),[b,y]),ae=l.useCallback((n,t,a)=>{let d=0;return ke(a).forEach(f=>{var p,N;d+=((N=(p=Z[n])==null?void 0:p[t])==null?void 0:N[f.id])||0}),a.method==="試合平均"?d=Pe?d/Pe:0:a.method==="セット平均"&&(d=Be?d/Be:0),d},[Z,Pe,Be,ke]),jn=n=>{const t=ke(n);return t.length>0&&t.every(a=>a.pointUnitType==="チーム")},yn=n=>{var d,i;const t=[];n.playCategoryId?t.push(((d=y.find(f=>f.id===n.playCategoryId))==null?void 0:d.name)||""):n.playCategoryTags&&n.playCategoryTags.length>0&&t.push(n.playCategoryTags.join(",")),n.playDetailId?t.push(((i=b.find(f=>f.id===n.playDetailId))==null?void 0:i.name)||""):n.playDetailTags&&n.playDetailTags.length>0&&t.push(n.playDetailTags.join(","));const a=[n.pointType,n.pointUnitType].filter(Boolean).join(",");return a&&t.push(a),t.length>0?`${t.join(" / ")} (${n.method})`:`(${n.method})`},bn=l.useMemo(()=>mn.flatMap(n=>(g[n]||[]).filter(t=>t.visible!==!1).map(t=>({teamId:n,member:t}))),[mn,g]),Pn=l.useMemo(()=>{const n=[],t=o.left==="ALL"?"全チーム":Ge(o.left);n.push(`分析対象チーム：${t}`),o.left!=="ALL"&&o.right&&o.right!==""&&n.push(`対戦相手チーム：${Ge(o.right)}`),o.date&&n.push(`試合日付：${o.date}`),o.name&&n.push(`試合名：${o.name}`),o.matchResult==="win"?n.push("勝ち試合"):o.matchResult==="lose"&&n.push("負け試合"),o.setResult==="win"?n.push("勝ちセット"):o.setResult==="lose"&&n.push("負けセット");const a=n.join("、");return o.tags.length>0?e.jsxs(e.Fragment,{children:[a,"、タグ：",o.tags.map(d=>{const i=m.find(p=>p.id===d),f=(i==null?void 0:i.color)||re;return e.jsx(ie,{label:(i==null?void 0:i.name)||d,size:"small",sx:{ml:.5,backgroundColor:f,color:"#fff"}},d)})]}):a},[o,m,Ge]),_e=l.useMemo(()=>{const n=new Map;return c.forEach(t=>{t.items.forEach(a=>{ke(a).length>0&&n.set(a.id,a)})}),n},[c,ke]),ee=l.useMemo(()=>G?G.items.filter(n=>_e.has(n.id)):[],[G,_e]),Bn=l.useMemo(()=>{const n=[...bn];return n.sort((t,a)=>{var f,p,N,w;let d="",i="";if(C==="member")d=t.member.name,i=a.member.name;else if(_e.has(C)){const A=_e.get(C);d=ae(t.teamId,t.member.id,A),i=ae(a.teamId,a.member.id,A)}else d=((p=(f=Z[t.teamId])==null?void 0:f[t.member.id])==null?void 0:p[C])||0,i=((w=(N=Z[a.teamId])==null?void 0:N[a.member.id])==null?void 0:w[C])||0;return d<i?R==="asc"?-1:1:d>i?R==="asc"?1:-1:0}),n},[bn,C,R,Z,_e,ae]),ne=l.useMemo(()=>{var d;if($==="ALL")return null;if(V&&G){const i={};return ee.forEach(p=>{i[p.id]=0}),(g[$]||[]).filter(p=>p.visible!==!1).forEach(p=>{ee.forEach(N=>{i[N.id]+=ae($,p.id,N)})}),ee.forEach(p=>{i[p.id]+=ae($,xe,p)}),i}const n={};(g[$]||[]).filter(i=>i.visible!==!1).forEach(i=>{var p;const f=((p=Z[$])==null?void 0:p[i.id])||{};Object.entries(f).forEach(([N,w])=>{n[N]=(n[N]||0)+w})});const a=((d=Z[$])==null?void 0:d[xe])||{};return Object.entries(a).forEach(([i,f])=>{n[i]=(n[i]||0)+f}),n},[$,g,Z,V,G,ee,ae]),Ne=n=>{C===n?oe(R==="asc"?"desc":"asc"):(ge(n),oe("asc"))},vn=(n,t,a)=>{var d;if(V&&G){let i=[];t===xe&&n===$&&ne?i=ee.map(f=>({label:yn(f),value:ne[f.id]||0})):i=ee.map(f=>({label:yn(f),value:ae(n,t,f)})),we(a),Oe(G.name),Ae(i),ye(!0)}else if(Se){let i={};t===xe&&n===$&&ne?i=ne:i=((d=Z[n])==null?void 0:d[t])||{};const f=Te.map(p=>({label:p.name,value:i[p.id]||0}));we(a),Oe(Se.name),Ae(f),ye(!0)}},Wn=e.jsxs(ys,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},sx:{display:"flex",flexDirection:"column",flexGrow:1},children:[e.jsxs(U,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(U,{sx:{display:"flex",alignItems:"center",gap:1,flexGrow:1,minWidth:0,overflow:"hidden"},children:e.jsx(Tn,{component:"div",variant:"body2",noWrap:!0,sx:{overflow:"hidden",textOverflow:"ellipsis"},children:Pn})}),e.jsx(Je,{size:"small",onClick:$n,children:e.jsx(zn,{})})]}),V&&e.jsxs(U,{sx:{display:"flex",alignItems:"center",mb:1,gap:1},children:[e.jsx(Tn,{sx:{flexGrow:1,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:G==null?void 0:G.name}),e.jsx(se,{variant:"contained",size:"medium",onClick:()=>{Re(We),de(!0)},startIcon:e.jsx(On,{}),children:"編集"}),e.jsx(se,{variant:"contained",size:"medium",color:"error",onClick:()=>ue(!0),startIcon:e.jsx(_n,{}),children:"削除"})]}),e.jsx(kn,{component:Rn,storageKey:"analysis-list",sx:{flexGrow:1},children:e.jsxs(Ln,{size:"small",sx:{"& th, & td":{textAlign:"center",verticalAlign:"middle"},"& .MuiTableRow-root":{height:50}},children:[e.jsx(En,{children:e.jsxs(Me,{sx:{backgroundColor:n=>n.palette.mode==="dark"?"#343A42":"#f5f5f5"},children:[e.jsx(v,{align:"center",sortDirection:C==="member"?R:!1,children:e.jsx(Ke,{active:C==="member",direction:C==="member"?R:"asc",onClick:()=>Ne("member"),children:"メンバー"})}),V&&G?ee.map(n=>{var f,p,N;const t=n.playCategoryId&&((f=y.find(w=>w.id===n.playCategoryId))==null?void 0:f.name)||"",a=n.playDetailId&&((p=b.find(w=>w.id===n.playDetailId))==null?void 0:p.name)||"",d=n.playDetailId?(N=b.find(w=>w.id===n.playDetailId))==null?void 0:N.pointType:void 0,i=[n.pointType,n.pointUnitType].filter(Boolean).join(",");return e.jsx(v,{align:"center",sortDirection:C===n.id?R:!1,children:e.jsx(Ke,{active:C===n.id,direction:C===n.id?R:"asc",onClick:()=>Ne(n.id),children:e.jsxs(U,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[n.playCategoryTags&&n.playCategoryTags.length>0?e.jsx(U,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center"},children:n.playCategoryTags.map(w=>{const A=h.find(qe=>qe.id===w),He=(A==null?void 0:A.color)||re;return e.jsx(ie,{label:(A==null?void 0:A.name)||w,size:"small",sx:{mr:.5,mb:.5,backgroundColor:He,color:"#fff"}},w)})}):t&&e.jsx("span",{children:t}),n.playDetailTags&&n.playDetailTags.length>0?e.jsx(U,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center"},children:n.playDetailTags.map(w=>{const A=T.find(qe=>qe.id===w),He=(A==null?void 0:A.color)||re;return e.jsx(ie,{label:(A==null?void 0:A.name)||w,size:"small",sx:{mr:.5,mb:.5,backgroundColor:He,color:"#fff"}},w)})}):a&&e.jsx(U,{component:"span",sx:{color:d==="得点"?j.scoreColor:d==="失点"?j.lossColor:void 0},children:a}),i&&e.jsx("span",{children:i}),e.jsxs("span",{children:["(",n.method,")"]})]})})},n.id)}):Te.map(n=>e.jsx(v,{align:"center",sortDirection:C===n.id?R:!1,sx:{color:n.pointType==="得点"?j.scoreColor:n.pointType==="失点"?j.lossColor:"inherit"},children:e.jsx(Ke,{active:C===n.id,direction:C===n.id?R:"asc",onClick:()=>Ne(n.id),children:n.name})},n.id))]})}),e.jsxs(An,{children:[$!=="ALL"&&e.jsxs(Me,{children:[e.jsx(v,{align:"center",children:e.jsx(In,{component:"button",underline:"hover",onClick:()=>vn($,xe,"チーム集計"),children:"チーム集計"})}),V&&G?ee.map(n=>e.jsx(v,{align:"center",children:(ne==null?void 0:ne[n.id])||0},n.id)):Te.map(n=>e.jsx(v,{align:"center",children:(ne==null?void 0:ne[n.id])||0},n.id))]}),(V&&G?ee.some(n=>!jn(n)):!Un)&&Bn.map(({teamId:n,member:t})=>e.jsxs(Me,{children:[e.jsx(v,{align:"center",children:e.jsx(In,{component:"button",underline:"hover",onClick:()=>vn(n,t.id,t.name),children:t.name})}),V&&G?ee.map(a=>e.jsx(v,{align:"center",children:jn(a)?"－":ae(n,t.id,a)},a.id)):Te.map(a=>{var d,i;return e.jsx(v,{align:"center",children:a.pointUnitType==="チーム"?"－":((i=(d=Z[n])==null?void 0:d[t.id])==null?void 0:i[a.id])||0},a.id)})]},`${n}-${t.id}`))]})]})})]},B);return e.jsxs(U,{sx:{display:"flex",height:"100%"},children:[e.jsx(Qn,{variant:q?"permanent":"temporary",open:q?!0:K,onClose:()=>{r(!1),be(!1)},PaperProps:{onTransitionEnd:F},ModalProps:{keepMounted:!0,BackdropProps:{sx:{backgroundColor:"rgba(0, 0, 0, 0.5)"}}},sx:{width:q?K?_:x:_,flexShrink:0,transition:z.transitions.create("width",{easing:z.transitions.easing.sharp,duration:z.transitions.duration.standard}),...q?{zIndex:z.zIndex.appBar-1}:{},"& .MuiDrawer-paper":{width:q?K?_:x:_,boxSizing:"border-box",overflowX:"hidden",transition:z.transitions.create("width",{easing:z.transitions.easing.sharp,duration:z.transitions.duration.standard}),...q?{top:z.mixins.toolbar.minHeight,height:`calc(100% - ${z.mixins.toolbar.minHeight}px)`,zIndex:z.zIndex.appBar-1}:{}}},children:e.jsx(Xn,{children:Fe.map((n,t)=>e.jsxs(Yn,{selected:t===B,onClick:()=>{t===Fe.length-1?(Re(null),de(!0)):W(t),q||Q()},sx:{minHeight:48,justifyContent:K?"initial":"center",px:2.5},children:[e.jsx(Jn,{sx:{minWidth:0,mr:K?3:0,justifyContent:"center"},children:t===Fe.length-1?e.jsx(Sn,{}):e.jsx(Gn,{})}),e.jsx(Zn,{primary:n.label,sx:{opacity:s?1:0,display:s?"block":"none",whiteSpace:"nowrap"}})]},n.key))})}),e.jsxs(U,{sx:{flexGrow:1,display:"flex",flexDirection:"column",width:q?`calc(100% - ${K?_:x}px)`:"100%",transition:q?z.transitions.create("width",{duration:z.transitions.duration.standard}):void 0},children:[e.jsx(is,{mode:"wait",children:Wn}),e.jsxs(wn,{open:Y,onClose:()=>J(!1),children:[e.jsx(Qe,{children:"詳細検索"}),e.jsxs(Xe,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(U,{sx:{display:"flex",gap:2},children:[e.jsxs(fe,{fullWidth:!0,sx:{flex:1},margin:"dense",children:[e.jsx(he,{id:"dlg-left",children:"分析チーム"}),e.jsx(pe,{labelId:"dlg-left",value:L,label:"分析チーム",onChange:n=>{const t=n.target.value;M(t)},children:u.map(n=>e.jsx(O,{value:n.id,children:n.name},n.id))})]}),e.jsxs(fe,{fullWidth:!0,sx:{flex:1},margin:"dense",children:[e.jsx(he,{id:"dlg-right",children:"対戦相手"}),e.jsxs(pe,{labelId:"dlg-right",value:E,label:"対戦相手",onChange:n=>ve(n.target.value),children:[e.jsx(O,{value:"",children:"指定なし"}),u.map(n=>e.jsx(O,{value:n.id,children:n.name},n.id))]})]})]}),e.jsxs(U,{sx:{display:"flex",gap:2},children:[e.jsx(Ie,{type:"date",label:"試合日付",margin:"dense",value:Ce,onChange:n=>rn(n.target.value),InputLabelProps:{shrink:!0},fullWidth:!0,sx:{flex:1,"& .MuiOutlinedInput-root":{height:56},"& .MuiOutlinedInput-input":{padding:"0 14px",height:"100%",lineHeight:"56px",fontSize:"1rem",textAlign:"left"},'& input[type="date"]':{WebkitAppearance:"none"}}}),e.jsx(Ie,{label:"試合名",margin:"dense",value:on,onChange:n=>dn(n.target.value),fullWidth:!0,sx:{flex:1}})]}),e.jsxs(U,{sx:{display:"flex",gap:2,flexDirection:"column"},children:[e.jsxs(Dn,{exclusive:!0,value:cn,onChange:(n,t)=>un(t),fullWidth:!0,sx:{width:"100%"},children:[e.jsx($e,{value:"win",sx:{whiteSpace:"nowrap"},children:"勝ち試合"}),e.jsx($e,{value:"lose",sx:{whiteSpace:"nowrap"},children:"負け試合"})]}),e.jsxs(Dn,{exclusive:!0,value:fn,onChange:(n,t)=>hn(t),fullWidth:!0,sx:{width:"100%"},children:[e.jsx($e,{value:"win",sx:{whiteSpace:"nowrap"},children:"勝ちセット"}),e.jsx($e,{value:"lose",sx:{whiteSpace:"nowrap"},children:"負けセット"})]})]}),e.jsx(U,{sx:{display:"flex",gap:2},children:e.jsx(Ye,{multiple:!0,options:m,getOptionLabel:n=>n.name,value:m.filter(n=>pn.includes(n.id)),onChange:(n,t)=>xn(t.map(a=>a.id)),renderTags:(n,t)=>n.map((a,d)=>e.jsx(ie,{...t({index:d}),label:a.name,size:"small",sx:{backgroundColor:a.color||re,color:"#fff"}})),renderInput:n=>e.jsx(Ie,{...n,label:"タグ",margin:"dense"}),fullWidth:!0})})]}),e.jsxs(Ze,{children:[e.jsx(se,{onClick:()=>J(!1),color:"inherit",startIcon:e.jsx(Ve,{}),children:"キャンセル"}),e.jsx(se,{onClick:()=>{me({left:L,right:E,date:Ce,name:on,tags:pn,matchResult:cn||void 0,setResult:fn||void 0}),J(!1)},startIcon:e.jsx(en,{}),children:"検索"})]})]}),e.jsxs(es,{open:De,onClose:()=>ue(!1),children:[e.jsx(Qe,{children:"削除確認"}),e.jsx(Xe,{sx:{mt:2},children:"このカスタム分析を削除しますか？"}),e.jsxs(Ze,{children:[e.jsx(se,{onClick:()=>ue(!1),color:"inherit",startIcon:e.jsx(Ve,{}),children:"キャンセル"}),e.jsx(se,{onClick:()=>{const n=We,t=c[n];D(c.filter((a,d)=>d!==n)),W(0),ue(!1),X("カスタム分析を削除しました","success",{actionLabel:"元に戻す",onAction:()=>{D(a=>{const d=[...a];return d.splice(n,0,t),d}),W(le.length+n)},autoHideDuration:5e3})},color:"error",startIcon:e.jsx(Mn,{}),children:"OK"})]})]}),e.jsx(os,{open:te,playCategories:y,playDetails:b,rallyCategoryTags:h,rallyDetailTags:T,initialData:ce!==null?c[ce]:void 0,onCancel:()=>de(!1),onSave:n=>{ce!==null?(D(c.map((t,a)=>a===ce?n:t)),W(le.length+ce)):(D([...c,n]),W(le.length+c.length)),de(!1)}}),e.jsx(l.Suspense,{fallback:null,children:e.jsx(js,{open:je,onClose:()=>ye(!1),memberName:Le,tabName:Ue,data:Ee})})]})]})}export{Rs as default};
