import{i as xe,j as e,B as m,a as Ms,f as Ge,g as ot,h as dt,k as ye,l as p,m as ct,C as _e,I as Je,r as Et,K as Mt,n as ke,o as $e,d as Ve,e as Ue,F as je,L as ge,S as be,M as Y,p as Oe,q as X,D as ut,N as Nt,O as oe,G as et,A as Vs,Q as jt,R as Ns,b as qs,U as Ut,V as Wt,W as Ks,X as Js,Y as Gs,Z as Lt,_ as Ft,$ as Vt}from"./mui-vendor-Bb0AjAZd.js";import{r as o,f as Ys,u as Xs}from"./react-vendor-QLNaZ7XN.js";import{r as me,u as Ds,S as xt,D as De,d as gt,a as Ot,R as bt,b as Re,c as Ie,A as Qs}from"./index-CnAiO6T0.js";import{d as Zs,a as en}from"./QueryStatsOutlined-BoU3fm2E.js";import{D as Yt,C as _t,P as kt,d as $t}from"./DragIndicator-ZCSlNOlV.js";import{m as tn,A as sn}from"./motion-vendor-Bslre2pU.js";import"./chart-vendor-CuPFlH9t.js";var Xt={},nn=xe;Object.defineProperty(Xt,"__esModule",{value:!0});var Ps=Xt.default=void 0,an=nn(me()),ln=e;Ps=Xt.default=(0,an.default)((0,ln.jsx)("path",{d:"M12 5.9c1.16 0 2.1.94 2.1 2.1s-.94 2.1-2.1 2.1S9.9 9.16 9.9 8s.94-2.1 2.1-2.1m0 9c2.97 0 6.1 1.46 6.1 2.1v1.1H5.9V17c0-.64 3.13-2.1 6.1-2.1M12 4C9.79 4 8 5.79 8 8s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4m0 9c-2.67 0-8 1.34-8 4v3h16v-3c0-2.66-5.33-4-8-4"}),"PersonOutlineOutlined");var Qt={},rn=xe;Object.defineProperty(Qt,"__esModule",{value:!0});var _s=Qt.default=void 0,on=rn(me()),dn=e;_s=Qt.default=(0,on.default)((0,dn.jsx)("path",{d:"M2 17h2v.5H3v1h1v.5H2v1h3v-4H2zm1-9h1V4H2v1h1zm-1 3h1.8L2 13.1v.9h3v-1H3.2L5 10.9V10H2zm5-6v2h14V5zm0 14h14v-2H7zm0-6h14v-2H7z"}),"FormatListNumberedOutlined");var Zt={},cn=xe;Object.defineProperty(Zt,"__esModule",{value:!0});var ks=Zt.default=void 0,un=cn(me()),xn=e;ks=Zt.default=(0,un.default)((0,xn.jsx)("path",{d:"M9 13.75c-2.34 0-7 1.17-7 3.5V19h14v-1.75c0-2.33-4.66-3.5-7-3.5M4.34 17c.84-.58 2.87-1.25 4.66-1.25s3.82.67 4.66 1.25zM9 12c1.93 0 3.5-1.57 3.5-3.5S10.93 5 9 5 5.5 6.57 5.5 8.5 7.07 12 9 12m0-5c.83 0 1.5.67 1.5 1.5S9.83 10 9 10s-1.5-.67-1.5-1.5S8.17 7 9 7m7.04 6.81c1.16.84 1.96 1.96 1.96 3.44V19h4v-1.75c0-2.02-3.5-3.17-5.96-3.44M15 12c1.93 0 3.5-1.57 3.5-3.5S16.93 5 15 5c-.54 0-1.04.13-1.5.35.63.89 1 1.98 1 3.15s-.37 2.26-1 3.15c.46.22.96.35 1.5.35"}),"GroupOutlined");var es={},mn=xe;Object.defineProperty(es,"__esModule",{value:!0});var $s=es.default=void 0,hn=mn(me()),fn=e;$s=es.default=(0,hn.default)((0,fn.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V5h14zm-7-2h2V7h-4v2h2z"}),"LooksOneOutlined");var ts={},pn=xe;Object.defineProperty(ts,"__esModule",{value:!0});var Os=ts.default=void 0,jn=pn(me()),gn=e;Os=ts.default=(0,jn.default)((0,gn.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V5h14zm-4-4h-4v-2h2c1.1 0 2-.89 2-2V9c0-1.11-.9-2-2-2H9v2h4v2h-2c-1.1 0-2 .89-2 2v4h6z"}),"LooksTwoOutlined");var ss={},bn=xe;Object.defineProperty(ss,"__esModule",{value:!0});var Rs=ss.default=void 0,vn=bn(me()),yn=e;Rs=ss.default=(0,vn.default)((0,yn.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V5h14zm-4-4v-1.5c0-.83-.67-1.5-1.5-1.5.83 0 1.5-.67 1.5-1.5V9c0-1.11-.9-2-2-2H9v2h4v2h-2v2h2v2H9v2h4c1.1 0 2-.89 2-2"}),"Looks3Outlined");var ns={},Cn=xe;Object.defineProperty(ns,"__esModule",{value:!0});var zs=ns.default=void 0,Sn=Cn(me()),An=e;zs=ns.default=(0,Sn.default)((0,An.jsx)("path",{d:"M19.04 3h-14c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16h-14V5h14zm-6-2h2V7h-2v4h-2V7h-2v6h4z"}),"Looks4Outlined");var as={},Tn=xe;Object.defineProperty(as,"__esModule",{value:!0});var Hs=as.default=void 0,Bn=Tn(me()),Dn=e;Hs=as.default=(0,Bn.default)((0,Dn.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V5h14zm-4-4v-2c0-1.11-.9-2-2-2h-2V9h4V7H9v6h4v2H9v2h4c1.1 0 2-.89 2-2"}),"Looks5Outlined");var is={},In=xe;Object.defineProperty(is,"__esModule",{value:!0});var Es=is.default=void 0,wn=In(me()),Mn=e;Es=is.default=(0,wn.default)((0,Mn.jsx)("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"}),"Save");var ls={},Pn=xe;Object.defineProperty(ls,"__esModule",{value:!0});var qt=ls.default=void 0,_n=Pn(me()),kn=e;qt=ls.default=(0,_n.default)((0,kn.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2M5 19V5h6v14zm14 0h-6v-7h6zm0-9h-6V5h6z"}),"SpaceDashboardOutlined");var rs={},$n=xe;Object.defineProperty(rs,"__esModule",{value:!0});var Kt=rs.default=void 0,On=$n(me()),Rn=e;Kt=rs.default=(0,On.default)((0,Rn.jsx)("path",{d:"M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8"}),"UndoOutlined");var os={},zn=xe;Object.defineProperty(os,"__esModule",{value:!0});var Jt=os.default=void 0,Hn=zn(me()),En=e;Jt=os.default=(0,Hn.default)((0,En.jsx)("path",{d:"M18.4 10.6C16.55 8.99 14.15 8 11.5 8c-4.65 0-8.58 3.03-9.96 7.22L3.9 16c1.05-3.19 4.05-5.5 7.6-5.5 1.95 0 3.73.72 5.12 1.88L13 16h9V7z"}),"RedoOutlined");var ds={},Un=xe;Object.defineProperty(ds,"__esModule",{value:!0});var Us=ds.default=void 0,Wn=Un(me()),Ln=e;Us=ds.default=(0,Wn.default)((0,Ln.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8m.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"}),"AccessTimeOutlined");var cs={},Fn=xe;Object.defineProperty(cs,"__esModule",{value:!0});var Ws=cs.default=void 0,Vn=Fn(me()),Nn=e;Ws=cs.default=(0,Vn.default)((0,Nn.jsx)("path",{d:"M6.99 11 3 15l3.99 4v-3H14v-2H6.99zM21 9l-3.99-4v3H10v2h7.01v3z"}),"SwapHorizOutlined");var us={},qn=xe;Object.defineProperty(us,"__esModule",{value:!0});var Ls=us.default=void 0,Kn=qn(me()),Jn=e;Ls=us.default=(0,Kn.default)((0,Jn.jsx)("path",{d:"M16 17.01V10h-2v7.01h-3L15 21l4-3.99zM9 3 5 6.99h3V14h2V6.99h3zm7 14.01V10h-2v7.01h-3L15 21l4-3.99zM9 3 5 6.99h3V14h2V6.99h3z"}),"SwapVertOutlined");var xs={},Gn=xe;Object.defineProperty(xs,"__esModule",{value:!0});var Fs=xs.default=void 0,Yn=Gn(me()),Xn=e;Fs=xs.default=(0,Yn.default)((0,Xn.jsx)("path",{d:"M16.01 11H4v2h12.01v3L20 12l-3.99-4z"}),"ArrowRightAlt");function Qn(n){if(typeof window>"u")return n;try{const j=new DOMParser().parseFromString(n,"image/svg+xml"),b=new Set(["svg","g","path","circle","rect","line","polygon","polyline","text","defs","use"]),c=d=>{[...d.children].forEach(i=>{if(b.has(i.tagName))[...i.attributes].forEach(_=>{_.name.startsWith("on")&&i.removeAttribute(_.name)}),c(i);else{const _=document.createTextNode(i.outerHTML);i.replaceWith(_)}})};return c(j.documentElement),j.documentElement.outerHTML}catch{return""}}function Zn({name:n}){const l=o.useRef(null),[j,b]=o.useState(1);return o.useEffect(()=>{const c=l.current;if(!c)return;const d=c.getBBox().width;b(d>64?64/d:1)},[n]),e.jsx("svg",{width:64,height:64,children:e.jsx("g",{transform:`scale(${j})`,children:e.jsx("text",{ref:l,x:32/j,y:32/j,textAnchor:"middle",dominantBaseline:"central",fontSize:8,children:n})})})}function Pt({category:n,borderColor:l}){const j=l?{border:"1px solid",borderColor:l,boxSizing:"border-box"}:{};return n.iconType==="svg"&&n.svg?e.jsx(m,{sx:{width:64,height:64,...j},dangerouslySetInnerHTML:{__html:Qn(n.svg)}}):n.iconType==="image"&&n.image?e.jsx(m,{component:"img",src:n.image,sx:{width:64,height:64,objectFit:"none",objectPosition:`-${n.cropX||0}px -${n.cropY||0}px`,...j}}):e.jsx(m,{sx:{width:64,height:64,display:"flex",...j},children:e.jsx(Zn,{name:n.name})})}function ea(n,l,j){const b=o.useCallback(i=>{let _=0,A=0;i.rallies.forEach(z=>{if(z.timeoutTeam||z.substitutionTeam)return;const S=l.find(U=>U.id===z.teamAPlayDetail),$=l.find(U=>U.id===z.teamBPlayDetail);(S==null?void 0:S.pointType)==="得点"||($==null?void 0:$.pointType)==="失点"?_+=1:(($==null?void 0:$.pointType)==="得点"||(S==null?void 0:S.pointType)==="失点")&&(A+=1)}),i.my=_,i.opponent=A},[l]),c=o.useCallback(i=>{const _=[...n.rallies,i],A={...n,rallies:_};b(A),j(A)},[n,b,j]),d=o.useCallback(i=>{const _=n.rallies.filter((z,S)=>S!==i),A={...n,rallies:_};b(A),j(A)},[n,b,j]);return{addRally:c,deleteRally:d,calculateScores:b}}function ta({setScore:n,playDetails:l,playCategories:j,teamAMembers:b,teamBMembers:c,teamAName:d,teamBName:i,onChange:_,locked:A=!1,scoreInputSetting:z,themeSetting:S}){var N,G,se,F,le,pe,re,Pe;const $=Ms(),[U,M]=o.useState(!1),[W,J]=o.useState(!1),[de,Q]=o.useState("teamA"),[te,T]=o.useState(""),[ee,ne]=o.useState(""),[Z,f]=o.useState(""),[H,g]=o.useState(""),[B,D]=o.useState(""),[O,P]=o.useState(""),[L,ue]=o.useState(""),[q,he]=o.useState(""),[we,Ae]=o.useState(!1),[Ne,ze]=o.useState(!1),[Me,Te]=o.useState(!1),[h,y]=o.useState(""),[a,x]=o.useState(""),[u,v]=o.useState(""),[k,E]=o.useState(null),[ae,ie]=o.useState(null),[Ce,ce]=o.useState(null),{addRally:mt,deleteRally:vt,calculateScores:tt}=ea(n,l,_),yt=Ds("md"),Ye=Ds("sm"),Xe=!Ye&&z.showRallyIcons,st=!yt&&z.showScoreProgressArea,Se=j.find(t=>t.id==="init-serve"),nt=n.rallies.filter(t=>t.timeoutTeam==="teamA").length,Qe=n.rallies.filter(t=>t.timeoutTeam==="teamB").length,ht=nt>=2,ft=Qe>=2,Ct=()=>{var K,Be;if(q)return!0;if(z.rallyMemberRequired&&!te||ee&&!H||Z&&!B||!!!(ee&&H)&&!!!(Z&&B))return!1;const I=(K=l.find(ve=>ve.id===H))==null?void 0:K.pointUnitType;if(z.rallyMemberRequired&&H&&I==="メンバー"&&!O)return!1;const R=(Be=l.find(ve=>ve.id===B))==null?void 0:Be.pointUnitType;return!(z.rallyMemberRequired&&B&&R==="メンバー"&&!L)},We=t=>{if(!t)return"";const s=l.find(R=>R.id===t),I=j.find(R=>R.id===(s==null?void 0:s.playCategoryId));return(I==null?void 0:I.name)||""},fe=t=>{if(!t)return;const s=l.find(I=>I.id===t);return j.find(I=>I.id===(s==null?void 0:s.playCategoryId))},St=(t,s)=>{if(!s)return"－";const R=(t==="teamA"?b:c).find(K=>K.id===s);return R?`${R.no}:${R.name}`:"－"},Rt=()=>{if(A)return;ie(null);const t=[...n.rallies].reverse().find(I=>!I.timeoutTeam&&!I.substitutionTeam);let s="teamA";if(t){const I=l.find(K=>K.id===t.teamAPlayDetail),R=l.find(K=>K.id===t.teamBPlayDetail);(I==null?void 0:I.pointType)==="得点"||(R==null?void 0:R.pointType)==="失点"?s="teamA":((R==null?void 0:R.pointType)==="得点"||(I==null?void 0:I.pointType)==="失点")&&(s="teamB")}Q(s),T(""),ne(""),f(""),g(""),D(""),P(""),ue(""),he(""),M(!0)},zt=t=>{var I,R;if(A)return;const s=n.rallies[t];ie(t),Q(s.serverTeam||"teamA"),T(s.server&&(s.serverTeam==="teamA"?b.some(K=>K.id===s.server):c.some(K=>K.id===s.server))?s.server:""),ne(((I=l.find(K=>K.id===s.teamAPlayDetail))==null?void 0:I.playCategoryId)||""),g(s.teamAPlayDetail||""),P(b.some(K=>K.id===s.teamAMember)&&s.teamAMember||""),f(((R=l.find(K=>K.id===s.teamBPlayDetail))==null?void 0:R.playCategoryId)||""),D(s.teamBPlayDetail||""),ue(c.some(K=>K.id===s.teamBMember)&&s.teamBMember||""),he(s.timeoutTeam||""),M(!0)},At=()=>{if(A)return;const t=q?{id:crypto.randomUUID(),timeoutTeam:q}:{id:crypto.randomUUID(),serverTeam:de,server:te||void 0,teamAPlayDetail:H||void 0,teamAMember:O||void 0,teamBPlayDetail:B||void 0,teamBMember:L||void 0};mt(t),M(!1)},pt=t=>{A||t==="teamA"&&ht||t==="teamB"&&ft||(mt({id:crypto.randomUUID(),timeoutTeam:t}),Ae(!1))},Tt=t=>{A||(y(t),x(""),v(""),E(null),Te(!0),ze(!1))},Bt=t=>{if(A)return;const s=n.rallies[t];s.substitutionTeam&&(y(s.substitutionTeam),x(s.outMember||""),v(s.inMember||""),E(t),Te(!0))},Ht=()=>{if(A||!h||!a||!u)return;const t=[...n.rallies];k!==null?t[k]={...t[k],substitutionTeam:h,outMember:a,inMember:u}:t.push({id:crypto.randomUUID(),substitutionTeam:h,outMember:a,inMember:u});const s={...n,rallies:t};tt(s),_(s),Te(!1),E(null)},Dt=()=>{Te(!1),E(null)},It=()=>{if(A||ae===null)return;const t=[...n.rallies];t[ae]=q?{...t[ae],timeoutTeam:q,serverTeam:void 0,server:void 0,teamAPlayDetail:void 0,teamAMember:void 0,teamBPlayDetail:void 0,teamBMember:void 0}:{...t[ae],timeoutTeam:void 0,serverTeam:de,server:te||void 0,teamAPlayDetail:H||void 0,teamAMember:O||void 0,teamBPlayDetail:B||void 0,teamBMember:L||void 0};const s={...n,rallies:t};tt(s),_(s),M(!1)},He=t=>{if(!t.destination||A)return;const s=Array.from(n.rallies),[I]=s.splice(t.source.index,1);s.splice(t.destination.index,0,I);const R={...n,rallies:s};tt(R),_(R)},qe=t=>{A||(ce(t),J(!0))},at=()=>{Ce!==null&&(vt(Ce),ce(null),J(!1))},Ze=()=>{ce(null),J(!1)},hs=t=>{let s=0,I=0,R=null;n.rallies.slice(0,t+1).forEach(ve=>{if(ve.timeoutTeam||ve.substitutionTeam)return;const Le=l.find(rt=>rt.id===ve.teamAPlayDetail),Fe=l.find(rt=>rt.id===ve.teamBPlayDetail);(Le==null?void 0:Le.pointType)==="得点"||(Fe==null?void 0:Fe.pointType)==="失点"?(s+=1,R="A"):(Fe==null?void 0:Fe.pointType)==="得点"||(Le==null?void 0:Le.pointType)==="失点"?(I+=1,R="B"):R=null});const K=$.palette.text.primary,Be=$.palette.mode==="dark"?"#343A42":"#D3D3D3";return e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{color:R==="A"?K:Be},children:String(s).padStart(2,"0")}),e.jsx("span",{style:{color:Be},children:" - "}),e.jsx("span",{style:{color:R==="B"?K:Be},children:String(I).padStart(2,"0")})]})},it=[],Ee=[];let wt=0,lt=0;n.rallies.forEach(t=>{if(t.timeoutTeam||t.substitutionTeam)return;const s=l.find(R=>R.id===t.teamAPlayDetail),I=l.find(R=>R.id===t.teamBPlayDetail);(s==null?void 0:s.pointType)==="得点"||(I==null?void 0:I.pointType)==="失点"?(wt+=1,Ee.push("A")):(I==null?void 0:I.pointType)==="得点"||(s==null?void 0:s.pointType)==="失点"?(lt+=1,Ee.push("B")):Ee.push(null),it.push({a:wt,b:lt})});const Ke=40,r=[];for(let t=0;t<Ee.length-1;t++){const s=Ee[t],I=Ee[t+1];s&&I&&s!==I&&r.push({from:s,index:t})}const C=Ee.map((t,s)=>t&&s>0&&t===Ee[s-1]),w=it.length*Ke;return e.jsxs(m,{sx:{position:"relative",display:"flex",flexDirection:"column",height:"100%"},children:[e.jsxs(m,{sx:{display:"flex",gap:2,flex:1,minHeight:0},children:[st&&e.jsxs(m,{sx:{flex:"0 0 20%",overflowY:"auto",height:"100%",position:"relative"},children:[it.map((t,s)=>{const I=s===0?{a:0,b:0}:it[s-1],R=t.a!==I.a&&t.a!==0,K=t.b!==I.b&&t.b!==0,Be=R&&C[s],ve=K&&C[s];return e.jsxs(m,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr 1fr",alignItems:"center",py:.5,height:`${Ke}px`,position:"relative",zIndex:1},children:[e.jsx(m,{}),e.jsxs(e.Fragment,{children:[e.jsx(m,{sx:{display:"flex",justifyContent:"center"},children:R?e.jsx(m,{sx:{width:32,height:32,border:"1px solid",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:24,borderColor:Be?"red":"currentColor",backgroundColor:Be?"#ffebee":"#fff",color:"black"},children:t.a}):null}),e.jsx(m,{}),e.jsx(m,{sx:{display:"flex",justifyContent:"center"},children:K?e.jsx(m,{sx:{width:32,height:32,border:"1px solid",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:24,borderColor:ve?"red":"currentColor",backgroundColor:ve?"#ffebee":"#fff",color:"black"},children:t.b}):null})]}),e.jsx(m,{})]},s)}),e.jsx("svg",{viewBox:`0 0 100 ${w}`,style:{position:"absolute",left:0,top:0,width:"100%",height:w,zIndex:0},preserveAspectRatio:"none",pointerEvents:"none",children:r.map(t=>{const s=t.index*Ke+Ke/2,I=(t.index+1)*Ke+Ke/2,R=t.from==="A"?30:70,K=t.from==="A"?70:30;return e.jsx("line",{x1:R,y1:s,x2:K,y2:I,stroke:"currentColor",strokeWidth:1},t.index)})})]}),e.jsx(m,{sx:{flex:1,overflowY:"auto",height:"100%",maxWidth:1024,width:"100%",mx:"auto",mb:2},children:e.jsx(Yt,{onDragEnd:He,children:e.jsx(xt,{component:Ge,storageKey:"set-tab",children:e.jsxs(ot,{size:"small",sx:{tableLayout:"fixed","& th, & td":{textAlign:"center",verticalAlign:"middle"}},children:[e.jsx(dt,{children:e.jsxs(ye,{sx:{backgroundColor:t=>t.palette.mode==="dark"?"#343A42":"#f5f5f5"},children:[e.jsx(p,{sx:{width:"6%"}}),e.jsx(p,{sx:{width:"16%"},children:e.jsxs(m,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{children:d||"チームA"}),e.jsx("span",{children:"サーブ"})]})}),e.jsx(p,{sx:{width:"18%"},children:e.jsxs(m,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{children:d||"チームA"}),e.jsx("span",{children:"ラリー結果"})]})}),e.jsx(p,{sx:{width:"20%"},children:"得点"}),e.jsx(p,{sx:{width:"18%"},children:e.jsxs(m,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{children:i||"チームB"}),e.jsx("span",{children:"ラリー結果"})]})}),e.jsx(p,{sx:{width:"16%"},children:e.jsxs(m,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{children:i||"チームB"}),e.jsx("span",{children:"サーブ"})]})}),e.jsx(p,{sx:{width:"6%"}})]})}),e.jsx(_t,{droppableId:"rallies",children:t=>e.jsxs(ct,{ref:t.innerRef,...t.droppableProps,children:[n.rallies.map((s,I)=>e.jsx(kt,{draggableId:s.id,index:I,isDragDisabled:A,children:R=>{var K,Be,ve,Le,Fe,rt,fs,ps,js,gs,bs,vs,ys,Cs,Ss,As,Ts,Bs;return e.jsxs(ye,{ref:R.innerRef,...R.draggableProps,"data-index":I,onClick:()=>{A||(s.substitutionTeam?Bt(I):s.timeoutTeam||zt(I))},sx:{cursor:A||s.timeoutTeam?"default":"pointer",backgroundColor:V=>s.timeoutTeam||s.substitutionTeam?V.palette.mode==="dark"?"#343A42":"#f5f5f5":void 0},children:[e.jsx(p,{padding:"checkbox",sx:{width:"6%"},children:e.jsx(m,{onClick:V=>V.stopPropagation(),...R.dragHandleProps,sx:{cursor:A?"default":"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:e.jsx($t,{fontSize:"small"})})}),s.timeoutTeam?e.jsx(p,{colSpan:5,sx:{width:"88%"},children:e.jsxs(m,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:[s.timeoutTeam==="teamA"?d||"チームA":i||"チームB","タイムアウト"]})}):s.substitutionTeam?e.jsx(p,{colSpan:5,sx:{width:"88%"},children:e.jsxs(m,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100%"},children:[e.jsxs("span",{children:[s.substitutionTeam==="teamA"?d||"チームA":i||"チームB","選手交代"]}),e.jsxs(m,{sx:{display:"flex",alignItems:"center",mt:.5},children:[e.jsx("span",{children:St(s.substitutionTeam,s.outMember)}),e.jsx(Fs,{fontSize:"small",sx:{mx:1}}),e.jsx("span",{children:St(s.substitutionTeam,s.inMember)})]})]})}):e.jsxs(e.Fragment,{children:[e.jsx(p,{sx:{width:"16%"},children:s.serverTeam==="teamA"?e.jsxs(m,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[Xe&&(Se?e.jsx(Pt,{category:Se}):e.jsxs("svg",{width:64,height:64,children:[e.jsx("rect",{width:64,height:64,fill:"none",stroke:"currentColor"}),e.jsx("text",{x:"50%",y:"50%",textAnchor:"middle",dominantBaseline:"central",fontSize:"12",children:"サーブ"})]})),e.jsx("span",{style:{fontSize:12},children:((K=b.find(V=>V.id===s.server))==null?void 0:K.name)||"－"})]}):null}),e.jsx(p,{sx:{width:"18%"},children:e.jsxs(m,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[Xe&&s.teamAPlayDetail&&fe(s.teamAPlayDetail)?e.jsx(m,{sx:{mb:"5px"},children:e.jsx(Pt,{category:fe(s.teamAPlayDetail),borderColor:((Be=l.find(V=>V.id===s.teamAPlayDetail))==null?void 0:Be.pointType)==="得点"?S.scoreColor:((ve=l.find(V=>V.id===s.teamAPlayDetail))==null?void 0:ve.pointType)==="失点"?S.lossColor:void 0})}):null,s.teamAPlayDetail?e.jsx(_e,{label:We(s.teamAPlayDetail),size:"small",variant:"outlined",sx:{borderColor:((Le=fe(s.teamAPlayDetail))==null?void 0:Le.color)||De,color:((Fe=fe(s.teamAPlayDetail))==null?void 0:Fe.color)||De,mb:.5}}):null,s.teamAPlayDetail?e.jsx(_e,{label:((rt=l.find(V=>V.id===s.teamAPlayDetail))==null?void 0:rt.name)||"",size:"small",sx:{backgroundColor:((fs=l.find(V=>V.id===s.teamAPlayDetail))==null?void 0:fs.pointType)==="得点"?S.scoreColor:S.lossColor,color:"#fff",mb:.5}}):null,e.jsx("span",{style:{fontSize:12},children:s.teamAPlayDetail?((ps=l.find(V=>V.id===s.teamAPlayDetail))==null?void 0:ps.pointUnitType)==="メンバー"&&((js=b.find(V=>V.id===s.teamAMember))==null?void 0:js.name)||"－":""})]})}),e.jsx(p,{sx:{width:"20%",fontSize:"2em"},children:hs(I)}),e.jsx(p,{sx:{width:"18%"},children:e.jsxs(m,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[Xe&&s.teamBPlayDetail&&fe(s.teamBPlayDetail)?e.jsx(m,{sx:{mb:"5px"},children:e.jsx(Pt,{category:fe(s.teamBPlayDetail),borderColor:((gs=l.find(V=>V.id===s.teamBPlayDetail))==null?void 0:gs.pointType)==="得点"?S.scoreColor:((bs=l.find(V=>V.id===s.teamBPlayDetail))==null?void 0:bs.pointType)==="失点"?S.lossColor:void 0})}):null,s.teamBPlayDetail?e.jsx(_e,{label:We(s.teamBPlayDetail),size:"small",variant:"outlined",sx:{borderColor:((vs=fe(s.teamBPlayDetail))==null?void 0:vs.color)||De,color:((ys=fe(s.teamBPlayDetail))==null?void 0:ys.color)||De,mb:.5}}):null,s.teamBPlayDetail?e.jsx(_e,{label:((Cs=l.find(V=>V.id===s.teamBPlayDetail))==null?void 0:Cs.name)||"",size:"small",sx:{backgroundColor:((Ss=l.find(V=>V.id===s.teamBPlayDetail))==null?void 0:Ss.pointType)==="得点"?S.scoreColor:S.lossColor,color:"#fff",mb:.5}}):null,e.jsx("span",{style:{fontSize:12},children:s.teamBPlayDetail?((As=l.find(V=>V.id===s.teamBPlayDetail))==null?void 0:As.pointUnitType)==="メンバー"&&((Ts=c.find(V=>V.id===s.teamBMember))==null?void 0:Ts.name)||"－":""})]})}),e.jsx(p,{sx:{width:"16%"},children:s.serverTeam==="teamB"?e.jsxs(m,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[Xe&&(Se?e.jsx(Pt,{category:Se}):e.jsxs("svg",{width:64,height:64,children:[e.jsx("rect",{width:64,height:64,fill:"none",stroke:"currentColor"}),e.jsx("text",{x:"50%",y:"50%",textAnchor:"middle",dominantBaseline:"central",fontSize:"12",children:"サーブ"})]})),e.jsx("span",{style:{fontSize:12},children:((Bs=c.find(V=>V.id===s.server))==null?void 0:Bs.name)||"－"})]}):null})]}),e.jsx(p,{padding:"checkbox",sx:{width:"6%"},children:e.jsx(m,{onClick:V=>V.stopPropagation(),sx:{width:32,height:32,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Je,{size:"small",onClick:A?void 0:()=>qe(I),disabled:A,sx:{width:24,height:24},children:e.jsx(gt,{fontSize:"small",color:A?"disabled":"error"})})})})]})}},s.id)),t.placeholder]})})]})})})})]}),!A&&e.jsxs(e.Fragment,{children:[e.jsx(m,{sx:{position:"fixed",right:"35px",bottom:200},children:e.jsxs(Et,{ariaLabel:"substitution actions",direction:"left",icon:e.jsx(Ws,{}),onOpen:()=>ze(!0),onClose:()=>ze(!1),open:Ne,FabProps:{size:"large"},children:[e.jsx(Mt,{icon:e.jsx(e.Fragment,{children:i||"チームB"}),tooltipTitle:"",FabProps:{variant:"extended",size:"small"},onClick:()=>Tt("teamB")}),e.jsx(Mt,{icon:e.jsx(e.Fragment,{children:d||"チームA"}),tooltipTitle:"",FabProps:{variant:"extended",size:"small"},onClick:()=>Tt("teamA")})]})}),e.jsx(m,{sx:{position:"fixed",right:"35px",bottom:140},children:e.jsxs(Et,{ariaLabel:"timeout actions",direction:"left",icon:e.jsx(Us,{}),onOpen:()=>Ae(!0),onClose:()=>Ae(!1),open:we,FabProps:{size:"large"},children:[e.jsx(Mt,{icon:e.jsx(e.Fragment,{children:i||"チームB"}),tooltipTitle:"",FabProps:{variant:"extended",size:"small",disabled:ft},onClick:()=>pt("teamB")}),e.jsx(Mt,{icon:e.jsx(e.Fragment,{children:d||"チームA"}),tooltipTitle:"",FabProps:{variant:"extended",size:"small",disabled:ht},onClick:()=>pt("teamA")})]})}),e.jsx(m,{sx:{position:"fixed",right:"35px",bottom:80},children:e.jsx(Et,{ariaLabel:"rally actions",direction:"left",icon:e.jsx(Ot,{}),FabProps:{size:"large",onClick:Rt}})})]}),e.jsxs(bt,{open:U,onClose:()=>M(!1),children:[e.jsx(ke,{children:ae===null?"ラリー追加":"ラリー編集"}),e.jsxs($e,{sx:{display:"flex",flexDirection:"column",gap:2,mt:2},children:[e.jsxs(Ve,{exclusive:!0,value:de,onChange:(t,s)=>s&&Q(s),sx:{width:"100%"},disabled:!!q,children:[e.jsx(Ue,{value:"teamA",sx:{flex:1},children:e.jsx(m,{sx:{whiteSpace:"pre-line",textAlign:"center"},children:`${d||"チームA"}
サーブ`})}),e.jsx(Ue,{value:"teamB",sx:{flex:1},children:e.jsx(m,{sx:{whiteSpace:"pre-line",textAlign:"center"},children:`${i||"チームB"}
サーブ`})})]}),e.jsxs(je,{fullWidth:!0,required:z.rallyMemberRequired,disabled:!!q,children:[e.jsx(ge,{id:"server",children:"サーバー"}),e.jsx(be,{labelId:"server",value:te,label:"サーバー",onChange:t=>T(t.target.value),children:(de==="teamA"?b:c).map(t=>e.jsx(Y,{value:t.id,children:t.name},t.id))})]}),Ye?e.jsxs(m,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(m,{sx:{flex:1,display:"flex",flexDirection:"column",gap:1},children:[e.jsx(Ve,{orientation:"vertical",exclusive:!0,value:ee,onChange:(t,s)=>{ee===s||s===null?(ne(""),g("")):(ne(s),g(""))},disabled:!!q,children:j.filter(t=>t.visible!==!1).map(t=>e.jsx(Ue,{value:t.id,sx:{whiteSpace:"nowrap"},children:t.name},t.id))}),e.jsx(Ve,{orientation:"vertical",exclusive:!0,value:H,onChange:(t,s)=>{g(H===s||s===null?"":s)},sx:{mt:1},disabled:!!q,children:l.filter(t=>t.playCategoryId===ee&&t.visible!==!1).map(t=>{const s=t.pointType==="得点"?S.scoreColor:S.lossColor;return e.jsx(Ue,{value:t.id,sx:{whiteSpace:"nowrap",color:s,"&.Mui-selected":{color:s}},children:t.name},t.id)})}),e.jsxs(je,{fullWidth:!0,sx:{mt:1},required:z.rallyMemberRequired&&((N=l.find(t=>t.id===H))==null?void 0:N.pointUnitType)==="メンバー",disabled:!!q,children:[e.jsx(ge,{id:"amem",children:`${d||"チームA"}メンバー`}),e.jsxs(be,{labelId:"amem",value:O,label:`${d||"チームA"}メンバー`,onChange:t=>P(t.target.value),disabled:((G=l.find(t=>t.id===H))==null?void 0:G.pointUnitType)!=="メンバー",children:[e.jsx(Y,{value:"",children:e.jsx("em",{children:"なし"})}),b.map(t=>e.jsx(Y,{value:t.id,children:t.name},t.id))]})]})]}),e.jsxs(m,{sx:{flex:1,display:"flex",flexDirection:"column",gap:1},children:[e.jsx(Ve,{orientation:"vertical",exclusive:!0,value:Z,onChange:(t,s)=>{Z===s||s===null?(f(""),D("")):(f(s),D(""))},disabled:!!q,children:j.filter(t=>t.visible!==!1).map(t=>e.jsx(Ue,{value:t.id,sx:{whiteSpace:"nowrap"},children:t.name},t.id))}),e.jsx(Ve,{orientation:"vertical",exclusive:!0,value:B,onChange:(t,s)=>{D(B===s||s===null?"":s)},sx:{mt:1},disabled:!!q,children:l.filter(t=>t.playCategoryId===Z&&t.visible!==!1).map(t=>{const s=t.pointType==="得点"?S.scoreColor:S.lossColor;return e.jsx(Ue,{value:t.id,sx:{whiteSpace:"nowrap",color:s,"&.Mui-selected":{color:s}},children:t.name},t.id)})}),e.jsxs(je,{fullWidth:!0,sx:{mt:1},required:z.rallyMemberRequired&&((se=l.find(t=>t.id===B))==null?void 0:se.pointUnitType)==="メンバー",disabled:!!q,children:[e.jsx(ge,{id:"bmem",children:`${i||"チームB"}メンバー`}),e.jsxs(be,{labelId:"bmem",value:L,label:`${i||"チームB"}メンバー`,onChange:t=>ue(t.target.value),disabled:((F=l.find(t=>t.id===B))==null?void 0:F.pointUnitType)!=="メンバー",children:[e.jsx(Y,{value:"",children:e.jsx("em",{children:"なし"})}),c.map(t=>e.jsx(Y,{value:t.id,children:t.name},t.id))]})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(m,{sx:{display:"flex",gap:2},children:[e.jsx(Ve,{orientation:"vertical",exclusive:!0,value:ee,onChange:(t,s)=>{ee===s||s===null?(ne(""),g("")):(ne(s),g(""))},disabled:!!q,sx:{flex:"1 1 25%"},children:j.filter(t=>t.visible!==!1).map(t=>e.jsx(Ue,{value:t.id,sx:{whiteSpace:"nowrap"},children:t.name},t.id))}),e.jsx(Ve,{orientation:"vertical",exclusive:!0,value:H,onChange:(t,s)=>{g(H===s||s===null?"":s)},disabled:!!q,sx:{flex:"1 1 25%"},children:l.filter(t=>t.playCategoryId===ee&&t.visible!==!1).map(t=>{const s=t.pointType==="得点"?S.scoreColor:S.lossColor;return e.jsx(Ue,{value:t.id,sx:{whiteSpace:"nowrap",color:s,"&.Mui-selected":{color:s}},children:t.name},t.id)})}),e.jsx(Ve,{orientation:"vertical",exclusive:!0,value:Z,onChange:(t,s)=>{Z===s||s===null?(f(""),D("")):(f(s),D(""))},disabled:!!q,sx:{flex:"1 1 25%"},children:j.filter(t=>t.visible!==!1).map(t=>e.jsx(Ue,{value:t.id,sx:{whiteSpace:"nowrap"},children:t.name},t.id))}),e.jsx(Ve,{orientation:"vertical",exclusive:!0,value:B,onChange:(t,s)=>{D(B===s||s===null?"":s)},disabled:!!q,sx:{flex:"1 1 25%"},children:l.filter(t=>t.playCategoryId===Z&&t.visible!==!1).map(t=>{const s=t.pointType==="得点"?S.scoreColor:S.lossColor;return e.jsx(Ue,{value:t.id,sx:{whiteSpace:"nowrap",color:s,"&.Mui-selected":{color:s}},children:t.name},t.id)})})]}),e.jsxs(m,{sx:{display:"flex",gap:2,mt:1},children:[e.jsxs(je,{fullWidth:!0,required:z.rallyMemberRequired&&((le=l.find(t=>t.id===H))==null?void 0:le.pointUnitType)==="メンバー",disabled:!!q,sx:{flex:1},children:[e.jsx(ge,{id:"amem",children:`${d||"チームA"}メンバー`}),e.jsxs(be,{labelId:"amem",value:O,label:`${d||"チームA"}メンバー`,onChange:t=>P(t.target.value),disabled:((pe=l.find(t=>t.id===H))==null?void 0:pe.pointUnitType)!=="メンバー",children:[e.jsx(Y,{value:"",children:e.jsx("em",{children:"なし"})}),b.map(t=>e.jsx(Y,{value:t.id,children:t.name},t.id))]})]}),e.jsxs(je,{fullWidth:!0,required:z.rallyMemberRequired&&((re=l.find(t=>t.id===B))==null?void 0:re.pointUnitType)==="メンバー",disabled:!!q,sx:{flex:1},children:[e.jsx(ge,{id:"bmem",children:`${i||"チームB"}メンバー`}),e.jsxs(be,{labelId:"bmem",value:L,label:`${i||"チームB"}メンバー`,onChange:t=>ue(t.target.value),disabled:((Pe=l.find(t=>t.id===B))==null?void 0:Pe.pointUnitType)!=="メンバー",children:[e.jsx(Y,{value:"",children:e.jsx("em",{children:"なし"})}),c.map(t=>e.jsx(Y,{value:t.id,children:t.name},t.id))]})]})]})]})]}),e.jsxs(Oe,{children:[e.jsx(X,{onClick:()=>M(!1),color:"inherit",startIcon:e.jsx(Re,{}),children:"キャンセル"}),ae===null?e.jsx(X,{onClick:At,disabled:!Ct(),startIcon:e.jsx(Ie,{}),children:"OK"}):e.jsx(X,{onClick:It,disabled:!Ct(),startIcon:e.jsx(Ie,{}),children:"OK"})]})]}),e.jsxs(bt,{open:Me,onClose:Dt,children:[e.jsx(ke,{children:"選手交代"}),e.jsx($e,{children:e.jsxs(m,{component:"form",sx:{mt:2},children:[e.jsxs(je,{fullWidth:!0,sx:{mb:2},children:[e.jsx(ge,{id:"out-member",children:"OUT"}),e.jsx(be,{labelId:"out-member",value:a,label:"OUT",onChange:t=>x(t.target.value),children:(h==="teamA"?b:c).map(t=>e.jsx(Y,{value:t.id,children:`${t.no}:${t.name}`},t.id))})]}),e.jsx(m,{sx:{display:"flex",justifyContent:"center",mb:2},children:e.jsx(Ls,{sx:{width:32,height:32}})}),e.jsxs(je,{fullWidth:!0,children:[e.jsx(ge,{id:"in-member",children:"IN"}),e.jsx(be,{labelId:"in-member",value:u,label:"IN",onChange:t=>v(t.target.value),children:(h==="teamA"?b:c).map(t=>e.jsx(Y,{value:t.id,children:`${t.no}:${t.name}`},t.id))})]})]})}),e.jsxs(Oe,{children:[e.jsx(X,{onClick:Dt,color:"inherit",startIcon:e.jsx(Re,{}),children:"キャンセル"}),e.jsx(X,{onClick:Ht,disabled:!a||!u,startIcon:e.jsx(Ie,{}),children:"OK"})]})]}),e.jsxs(ut,{open:W,onClose:Ze,children:[e.jsx(ke,{children:"削除確認"}),e.jsx($e,{sx:{mt:2},children:"このラリーを削除しますか？"}),e.jsxs(Oe,{children:[e.jsx(X,{onClick:Ze,color:"inherit",startIcon:e.jsx(Re,{}),children:"キャンセル"}),e.jsx(X,{onClick:at,color:"error",startIcon:e.jsx(Ie,{}),children:"OK"})]})]})]})}function sa(n,l){const[j,b]=o.useState(null),c=o.useRef(n);c.current=n;const d=o.useRef(),i=o.useCallback(S=>{if(j===null)return;const $=document.elementFromPoint(S.clientX,S.clientY),U=$==null?void 0:$.closest("[data-index]");if(!U)return;const M=Number(U.dataset.index);if(isNaN(M)||M===j)return;const W=[...c.current],[J]=W.splice(j,1);W.splice(M,0,J),b(M),l(W)},[j,l]),_=o.useCallback(()=>{window.removeEventListener("pointermove",i),d.current&&(window.removeEventListener("pointerup",d.current),window.removeEventListener("pointercancel",d.current))},[i]),A=o.useCallback(S=>{var $,U;S&&"currentTarget"in S&&((U=($=S.currentTarget).releasePointerCapture)==null||U.call($,S.pointerId)),_(),b(null)},[_]);function z(S,$){var U,M;$.preventDefault(),(M=(U=$.currentTarget).setPointerCapture)==null||M.call(U,$.pointerId),b(S),d.current=A,window.addEventListener("pointermove",i),window.addEventListener("pointerup",d.current),window.addEventListener("pointercancel",d.current)}return o.useEffect(()=>()=>_(),[_]),{start:z,move:i,end:A,dragging:j!==null}}const na=()=>typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():Math.random().toString(36).slice(2)+Date.now().toString(36);function aa({statsSettings:n,onChange:l,playCategories:j,playDetails:b,rallyCategoryTags:c,rallyDetailTags:d,disabled:i}){const{start:_,move:A,end:z}=sa(n,l),S=a=>{var x;return((x=j.find(u=>u.id===a))==null?void 0:x.name)||""},$=a=>{var x;return((x=b.find(u=>u.id===a))==null?void 0:x.name)||""},[U,M]=o.useState(!1),[W,J]=o.useState(null),[de,Q]=o.useState(""),[te,T]=o.useState(""),[ee,ne]=o.useState([]),[Z,f]=o.useState([]),[H,g]=o.useState(""),[B,D]=o.useState(""),[O,P]=o.useState("合算"),[L,ue]=o.useState(null),[q,he]=o.useState(!1),we=()=>{i||(J(-1),Q(""),T(""),ne([]),f([]),g(""),D(""),P("合算"),M(!0))},Ae=a=>{if(i)return;const x=n[a];J(a),Q(x.playCategoryId||""),T(x.playDetailId||""),ne(x.playCategoryTags||[]),f(x.playDetailTags||[]),g(x.pointType||""),D(x.pointUnitType||""),P(x.aggregateType||"合算"),M(!0)},Ne=()=>{const a=de!=="",x=te!=="",u=ee.length>0,v=Z.length>0,k=H!=="",E=B!=="";return a&&!x&&!u&&!v&&!k&&!E||a&&x&&!u&&!v&&!k&&!E||a&&!x&&!u&&!v&&k&&!E||a&&!x&&!u&&!v&&!k&&E||a&&!x&&!u&&!v&&k&&E||!a&&!x&&!u&&!v&&k&&!E||!a&&!x&&!u&&!v&&k&&E||!a&&!x&&!u&&!v&&!k&&E||u&&!a&&!x&&!v&&!k&&!E||u&&v&&!a&&!x&&!k&&!E||u&&v&&!a&&!x&&k&&!E||u&&v&&!a&&!x&&!k&&E||u&&v&&!a&&!x&&k&&E||u&&!a&&!x&&k&&!E||u&&!a&&!x&&!k&&E||u&&!a&&!x&&k&&E||v&&!a&&!x&&!u&&!k&&!E||v&&!a&&!x&&!u&&k&&!E||v&&!a&&!x&&!u&&!k&&E||v&&!a&&!x&&!u&&k&&E},ze=()=>{const a={id:W===-1?na():n[W].id,playCategoryId:de||void 0,playDetailId:te||void 0,playCategoryTags:de===""&&ee.length>0?ee:void 0,playDetailTags:te===""&&Z.length>0?Z:void 0,pointType:te?void 0:H||void 0,pointUnitType:te?void 0:B||void 0,aggregateType:O};W===-1?l([...n,a]):W!==null&&l(n.map((x,u)=>u===W?a:x)),M(!1)},Me=()=>{M(!1)},Te=a=>{i||(ue(a),he(!0))},h=()=>{L!==null&&l(n.filter((a,x)=>x!==L)),he(!1)},y=()=>{he(!1)};return e.jsxs(m,{children:[e.jsxs(m,{sx:{maxWidth:1024,mx:"auto",display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(m,{sx:{fontWeight:"bold"},children:"スタッツ設定"}),e.jsx(X,{onClick:we,variant:"contained",size:"small",startIcon:e.jsx(Ot,{}),disabled:i,children:"追加"})]}),e.jsx(xt,{component:Ge,storageKey:"match-stats-grid",sx:{maxWidth:1024,mx:"auto"},children:e.jsxs(ot,{size:"small",children:[e.jsx(dt,{children:e.jsxs(ye,{sx:{backgroundColor:a=>a.palette.mode==="dark"?"#343A42":"#f5f5f5",height:50},children:[e.jsx(p,{}),e.jsx(p,{children:"プレー区分"}),e.jsx(p,{children:"プレー詳細"}),e.jsx(p,{children:"得点区分"}),e.jsx(p,{children:"得失点単位区分"}),e.jsx(p,{children:"集計方法"}),e.jsx(p,{})]})}),e.jsx(ct,{children:n.map((a,x)=>e.jsxs(ye,{"data-index":x,onClick:()=>Ae(x),sx:{cursor:i?"default":"pointer",height:50},children:[e.jsx(p,{padding:"checkbox",children:e.jsx(m,{onClick:u=>u.stopPropagation(),onPointerDown:u=>{i||(u.stopPropagation(),_(x,u))},onPointerMove:u=>A(u),onPointerUp:u=>z(u),onPointerCancel:u=>z(u),sx:{cursor:i?"default":"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:e.jsx($t,{})})}),e.jsx(p,{children:a.playCategoryId?S(a.playCategoryId):a.playCategoryTags&&a.playCategoryTags.length>0?e.jsx(m,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:a.playCategoryTags.map(u=>{const v=c.find(k=>k.id===u);return e.jsx(_e,{label:(v==null?void 0:v.name)||u,size:"small",sx:{backgroundColor:(v==null?void 0:v.color)||De,color:"#fff"}},u)})}):""}),e.jsx(p,{children:a.playDetailId?$(a.playDetailId):a.playDetailTags&&a.playDetailTags.length>0?e.jsx(m,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:a.playDetailTags.map(u=>{const v=d.find(k=>k.id===u);return e.jsx(_e,{label:(v==null?void 0:v.name)||u,size:"small",sx:{backgroundColor:(v==null?void 0:v.color)||De,color:"#fff"}},u)})}):""}),e.jsx(p,{children:a.pointType||""}),e.jsx(p,{children:a.pointUnitType||""}),e.jsx(p,{children:a.aggregateType||"合算"}),e.jsx(p,{padding:"checkbox",children:e.jsx(m,{onClick:u=>u.stopPropagation(),sx:{width:32,height:32,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Je,{size:"small",onClick:()=>Te(x),sx:{width:24,height:24},disabled:i,children:e.jsx(gt,{fontSize:"small",color:i?"disabled":"error"})})})})]},a.id))})]})}),e.jsxs(bt,{open:U,onClose:Me,children:[e.jsxs(ke,{children:["スタッツ設定",W===-1?"追加":"編集"]}),e.jsx($e,{sx:{display:"flex",flexDirection:"column",gap:2},children:e.jsxs(e.Fragment,{children:[e.jsxs(je,{fullWidth:!0,sx:{mt:3},children:[e.jsx(ge,{id:"stat-category-label",children:"プレー区分"}),e.jsxs(be,{labelId:"stat-category-label",value:de,label:"プレー区分",onChange:a=>{Q(a.target.value),T(""),ne([]),f([])},disabled:ee.length>0||Z.length>0,children:[e.jsx(Y,{value:"",children:"なし"}),j.map(a=>e.jsx(Y,{value:a.id,children:a.name},a.id))]})]}),e.jsxs(je,{fullWidth:!0,sx:{mt:1},children:[e.jsx(ge,{id:"stat-detail-label",children:"プレー詳細"}),e.jsxs(be,{labelId:"stat-detail-label",value:te,label:"プレー詳細",onChange:a=>{T(a.target.value),g(""),D(""),ne([]),f([])},disabled:H!==""||B!==""||ee.length>0||Z.length>0,children:[e.jsx(Y,{value:"",children:"なし"}),b.filter(a=>a.playCategoryId===de).map(a=>e.jsx(Y,{value:a.id,children:a.name},a.id))]})]}),e.jsx(Nt,{multiple:!0,options:c,getOptionLabel:a=>a.name,value:c.filter(a=>ee.includes(a.id)),onChange:(a,x)=>{ne(x.map(u=>u.id)),x.length>0&&(Q(""),T(""))},disabled:de!==""||te!=="",renderTags:(a,x)=>a.map((u,v)=>e.jsx(_e,{...x({index:v}),label:u.name,size:"small",sx:{backgroundColor:u.color||De,color:"#fff"}})),renderInput:a=>e.jsx(oe,{...a,label:"プレー区分タグ",margin:"dense"}),fullWidth:!0}),e.jsx(Nt,{multiple:!0,options:d,getOptionLabel:a=>a.name,value:d.filter(a=>Z.includes(a.id)),onChange:(a,x)=>{f(x.map(u=>u.id)),x.length>0&&(Q(""),T(""))},disabled:de!==""||te!=="",renderTags:(a,x)=>a.map((u,v)=>e.jsx(_e,{...x({index:v}),label:u.name,size:"small",sx:{backgroundColor:u.color||De,color:"#fff"}})),renderInput:a=>e.jsx(oe,{...a,label:"プレー詳細タグ",margin:"dense"}),fullWidth:!0}),e.jsxs(m,{sx:{display:"flex",gap:2},children:[e.jsxs(je,{fullWidth:!0,children:[e.jsx(ge,{id:"stat-point-label",children:"得点区分"}),e.jsxs(be,{labelId:"stat-point-label",value:H,label:"得点区分",onChange:a=>{g(a.target.value),a.target.value!==""&&T("")},disabled:te!=="",children:[e.jsx(Y,{value:"",children:"なし"}),e.jsx(Y,{value:"得点",children:"得点"}),e.jsx(Y,{value:"失点",children:"失点"})]})]}),e.jsxs(je,{fullWidth:!0,children:[e.jsx(ge,{id:"stat-unit-label",children:"得失点単位区分"}),e.jsxs(be,{labelId:"stat-unit-label",value:B,label:"得失点単位区分",onChange:a=>{D(a.target.value),a.target.value!==""&&T("")},disabled:te!=="",children:[e.jsx(Y,{value:"",children:"なし"}),e.jsx(Y,{value:"メンバー",children:"メンバー"}),e.jsx(Y,{value:"チーム",children:"チーム"})]})]})]}),e.jsxs(je,{fullWidth:!0,children:[e.jsx(ge,{id:"stat-aggregate-label",children:"集計方法"}),e.jsxs(be,{labelId:"stat-aggregate-label",value:O,label:"集計方法",onChange:a=>P(a.target.value),children:[e.jsx(Y,{value:"合算",children:"合算"}),e.jsx(Y,{value:"セット平均",children:"セット平均"})]})]})]})}),e.jsxs(Oe,{children:[e.jsx(X,{onClick:Me,color:"inherit",startIcon:e.jsx(Re,{}),children:"キャンセル"}),e.jsx(X,{onClick:ze,disabled:!Ne(),startIcon:e.jsx(Ie,{}),children:"OK"})]})]}),e.jsxs(ut,{open:q,onClose:y,children:[e.jsx(ke,{children:"削除確認"}),e.jsx($e,{sx:{mt:2},children:"このスタッツ設定を削除しますか？"}),e.jsxs(Oe,{children:[e.jsx(X,{onClick:y,color:"inherit",startIcon:e.jsx(Re,{}),children:"キャンセル"}),e.jsx(X,{onClick:h,color:"error",startIcon:e.jsx(Ie,{}),children:"OK"})]})]})]})}function Is(n,l,j){var c,d;if(!n)return!1;const b=l.get(n.playCategoryId);return!(j.playDetailId&&n.id!==j.playDetailId||j.playCategoryId&&n.playCategoryId!==j.playCategoryId||j.playCategoryTags&&j.playCategoryTags.length>0&&!((c=b==null?void 0:b.tags)!=null&&c.some(i=>j.playCategoryTags.includes(i)))||j.playDetailTags&&j.playDetailTags.length>0&&!((d=n.tags)!=null&&d.some(i=>j.playDetailTags.includes(i)))||j.pointType&&n.pointType!==j.pointType||j.pointUnitType&&n.pointUnitType!==j.pointUnitType)}function ws(n,l,j,b){const c=b.map(()=>({teamA:0,teamB:0}));return n.forEach(d=>{d.rallies.forEach(i=>{b.forEach((_,A)=>{const z=i.teamAPlayDetail?l.get(i.teamAPlayDetail):void 0;Is(z,j,_)&&(c[A].teamA+=1);const S=i.teamBPlayDetail?l.get(i.teamBPlayDetail):void 0;Is(S,j,_)&&(c[A].teamB+=1)})})}),c}function ia(n,l){const j=[];let b=0,c=0,d=0,i=0;return n.forEach(A=>{let z=0,S=0,$=0,U=0;A.rallies.forEach(M=>{if(M.timeoutTeam||M.substitutionTeam||!M.serverTeam)return;const W=M.teamAPlayDetail?l.get(M.teamAPlayDetail):void 0,J=M.teamBPlayDetail?l.get(M.teamBPlayDetail):void 0;M.serverTeam==="teamA"?(S+=1,(W&&W.pointType==="得点"||J&&J.pointType==="失点")&&(z+=1)):(U+=1,(J&&J.pointType==="得点"||W&&W.pointType==="失点")&&($+=1))}),b+=z,c+=S,d+=$,i+=U,j.push({teamA:S?`${Math.round(z/S*100)}%`:"-",teamB:U?`${Math.round($/U*100)}%`:"-"})}),{overall:{teamA:c?`${Math.round(b/c*100)}%`:"-",teamB:i?`${Math.round(d/i*100)}%`:"-"},perSet:j}}function la(n,l){const j=[];let b=0,c=0,d=0,i=0;return n.forEach(A=>{let z=0,S=0,$=0,U=0;A.rallies.forEach(M=>{if(M.timeoutTeam||M.substitutionTeam||!M.serverTeam)return;const W=M.teamAPlayDetail?l.get(M.teamAPlayDetail):void 0,J=M.teamBPlayDetail?l.get(M.teamBPlayDetail):void 0;M.serverTeam==="teamB"?(S+=1,(W&&W.pointType==="得点"||J&&J.pointType==="失点")&&(z+=1)):(U+=1,(J&&J.pointType==="得点"||W&&W.pointType==="失点")&&($+=1))}),b+=z,c+=S,d+=$,i+=U,j.push({teamA:S?`${Math.round(z/S*100)}%`:"-",teamB:U?`${Math.round($/U*100)}%`:"-"})}),{overall:{teamA:c?`${Math.round(b/c*100)}%`:"-",teamB:i?`${Math.round(d/i*100)}%`:"-"},perSet:j}}function ra({sets:n,playDetails:l,playCategories:j,statsSettings:b,matchStatsSettings:c,onMatchStatsSettingsChange:d,rallyCategoryTags:i,rallyDetailTags:_,teamAName:A,teamBName:z,locked:S}){const $=new Map(l.map(g=>[g.id,g])),U=new Map(j.map(g=>[g.id,g])),M=g=>{var B;return((B=j.find(D=>D.id===g))==null?void 0:B.name)||""},W=g=>{var B;return((B=l.find(D=>D.id===g))==null?void 0:B.name)||""},J=[...b,...c],de=ws(n,$,U,J),Q=n.map(g=>ws([g],$,U,J)),te=de.map((g,B)=>{if(J[B].aggregateType==="セット平均"){const O=n.length||1;return{teamA:(g.teamA/O).toFixed(1),teamB:(g.teamB/O).toFixed(1)}}return g}),T=Q.map(g=>J.reduce((B,D,O)=>(D.aggregateType!=="セット平均"&&B.push(g[O]),B),[])),ee=J.filter(g=>g.aggregateType!=="セット平均"),ne=ia(n,$),Z=la(n,$),f=g=>{const B=[];g.playCategoryId?B.push(e.jsx("span",{children:M(g.playCategoryId)},"cat")):g.playCategoryTags&&g.playCategoryTags.length>0&&B.push(e.jsx(m,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center",mt:.5},children:g.playCategoryTags.map(O=>{const P=i.find(L=>L.id===O);return e.jsx(_e,{label:(P==null?void 0:P.name)||O,size:"small",sx:{mr:.5,mb:.5,backgroundColor:(P==null?void 0:P.color)||De,color:"#fff"}},O)})},"catTags")),g.playDetailId?B.push(e.jsx("span",{children:W(g.playDetailId)},"detail")):g.playDetailTags&&g.playDetailTags.length>0&&B.push(e.jsx(m,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center",mt:.5},children:g.playDetailTags.map(O=>{const P=_.find(L=>L.id===O);return e.jsx(_e,{label:(P==null?void 0:P.name)||O,size:"small",sx:{mr:.5,mb:.5,backgroundColor:(P==null?void 0:P.color)||De,color:"#fff"}},O)})},"detailTags"));const D=[];return g.pointType&&D.push(g.pointType),g.pointUnitType&&D.push(g.pointUnitType),D.length>0&&B.push(e.jsx("span",{children:D.join(",")},"point")),B.push(e.jsxs("span",{children:["(",g.aggregateType||"合算",")"]},"agg")),e.jsx(m,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:B.map((O,P)=>e.jsx(m,{sx:{display:"flex",justifyContent:"center"},children:O},P))})},H=(g,B,D,O,P)=>e.jsx(xt,{component:Ge,storageKey:P,sx:{mb:2},children:e.jsxs(ot,{size:"small",sx:{"& th, & td":{textAlign:"center",verticalAlign:"middle"}},children:[e.jsx(dt,{children:e.jsxs(ye,{sx:{backgroundColor:L=>L.palette.mode==="dark"?"#343A42":"#f5f5f5",height:50},children:[e.jsx(p,{children:A||"チームA"}),e.jsx(p,{children:"項目"}),e.jsx(p,{children:z||"チームB"})]})}),e.jsxs(ct,{children:[e.jsxs(ye,{sx:{height:50},children:[e.jsx(p,{children:B.teamA}),e.jsx(p,{children:"ブレイク率"}),e.jsx(p,{children:B.teamB})]},"break-rate"),e.jsxs(ye,{sx:{height:50},children:[e.jsx(p,{children:D.teamA}),e.jsx(p,{children:"サイドアウト率"}),e.jsx(p,{children:D.teamB})]},"sideout-rate"),O.map((L,ue)=>e.jsxs(ye,{sx:{height:50},children:[e.jsx(p,{children:g[ue].teamA}),e.jsx(p,{children:f(L)}),e.jsx(p,{children:g[ue].teamB})]},L.id))]})]})});return e.jsxs(m,{sx:{display:"grid",gap:2,gridTemplateColumns:{xs:"1fr",md:"repeat(2, 1fr)"},maxWidth:1024,width:"100%",mx:"auto"},children:[e.jsxs(m,{children:[e.jsx(et,{variant:"h6",sx:{mb:1},children:"試合全体のスタッツ"}),H(te,ne.overall,Z.overall,J,"stats-overall")]}),n.map((g,B)=>e.jsxs(m,{children:[e.jsx(et,{variant:"h6",sx:{mb:1},children:`${B+1}セット目(${g.my}-${g.opponent})のスタッツ`}),H(T[B],ne.perSet[B],Z.perSet[B],ee,`stats-set-${B}`)]},g.id)),e.jsxs(m,{sx:{gridColumn:"1 / -1"},children:[e.jsx(aa,{statsSettings:c,onChange:d,playCategories:j,playDetails:l,rallyCategoryTags:i,rallyDetailTags:_,disabled:S}),e.jsxs(Vs,{severity:"info",sx:{mt:1},children:["本設定は試合内のみでの設定となります",e.jsx("br",{}),"各試合共通でのスタッツ項目の設定は設定＞スタッツメニューから設定してください"]})]})]})}var ms={},oa=xe;Object.defineProperty(ms,"__esModule",{value:!0});var Gt=ms.default=void 0,da=oa(me()),ca=e;Gt=ms.default=(0,da.default)((0,ca.jsx)("path",{d:"M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m-9-2V7H4v3H1v2h3v3h2v-3h3v-2zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"PersonAdd");const ua=()=>typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():Math.random().toString(36).slice(2)+Date.now().toString(36);function xa({match:n,setMatch:l,teamAName:j,teamBName:b,teamMembers:c,onAddMember:d,locked:i}){const[_,A]=o.useState(!1),[z,S]=o.useState(!1),[$,U]=o.useState(""),[M,W]=o.useState(""),[J,de]=o.useState([]),[Q,te]=o.useState("teamA"),[T,ee]=o.useState([]),[ne,Z]=o.useState(!1),[f,H]=o.useState(null),[g,B]=o.useState(null),D=h=>{if(!h.destination||h.source.droppableId!==h.destination.droppableId||i)return;const y=h.source.droppableId==="teamA"?"teamAMembers":"teamBMembers",a=Array.from(n[y]),[x]=a.splice(h.source.index,1);a.splice(h.destination.index,0,x),l(u=>({...u,[y]:a}))},O=o.useMemo(()=>{const h=Q==="teamA"?n.teamA:n.teamB,y=c[h]||[],a=Q==="teamA"?n.teamAMembers:n.teamBMembers;return y.filter(x=>x.visible!==!1&&!a.some(u=>u.id===x.id))},[Q,n,c]),P=h=>{te(h),ee([]),A(!0)},L=h=>{ee(y=>y.some(x=>x.id===h.id)?y.filter(x=>x.id!==h.id):[...y,h])},ue=()=>{l(Q==="teamA"?h=>({...h,teamAMembers:[...h.teamAMembers,...T.map(y=>({...y,statuses:Array(h.sets.length).fill("")}))]}):h=>({...h,teamBMembers:[...h.teamBMembers,...T.map(y=>({...y,statuses:Array(h.sets.length).fill("")}))]})),A(!1)},q=()=>{A(!1)},he=(h,y)=>{i||(H(h),B(y),Z(!0))},we=()=>{f&&g!==null&&l(f==="teamA"?h=>({...h,teamAMembers:h.teamAMembers.filter((y,a)=>a!==g)}):h=>({...h,teamBMembers:h.teamBMembers.filter((y,a)=>a!==g)})),Z(!1)},Ae=()=>{Z(!1)},Ne=()=>{i||(U(""),W(""),de([]),S(!0))},ze=()=>{const h=Q==="teamA"?n.teamA:n.teamB;h&&d(h,{id:ua(),no:Number($),name:M,positions:J}),S(!1)},Me=()=>{S(!1)},Te=(h,y,a)=>{i||l(x=>{const u=h==="teamA"?"teamAMembers":"teamBMembers",v=[...x[u]],k={...v[y]},E=[...k.statuses||Array(x.sets.length).fill("")],ae=E[a]||"";let ie="";return ae===""?ie="starter":ae==="starter"?ie="libero":ie="",E[a]=ie,k.statuses=E,v[y]=k,{...x,[u]:v}})};return e.jsxs(Yt,{onDragEnd:D,children:[e.jsxs(jt,{container:!0,spacing:2,children:[e.jsxs(jt,{item:!0,xs:12,children:[e.jsxs(m,{sx:{maxWidth:1024,mx:"auto"},children:[e.jsx(et,{variant:"h6",sx:{mb:1},children:j}),e.jsx(X,{variant:"contained",size:"small",sx:{mb:1},onClick:()=>P("teamA"),disabled:i,startIcon:e.jsx(Gt,{}),children:"メンバー登録"})]}),e.jsx(xt,{component:Ge,storageKey:"members-teamA",sx:{maxWidth:1024,mx:"auto"},children:e.jsxs(ot,{size:"small",children:[e.jsx(dt,{children:e.jsxs(ye,{sx:{backgroundColor:h=>h.palette.mode==="dark"?"#343A42":"#f5f5f5",height:50},children:[e.jsx(p,{}),e.jsx(p,{children:"番号"}),e.jsx(p,{children:"名前"}),e.jsx(p,{children:"ポジション"}),n.sets.map((h,y)=>e.jsx(p,{align:"center",children:y+1},y)),e.jsx(p,{})]})}),e.jsx(_t,{droppableId:"teamA",children:h=>e.jsxs(ct,{ref:h.innerRef,...h.droppableProps,children:[n.teamAMembers.map((y,a)=>e.jsx(kt,{draggableId:`teamA-${y.id}`,index:a,isDragDisabled:i,children:x=>e.jsxs(ye,{ref:x.innerRef,...x.draggableProps,"data-index":a,sx:{cursor:i?"default":"pointer",height:50},children:[e.jsx(p,{padding:"checkbox",children:e.jsx(m,{onClick:u=>u.stopPropagation(),...x.dragHandleProps,sx:{cursor:i?"default":"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:e.jsx($t,{})})}),e.jsx(p,{children:y.no}),e.jsx(p,{children:y.name}),e.jsx(p,{children:(y.positions||[]).join(", ")}),n.sets.map((u,v)=>{var k,E,ae,ie,Ce,ce;return e.jsx(p,{padding:"checkbox",align:"center",children:e.jsx(X,{size:"small",variant:(k=y.statuses)!=null&&k[v]?"contained":"outlined",color:((E=y.statuses)==null?void 0:E[v])==="starter"?"primary":void 0,sx:{minWidth:32,width:32,p:0,...((ae=y.statuses)==null?void 0:ae[v])==="starter"?{backgroundColor:"primary.main",color:"#fff","&:hover":{backgroundColor:"primary.main"}}:((ie=y.statuses)==null?void 0:ie[v])==="libero"?{backgroundColor:"#FF9933",color:"#fff","&:hover":{backgroundColor:"#FF9933"},"&.Mui-focusVisible":{outline:"2px solid #FF9933"}}:{}},onClick:()=>Te("teamA",a,v),disabled:i,children:((Ce=y.statuses)==null?void 0:Ce[v])==="starter"?"出":((ce=y.statuses)==null?void 0:ce[v])==="libero"?"リ":"不"})},v)}),e.jsx(p,{padding:"checkbox",children:e.jsx(m,{onClick:u=>u.stopPropagation(),sx:{width:32,height:32,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Je,{size:"small",onClick:i?void 0:()=>he("teamA",a),disabled:i,sx:{width:24,height:24},children:e.jsx(gt,{fontSize:"small",color:i?"disabled":"error"})})})})]})},y.id)),h.placeholder]})})]})})]}),e.jsxs(jt,{item:!0,xs:12,children:[e.jsxs(m,{sx:{maxWidth:1024,mx:"auto"},children:[e.jsx(et,{variant:"h6",sx:{mb:1},children:b}),e.jsx(X,{variant:"contained",size:"small",sx:{mb:1},onClick:()=>P("teamB"),disabled:i,startIcon:e.jsx(Gt,{}),children:"メンバー登録"})]}),e.jsx(xt,{component:Ge,storageKey:"members-teamB",sx:{maxWidth:1024,mx:"auto"},children:e.jsxs(ot,{size:"small",children:[e.jsx(dt,{children:e.jsxs(ye,{sx:{backgroundColor:h=>h.palette.mode==="dark"?"#343A42":"#f5f5f5",height:50},children:[e.jsx(p,{}),e.jsx(p,{children:"番号"}),e.jsx(p,{children:"名前"}),e.jsx(p,{children:"ポジション"}),n.sets.map((h,y)=>e.jsx(p,{align:"center",children:y+1},y)),e.jsx(p,{})]})}),e.jsx(_t,{droppableId:"teamB",children:h=>e.jsxs(ct,{ref:h.innerRef,...h.droppableProps,children:[n.teamBMembers.map((y,a)=>e.jsx(kt,{draggableId:`teamB-${y.id}`,index:a,isDragDisabled:i,children:x=>e.jsxs(ye,{ref:x.innerRef,...x.draggableProps,"data-index":a,sx:{cursor:i?"default":"pointer",height:50},children:[e.jsx(p,{padding:"checkbox",children:e.jsx(m,{onClick:u=>u.stopPropagation(),...x.dragHandleProps,sx:{cursor:i?"default":"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:e.jsx($t,{})})}),e.jsx(p,{children:y.no}),e.jsx(p,{children:y.name}),e.jsx(p,{children:(y.positions||[]).join(", ")}),n.sets.map((u,v)=>{var k,E,ae,ie,Ce,ce;return e.jsx(p,{padding:"checkbox",align:"center",children:e.jsx(X,{size:"small",variant:(k=y.statuses)!=null&&k[v]?"contained":"outlined",color:((E=y.statuses)==null?void 0:E[v])==="starter"?"primary":void 0,sx:{minWidth:32,width:32,p:0,...((ae=y.statuses)==null?void 0:ae[v])==="starter"?{backgroundColor:"primary.main",color:"#fff","&:hover":{backgroundColor:"primary.main"}}:((ie=y.statuses)==null?void 0:ie[v])==="libero"?{backgroundColor:"#FF9933",color:"#fff","&:hover":{backgroundColor:"#FF9933"},"&.Mui-focusVisible":{outline:"2px solid #FF9933"}}:{}},onClick:()=>Te("teamB",a,v),disabled:i,children:((Ce=y.statuses)==null?void 0:Ce[v])==="starter"?"出":((ce=y.statuses)==null?void 0:ce[v])==="libero"?"リ":"不"})},v)}),e.jsx(p,{padding:"checkbox",children:e.jsx(m,{onClick:u=>u.stopPropagation(),sx:{width:32,height:32,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Je,{size:"small",onClick:i?void 0:()=>he("teamB",a),disabled:i,sx:{width:24,height:24},children:e.jsx(gt,{fontSize:"small",color:i?"disabled":"error"})})})})]})},y.id)),h.placeholder]})})]})})]})]}),e.jsxs(bt,{open:_,onClose:q,children:[e.jsx(ke,{children:"メンバー選択"}),e.jsxs($e,{sx:{mt:2},children:[e.jsx(m,{sx:{display:"flex",justifyContent:"flex-end",mb:1},children:e.jsx(X,{onClick:Ne,variant:"contained",size:"small",startIcon:e.jsx(Ot,{}),disabled:i||!(Q==="teamA"?n.teamA:n.teamB),children:"追加"})}),e.jsx(xt,{component:Ge,storageKey:`members-select-${Q}`,children:e.jsxs(ot,{size:"small",children:[e.jsx(dt,{children:e.jsxs(ye,{sx:{backgroundColor:h=>h.palette.mode==="dark"?"#343A42":"#f5f5f5",height:50},children:[e.jsx(p,{padding:"checkbox"}),e.jsx(p,{children:"番号"}),e.jsx(p,{children:"名前"}),e.jsx(p,{children:"ポジション"})]})}),e.jsx(ct,{children:O.map(h=>{const y=T.some(a=>a.id===h.id);return e.jsxs(ye,{sx:{cursor:"pointer",height:50},children:[e.jsx(p,{padding:"checkbox",onClick:a=>a.stopPropagation(),children:e.jsx(Ns,{checked:y,onChange:()=>L(h)})}),e.jsx(p,{children:h.no}),e.jsx(p,{children:h.name}),e.jsx(p,{children:(h.positions||[]).join(", ")})]},h.id)})})]})})]}),e.jsxs(Oe,{children:[e.jsx(X,{onClick:q,startIcon:e.jsx(Re,{}),color:"inherit",children:"キャンセル"}),e.jsx(X,{onClick:ue,disabled:T.length===0,startIcon:e.jsx(Ie,{}),children:"OK"})]})]}),e.jsxs(bt,{open:z,onClose:Me,children:[e.jsx(ke,{children:"メンバー追加"}),e.jsxs($e,{sx:{display:"flex",flexDirection:"column",gap:2,mt:2},children:[e.jsx(oe,{label:"番号",type:"number",value:$,onChange:h=>U(h.target.value),margin:"dense"}),e.jsx(oe,{label:"名前",value:M,onChange:h=>W(h.target.value),margin:"dense"}),e.jsxs(je,{children:[e.jsx(ge,{id:"md-positions-label",children:"ポジション"}),e.jsxs(be,{labelId:"md-positions-label",multiple:!0,value:J,label:"ポジション",onChange:h=>de(typeof h.target.value=="string"?h.target.value.split(","):h.target.value),renderValue:h=>h.join(", "),children:[e.jsx(Y,{value:"レフト",children:"レフト"}),e.jsx(Y,{value:"センター",children:"センター"}),e.jsx(Y,{value:"ライト",children:"ライト"}),e.jsx(Y,{value:"セッター",children:"セッター"}),e.jsx(Y,{value:"リベロ",children:"リベロ"})]})]})]}),e.jsxs(Oe,{children:[e.jsx(X,{onClick:Me,startIcon:e.jsx(Re,{}),color:"inherit",children:"キャンセル"}),e.jsx(X,{onClick:ze,disabled:$==="",startIcon:e.jsx(Ie,{}),children:"OK"})]})]}),e.jsxs(ut,{open:ne,onClose:Ae,children:[e.jsx(ke,{children:"削除確認"}),e.jsx($e,{sx:{mt:2},children:"このメンバーを削除しますか？"}),e.jsxs(Oe,{children:[e.jsx(X,{onClick:Ae,startIcon:e.jsx(Re,{}),color:"inherit",children:"キャンセル"}),e.jsx(X,{onClick:we,color:"error",startIcon:e.jsx(Ie,{}),children:"OK"})]})]})]})}function ma({match:n,setMatch:l,tags:j,onAddTag:b,locked:c}){return e.jsx(m,{sx:{maxWidth:1024,mx:"auto"},children:e.jsx(jt,{container:!0,spacing:2,children:e.jsx(jt,{item:!0,xs:12,children:e.jsxs(Ge,{elevation:0,sx:{p:2},children:[e.jsx(oe,{label:"試合日付",type:"date",InputLabelProps:{shrink:!0},value:n.date,onChange:d=>l(i=>({...i,date:d.target.value})),fullWidth:!0,margin:"dense",disabled:c,sx:{"& .MuiOutlinedInput-root":{height:56},"& .MuiOutlinedInput-input":{padding:"0 14px",height:"100%",lineHeight:"56px",fontSize:"1rem",textAlign:"left"},'& input[type="date"]':{WebkitAppearance:"none"}}}),e.jsx(oe,{label:"試合名",value:n.matchName,onChange:d=>l(i=>({...i,matchName:d.target.value})),fullWidth:!0,margin:"dense",disabled:c}),e.jsx(Nt,{multiple:!0,freeSolo:!0,options:j,getOptionLabel:d=>typeof d=="string"?d:d.name,value:n.tags.map(d=>j.find(i=>i.id===d)).filter(Boolean),onChange:(d,i)=>{const _=[];i.forEach(A=>{if(typeof A=="string"){const z={id:crypto.randomUUID(),name:A,color:De};b(z),_.push(z.id)}else _.push(A.id)}),l(A=>({...A,tags:_}))},renderTags:(d,i)=>d.map((_,A)=>e.jsx(_e,{...i({index:A}),label:_.name,sx:{backgroundColor:_.color||De,color:"#fff",mr:.5,mb:.5}})),renderInput:d=>e.jsx(oe,{...d,label:"タグ",margin:"dense"}),fullWidth:!0,disabled:c}),e.jsx(oe,{label:"場所",value:n.location,onChange:d=>l(i=>({...i,location:d.target.value})),fullWidth:!0,margin:"dense",disabled:c}),e.jsx(oe,{label:"主審",value:n.mainReferee,onChange:d=>l(i=>({...i,mainReferee:d.target.value})),fullWidth:!0,margin:"dense",disabled:c}),e.jsx(oe,{label:"副審",value:n.subReferee,onChange:d=>l(i=>({...i,subReferee:d.target.value})),fullWidth:!0,margin:"dense",disabled:c}),e.jsx(oe,{label:"動画URL",value:n.videoUrl,onChange:d=>l(i=>({...i,videoUrl:d.target.value})),multiline:!0,rows:3,fullWidth:!0,margin:"dense",disabled:c}),e.jsx(oe,{label:"メモ",value:n.memo,onChange:d=>l(i=>({...i,memo:d.target.value})),multiline:!0,rows:3,fullWidth:!0,margin:"dense",disabled:c})]})})})})}function ha({match:n,setMatch:l,teams:j,locked:b}){return e.jsxs(Ge,{elevation:0,sx:{p:2},children:[e.jsxs(je,{fullWidth:!0,margin:"normal",disabled:b,children:[e.jsx(ge,{id:"teamA-label",children:"チームA"}),e.jsx(be,{labelId:"teamA-label",value:n.teamA,label:"チームA",onChange:c=>l(d=>({...d,teamA:c.target.value,teamAMembers:[]})),disabled:b,children:j.map(c=>e.jsx(Y,{value:c.id,children:c.name},c.id))})]}),e.jsx(oe,{label:"チームA監督",value:n.teamAHeadCoach,onChange:c=>l(d=>({...d,teamAHeadCoach:c.target.value})),fullWidth:!0,margin:"dense",disabled:b}),e.jsx(oe,{label:"チームAコーチ",value:n.teamACoach,onChange:c=>l(d=>({...d,teamACoach:c.target.value})),fullWidth:!0,margin:"dense",disabled:b}),e.jsx(oe,{label:"チームAマネージャー",value:n.teamAManager,onChange:c=>l(d=>({...d,teamAManager:c.target.value})),fullWidth:!0,margin:"dense",disabled:b}),e.jsx(oe,{label:"チームAキャプテン",value:n.teamACaptain,onChange:c=>l(d=>({...d,teamACaptain:c.target.value})),fullWidth:!0,margin:"dense",disabled:b}),e.jsxs(je,{fullWidth:!0,margin:"normal",disabled:b,children:[e.jsx(ge,{id:"teamB-label",children:"チームB"}),e.jsx(be,{labelId:"teamB-label",value:n.teamB,label:"チームB",onChange:c=>l(d=>({...d,teamB:c.target.value,teamBMembers:[]})),disabled:b,children:j.map(c=>e.jsx(Y,{value:c.id,children:c.name},c.id))})]}),e.jsx(oe,{label:"チームB監督",value:n.teamBHeadCoach,onChange:c=>l(d=>({...d,teamBHeadCoach:c.target.value})),fullWidth:!0,margin:"dense",disabled:b}),e.jsx(oe,{label:"チームBコーチ",value:n.teamBCoach,onChange:c=>l(d=>({...d,teamBCoach:c.target.value})),fullWidth:!0,margin:"dense",disabled:b}),e.jsx(oe,{label:"チームBマネージャー",value:n.teamBManager,onChange:c=>l(d=>({...d,teamBManager:c.target.value})),fullWidth:!0,margin:"dense",disabled:b}),e.jsx(oe,{label:"チームBキャプテン",value:n.teamBCaptain,onChange:c=>l(d=>({...d,teamBCaptain:c.target.value})),fullWidth:!0,margin:"dense",disabled:b})]})}const fa=tn.create(m),pa=()=>typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():Math.random().toString(36).slice(2)+Date.now().toString(36);function Aa({match:n,onSave:l,teams:j,teamMembers:b,playDetails:c,playCategories:d,statsSettings:i,rallyCategoryTags:_,rallyDetailTags:A,themeSetting:z,scoreInputSetting:S,onAddMember:$,setAppBarAction:U,setAppBarLeftAction:M,onDirtyChange:W,tags:J,onAddTag:de}){const Q=Ys(),te=Xs(),[T,ee]=o.useState("info"),ne=!1;o.useEffect(()=>{const r=te.pathname.split("/").filter(Boolean);if(r[0]!=="matches"||r[1]!==n.id)return;const C=r[2]??"info";C==="setinfo"?(ee("info"),Q(`/matches/${n.id}/info`,{replace:!0})):(ee(C),r[2]||Q(`/matches/${n.id}/info`,{replace:!0}))},[te.pathname,Q,n.id,ne]);const Z=o.useCallback(r=>{const C=r.teamA,w=r.teamB,N=(se,F)=>!!F&&(b[se]||[]).some(le=>le.id===F&&le.visible!==!1),G=(se,F)=>F.filter(le=>N(se,le.id)).map(le=>{const pe=(b[se]||[]).find(re=>re.id===le.id);return pe?{...le,no:pe.no,name:pe.name,positions:pe.positions}:le});return{...r,teamAMembers:G(C,r.teamAMembers),teamBMembers:G(w,r.teamBMembers),sets:r.sets.map(se=>({...se,rallies:se.rallies.map(F=>({...F,server:N(F.serverTeam==="teamA"?C:w,F.server)?F.server:void 0,teamAMember:N(C,F.teamAMember)?F.teamAMember:void 0,teamBMember:N(w,F.teamBMember)?F.teamBMember:void 0}))}))}},[b]),[f,H]=o.useState(()=>Z({...n,tags:n.tags||[],matchStatsSettings:n.matchStatsSettings||[],teamAMembers:n.teamAMembers.map(r=>({...r,statuses:r.statuses??Array(n.sets.length).fill("")})),teamBMembers:n.teamBMembers.map(r=>({...r,statuses:r.statuses??Array(n.sets.length).fill("")}))})),g=5,B=[$s,Os,Rs,zs,Hs],D=!!n.locked,O=Ms(),P=qs(O.breakpoints.up("sm")),[L,ue]=o.useState(!1),[q,he]=o.useState(!1),we=200,Ae=56,Ne=o.useRef(null),[ze,Me]=o.useState(!1),Te=o.useCallback(()=>{L?(he(!1),ue(!1)):(ue(!0),P||he(!0))},[L,P]),h=o.useCallback(r=>{r.propertyName==="width"&&P&&L&&he(!0)},[P,L]);o.useEffect(()=>{P||(ue(!1),he(!1))},[P]),o.useEffect(()=>(M(e.jsxs(e.Fragment,{children:[e.jsx(Je,{color:"inherit",onClick:Te,ref:Ne,children:e.jsx(qt,{})}),e.jsx(Ut,{open:ze,anchorEl:Ne.current,onClose:()=>Me(!1),anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},slotProps:{paper:{sx:{mt:.25}}},children:e.jsxs(m,{sx:{p:1,maxWidth:260},children:[e.jsxs(et,{variant:"body2",children:[e.jsx(qt,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),"からメニューを開き、各セットのメニューをロングタップし上下にスライドすることでセット順の変更が可能です"]}),e.jsx(m,{sx:{textAlign:"right",mt:1},children:e.jsx(Wt,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem("tutorial-set-reorder","1"),Me(!1)},children:"了解した"})})]})})]})),()=>M(null)),[M,Te,ze]);const[y,a]=o.useState(!1),[x,u]=o.useState(!1),[v,k]=o.useState(null),[E,ae]=o.useState(!1),[ie,Ce]=o.useState({open:!1,message:"",severity:"success"}),ce=`matchDraft-${n.id}`,mt=o.useRef(!1),vt=o.useRef(null),tt=o.useRef(null),[yt,Ye]=o.useState(!1),[Xe,st]=o.useState(!1),[Se,nt]=o.useState({}),Qe=o.useCallback((r,C,w=!0)=>{H(N=>{const G=[...N.sets],se=G.findIndex(le=>le.id===r);if(se===-1)return N;const F=G[se];return w&&nt(le=>{const pe=le[r]||{undo:[]};return{...le,[r]:{undo:[...pe.undo,F],redo:[]}}}),G[se]=C,{...N,sets:G}})},[]),ht=o.useCallback(()=>{if(!/^[0-9]+$/.test(T))return;const r=Number(T)-1,C=f.sets[r],w=Se[C.id];if(!w||w.undo.length===0)return;const N=w.undo[w.undo.length-1];nt(G=>({...G,[C.id]:{undo:w.undo.slice(0,-1),redo:[...w.redo,C]}})),Qe(C.id,N,!1)},[T,f.sets,Se,Qe]),ft=o.useCallback(()=>{if(!/^[0-9]+$/.test(T))return;const r=Number(T)-1,C=f.sets[r],w=Se[C.id];if(!w||w.redo.length===0)return;const N=w.redo[w.redo.length-1];nt(G=>({...G,[C.id]:{undo:[...w.undo,C],redo:w.redo.slice(0,-1)}})),Qe(C.id,N,!1)},[T,f.sets,Se,Qe]),Ct=r=>{if(!r.destination||D)return;const C=r.source.index,w=r.destination.index;if(C===w)return;const N=Array.from(f.sets),[G]=N.splice(C,1);N.splice(w,0,G);const se=pe=>pe.map(re=>{const Pe=Array.from(re.statuses||[]),[t]=Pe.splice(C,1);return Pe.splice(w,0,t),{...re,statuses:Pe}}),F=se(f.teamAMembers),le=se(f.teamBMembers);H(pe=>({...pe,sets:N,teamAMembers:F,teamBMembers:le}))};o.useEffect(()=>{nt(r=>{const C={...r};return Object.keys(C).forEach(w=>{f.sets.some(N=>N.id===w)||delete C[w]}),C})},[f.sets]),o.useEffect(()=>{H(r=>Z(r))},[Z]);const We=r=>{var C;return((C=j.find(w=>w.id===r))==null?void 0:C.name)||""},fe=o.useMemo(()=>f.date!==n.date||f.matchName!==n.matchName||f.location!==n.location||f.mainReferee!==n.mainReferee||f.subReferee!==n.subReferee||f.videoUrl!==n.videoUrl||f.memo!==n.memo||f.teamA!==n.teamA||f.teamAHeadCoach!==n.teamAHeadCoach||f.teamACoach!==n.teamACoach||f.teamAManager!==n.teamAManager||f.teamACaptain!==n.teamACaptain||f.teamB!==n.teamB||f.teamBHeadCoach!==n.teamBHeadCoach||f.teamBCoach!==n.teamBCoach||f.teamBManager!==n.teamBManager||f.teamBCaptain!==n.teamBCaptain||JSON.stringify(f.tags)!==JSON.stringify(n.tags)||JSON.stringify(f.teamAMembers)!==JSON.stringify(n.teamAMembers)||JSON.stringify(f.teamBMembers)!==JSON.stringify(n.teamBMembers)||JSON.stringify(f.matchStatsSettings||[])!==JSON.stringify(n.matchStatsSettings||[])||JSON.stringify(f.sets)!==JSON.stringify(n.sets),[f,n]);o.useEffect(()=>{localStorage.getItem(ce)&&ae(!0)},[ce]),o.useEffect(()=>{if(!mt.current){mt.current=!0;return}fe?localStorage.setItem(ce,JSON.stringify(f)):localStorage.removeItem(ce)},[f,fe,ce]);const St=()=>{if(D||f.sets.length>=g)return;f.sets.length===1&&!localStorage.getItem("tutorial-set-reorder")&&Me(!0);const r={id:pa(),my:0,opponent:0,rallies:[]};H(C=>({...C,sets:[...C.sets,r],teamAMembers:C.teamAMembers.map(w=>({...w,statuses:[...w.statuses||[],""]})),teamBMembers:C.teamBMembers.map(w=>({...w,statuses:[...w.statuses||[],""]}))})),Q(`/matches/${n.id}/${f.sets.length+1}`)},Rt=r=>{D||(k(r),u(!0))},zt=()=>{if(v===null)return;const r=v;let C=[],w=[],N=[];const G=T;let se=T;if(T!=="info"&&T!=="members"&&T!=="stats"&&T!=="setinfo"){const F=Number(T)-1;F===r?(se="info",Q(`/matches/${n.id}/info`)):F>r&&(se=String(F),Q(`/matches/${n.id}/${F}`))}ee(se),H(F=>{C=F.sets.map(re=>({...re})),w=F.teamAMembers.map(re=>({...re,statuses:re.statuses?[...re.statuses]:[]})),N=F.teamBMembers.map(re=>({...re,statuses:re.statuses?[...re.statuses]:[]}));const le=F.sets.filter((re,Pe)=>Pe!==r),pe=re=>re.map(Pe=>({...Pe,statuses:(Pe.statuses||[]).filter((t,s)=>s!==r)}));return{...F,sets:le,teamAMembers:pe(F.teamAMembers),teamBMembers:pe(F.teamBMembers)}}),k(null),u(!1),Ce({open:!0,message:"セットを削除しました",severity:"success",actionLabel:"元に戻す",onAction:()=>{H(F=>({...F,sets:C,teamAMembers:w,teamBMembers:N})),G!=="info"&&G!=="members"&&G!=="stats"&&G!=="setinfo"&&Q(`/matches/${n.id}/${G}`)},autoHideDuration:5e3})},At=()=>{k(null),u(!1)},pt=o.useCallback(()=>{a(!0)},[]),Tt=async()=>{const r=Z(f);H(r);try{await Promise.resolve(l(r)),localStorage.removeItem(ce),Ce({open:!0,message:"保存しました",severity:"success"})}catch{Ce({open:!0,message:"保存に失敗しました",severity:"error"})}a(!1)},Bt=()=>{a(!1)},Ht=()=>{Ce(r=>({...r,open:!1}))},Dt=()=>{const r=localStorage.getItem(ce);if(!r){ae(!1);return}try{const C=JSON.parse(r),w={...C,tags:C.tags||[],matchStatsSettings:C.matchStatsSettings||[],teamAMembers:C.teamAMembers.map(G=>({...G,statuses:G.statuses??Array(C.sets.length).fill("")})),teamBMembers:C.teamBMembers.map(G=>({...G,statuses:G.statuses??Array(C.sets.length).fill("")}))},N=Z(w);H(N),l(N)}catch{}localStorage.removeItem(ce),ae(!1)},It=()=>{localStorage.removeItem(ce),ae(!1)},He=o.useMemo(()=>/^[0-9]+$/.test(T),[T]),qe=o.useMemo(()=>He?f.sets[Number(T)-1]:null,[He,T,f.sets]),at=o.useMemo(()=>{var r;return!He||D||!qe||!((r=Se[qe.id])!=null&&r.undo.length)},[He,D,qe,Se]),Ze=o.useMemo(()=>{var r;return!He||D||!qe||!((r=Se[qe.id])!=null&&r.redo.length)},[He,D,qe,Se]);o.useEffect(()=>{at?Ye(!1):localStorage.getItem("tutorial-undo")||Ye(!0)},[at]),o.useEffect(()=>{Ze?st(!1):localStorage.getItem("tutorial-redo")||st(!0)},[Ze]),o.useEffect(()=>(U(e.jsxs(m,{sx:{display:"flex",alignItems:"center"},children:[He&&e.jsxs(e.Fragment,{children:[e.jsx(Je,{ref:vt,onClick:ht,disabled:at,color:"inherit",sx:{ml:1},children:e.jsx(Kt,{})}),e.jsx(Ut,{open:yt,anchorEl:vt.current,onClose:()=>Ye(!1),anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},slotProps:{paper:{sx:{mt:.25}}},children:e.jsxs(m,{sx:{p:1,maxWidth:260},children:[e.jsxs(et,{variant:"body2",children:["各セットタブで独立し、ラリー結果の操作履歴を保持しています。",e.jsx("br",{}),e.jsx(Kt,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),"を選択することで1つ前の操作を取り消すことができます。",e.jsx("br",{}),"操作履歴は試合画面を離れると消去されます。"]}),e.jsx(m,{sx:{textAlign:"right",mt:1},children:e.jsx(Wt,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem("tutorial-undo","1"),Ye(!1)},children:"了解した"})})]})}),e.jsx(Je,{ref:tt,onClick:ft,disabled:Ze,color:"inherit",sx:{ml:1},children:e.jsx(Jt,{})}),e.jsx(Ut,{open:Xe,anchorEl:tt.current,onClose:()=>st(!1),anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},slotProps:{paper:{sx:{mt:.25}}},children:e.jsxs(m,{sx:{p:1,maxWidth:260},children:[e.jsxs(et,{variant:"body2",children:[e.jsx(Jt,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),"を選択することで1つ前に取り消した操作を復活することができます。"]}),e.jsx(m,{sx:{textAlign:"right",mt:1},children:e.jsx(Wt,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem("tutorial-redo","1"),st(!1)},children:"了解した"})})]})})]}),e.jsx(X,{onClick:pt,variant:"contained",disabled:!fe||D,startIcon:e.jsx(Es,{}),sx:{ml:1},children:"保存"})]})),()=>U(null)),[U,He,ht,ft,pt,fe,D,at,Ze,yt,Xe]),o.useEffect(()=>(W==null||W(fe),()=>W==null?void 0:W(!1)),[fe,W]);const it=[{key:"info",label:"試合概要",icon:e.jsx(Zs,{})},{key:"team",label:"チーム",icon:e.jsx(ks,{})},{key:"members",label:"メンバー登録",icon:e.jsx(Ps,{})},{key:"sep1",divider:!0},{key:"stats",label:"スタッツ",icon:e.jsx(en,{})},{key:"sep2",divider:!0},{key:"setinfo",label:"セット情報",icon:e.jsx(_s,{})}].filter(r=>r.key!=="setinfo"),Ee=f.sets.map((r,C)=>{const w=B[C];return{key:`${C+1}`,icon:e.jsx(w,{}),label:`${r.my}-${r.opponent}`}}),wt=!D&&f.sets.length<g?[{key:"add",label:"セット追加",icon:e.jsx(Ot,{})}]:[],lt=r=>{r==="add"?St():(ee(r),Q(`/matches/${n.id}/${r}`)),P||(he(!1),ue(!1))},Ke=e.jsxs(fa,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},sx:{flexGrow:1,overflowY:"auto",display:"flex",flexDirection:"column"},children:[T==="info"&&e.jsx(ma,{match:f,setMatch:H,tags:J,onAddTag:de,locked:D}),T==="members"&&e.jsx(xa,{match:f,setMatch:H,teamAName:We(f.teamA)||"チームA",teamBName:We(f.teamB)||"チームB",teamMembers:b,onAddMember:$,locked:D}),T==="stats"&&e.jsx(ra,{sets:f.sets,playDetails:c,playCategories:d,statsSettings:i,matchStatsSettings:f.matchStatsSettings||[],onMatchStatsSettingsChange:r=>H(C=>({...C,matchStatsSettings:r})),rallyCategoryTags:_,rallyDetailTags:A,teamAName:We(f.teamA),teamBName:We(f.teamB),locked:D}),T==="team"&&e.jsx(m,{sx:{maxWidth:1024,mx:"auto"},children:e.jsx(ha,{match:f,setMatch:H,teams:j,locked:D})}),ne,T!=="info"&&T!=="members"&&T!=="stats"&&T!=="setinfo"&&T!=="team"&&e.jsx(ta,{setScore:f.sets[Number(T)-1],playDetails:c,playCategories:d,teamAMembers:f.teamAMembers,teamBMembers:f.teamBMembers,teamAName:We(f.teamA),teamBName:We(f.teamB),locked:D,scoreInputSetting:S,themeSetting:z,onChange:r=>Qe(r.id,r)})]},T);return e.jsxs(m,{sx:{display:"flex",height:"100%"},children:[e.jsx(Ks,{variant:P?"permanent":"temporary",open:P?!0:L,onClose:()=>{he(!1),ue(!1)},PaperProps:{onTransitionEnd:h},ModalProps:{keepMounted:!0,BackdropProps:{sx:{backgroundColor:"rgba(0, 0, 0, 0.5)"}}},sx:{width:P?L?we:Ae:we,flexShrink:0,transition:O.transitions.create("width",{easing:O.transitions.easing.sharp,duration:O.transitions.duration.standard}),...P?{zIndex:O.zIndex.appBar-1}:{},"& .MuiDrawer-paper":{width:P?L?we:Ae:we,boxSizing:"border-box",overflowX:"hidden",transition:O.transitions.create("width",{easing:O.transitions.easing.sharp,duration:O.transitions.duration.standard}),...P?{top:O.mixins.toolbar.minHeight,height:`calc(100% - ${O.mixins.toolbar.minHeight}px)`,zIndex:O.zIndex.appBar-1}:{}}},children:e.jsxs(Js,{children:[it.map(r=>r.divider?e.jsx(Gs,{component:"li"},r.key):e.jsxs(Lt,{selected:T===r.key,onClick:()=>lt(r.key),sx:{minHeight:48,justifyContent:L?"initial":"center",px:2.5},children:[e.jsx(Ft,{sx:{minWidth:0,mr:L?3:0,justifyContent:"center"},children:r.icon}),e.jsx(Vt,{primary:r.label??`セット${r.key}`,sx:{opacity:q?1:0,display:q?"block":"none",whiteSpace:"nowrap"}})]},r.key)),e.jsx(Yt,{onDragEnd:Ct,children:e.jsx(_t,{droppableId:"drawer-sets",children:r=>e.jsxs(m,{ref:r.innerRef,...r.droppableProps,children:[Ee.map((C,w)=>e.jsx(kt,{draggableId:f.sets[w].id,index:w,children:N=>e.jsxs(Lt,{ref:N.innerRef,...N.draggableProps,...N.dragHandleProps,style:N.draggableProps.style,selected:T===C.key,onClick:()=>lt(C.key),sx:{minHeight:48,justifyContent:L?"initial":"center",px:2.5},children:[e.jsx(Ft,{sx:{minWidth:0,mr:L?3:0,justifyContent:"center"},children:C.icon}),e.jsx(Vt,{primary:C.label??`セット${C.key}`,sx:{opacity:q?1:0,display:q?"block":"none",whiteSpace:"nowrap"}}),!D&&L&&e.jsx(Je,{edge:"end",onClick:G=>{G.stopPropagation(),Rt(w)},children:e.jsx(gt,{})})]})},f.sets[w].id)),r.placeholder]})})}),wt.map(r=>e.jsxs(Lt,{selected:T===r.key,onClick:()=>lt(r.key),sx:{minHeight:48,justifyContent:L?"initial":"center",px:2.5},children:[e.jsx(Ft,{sx:{minWidth:0,mr:L?3:0,justifyContent:"center"},children:r.icon}),e.jsx(Vt,{primary:r.label??`セット${r.key}`,sx:{opacity:q?1:0,display:q?"block":"none",whiteSpace:"nowrap"}})]},r.key))]})}),e.jsxs(m,{sx:{flexGrow:1,display:"flex",flexDirection:"column",width:P?`calc(100% - ${L?we:Ae}px)`:"100%",transition:P?O.transitions.create("width",{duration:O.transitions.duration.standard}):void 0},children:[e.jsx(m,{sx:{mt:2,flexGrow:1,position:"relative",overflowY:"hidden",display:"flex",width:"100%"},children:e.jsx(sn,{mode:"wait",children:Ke})}),e.jsxs(ut,{open:x,onClose:At,children:[e.jsx(ke,{children:"削除確認"}),e.jsx($e,{sx:{mt:2},children:"このセットを削除しますか？"}),e.jsxs(Oe,{children:[e.jsx(X,{onClick:At,startIcon:e.jsx(Re,{}),color:"inherit",children:"キャンセル"}),e.jsx(X,{onClick:zt,color:"error",startIcon:e.jsx(Ie,{}),children:"OK"})]})]}),e.jsxs(ut,{open:E,onClose:It,children:[e.jsx(ke,{children:"復元確認"}),e.jsx($e,{sx:{mt:2},children:"入力途中のデータが存在します。復元しますか？"}),e.jsxs(Oe,{children:[e.jsx(X,{onClick:It,startIcon:e.jsx(Re,{}),color:"inherit",children:"いいえ"}),e.jsx(X,{onClick:Dt,startIcon:e.jsx(Ie,{}),children:"はい"})]})]}),e.jsxs(ut,{open:y,onClose:Bt,children:[e.jsx(ke,{children:"保存確認"}),e.jsx($e,{sx:{mt:2},children:"入力内容を保存しますか？"}),e.jsxs(Oe,{children:[e.jsx(X,{onClick:Bt,startIcon:e.jsx(Re,{}),color:"inherit",children:"キャンセル"}),e.jsx(X,{onClick:Tt,disabled:!fe||D,startIcon:e.jsx(Ie,{}),children:"OK"})]})]}),e.jsx(Qs,{open:ie.open,message:ie.message,severity:ie.severity,onClose:Ht,actionLabel:ie.actionLabel,onAction:ie.onAction,autoHideDuration:ie.autoHideDuration})]})]})}export{Aa as default};
