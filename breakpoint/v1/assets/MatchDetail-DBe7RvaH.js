import{i as pe,j as e,B as u,a as Xt,K as at,Z as it,f as lt,g as mt,h as ht,k as Ae,l as h,m as ft,C as He,I as st,G as $e,L as rt,N as Ys,r as Ut,O as Pt,n as Le,o as Ee,d as et,e as qe,F as ye,Q as Ce,S as Se,M as X,p as We,q as Q,D as pt,R as Kt,U as oe,A as Rs,V as Ct,W as Xs,b as Qs,X as Zs,Y as en,_ as tn,$ as Vt,a0 as Nt,a1 as qt}from"./mui-vendor-0BmcROP4.js";import{r as o,f as sn,u as nn}from"./react-vendor-QLNaZ7XN.js";import{r as je,u as $s,S as jt,D as ke,d as nt,a as Ot,R as St,b as Ue,c as _e,A as an}from"./index-DvZwjNoh.js";import{d as ln,a as rn}from"./QueryStatsOutlined-D1Hb2cpC.js";import{d as ks}from"./SpaceDashboardOutlined-YVRIy-Dh.js";import{D as Qt,C as kt,P as _t,d as dt}from"./DragIndicator-Bik0IU_S.js";import{m as on,A as dn}from"./motion-vendor-CtLLg_49.js";import"./chart-vendor-BtE8BaVf.js";var Zt={},cn=pe;Object.defineProperty(Zt,"__esModule",{value:!0});var zs=Zt.default=void 0,un=cn(je()),xn=e;zs=Zt.default=(0,un.default)((0,xn.jsx)("path",{d:"M12 5.9c1.16 0 2.1.94 2.1 2.1s-.94 2.1-2.1 2.1S9.9 9.16 9.9 8s.94-2.1 2.1-2.1m0 9c2.97 0 6.1 1.46 6.1 2.1v1.1H5.9V17c0-.64 3.13-2.1 6.1-2.1M12 4C9.79 4 8 5.79 8 8s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4m0 9c-2.67 0-8 1.34-8 4v3h16v-3c0-2.66-5.33-4-8-4"}),"PersonOutlineOutlined");var es={},mn=pe;Object.defineProperty(es,"__esModule",{value:!0});var Fs=es.default=void 0,hn=mn(je()),fn=e;Fs=es.default=(0,hn.default)((0,fn.jsx)("path",{d:"M2 17h2v.5H3v1h1v.5H2v1h3v-4H2zm1-9h1V4H2v1h1zm-1 3h1.8L2 13.1v.9h3v-1H3.2L5 10.9V10H2zm5-6v2h14V5zm0 14h14v-2H7zm0-6h14v-2H7z"}),"FormatListNumberedOutlined");var ts={},pn=pe;Object.defineProperty(ts,"__esModule",{value:!0});var Hs=ts.default=void 0,jn=pn(je()),gn=e;Hs=ts.default=(0,jn.default)((0,gn.jsx)("path",{d:"M9 13.75c-2.34 0-7 1.17-7 3.5V19h14v-1.75c0-2.33-4.66-3.5-7-3.5M4.34 17c.84-.58 2.87-1.25 4.66-1.25s3.82.67 4.66 1.25zM9 12c1.93 0 3.5-1.57 3.5-3.5S10.93 5 9 5 5.5 6.57 5.5 8.5 7.07 12 9 12m0-5c.83 0 1.5.67 1.5 1.5S9.83 10 9 10s-1.5-.67-1.5-1.5S8.17 7 9 7m7.04 6.81c1.16.84 1.96 1.96 1.96 3.44V19h4v-1.75c0-2.02-3.5-3.17-5.96-3.44M15 12c1.93 0 3.5-1.57 3.5-3.5S16.93 5 15 5c-.54 0-1.04.13-1.5.35.63.89 1 1.98 1 3.15s-.37 2.26-1 3.15c.46.22.96.35 1.5.35"}),"GroupOutlined");var ss={},bn=pe;Object.defineProperty(ss,"__esModule",{value:!0});var Ls=ss.default=void 0,vn=bn(je()),yn=e;Ls=ss.default=(0,vn.default)((0,yn.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V5h14zm-7-2h2V7h-4v2h2z"}),"LooksOneOutlined");var ns={},Cn=pe;Object.defineProperty(ns,"__esModule",{value:!0});var Es=ns.default=void 0,Sn=Cn(je()),Tn=e;Es=ns.default=(0,Sn.default)((0,Tn.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V5h14zm-4-4h-4v-2h2c1.1 0 2-.89 2-2V9c0-1.11-.9-2-2-2H9v2h4v2h-2c-1.1 0-2 .89-2 2v4h6z"}),"LooksTwoOutlined");var as={},An=pe;Object.defineProperty(as,"__esModule",{value:!0});var Ws=as.default=void 0,wn=An(je()),Bn=e;Ws=as.default=(0,wn.default)((0,Bn.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V5h14zm-4-4v-1.5c0-.83-.67-1.5-1.5-1.5.83 0 1.5-.67 1.5-1.5V9c0-1.11-.9-2-2-2H9v2h4v2h-2v2h2v2H9v2h4c1.1 0 2-.89 2-2"}),"Looks3Outlined");var is={},In=pe;Object.defineProperty(is,"__esModule",{value:!0});var Us=is.default=void 0,Dn=In(je()),Mn=e;Us=is.default=(0,Dn.default)((0,Mn.jsx)("path",{d:"M19.04 3h-14c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16h-14V5h14zm-6-2h2V7h-2v4h-2V7h-2v6h4z"}),"Looks4Outlined");var ls={},Pn=pe;Object.defineProperty(ls,"__esModule",{value:!0});var Vs=ls.default=void 0,$n=Pn(je()),kn=e;Vs=ls.default=(0,$n.default)((0,kn.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V5h14zm-4-4v-2c0-1.11-.9-2-2-2h-2V9h4V7H9v6h4v2H9v2h4c1.1 0 2-.89 2-2"}),"Looks5Outlined");var rs={},_n=pe;Object.defineProperty(rs,"__esModule",{value:!0});var Ns=rs.default=void 0,On=_n(je()),Rn=e;Ns=rs.default=(0,On.default)((0,Rn.jsx)("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"}),"Save");var os={},zn=pe;Object.defineProperty(os,"__esModule",{value:!0});var Jt=os.default=void 0,Fn=zn(je()),Hn=e;Jt=os.default=(0,Fn.default)((0,Hn.jsx)("path",{d:"M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8"}),"UndoOutlined");var ds={},Ln=pe;Object.defineProperty(ds,"__esModule",{value:!0});var Gt=ds.default=void 0,En=Ln(je()),Wn=e;Gt=ds.default=(0,En.default)((0,Wn.jsx)("path",{d:"M18.4 10.6C16.55 8.99 14.15 8 11.5 8c-4.65 0-8.58 3.03-9.96 7.22L3.9 16c1.05-3.19 4.05-5.5 7.6-5.5 1.95 0 3.73.72 5.12 1.88L13 16h9V7z"}),"RedoOutlined");var cs={},Un=pe;Object.defineProperty(cs,"__esModule",{value:!0});var qs=cs.default=void 0,Vn=Un(je()),Nn=e;qs=cs.default=(0,Vn.default)((0,Nn.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8m.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"}),"AccessTimeOutlined");var us={},qn=pe;Object.defineProperty(us,"__esModule",{value:!0});var Ks=us.default=void 0,Kn=qn(je()),Jn=e;Ks=us.default=(0,Kn.default)((0,Jn.jsx)("path",{d:"M6.99 11 3 15l3.99 4v-3H14v-2H6.99zM21 9l-3.99-4v3H10v2h7.01v3z"}),"SwapHorizOutlined");var xs={},Gn=pe;Object.defineProperty(xs,"__esModule",{value:!0});var Js=xs.default=void 0,Yn=Gn(je()),Xn=e;Js=xs.default=(0,Yn.default)((0,Xn.jsx)("path",{d:"M16 17.01V10h-2v7.01h-3L15 21l4-3.99zM9 3 5 6.99h3V14h2V6.99h3zm7 14.01V10h-2v7.01h-3L15 21l4-3.99zM9 3 5 6.99h3V14h2V6.99h3z"}),"SwapVertOutlined");var ms={},Qn=pe;Object.defineProperty(ms,"__esModule",{value:!0});var Gs=ms.default=void 0,Zn=Qn(je()),ea=e;Gs=ms.default=(0,Zn.default)((0,ea.jsx)("path",{d:"M16.01 11H4v2h12.01v3L20 12l-3.99-4z"}),"ArrowRightAlt");function ta(n){if(typeof window>"u")return n;try{const f=new DOMParser().parseFromString(n,"image/svg+xml"),g=new Set(["svg","g","path","circle","rect","line","polygon","polyline","text","defs","use"]),x=d=>{[...d.children].forEach(a=>{if(g.has(a.tagName))[...a.attributes].forEach(M=>{M.name.startsWith("on")&&a.removeAttribute(M.name)}),x(a);else{const M=document.createTextNode(a.outerHTML);a.replaceWith(M)}})};return x(f.documentElement),f.documentElement.outerHTML}catch{return""}}function sa({name:n}){const r=o.useRef(null),[f,g]=o.useState(1);return o.useEffect(()=>{const x=r.current;if(!x)return;const d=x.getBBox().width;g(d>64?64/d:1)},[n]),e.jsx("svg",{width:64,height:64,children:e.jsx("g",{transform:`scale(${f})`,children:e.jsx("text",{ref:r,x:32/f,y:32/f,textAnchor:"middle",dominantBaseline:"central",fontSize:8,children:n})})})}function $t({category:n,borderColor:r}){const f=r?{border:"1px solid",borderColor:r,boxSizing:"border-box"}:{};return n.iconType==="svg"&&n.svg?e.jsx(u,{sx:{width:64,height:64,...f},dangerouslySetInnerHTML:{__html:ta(n.svg)}}):n.iconType==="image"&&n.image?e.jsx(u,{component:"img",src:n.image,sx:{width:64,height:64,objectFit:"none",objectPosition:`-${n.cropX||0}px -${n.cropY||0}px`,...f}}):e.jsx(u,{sx:{width:64,height:64,display:"flex",...f},children:e.jsx(sa,{name:n.name})})}function na(n,r,f){const g=o.useCallback(a=>{let M=0,S=0;a.rallies.forEach(H=>{if(H.timeoutTeam||H.substitutionTeam)return;const y=r.find(L=>L.id===H.teamAPlayDetail),$=r.find(L=>L.id===H.teamBPlayDetail);(y==null?void 0:y.pointType)==="得点"||($==null?void 0:$.pointType)==="失点"?M+=1:(($==null?void 0:$.pointType)==="得点"||(y==null?void 0:y.pointType)==="失点")&&(S+=1)}),a.my=M,a.opponent=S},[r]),x=o.useCallback(a=>{const M=[...n.rallies,a],S={...n,rallies:M};g(S),f(S)},[n,g,f]),d=o.useCallback(a=>{const M=n.rallies.filter((H,y)=>y!==a),S={...n,rallies:M};g(S),f(S)},[n,g,f]);return{addRally:x,deleteRally:d,calculateScores:g}}function aa({setScore:n,playDetails:r,playCategories:f,teamAMembers:g,teamBMembers:x,teamAName:d,teamBName:a,onChange:M,locked:S=!1,scoreInputSetting:H,themeSetting:y}){var de,Xe,Wt,Mt,ps,js,gs,bs;const $=Xt(),[L,I]=o.useState(!1),[U,K]=o.useState(!1),[ce,se]=o.useState("teamA"),[ie,D]=o.useState(""),[ne,re]=o.useState(""),[ee,m]=o.useState(""),[_,b]=o.useState(""),[T,w]=o.useState(""),[R,P]=o.useState(""),[E,me]=o.useState(""),[q,ge]=o.useState(""),[Oe,Re]=o.useState(!1),[Ke,ze]=o.useState(!1),[be,Be]=o.useState(!1),[Ie,Je]=o.useState(""),[i,v]=o.useState(""),[p,k]=o.useState(""),[W,c]=o.useState(null),[j,z]=o.useState(null),[Z,G]=o.useState(null),[ae,ue]=o.useState(!1),he="tutorial-settab-add-rally",[we,xe]=o.useState(()=>!localStorage.getItem(he)),{addRally:fe,deleteRally:De,calculateScores:Ge}=na(n,r,M),Tt=$s("md"),gt=$s("sm"),ct=!gt&&H.showRallyIcons,tt=!Tt&&H.showScoreProgressArea,Me=f.find(t=>t.id==="init-serve"),Rt=n.rallies.filter(t=>t.timeoutTeam==="teamA").length,zt=n.rallies.filter(t=>t.timeoutTeam==="teamB").length,At=Rt>=2,bt=zt>=2,vt=()=>{var J,Pe;if(q)return!0;if(H.rallyMemberRequired&&!ie||ne&&!_||ee&&!T||!!!(ne&&_)&&!!!(ee&&T))return!1;const A=(J=r.find(Te=>Te.id===_))==null?void 0:J.pointUnitType;if(H.rallyMemberRequired&&_&&A==="メンバー"&&!R)return!1;const F=(Pe=r.find(Te=>Te.id===T))==null?void 0:Pe.pointUnitType;return!(H.rallyMemberRequired&&T&&F==="メンバー"&&!E)},wt=t=>{if(!t)return"";const s=r.find(F=>F.id===t),A=f.find(F=>F.id===(s==null?void 0:s.playCategoryId));return(A==null?void 0:A.name)||""},Fe=t=>{if(!t)return;const s=r.find(A=>A.id===t);return f.find(A=>A.id===(s==null?void 0:s.playCategoryId))},Bt=(t,s)=>{if(!s)return"－";const F=(t==="teamA"?g:x).find(J=>J.id===s);return F?`${F.no}:${F.name}`:"－"},Ft=()=>{if(S)return;z(null);const t=[...n.rallies].reverse().find(A=>!A.timeoutTeam&&!A.substitutionTeam);let s="teamA";if(t){const A=r.find(J=>J.id===t.teamAPlayDetail),F=r.find(J=>J.id===t.teamBPlayDetail);(A==null?void 0:A.pointType)==="得点"||(F==null?void 0:F.pointType)==="失点"?s="teamA":((F==null?void 0:F.pointType)==="得点"||(A==null?void 0:A.pointType)==="失点")&&(s="teamB")}se(s),D(""),re(""),m(""),b(""),w(""),P(""),me(""),ge(""),I(!0)},It=t=>{var A,F;if(S)return;const s=n.rallies[t];z(t),se(s.serverTeam||"teamA"),D(s.server&&(s.serverTeam==="teamA"?g.some(J=>J.id===s.server):x.some(J=>J.id===s.server))?s.server:""),re(((A=r.find(J=>J.id===s.teamAPlayDetail))==null?void 0:A.playCategoryId)||""),b(s.teamAPlayDetail||""),P(g.some(J=>J.id===s.teamAMember)&&s.teamAMember||""),m(((F=r.find(J=>J.id===s.teamBPlayDetail))==null?void 0:F.playCategoryId)||""),w(s.teamBPlayDetail||""),me(x.some(J=>J.id===s.teamBMember)&&s.teamBMember||""),ge(s.timeoutTeam||""),I(!0)},Ve=()=>{if(S)return;const t=!localStorage.getItem("tutorial-rally-row"),s=q?{id:crypto.randomUUID(),timeoutTeam:q}:{id:crypto.randomUUID(),serverTeam:ce,server:ie||void 0,teamAPlayDetail:_||void 0,teamAMember:R||void 0,teamBPlayDetail:T||void 0,teamBMember:E||void 0};fe(s),I(!1),t&&ue(!0)},Ye=t=>{if(S||t==="teamA"&&At||t==="teamB"&&bt)return;const s=!localStorage.getItem("tutorial-rally-row");fe({id:crypto.randomUUID(),timeoutTeam:t}),Re(!1),s&&ue(!0)},ot=t=>{S||(Je(t),v(""),k(""),c(null),Be(!0),ze(!1))},ut=t=>{if(S)return;const s=n.rallies[t];s.substitutionTeam&&(Je(s.substitutionTeam),v(s.outMember||""),k(s.inMember||""),c(t),Be(!0))},fs=()=>{if(S||!Ie||!i||!p)return;const t=!localStorage.getItem("tutorial-rally-row"),s=[...n.rallies];W!==null?s[W]={...s[W],substitutionTeam:Ie,outMember:i,inMember:p}:s.push({id:crypto.randomUUID(),substitutionTeam:Ie,outMember:i,inMember:p});const A={...n,rallies:s};Ge(A),M(A),t&&ue(!0),Be(!1),c(null)},Dt=()=>{Be(!1),c(null)},Ht=()=>{if(S||j===null)return;const t=[...n.rallies];t[j]=q?{...t[j],timeoutTeam:q,serverTeam:void 0,server:void 0,teamAPlayDetail:void 0,teamAMember:void 0,teamBPlayDetail:void 0,teamBMember:void 0}:{...t[j],timeoutTeam:void 0,serverTeam:ce,server:ie||void 0,teamAPlayDetail:_||void 0,teamAMember:R||void 0,teamBPlayDetail:T||void 0,teamBMember:E||void 0};const s={...n,rallies:t};Ge(s),M(s),I(!1)},Lt=t=>{if(!t.destination||S)return;const s=Array.from(n.rallies),[A]=s.splice(t.source.index,1);s.splice(t.destination.index,0,A);const F={...n,rallies:s};Ge(F),M(F)},yt=t=>{S||(G(t),K(!0))},Et=()=>{Z!==null&&(De(Z),G(null),K(!1))},l=()=>{G(null),K(!1)},C=t=>{let s=0,A=0,F=null;n.rallies.slice(0,t+1).forEach(Te=>{if(Te.timeoutTeam||Te.substitutionTeam)return;const Qe=r.find(xt=>xt.id===Te.teamAPlayDetail),Ze=r.find(xt=>xt.id===Te.teamBPlayDetail);(Qe==null?void 0:Qe.pointType)==="得点"||(Ze==null?void 0:Ze.pointType)==="失点"?(s+=1,F="A"):(Ze==null?void 0:Ze.pointType)==="得点"||(Qe==null?void 0:Qe.pointType)==="失点"?(A+=1,F="B"):F=null});const J=$.palette.text.primary,Pe=$.palette.mode==="dark"?"#343A42":"#D3D3D3";return e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{color:F==="A"?J:Pe},children:String(s).padStart(2,"0")}),e.jsx("span",{style:{color:Pe},children:" - "}),e.jsx("span",{style:{color:F==="B"?J:Pe},children:String(A).padStart(2,"0")})]})},B=[],O=[];let te=0,le=0;n.rallies.forEach(t=>{if(t.timeoutTeam||t.substitutionTeam)return;const s=r.find(F=>F.id===t.teamAPlayDetail),A=r.find(F=>F.id===t.teamBPlayDetail);(s==null?void 0:s.pointType)==="得点"||(A==null?void 0:A.pointType)==="失点"?(te+=1,O.push("A")):(A==null?void 0:A.pointType)==="得点"||(s==null?void 0:s.pointType)==="失点"?(le+=1,O.push("B")):O.push(null),B.push({a:te,b:le})});const Y=40,V=[];for(let t=0;t<O.length-1;t++){const s=O[t],A=O[t+1];s&&A&&s!==A&&V.push({from:s,index:t})}const ve=O.map((t,s)=>t&&s>0&&t===O[s-1]),Ne=B.length*Y;return e.jsxs(u,{sx:{position:"relative",display:"flex",flexDirection:"column",height:"100%"},children:[e.jsxs(u,{sx:{display:"flex",gap:2,flex:1,minHeight:0},children:[tt&&e.jsxs(u,{sx:{flex:"0 0 20%",overflowY:"auto",height:"100%",position:"relative"},children:[B.map((t,s)=>{const A=s===0?{a:0,b:0}:B[s-1],F=t.a!==A.a&&t.a!==0,J=t.b!==A.b&&t.b!==0,Pe=F&&ve[s],Te=J&&ve[s];return e.jsxs(u,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr 1fr",alignItems:"center",py:.5,height:`${Y}px`,position:"relative",zIndex:1},children:[e.jsx(u,{}),e.jsxs(e.Fragment,{children:[e.jsx(u,{sx:{display:"flex",justifyContent:"center"},children:F?e.jsx(u,{sx:{width:32,height:32,border:"1px solid",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:24,borderColor:Pe?"red":"currentColor",backgroundColor:Pe?"#ffebee":"#fff",color:"black"},children:t.a}):null}),e.jsx(u,{}),e.jsx(u,{sx:{display:"flex",justifyContent:"center"},children:J?e.jsx(u,{sx:{width:32,height:32,border:"1px solid",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:24,borderColor:Te?"red":"currentColor",backgroundColor:Te?"#ffebee":"#fff",color:"black"},children:t.b}):null})]}),e.jsx(u,{})]},s)}),e.jsx("svg",{viewBox:`0 0 100 ${Ne}`,style:{position:"absolute",left:0,top:0,width:"100%",height:Ne,zIndex:0},preserveAspectRatio:"none",pointerEvents:"none",children:V.map(t=>{const s=t.index*Y+Y/2,A=(t.index+1)*Y+Y/2,F=t.from==="A"?30:70,J=t.from==="A"?70:30;return e.jsx("line",{x1:F,y1:s,x2:J,y2:A,stroke:"currentColor",strokeWidth:1},t.index)})})]}),e.jsx(u,{sx:{flex:1,overflowY:"auto",height:"100%",maxWidth:1024,width:"100%",mx:"auto",mb:2},children:e.jsx(at,{open:ae,onClose:()=>ue(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:it,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${$.palette.text.secondary}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${$.palette.text.secondary}`}}}},title:e.jsxs(u,{sx:{p:1,maxWidth:260},children:[e.jsxs($e,{variant:"body2",children:["行をタップすることでラリー結果を編集できます",e.jsx("br",{}),"左端の",e.jsx(dt,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),"をドラッグすることでラリー結果の順番を入れ替えることができます",e.jsx("br",{}),"右端の",e.jsx(nt,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),"をタップすることでラリー結果を削除することができます"]}),e.jsx(u,{sx:{textAlign:"right",mt:1},children:e.jsx(rt,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem("tutorial-rally-row","1"),ue(!1)},children:"了解した"})})]}),children:e.jsx(u,{children:e.jsx(Qt,{onDragEnd:Lt,children:e.jsx(jt,{component:lt,storageKey:"set-tab",children:e.jsxs(mt,{size:"small",sx:{tableLayout:"fixed","& th, & td":{textAlign:"center",verticalAlign:"middle"}},children:[e.jsx(ht,{children:e.jsxs(Ae,{sx:{backgroundColor:t=>t.palette.mode==="dark"?"#343A42":"#f5f5f5"},children:[e.jsx(h,{sx:{width:"6%"}}),e.jsx(h,{sx:{width:"16%"},children:e.jsxs(u,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{children:d||"チームA"}),e.jsx("span",{children:"サーブ"})]})}),e.jsx(h,{sx:{width:"18%"},children:e.jsxs(u,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{children:d||"チームA"}),e.jsx("span",{children:"ラリー結果"})]})}),e.jsx(h,{sx:{width:"20%"},children:"得点"}),e.jsx(h,{sx:{width:"18%"},children:e.jsxs(u,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{children:a||"チームB"}),e.jsx("span",{children:"ラリー結果"})]})}),e.jsx(h,{sx:{width:"16%"},children:e.jsxs(u,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{children:a||"チームB"}),e.jsx("span",{children:"サーブ"})]})}),e.jsx(h,{sx:{width:"6%"}})]})}),e.jsx(kt,{droppableId:"rallies",children:t=>e.jsxs(ft,{ref:t.innerRef,...t.droppableProps,children:[n.rallies.map((s,A)=>e.jsx(_t,{draggableId:s.id,index:A,isDragDisabled:S,children:F=>{var J,Pe,Te,Qe,Ze,xt,vs,ys,Cs,Ss,Ts,As,ws,Bs,Is,Ds,Ms,Ps;return e.jsxs(Ae,{ref:F.innerRef,...F.draggableProps,"data-index":A,onClick:()=>{S||(s.substitutionTeam?ut(A):s.timeoutTeam||It(A))},sx:{cursor:S||s.timeoutTeam?"default":"pointer",backgroundColor:N=>s.timeoutTeam||s.substitutionTeam?N.palette.mode==="dark"?"#343A42":"#f5f5f5":void 0},children:[e.jsx(h,{padding:"checkbox",sx:{width:"6%"},children:e.jsx(u,{onClick:N=>N.stopPropagation(),...F.dragHandleProps,sx:{cursor:S?"default":"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:e.jsx(dt,{fontSize:"small"})})}),s.timeoutTeam?e.jsx(h,{colSpan:5,sx:{width:"88%"},children:e.jsxs(u,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:[s.timeoutTeam==="teamA"?d||"チームA":a||"チームB","タイムアウト"]})}):s.substitutionTeam?e.jsx(h,{colSpan:5,sx:{width:"88%"},children:e.jsxs(u,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100%"},children:[e.jsxs("span",{children:[s.substitutionTeam==="teamA"?d||"チームA":a||"チームB","選手交代"]}),e.jsxs(u,{sx:{display:"flex",alignItems:"center",mt:.5},children:[e.jsx("span",{children:Bt(s.substitutionTeam,s.outMember)}),e.jsx(Gs,{fontSize:"small",sx:{mx:1}}),e.jsx("span",{children:Bt(s.substitutionTeam,s.inMember)})]})]})}):e.jsxs(e.Fragment,{children:[e.jsx(h,{sx:{width:"16%"},children:s.serverTeam==="teamA"?e.jsxs(u,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[ct&&(Me?e.jsx($t,{category:Me}):e.jsxs("svg",{width:64,height:64,children:[e.jsx("rect",{width:64,height:64,fill:"none",stroke:"currentColor"}),e.jsx("text",{x:"50%",y:"50%",textAnchor:"middle",dominantBaseline:"central",fontSize:"12",children:"サーブ"})]})),e.jsx("span",{style:{fontSize:12},children:((J=g.find(N=>N.id===s.server))==null?void 0:J.name)||"－"})]}):null}),e.jsx(h,{sx:{width:"18%"},children:e.jsxs(u,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[ct&&s.teamAPlayDetail&&Fe(s.teamAPlayDetail)?e.jsx(u,{sx:{mb:"5px"},children:e.jsx($t,{category:Fe(s.teamAPlayDetail),borderColor:((Pe=r.find(N=>N.id===s.teamAPlayDetail))==null?void 0:Pe.pointType)==="得点"?y.scoreColor:((Te=r.find(N=>N.id===s.teamAPlayDetail))==null?void 0:Te.pointType)==="失点"?y.lossColor:void 0})}):null,s.teamAPlayDetail?e.jsx(He,{label:wt(s.teamAPlayDetail),size:"small",variant:"outlined",sx:{borderColor:((Qe=Fe(s.teamAPlayDetail))==null?void 0:Qe.color)||ke,color:((Ze=Fe(s.teamAPlayDetail))==null?void 0:Ze.color)||ke,mb:.5}}):null,s.teamAPlayDetail?e.jsx(He,{label:((xt=r.find(N=>N.id===s.teamAPlayDetail))==null?void 0:xt.name)||"",size:"small",sx:{backgroundColor:((vs=r.find(N=>N.id===s.teamAPlayDetail))==null?void 0:vs.pointType)==="得点"?y.scoreColor:y.lossColor,color:"#fff",mb:.5}}):null,e.jsx("span",{style:{fontSize:12},children:s.teamAPlayDetail?((ys=r.find(N=>N.id===s.teamAPlayDetail))==null?void 0:ys.pointUnitType)==="メンバー"&&((Cs=g.find(N=>N.id===s.teamAMember))==null?void 0:Cs.name)||"－":""})]})}),e.jsx(h,{sx:{width:"20%",fontSize:"2em"},children:C(A)}),e.jsx(h,{sx:{width:"18%"},children:e.jsxs(u,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[ct&&s.teamBPlayDetail&&Fe(s.teamBPlayDetail)?e.jsx(u,{sx:{mb:"5px"},children:e.jsx($t,{category:Fe(s.teamBPlayDetail),borderColor:((Ss=r.find(N=>N.id===s.teamBPlayDetail))==null?void 0:Ss.pointType)==="得点"?y.scoreColor:((Ts=r.find(N=>N.id===s.teamBPlayDetail))==null?void 0:Ts.pointType)==="失点"?y.lossColor:void 0})}):null,s.teamBPlayDetail?e.jsx(He,{label:wt(s.teamBPlayDetail),size:"small",variant:"outlined",sx:{borderColor:((As=Fe(s.teamBPlayDetail))==null?void 0:As.color)||ke,color:((ws=Fe(s.teamBPlayDetail))==null?void 0:ws.color)||ke,mb:.5}}):null,s.teamBPlayDetail?e.jsx(He,{label:((Bs=r.find(N=>N.id===s.teamBPlayDetail))==null?void 0:Bs.name)||"",size:"small",sx:{backgroundColor:((Is=r.find(N=>N.id===s.teamBPlayDetail))==null?void 0:Is.pointType)==="得点"?y.scoreColor:y.lossColor,color:"#fff",mb:.5}}):null,e.jsx("span",{style:{fontSize:12},children:s.teamBPlayDetail?((Ds=r.find(N=>N.id===s.teamBPlayDetail))==null?void 0:Ds.pointUnitType)==="メンバー"&&((Ms=x.find(N=>N.id===s.teamBMember))==null?void 0:Ms.name)||"－":""})]})}),e.jsx(h,{sx:{width:"16%"},children:s.serverTeam==="teamB"?e.jsxs(u,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[ct&&(Me?e.jsx($t,{category:Me}):e.jsxs("svg",{width:64,height:64,children:[e.jsx("rect",{width:64,height:64,fill:"none",stroke:"currentColor"}),e.jsx("text",{x:"50%",y:"50%",textAnchor:"middle",dominantBaseline:"central",fontSize:"12",children:"サーブ"})]})),e.jsx("span",{style:{fontSize:12},children:((Ps=x.find(N=>N.id===s.server))==null?void 0:Ps.name)||"－"})]}):null})]}),e.jsx(h,{padding:"checkbox",sx:{width:"6%"},children:e.jsx(u,{onClick:N=>N.stopPropagation(),sx:{width:32,height:32,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:e.jsx(st,{size:"small",onClick:S?void 0:()=>yt(A),disabled:S,sx:{width:24,height:24},children:e.jsx(nt,{fontSize:"small",color:S?"disabled":"error"})})})})]})}},s.id)),t.placeholder]})})]})})})})})})]}),!S&&e.jsxs(Ys,{children:[e.jsxs(Ut,{ariaLabel:"substitution actions",direction:"left",icon:e.jsx(Ks,{}),onOpen:()=>ze(!0),onClose:()=>ze(!1),open:Ke,FabProps:{size:"large"},sx:{position:"fixed",right:35,bottom:200},children:[e.jsx(Pt,{icon:e.jsx(e.Fragment,{children:a||"チームB"}),tooltipTitle:"",FabProps:{variant:"extended",size:"small"},onClick:()=>ot("teamB")}),e.jsx(Pt,{icon:e.jsx(e.Fragment,{children:d||"チームA"}),tooltipTitle:"",FabProps:{variant:"extended",size:"small"},onClick:()=>ot("teamA")})]}),e.jsxs(Ut,{ariaLabel:"timeout actions",direction:"left",icon:e.jsx(qs,{}),onOpen:()=>Re(!0),onClose:()=>Re(!1),open:Oe,FabProps:{size:"large"},sx:{position:"fixed",right:35,bottom:140},children:[e.jsx(Pt,{icon:e.jsx(e.Fragment,{children:a||"チームB"}),tooltipTitle:"",FabProps:{variant:"extended",size:"small",disabled:bt},onClick:()=>Ye("teamB")}),e.jsx(Pt,{icon:e.jsx(e.Fragment,{children:d||"チームA"}),tooltipTitle:"",FabProps:{variant:"extended",size:"small",disabled:At},onClick:()=>Ye("teamA")})]}),e.jsx(at,{open:we,onClose:()=>xe(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"left",TransitionComponent:it,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${$.palette.text.secondary}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${$.palette.text.secondary}`}}}},title:e.jsxs(u,{sx:{p:1,maxWidth:260},children:[e.jsx($e,{variant:"body2",children:"ラリー結果、タイムアウト、メンバー交代を追加できます"}),e.jsx(u,{sx:{textAlign:"right",mt:1},children:e.jsx(rt,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem(he,"1"),xe(!1)},children:"了解した"})})]}),children:e.jsx(Ut,{ariaLabel:"rally actions",direction:"left",icon:e.jsx(Ot,{}),FabProps:{size:"large",onClick:Ft},sx:{position:"fixed",right:35,bottom:80}})})]}),e.jsxs(St,{open:L,onClose:()=>I(!1),children:[e.jsx(Le,{children:j===null?"ラリー追加":"ラリー編集"}),e.jsxs(Ee,{sx:{display:"flex",flexDirection:"column",gap:2,mt:2},children:[e.jsxs(et,{exclusive:!0,value:ce,onChange:(t,s)=>s&&se(s),sx:{width:"100%"},disabled:!!q,children:[e.jsx(qe,{value:"teamA",sx:{flex:1},children:e.jsx(u,{sx:{whiteSpace:"pre-line",textAlign:"center"},children:`${d||"チームA"}
サーブ`})}),e.jsx(qe,{value:"teamB",sx:{flex:1},children:e.jsx(u,{sx:{whiteSpace:"pre-line",textAlign:"center"},children:`${a||"チームB"}
サーブ`})})]}),e.jsxs(ye,{fullWidth:!0,required:H.rallyMemberRequired,disabled:!!q,children:[e.jsx(Ce,{id:"server",children:"サーバー"}),e.jsx(Se,{labelId:"server",value:ie,label:"サーバー",onChange:t=>D(t.target.value),children:(ce==="teamA"?g:x).map(t=>e.jsx(X,{value:t.id,children:t.name},t.id))})]}),gt?e.jsxs(u,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(u,{sx:{flex:1,display:"flex",flexDirection:"column",gap:1},children:[e.jsx(et,{orientation:"vertical",exclusive:!0,value:ne,onChange:(t,s)=>{ne===s||s===null?(re(""),b("")):(re(s),b(""))},disabled:!!q,children:f.filter(t=>t.visible!==!1).map(t=>e.jsx(qe,{value:t.id,sx:{whiteSpace:"nowrap"},children:t.name},t.id))}),e.jsx(et,{orientation:"vertical",exclusive:!0,value:_,onChange:(t,s)=>{b(_===s||s===null?"":s)},sx:{mt:1},disabled:!!q,children:r.filter(t=>t.playCategoryId===ne&&t.visible!==!1).map(t=>{const s=t.pointType==="得点"?y.scoreColor:y.lossColor;return e.jsx(qe,{value:t.id,sx:{whiteSpace:"nowrap",color:s,"&.Mui-selected":{color:s}},children:t.name},t.id)})}),e.jsxs(ye,{fullWidth:!0,sx:{mt:1},required:H.rallyMemberRequired&&((de=r.find(t=>t.id===_))==null?void 0:de.pointUnitType)==="メンバー",disabled:!!q,children:[e.jsx(Ce,{id:"amem",children:`${d||"チームA"}メンバー`}),e.jsxs(Se,{labelId:"amem",value:R,label:`${d||"チームA"}メンバー`,onChange:t=>P(t.target.value),disabled:((Xe=r.find(t=>t.id===_))==null?void 0:Xe.pointUnitType)!=="メンバー",children:[e.jsx(X,{value:"",children:e.jsx("em",{children:"なし"})}),g.map(t=>e.jsx(X,{value:t.id,children:t.name},t.id))]})]})]}),e.jsxs(u,{sx:{flex:1,display:"flex",flexDirection:"column",gap:1},children:[e.jsx(et,{orientation:"vertical",exclusive:!0,value:ee,onChange:(t,s)=>{ee===s||s===null?(m(""),w("")):(m(s),w(""))},disabled:!!q,children:f.filter(t=>t.visible!==!1).map(t=>e.jsx(qe,{value:t.id,sx:{whiteSpace:"nowrap"},children:t.name},t.id))}),e.jsx(et,{orientation:"vertical",exclusive:!0,value:T,onChange:(t,s)=>{w(T===s||s===null?"":s)},sx:{mt:1},disabled:!!q,children:r.filter(t=>t.playCategoryId===ee&&t.visible!==!1).map(t=>{const s=t.pointType==="得点"?y.scoreColor:y.lossColor;return e.jsx(qe,{value:t.id,sx:{whiteSpace:"nowrap",color:s,"&.Mui-selected":{color:s}},children:t.name},t.id)})}),e.jsxs(ye,{fullWidth:!0,sx:{mt:1},required:H.rallyMemberRequired&&((Wt=r.find(t=>t.id===T))==null?void 0:Wt.pointUnitType)==="メンバー",disabled:!!q,children:[e.jsx(Ce,{id:"bmem",children:`${a||"チームB"}メンバー`}),e.jsxs(Se,{labelId:"bmem",value:E,label:`${a||"チームB"}メンバー`,onChange:t=>me(t.target.value),disabled:((Mt=r.find(t=>t.id===T))==null?void 0:Mt.pointUnitType)!=="メンバー",children:[e.jsx(X,{value:"",children:e.jsx("em",{children:"なし"})}),x.map(t=>e.jsx(X,{value:t.id,children:t.name},t.id))]})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(u,{sx:{display:"flex",gap:2},children:[e.jsx(et,{orientation:"vertical",exclusive:!0,value:ne,onChange:(t,s)=>{ne===s||s===null?(re(""),b("")):(re(s),b(""))},disabled:!!q,sx:{flex:"1 1 25%"},children:f.filter(t=>t.visible!==!1).map(t=>e.jsx(qe,{value:t.id,sx:{whiteSpace:"nowrap"},children:t.name},t.id))}),e.jsx(et,{orientation:"vertical",exclusive:!0,value:_,onChange:(t,s)=>{b(_===s||s===null?"":s)},disabled:!!q,sx:{flex:"1 1 25%"},children:r.filter(t=>t.playCategoryId===ne&&t.visible!==!1).map(t=>{const s=t.pointType==="得点"?y.scoreColor:y.lossColor;return e.jsx(qe,{value:t.id,sx:{whiteSpace:"nowrap",color:s,"&.Mui-selected":{color:s}},children:t.name},t.id)})}),e.jsx(et,{orientation:"vertical",exclusive:!0,value:ee,onChange:(t,s)=>{ee===s||s===null?(m(""),w("")):(m(s),w(""))},disabled:!!q,sx:{flex:"1 1 25%"},children:f.filter(t=>t.visible!==!1).map(t=>e.jsx(qe,{value:t.id,sx:{whiteSpace:"nowrap"},children:t.name},t.id))}),e.jsx(et,{orientation:"vertical",exclusive:!0,value:T,onChange:(t,s)=>{w(T===s||s===null?"":s)},disabled:!!q,sx:{flex:"1 1 25%"},children:r.filter(t=>t.playCategoryId===ee&&t.visible!==!1).map(t=>{const s=t.pointType==="得点"?y.scoreColor:y.lossColor;return e.jsx(qe,{value:t.id,sx:{whiteSpace:"nowrap",color:s,"&.Mui-selected":{color:s}},children:t.name},t.id)})})]}),e.jsxs(u,{sx:{display:"flex",gap:2,mt:1},children:[e.jsxs(ye,{fullWidth:!0,required:H.rallyMemberRequired&&((ps=r.find(t=>t.id===_))==null?void 0:ps.pointUnitType)==="メンバー",disabled:!!q,sx:{flex:1},children:[e.jsx(Ce,{id:"amem",children:`${d||"チームA"}メンバー`}),e.jsxs(Se,{labelId:"amem",value:R,label:`${d||"チームA"}メンバー`,onChange:t=>P(t.target.value),disabled:((js=r.find(t=>t.id===_))==null?void 0:js.pointUnitType)!=="メンバー",children:[e.jsx(X,{value:"",children:e.jsx("em",{children:"なし"})}),g.map(t=>e.jsx(X,{value:t.id,children:t.name},t.id))]})]}),e.jsxs(ye,{fullWidth:!0,required:H.rallyMemberRequired&&((gs=r.find(t=>t.id===T))==null?void 0:gs.pointUnitType)==="メンバー",disabled:!!q,sx:{flex:1},children:[e.jsx(Ce,{id:"bmem",children:`${a||"チームB"}メンバー`}),e.jsxs(Se,{labelId:"bmem",value:E,label:`${a||"チームB"}メンバー`,onChange:t=>me(t.target.value),disabled:((bs=r.find(t=>t.id===T))==null?void 0:bs.pointUnitType)!=="メンバー",children:[e.jsx(X,{value:"",children:e.jsx("em",{children:"なし"})}),x.map(t=>e.jsx(X,{value:t.id,children:t.name},t.id))]})]})]})]})]}),e.jsxs(We,{children:[e.jsx(Q,{onClick:()=>I(!1),color:"inherit",startIcon:e.jsx(Ue,{}),children:"キャンセル"}),j===null?e.jsx(Q,{onClick:Ve,disabled:!vt(),startIcon:e.jsx(_e,{}),children:"OK"}):e.jsx(Q,{onClick:Ht,disabled:!vt(),startIcon:e.jsx(_e,{}),children:"OK"})]})]}),e.jsxs(St,{open:be,onClose:Dt,children:[e.jsx(Le,{children:"選手交代"}),e.jsx(Ee,{children:e.jsxs(u,{component:"form",sx:{mt:2},children:[e.jsxs(ye,{fullWidth:!0,sx:{mb:2},children:[e.jsx(Ce,{id:"out-member",children:"OUT"}),e.jsx(Se,{labelId:"out-member",value:i,label:"OUT",onChange:t=>v(t.target.value),children:(Ie==="teamA"?g:x).map(t=>e.jsx(X,{value:t.id,children:`${t.no}:${t.name}`},t.id))})]}),e.jsx(u,{sx:{display:"flex",justifyContent:"center",mb:2},children:e.jsx(Js,{sx:{width:32,height:32}})}),e.jsxs(ye,{fullWidth:!0,children:[e.jsx(Ce,{id:"in-member",children:"IN"}),e.jsx(Se,{labelId:"in-member",value:p,label:"IN",onChange:t=>k(t.target.value),children:(Ie==="teamA"?g:x).map(t=>e.jsx(X,{value:t.id,children:`${t.no}:${t.name}`},t.id))})]})]})}),e.jsxs(We,{children:[e.jsx(Q,{onClick:Dt,color:"inherit",startIcon:e.jsx(Ue,{}),children:"キャンセル"}),e.jsx(Q,{onClick:fs,disabled:!i||!p,startIcon:e.jsx(_e,{}),children:"OK"})]})]}),e.jsxs(pt,{open:U,onClose:l,children:[e.jsx(Le,{children:"削除確認"}),e.jsx(Ee,{sx:{mt:2},children:"このラリーを削除しますか？"}),e.jsxs(We,{children:[e.jsx(Q,{onClick:l,color:"inherit",startIcon:e.jsx(Ue,{}),children:"キャンセル"}),e.jsx(Q,{onClick:Et,color:"error",startIcon:e.jsx(_e,{}),children:"OK"})]})]})]})}function ia(n,r){const[f,g]=o.useState(null),x=o.useRef(n);x.current=n;const d=o.useRef(),a=o.useCallback(y=>{if(f===null)return;const $=document.elementFromPoint(y.clientX,y.clientY),L=$==null?void 0:$.closest("[data-index]");if(!L)return;const I=Number(L.dataset.index);if(isNaN(I)||I===f)return;const U=[...x.current],[K]=U.splice(f,1);U.splice(I,0,K),g(I),r(U)},[f,r]),M=o.useCallback(()=>{window.removeEventListener("pointermove",a),d.current&&(window.removeEventListener("pointerup",d.current),window.removeEventListener("pointercancel",d.current))},[a]),S=o.useCallback(y=>{var $,L;y&&"currentTarget"in y&&((L=($=y.currentTarget).releasePointerCapture)==null||L.call($,y.pointerId)),M(),g(null)},[M]);function H(y,$){var L,I;$.preventDefault(),(I=(L=$.currentTarget).setPointerCapture)==null||I.call(L,$.pointerId),g(y),d.current=S,window.addEventListener("pointermove",a),window.addEventListener("pointerup",d.current),window.addEventListener("pointercancel",d.current)}return o.useEffect(()=>()=>M(),[M]),{start:H,move:a,end:S,dragging:f!==null}}const la=()=>typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():Math.random().toString(36).slice(2)+Date.now().toString(36);function ra({statsSettings:n,onChange:r,playCategories:f,playDetails:g,rallyCategoryTags:x,rallyDetailTags:d,disabled:a}){const{start:M,move:S,end:H}=ia(n,r),y=i=>{var v;return((v=f.find(p=>p.id===i))==null?void 0:v.name)||""},$=i=>{var v;return((v=g.find(p=>p.id===i))==null?void 0:v.name)||""},[L,I]=o.useState(!1),[U,K]=o.useState(null),[ce,se]=o.useState(""),[ie,D]=o.useState(""),[ne,re]=o.useState([]),[ee,m]=o.useState([]),[_,b]=o.useState(""),[T,w]=o.useState(""),[R,P]=o.useState("合算"),[E,me]=o.useState(null),[q,ge]=o.useState(!1),Oe=()=>{a||(K(-1),se(""),D(""),re([]),m([]),b(""),w(""),P("合算"),I(!0))},Re=i=>{if(a)return;const v=n[i];K(i),se(v.playCategoryId||""),D(v.playDetailId||""),re(v.playCategoryTags||[]),m(v.playDetailTags||[]),b(v.pointType||""),w(v.pointUnitType||""),P(v.aggregateType||"合算"),I(!0)},Ke=()=>{const i=ce!=="",v=ie!=="",p=ne.length>0,k=ee.length>0,W=_!=="",c=T!=="";return i&&!v&&!p&&!k&&!W&&!c||i&&v&&!p&&!k&&!W&&!c||i&&!v&&!p&&!k&&W&&!c||i&&!v&&!p&&!k&&!W&&c||i&&!v&&!p&&!k&&W&&c||!i&&!v&&!p&&!k&&W&&!c||!i&&!v&&!p&&!k&&W&&c||!i&&!v&&!p&&!k&&!W&&c||p&&!i&&!v&&!k&&!W&&!c||p&&k&&!i&&!v&&!W&&!c||p&&k&&!i&&!v&&W&&!c||p&&k&&!i&&!v&&!W&&c||p&&k&&!i&&!v&&W&&c||p&&!i&&!v&&W&&!c||p&&!i&&!v&&!W&&c||p&&!i&&!v&&W&&c||k&&!i&&!v&&!p&&!W&&!c||k&&!i&&!v&&!p&&W&&!c||k&&!i&&!v&&!p&&!W&&c||k&&!i&&!v&&!p&&W&&c},ze=()=>{const i={id:U===-1?la():n[U].id,playCategoryId:ce||void 0,playDetailId:ie||void 0,playCategoryTags:ce===""&&ne.length>0?ne:void 0,playDetailTags:ie===""&&ee.length>0?ee:void 0,pointType:ie?void 0:_||void 0,pointUnitType:ie?void 0:T||void 0,aggregateType:R};U===-1?r([...n,i]):U!==null&&r(n.map((v,p)=>p===U?i:v)),I(!1)},be=()=>{I(!1)},Be=i=>{a||(me(i),ge(!0))},Ie=()=>{E!==null&&r(n.filter((i,v)=>v!==E)),ge(!1)},Je=()=>{ge(!1)};return e.jsxs(u,{children:[e.jsxs(u,{sx:{maxWidth:1024,mx:"auto",display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(u,{sx:{fontWeight:"bold"},children:"スタッツ設定"}),e.jsx(Q,{onClick:Oe,variant:"contained",size:"small",startIcon:e.jsx(Ot,{}),disabled:a,children:"追加"})]}),e.jsx(jt,{component:lt,storageKey:"match-stats-grid",sx:{maxWidth:1024,mx:"auto"},children:e.jsxs(mt,{size:"small",children:[e.jsx(ht,{children:e.jsxs(Ae,{sx:{backgroundColor:i=>i.palette.mode==="dark"?"#343A42":"#f5f5f5",height:50},children:[e.jsx(h,{}),e.jsx(h,{children:"プレー区分"}),e.jsx(h,{children:"プレー詳細"}),e.jsx(h,{children:"得点区分"}),e.jsx(h,{children:"得失点単位区分"}),e.jsx(h,{children:"集計方法"}),e.jsx(h,{})]})}),e.jsx(ft,{children:n.map((i,v)=>e.jsxs(Ae,{"data-index":v,onClick:()=>Re(v),sx:{cursor:a?"default":"pointer",height:50},children:[e.jsx(h,{padding:"checkbox",children:e.jsx(u,{onClick:p=>p.stopPropagation(),onPointerDown:p=>{a||(p.stopPropagation(),M(v,p))},onPointerMove:p=>S(p),onPointerUp:p=>H(p),onPointerCancel:p=>H(p),sx:{cursor:a?"default":"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:e.jsx(dt,{})})}),e.jsx(h,{children:i.playCategoryId?y(i.playCategoryId):i.playCategoryTags&&i.playCategoryTags.length>0?e.jsx(u,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:i.playCategoryTags.map(p=>{const k=x.find(W=>W.id===p);return e.jsx(He,{label:(k==null?void 0:k.name)||p,size:"small",sx:{backgroundColor:(k==null?void 0:k.color)||ke,color:"#fff"}},p)})}):""}),e.jsx(h,{children:i.playDetailId?$(i.playDetailId):i.playDetailTags&&i.playDetailTags.length>0?e.jsx(u,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:i.playDetailTags.map(p=>{const k=d.find(W=>W.id===p);return e.jsx(He,{label:(k==null?void 0:k.name)||p,size:"small",sx:{backgroundColor:(k==null?void 0:k.color)||ke,color:"#fff"}},p)})}):""}),e.jsx(h,{children:i.pointType||""}),e.jsx(h,{children:i.pointUnitType||""}),e.jsx(h,{children:i.aggregateType||"合算"}),e.jsx(h,{padding:"checkbox",children:e.jsx(u,{onClick:p=>p.stopPropagation(),sx:{width:32,height:32,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:e.jsx(st,{size:"small",onClick:()=>Be(v),sx:{width:24,height:24},disabled:a,children:e.jsx(nt,{fontSize:"small",color:a?"disabled":"error"})})})})]},i.id))})]})}),e.jsxs(St,{open:L,onClose:be,children:[e.jsxs(Le,{children:["スタッツ設定",U===-1?"追加":"編集"]}),e.jsx(Ee,{sx:{display:"flex",flexDirection:"column",gap:2},children:e.jsxs(e.Fragment,{children:[e.jsxs(ye,{fullWidth:!0,sx:{mt:3},children:[e.jsx(Ce,{id:"stat-category-label",children:"プレー区分"}),e.jsxs(Se,{labelId:"stat-category-label",value:ce,label:"プレー区分",onChange:i=>{se(i.target.value),D(""),re([]),m([])},disabled:ne.length>0||ee.length>0,children:[e.jsx(X,{value:"",children:"なし"}),f.map(i=>e.jsx(X,{value:i.id,children:i.name},i.id))]})]}),e.jsxs(ye,{fullWidth:!0,sx:{mt:1},children:[e.jsx(Ce,{id:"stat-detail-label",children:"プレー詳細"}),e.jsxs(Se,{labelId:"stat-detail-label",value:ie,label:"プレー詳細",onChange:i=>{D(i.target.value),b(""),w(""),re([]),m([])},disabled:_!==""||T!==""||ne.length>0||ee.length>0,children:[e.jsx(X,{value:"",children:"なし"}),g.filter(i=>i.playCategoryId===ce).map(i=>e.jsx(X,{value:i.id,children:i.name},i.id))]})]}),e.jsx(Kt,{multiple:!0,options:x,getOptionLabel:i=>i.name,value:x.filter(i=>ne.includes(i.id)),onChange:(i,v)=>{re(v.map(p=>p.id)),v.length>0&&(se(""),D(""))},disabled:ce!==""||ie!=="",renderTags:(i,v)=>i.map((p,k)=>e.jsx(He,{...v({index:k}),label:p.name,size:"small",sx:{backgroundColor:p.color||ke,color:"#fff"}})),renderInput:i=>e.jsx(oe,{...i,label:"プレー区分タグ",margin:"dense"}),fullWidth:!0}),e.jsx(Kt,{multiple:!0,options:d,getOptionLabel:i=>i.name,value:d.filter(i=>ee.includes(i.id)),onChange:(i,v)=>{m(v.map(p=>p.id)),v.length>0&&(se(""),D(""))},disabled:ce!==""||ie!=="",renderTags:(i,v)=>i.map((p,k)=>e.jsx(He,{...v({index:k}),label:p.name,size:"small",sx:{backgroundColor:p.color||ke,color:"#fff"}})),renderInput:i=>e.jsx(oe,{...i,label:"プレー詳細タグ",margin:"dense"}),fullWidth:!0}),e.jsxs(u,{sx:{display:"flex",gap:2},children:[e.jsxs(ye,{fullWidth:!0,children:[e.jsx(Ce,{id:"stat-point-label",children:"得点区分"}),e.jsxs(Se,{labelId:"stat-point-label",value:_,label:"得点区分",onChange:i=>{b(i.target.value),i.target.value!==""&&D("")},disabled:ie!=="",children:[e.jsx(X,{value:"",children:"なし"}),e.jsx(X,{value:"得点",children:"得点"}),e.jsx(X,{value:"失点",children:"失点"})]})]}),e.jsxs(ye,{fullWidth:!0,children:[e.jsx(Ce,{id:"stat-unit-label",children:"得失点単位区分"}),e.jsxs(Se,{labelId:"stat-unit-label",value:T,label:"得失点単位区分",onChange:i=>{w(i.target.value),i.target.value!==""&&D("")},disabled:ie!=="",children:[e.jsx(X,{value:"",children:"なし"}),e.jsx(X,{value:"メンバー",children:"メンバー"}),e.jsx(X,{value:"チーム",children:"チーム"})]})]})]}),e.jsxs(ye,{fullWidth:!0,children:[e.jsx(Ce,{id:"stat-aggregate-label",children:"集計方法"}),e.jsxs(Se,{labelId:"stat-aggregate-label",value:R,label:"集計方法",onChange:i=>P(i.target.value),children:[e.jsx(X,{value:"合算",children:"合算"}),e.jsx(X,{value:"セット平均",children:"セット平均"})]})]})]})}),e.jsxs(We,{children:[e.jsx(Q,{onClick:be,color:"inherit",startIcon:e.jsx(Ue,{}),children:"キャンセル"}),e.jsx(Q,{onClick:ze,disabled:!Ke(),startIcon:e.jsx(_e,{}),children:"OK"})]})]}),e.jsxs(pt,{open:q,onClose:Je,children:[e.jsx(Le,{children:"削除確認"}),e.jsx(Ee,{sx:{mt:2},children:"このスタッツ設定を削除しますか？"}),e.jsxs(We,{children:[e.jsx(Q,{onClick:Je,color:"inherit",startIcon:e.jsx(Ue,{}),children:"キャンセル"}),e.jsx(Q,{onClick:Ie,color:"error",startIcon:e.jsx(_e,{}),children:"OK"})]})]})]})}function _s(n,r,f){var x,d;if(!n)return!1;const g=r.get(n.playCategoryId);return!(f.playDetailId&&n.id!==f.playDetailId||f.playCategoryId&&n.playCategoryId!==f.playCategoryId||f.playCategoryTags&&f.playCategoryTags.length>0&&!((x=g==null?void 0:g.tags)!=null&&x.some(a=>f.playCategoryTags.includes(a)))||f.playDetailTags&&f.playDetailTags.length>0&&!((d=n.tags)!=null&&d.some(a=>f.playDetailTags.includes(a)))||f.pointType&&n.pointType!==f.pointType||f.pointUnitType&&n.pointUnitType!==f.pointUnitType)}function Os(n,r,f,g){const x=g.map(()=>({teamA:0,teamB:0}));return n.forEach(d=>{d.rallies.forEach(a=>{g.forEach((M,S)=>{const H=a.teamAPlayDetail?r.get(a.teamAPlayDetail):void 0;_s(H,f,M)&&(x[S].teamA+=1);const y=a.teamBPlayDetail?r.get(a.teamBPlayDetail):void 0;_s(y,f,M)&&(x[S].teamB+=1)})})}),x}function oa(n,r){const f=[];let g=0,x=0,d=0,a=0;return n.forEach(S=>{let H=0,y=0,$=0,L=0;S.rallies.forEach(I=>{if(I.timeoutTeam||I.substitutionTeam||!I.serverTeam)return;const U=I.teamAPlayDetail?r.get(I.teamAPlayDetail):void 0,K=I.teamBPlayDetail?r.get(I.teamBPlayDetail):void 0;I.serverTeam==="teamA"?(y+=1,(U&&U.pointType==="得点"||K&&K.pointType==="失点")&&(H+=1)):(L+=1,(K&&K.pointType==="得点"||U&&U.pointType==="失点")&&($+=1))}),g+=H,x+=y,d+=$,a+=L,f.push({teamA:y?`${Math.round(H/y*100)}%`:"-",teamB:L?`${Math.round($/L*100)}%`:"-"})}),{overall:{teamA:x?`${Math.round(g/x*100)}%`:"-",teamB:a?`${Math.round(d/a*100)}%`:"-"},perSet:f}}function da(n,r){const f=[];let g=0,x=0,d=0,a=0;return n.forEach(S=>{let H=0,y=0,$=0,L=0;S.rallies.forEach(I=>{if(I.timeoutTeam||I.substitutionTeam||!I.serverTeam)return;const U=I.teamAPlayDetail?r.get(I.teamAPlayDetail):void 0,K=I.teamBPlayDetail?r.get(I.teamBPlayDetail):void 0;I.serverTeam==="teamB"?(y+=1,(U&&U.pointType==="得点"||K&&K.pointType==="失点")&&(H+=1)):(L+=1,(K&&K.pointType==="得点"||U&&U.pointType==="失点")&&($+=1))}),g+=H,x+=y,d+=$,a+=L,f.push({teamA:y?`${Math.round(H/y*100)}%`:"-",teamB:L?`${Math.round($/L*100)}%`:"-"})}),{overall:{teamA:x?`${Math.round(g/x*100)}%`:"-",teamB:a?`${Math.round(d/a*100)}%`:"-"},perSet:f}}function ca({sets:n,playDetails:r,playCategories:f,statsSettings:g,matchStatsSettings:x,onMatchStatsSettingsChange:d,rallyCategoryTags:a,rallyDetailTags:M,teamAName:S,teamBName:H,locked:y}){const $=new Map(r.map(b=>[b.id,b])),L=new Map(f.map(b=>[b.id,b])),I=b=>{var T;return((T=f.find(w=>w.id===b))==null?void 0:T.name)||""},U=b=>{var T;return((T=r.find(w=>w.id===b))==null?void 0:T.name)||""},K=[...g,...x],ce=Os(n,$,L,K),se=n.map(b=>Os([b],$,L,K)),ie=ce.map((b,T)=>{if(K[T].aggregateType==="セット平均"){const R=n.length||1;return{teamA:(b.teamA/R).toFixed(1),teamB:(b.teamB/R).toFixed(1)}}return b}),D=se.map(b=>K.reduce((T,w,R)=>(w.aggregateType!=="セット平均"&&T.push(b[R]),T),[])),ne=K.filter(b=>b.aggregateType!=="セット平均"),re=oa(n,$),ee=da(n,$),m=b=>{const T=[];b.playCategoryId?T.push(e.jsx("span",{children:I(b.playCategoryId)},"cat")):b.playCategoryTags&&b.playCategoryTags.length>0&&T.push(e.jsx(u,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center",mt:.5},children:b.playCategoryTags.map(R=>{const P=a.find(E=>E.id===R);return e.jsx(He,{label:(P==null?void 0:P.name)||R,size:"small",sx:{mr:.5,mb:.5,backgroundColor:(P==null?void 0:P.color)||ke,color:"#fff"}},R)})},"catTags")),b.playDetailId?T.push(e.jsx("span",{children:U(b.playDetailId)},"detail")):b.playDetailTags&&b.playDetailTags.length>0&&T.push(e.jsx(u,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center",mt:.5},children:b.playDetailTags.map(R=>{const P=M.find(E=>E.id===R);return e.jsx(He,{label:(P==null?void 0:P.name)||R,size:"small",sx:{mr:.5,mb:.5,backgroundColor:(P==null?void 0:P.color)||ke,color:"#fff"}},R)})},"detailTags"));const w=[];return b.pointType&&w.push(b.pointType),b.pointUnitType&&w.push(b.pointUnitType),w.length>0&&T.push(e.jsx("span",{children:w.join(",")},"point")),T.push(e.jsxs("span",{children:["(",b.aggregateType||"合算",")"]},"agg")),e.jsx(u,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:T.map((R,P)=>e.jsx(u,{sx:{display:"flex",justifyContent:"center"},children:R},P))})},_=(b,T,w,R,P)=>e.jsx(jt,{component:lt,storageKey:P,sx:{mb:2},children:e.jsxs(mt,{size:"small",sx:{"& th, & td":{textAlign:"center",verticalAlign:"middle"}},children:[e.jsx(ht,{children:e.jsxs(Ae,{sx:{backgroundColor:E=>E.palette.mode==="dark"?"#343A42":"#f5f5f5",height:50},children:[e.jsx(h,{children:S||"チームA"}),e.jsx(h,{children:"項目"}),e.jsx(h,{children:H||"チームB"})]})}),e.jsxs(ft,{children:[e.jsxs(Ae,{sx:{height:50},children:[e.jsx(h,{children:T.teamA}),e.jsx(h,{children:"ブレイク率"}),e.jsx(h,{children:T.teamB})]},"break-rate"),e.jsxs(Ae,{sx:{height:50},children:[e.jsx(h,{children:w.teamA}),e.jsx(h,{children:"サイドアウト率"}),e.jsx(h,{children:w.teamB})]},"sideout-rate"),R.map((E,me)=>e.jsxs(Ae,{sx:{height:50},children:[e.jsx(h,{children:b[me].teamA}),e.jsx(h,{children:m(E)}),e.jsx(h,{children:b[me].teamB})]},E.id))]})]})});return e.jsxs(u,{sx:{display:"grid",gap:2,gridTemplateColumns:{xs:"1fr",md:"repeat(2, 1fr)"},maxWidth:1024,width:"100%",mx:"auto"},children:[e.jsxs(u,{children:[e.jsx($e,{variant:"h6",sx:{mb:1},children:"試合全体のスタッツ"}),_(ie,re.overall,ee.overall,K,"stats-overall")]}),n.map((b,T)=>e.jsxs(u,{children:[e.jsx($e,{variant:"h6",sx:{mb:1},children:`${T+1}セット目(${b.my}-${b.opponent})のスタッツ`}),_(D[T],re.perSet[T],ee.perSet[T],ne,`stats-set-${T}`)]},b.id)),e.jsxs(u,{sx:{gridColumn:"1 / -1"},children:[e.jsx(ra,{statsSettings:x,onChange:d,playCategories:f,playDetails:r,rallyCategoryTags:a,rallyDetailTags:M,disabled:y}),e.jsxs(Rs,{severity:"info",sx:{mt:1},children:["本設定は試合内のみでの設定となります",e.jsx("br",{}),"各試合共通でのスタッツ項目の設定は設定＞スタッツメニューから設定してください"]})]})]})}var hs={},ua=pe;Object.defineProperty(hs,"__esModule",{value:!0});var Yt=hs.default=void 0,xa=ua(je()),ma=e;Yt=hs.default=(0,xa.default)((0,ma.jsx)("path",{d:"M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m-9-2V7H4v3H1v2h3v3h2v-3h3v-2zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"PersonAdd");const ha=()=>typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():Math.random().toString(36).slice(2)+Date.now().toString(36);function fa({match:n,setMatch:r,teamAName:f,teamBName:g,teamMembers:x,onAddMember:d,locked:a}){const M=Xt(),S="tutorial-member-select",[H,y]=o.useState(()=>!localStorage.getItem(S)),$="tutorial-member-row",[L,I]=o.useState(null),[U,K]=o.useState(!1),[ce,se]=o.useState(!1),[ie,D]=o.useState(""),[ne,re]=o.useState(""),[ee,m]=o.useState([]),[_,b]=o.useState("teamA"),[T,w]=o.useState([]),[R,P]=o.useState(!1),[E,me]=o.useState(null),[q,ge]=o.useState(null),Oe=c=>{if(!c.destination||c.source.droppableId!==c.destination.droppableId||a)return;const j=c.source.droppableId==="teamA"?"teamAMembers":"teamBMembers",z=Array.from(n[j]),[Z]=z.splice(c.source.index,1);z.splice(c.destination.index,0,Z),r(G=>({...G,[j]:z}))},Re=o.useMemo(()=>{const c=_==="teamA"?n.teamA:n.teamB,j=x[c]||[],z=_==="teamA"?n.teamAMembers:n.teamBMembers;return j.filter(Z=>Z.visible!==!1&&!z.some(G=>G.id===Z.id))},[_,n,x]),Ke=c=>{b(c),w([]),K(!0)},ze=c=>{w(j=>j.some(Z=>Z.id===c.id)?j.filter(Z=>Z.id!==c.id):[...j,c])},be=()=>{const c=!localStorage.getItem($);r(_==="teamA"?j=>({...j,teamAMembers:[...j.teamAMembers,...T.map(z=>({...z,statuses:Array(j.sets.length).fill("")}))]}):j=>({...j,teamBMembers:[...j.teamBMembers,...T.map(z=>({...z,statuses:Array(j.sets.length).fill("")}))]})),K(!1),c&&I(_)},Be=()=>{K(!1)},Ie=(c,j)=>{a||(me(c),ge(j),P(!0))},Je=()=>{E&&q!==null&&r(E==="teamA"?c=>({...c,teamAMembers:c.teamAMembers.filter((j,z)=>z!==q)}):c=>({...c,teamBMembers:c.teamBMembers.filter((j,z)=>z!==q)})),P(!1)},i=()=>{P(!1)},v=()=>{a||(D(""),re(""),m([]),se(!0))},p=()=>{const c=_==="teamA"?n.teamA:n.teamB;c&&d(c,{id:ha(),no:Number(ie),name:ne,positions:ee}),se(!1)},k=()=>{se(!1)},W=(c,j,z)=>{a||r(Z=>{const G=c==="teamA"?"teamAMembers":"teamBMembers",ae=[...Z[G]],ue={...ae[j]},he=[...ue.statuses||Array(Z.sets.length).fill("")],we=he[z]||"";let xe="";return we===""?xe="starter":we==="starter"?xe="libero":xe="",he[z]=xe,ue.statuses=he,ae[j]=ue,{...Z,[G]:ae}})};return e.jsxs(Qt,{onDragEnd:Oe,children:[e.jsxs(Ct,{container:!0,spacing:2,children:[e.jsxs(Ct,{item:!0,xs:12,children:[e.jsxs(u,{sx:{maxWidth:1024,mx:"auto"},children:[e.jsx($e,{variant:"h6",sx:{mb:1},children:f}),e.jsx(Q,{variant:"contained",size:"small",sx:{mb:1},onClick:()=>Ke("teamA"),disabled:a,startIcon:e.jsx(Yt,{}),children:"メンバー登録"})]}),e.jsx(at,{open:H,onClose:()=>y(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:it,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${M.palette.text.secondary}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${M.palette.text.secondary}`}}}},title:e.jsxs(u,{sx:{p:1,maxWidth:260},children:[e.jsx($e,{variant:"body2",children:"各セットのラリー結果を入力する際に選択するメンバーとして表示されますが、未登録の場合においてもラリー結果の入力自体は可能です"}),e.jsx(u,{sx:{textAlign:"right",mt:1},children:e.jsx(rt,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem(S,"1"),y(!1)},children:"了解した"})})]}),children:e.jsx(u,{children:e.jsx(at,{open:L==="teamA",onClose:()=>I(null),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:it,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${M.palette.text.secondary}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${M.palette.text.secondary}`}}}},title:e.jsxs(u,{sx:{p:1,maxWidth:260},children:[e.jsxs($e,{variant:"body2",children:["左側の",e.jsx(dt,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),"をドラッグすることで順番を入れ替えることができます",e.jsx("br",{}),"右側の",e.jsx(nt,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),"をタップすることで削除ができます",e.jsx("br",{}),"各セットごとで出場設定をすることができますが、現状は何かに使われることはありません（今後の機能アップデートにて利用）"]}),e.jsx(u,{sx:{textAlign:"right",mt:1},children:e.jsx(rt,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem($,"1"),I(null)},children:"了解した"})})]}),children:e.jsx(u,{children:e.jsx(jt,{component:lt,storageKey:"members-teamA",sx:{maxWidth:1024,mx:"auto"},children:e.jsxs(mt,{size:"small",children:[e.jsx(ht,{children:e.jsxs(Ae,{sx:{backgroundColor:c=>c.palette.mode==="dark"?"#343A42":"#f5f5f5",height:50},children:[e.jsx(h,{}),e.jsx(h,{children:"番号"}),e.jsx(h,{children:"名前"}),e.jsx(h,{children:"ポジション"}),n.sets.map((c,j)=>e.jsx(h,{align:"center",children:j+1},j)),e.jsx(h,{})]})}),e.jsx(kt,{droppableId:"teamA",children:c=>e.jsxs(ft,{ref:c.innerRef,...c.droppableProps,children:[n.teamAMembers.map((j,z)=>e.jsx(_t,{draggableId:`teamA-${j.id}`,index:z,isDragDisabled:a,children:Z=>e.jsxs(Ae,{ref:Z.innerRef,...Z.draggableProps,"data-index":z,sx:{cursor:a?"default":"pointer",height:50},children:[e.jsx(h,{padding:"checkbox",children:e.jsx(u,{onClick:G=>G.stopPropagation(),...Z.dragHandleProps,sx:{cursor:a?"default":"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:e.jsx(dt,{})})}),e.jsx(h,{children:j.no}),e.jsx(h,{children:j.name}),e.jsx(h,{children:(j.positions||[]).join(", ")}),n.sets.map((G,ae)=>{var ue,he,we,xe,fe,De;return e.jsx(h,{padding:"checkbox",align:"center",children:e.jsx(Q,{size:"small",variant:(ue=j.statuses)!=null&&ue[ae]?"contained":"outlined",color:((he=j.statuses)==null?void 0:he[ae])==="starter"?"primary":void 0,sx:{minWidth:32,width:32,p:0,...((we=j.statuses)==null?void 0:we[ae])==="starter"?{backgroundColor:"primary.main",color:"#fff","&:hover":{backgroundColor:"primary.main"}}:((xe=j.statuses)==null?void 0:xe[ae])==="libero"?{backgroundColor:"#FF9933",color:"#fff","&:hover":{backgroundColor:"#FF9933"},"&.Mui-focusVisible":{outline:"2px solid #FF9933"}}:{}},onClick:()=>W("teamA",z,ae),disabled:a,children:((fe=j.statuses)==null?void 0:fe[ae])==="starter"?"出":((De=j.statuses)==null?void 0:De[ae])==="libero"?"リ":"不"})},ae)}),e.jsx(h,{padding:"checkbox",children:e.jsx(u,{onClick:G=>G.stopPropagation(),sx:{width:32,height:32,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:e.jsx(st,{size:"small",onClick:a?void 0:()=>Ie("teamA",z),disabled:a,sx:{width:24,height:24},children:e.jsx(nt,{fontSize:"small",color:a?"disabled":"error"})})})})]})},j.id)),c.placeholder]})})]})})})})})})]}),e.jsxs(Ct,{item:!0,xs:12,children:[e.jsxs(u,{sx:{maxWidth:1024,mx:"auto"},children:[e.jsx($e,{variant:"h6",sx:{mb:1},children:g}),e.jsx(Q,{variant:"contained",size:"small",sx:{mb:1},onClick:()=>Ke("teamB"),disabled:a,startIcon:e.jsx(Yt,{}),children:"メンバー登録"})]}),e.jsx(at,{open:L==="teamB",onClose:()=>I(null),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:it,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${M.palette.text.secondary}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${M.palette.text.secondary}`}}}},title:e.jsxs(u,{sx:{p:1,maxWidth:260},children:[e.jsxs($e,{variant:"body2",children:["左側の",e.jsx(dt,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),"をドラッグすることで順番を入れ替えることができます",e.jsx("br",{}),"右側の",e.jsx(nt,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),"をタップすることで削除ができます",e.jsx("br",{}),"各セットごとで出場設定をすることができますが、現状は何かに使われることはありません（今後の機能アップデートにて利用）"]}),e.jsx(u,{sx:{textAlign:"right",mt:1},children:e.jsx(rt,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem($,"1"),I(null)},children:"了解した"})})]}),children:e.jsx(u,{children:e.jsx(jt,{component:lt,storageKey:"members-teamB",sx:{maxWidth:1024,mx:"auto"},children:e.jsxs(mt,{size:"small",children:[e.jsx(ht,{children:e.jsxs(Ae,{sx:{backgroundColor:c=>c.palette.mode==="dark"?"#343A42":"#f5f5f5",height:50},children:[e.jsx(h,{}),e.jsx(h,{children:"番号"}),e.jsx(h,{children:"名前"}),e.jsx(h,{children:"ポジション"}),n.sets.map((c,j)=>e.jsx(h,{align:"center",children:j+1},j)),e.jsx(h,{})]})}),e.jsx(kt,{droppableId:"teamB",children:c=>e.jsxs(ft,{ref:c.innerRef,...c.droppableProps,children:[n.teamBMembers.map((j,z)=>e.jsx(_t,{draggableId:`teamB-${j.id}`,index:z,isDragDisabled:a,children:Z=>e.jsxs(Ae,{ref:Z.innerRef,...Z.draggableProps,"data-index":z,sx:{cursor:a?"default":"pointer",height:50},children:[e.jsx(h,{padding:"checkbox",children:e.jsx(u,{onClick:G=>G.stopPropagation(),...Z.dragHandleProps,sx:{cursor:a?"default":"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:e.jsx(dt,{})})}),e.jsx(h,{children:j.no}),e.jsx(h,{children:j.name}),e.jsx(h,{children:(j.positions||[]).join(", ")}),n.sets.map((G,ae)=>{var ue,he,we,xe,fe,De;return e.jsx(h,{padding:"checkbox",align:"center",children:e.jsx(Q,{size:"small",variant:(ue=j.statuses)!=null&&ue[ae]?"contained":"outlined",color:((he=j.statuses)==null?void 0:he[ae])==="starter"?"primary":void 0,sx:{minWidth:32,width:32,p:0,...((we=j.statuses)==null?void 0:we[ae])==="starter"?{backgroundColor:"primary.main",color:"#fff","&:hover":{backgroundColor:"primary.main"}}:((xe=j.statuses)==null?void 0:xe[ae])==="libero"?{backgroundColor:"#FF9933",color:"#fff","&:hover":{backgroundColor:"#FF9933"},"&.Mui-focusVisible":{outline:"2px solid #FF9933"}}:{}},onClick:()=>W("teamB",z,ae),disabled:a,children:((fe=j.statuses)==null?void 0:fe[ae])==="starter"?"出":((De=j.statuses)==null?void 0:De[ae])==="libero"?"リ":"不"})},ae)}),e.jsx(h,{padding:"checkbox",children:e.jsx(u,{onClick:G=>G.stopPropagation(),sx:{width:32,height:32,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:e.jsx(st,{size:"small",onClick:a?void 0:()=>Ie("teamB",z),disabled:a,sx:{width:24,height:24},children:e.jsx(nt,{fontSize:"small",color:a?"disabled":"error"})})})})]})},j.id)),c.placeholder]})})]})})})})]})]}),e.jsxs(St,{open:U,onClose:Be,children:[e.jsx(Le,{children:"メンバー選択"}),e.jsxs(Ee,{sx:{mt:2},children:[e.jsx(u,{sx:{display:"flex",justifyContent:"flex-end",mb:1},children:e.jsx(Q,{onClick:v,variant:"contained",size:"small",startIcon:e.jsx(Ot,{}),disabled:a||!(_==="teamA"?n.teamA:n.teamB),children:"追加"})}),e.jsx(jt,{component:lt,storageKey:`members-select-${_}`,children:e.jsxs(mt,{size:"small",children:[e.jsx(ht,{children:e.jsxs(Ae,{sx:{backgroundColor:c=>c.palette.mode==="dark"?"#343A42":"#f5f5f5",height:50},children:[e.jsx(h,{padding:"checkbox"}),e.jsx(h,{children:"番号"}),e.jsx(h,{children:"名前"}),e.jsx(h,{children:"ポジション"})]})}),e.jsx(ft,{children:Re.map(c=>{const j=T.some(z=>z.id===c.id);return e.jsxs(Ae,{sx:{cursor:"pointer",height:50},children:[e.jsx(h,{padding:"checkbox",onClick:z=>z.stopPropagation(),children:e.jsx(Xs,{checked:j,onChange:()=>ze(c)})}),e.jsx(h,{children:c.no}),e.jsx(h,{children:c.name}),e.jsx(h,{children:(c.positions||[]).join(", ")})]},c.id)})})]})})]}),e.jsxs(We,{children:[e.jsx(Q,{onClick:Be,startIcon:e.jsx(Ue,{}),color:"inherit",children:"キャンセル"}),e.jsx(Q,{onClick:be,disabled:T.length===0,startIcon:e.jsx(_e,{}),children:"OK"})]})]}),e.jsxs(St,{open:ce,onClose:k,children:[e.jsx(Le,{children:"メンバー追加"}),e.jsxs(Ee,{sx:{display:"flex",flexDirection:"column",gap:2,mt:2},children:[e.jsx(oe,{label:"番号",type:"number",value:ie,onChange:c=>D(c.target.value),margin:"dense"}),e.jsx(oe,{label:"名前",value:ne,onChange:c=>re(c.target.value),margin:"dense"}),e.jsxs(ye,{children:[e.jsx(Ce,{id:"md-positions-label",children:"ポジション"}),e.jsxs(Se,{labelId:"md-positions-label",multiple:!0,value:ee,label:"ポジション",onChange:c=>m(typeof c.target.value=="string"?c.target.value.split(","):c.target.value),renderValue:c=>c.join(", "),children:[e.jsx(X,{value:"レフト",children:"レフト"}),e.jsx(X,{value:"センター",children:"センター"}),e.jsx(X,{value:"ライト",children:"ライト"}),e.jsx(X,{value:"セッター",children:"セッター"}),e.jsx(X,{value:"リベロ",children:"リベロ"})]})]})]}),e.jsxs(We,{children:[e.jsx(Q,{onClick:k,startIcon:e.jsx(Ue,{}),color:"inherit",children:"キャンセル"}),e.jsx(Q,{onClick:p,disabled:ie==="",startIcon:e.jsx(_e,{}),children:"OK"})]})]}),e.jsxs(pt,{open:R,onClose:i,children:[e.jsx(Le,{children:"削除確認"}),e.jsx(Ee,{sx:{mt:2},children:"このメンバーを削除しますか？"}),e.jsxs(We,{children:[e.jsx(Q,{onClick:i,startIcon:e.jsx(Ue,{}),color:"inherit",children:"キャンセル"}),e.jsx(Q,{onClick:Je,color:"error",startIcon:e.jsx(_e,{}),children:"OK"})]})]})]})}function pa({match:n,setMatch:r,tags:f,onAddTag:g,locked:x}){return e.jsx(u,{sx:{maxWidth:1024,mx:"auto"},children:e.jsx(Ct,{container:!0,spacing:2,children:e.jsx(Ct,{item:!0,xs:12,children:e.jsxs(lt,{elevation:0,sx:{p:2},children:[e.jsx(oe,{label:"試合日付",type:"date",InputLabelProps:{shrink:!0},value:n.date,onChange:d=>r(a=>({...a,date:d.target.value})),fullWidth:!0,margin:"dense",disabled:x,sx:{"& .MuiOutlinedInput-root":{height:56},"& .MuiOutlinedInput-input":{padding:"0 14px",height:"100%",lineHeight:"56px",fontSize:"1rem",textAlign:"left"},'& input[type="date"]':{WebkitAppearance:"none"}}}),e.jsx(oe,{label:"試合名",value:n.matchName,onChange:d=>r(a=>({...a,matchName:d.target.value})),fullWidth:!0,margin:"dense",disabled:x}),e.jsx(Kt,{multiple:!0,freeSolo:!0,options:f,getOptionLabel:d=>typeof d=="string"?d:d.name,value:n.tags.map(d=>f.find(a=>a.id===d)).filter(Boolean),onChange:(d,a)=>{const M=[];a.forEach(S=>{if(typeof S=="string"){const H={id:crypto.randomUUID(),name:S,color:ke};g(H),M.push(H.id)}else M.push(S.id)}),r(S=>({...S,tags:M}))},renderTags:(d,a)=>d.map((M,S)=>e.jsx(He,{...a({index:S}),label:M.name,sx:{backgroundColor:M.color||ke,color:"#fff",mr:.5,mb:.5}})),renderInput:d=>e.jsx(oe,{...d,label:"タグ",margin:"dense"}),fullWidth:!0,disabled:x}),e.jsxs(Rs,{severity:"info",sx:{mt:1},children:["試合タグは上記項目にて直接入力するか、設定＞タグメニューにて追加できます",e.jsx("br",{}),"試合にタグを設定することにより、試合を横串で集計することが可能となります"]}),e.jsx(oe,{label:"場所",value:n.location,onChange:d=>r(a=>({...a,location:d.target.value})),fullWidth:!0,margin:"dense",disabled:x}),e.jsx(oe,{label:"主審",value:n.mainReferee,onChange:d=>r(a=>({...a,mainReferee:d.target.value})),fullWidth:!0,margin:"dense",disabled:x}),e.jsx(oe,{label:"副審",value:n.subReferee,onChange:d=>r(a=>({...a,subReferee:d.target.value})),fullWidth:!0,margin:"dense",disabled:x}),e.jsx(oe,{label:"動画URL",value:n.videoUrl,onChange:d=>r(a=>({...a,videoUrl:d.target.value})),multiline:!0,rows:3,fullWidth:!0,margin:"dense",disabled:x}),e.jsx(oe,{label:"メモ",value:n.memo,onChange:d=>r(a=>({...a,memo:d.target.value})),multiline:!0,rows:3,fullWidth:!0,margin:"dense",disabled:x})]})})})})}function ja({match:n,setMatch:r,teams:f,locked:g}){return e.jsxs(lt,{elevation:0,sx:{p:2},children:[e.jsxs(ye,{fullWidth:!0,margin:"normal",disabled:g,children:[e.jsx(Ce,{id:"teamA-label",children:"チームA"}),e.jsx(Se,{labelId:"teamA-label",value:n.teamA,label:"チームA",onChange:x=>r(d=>({...d,teamA:x.target.value,teamAMembers:[]})),disabled:g,children:f.map(x=>e.jsx(X,{value:x.id,children:x.name},x.id))})]}),e.jsx(oe,{label:"チームA監督",value:n.teamAHeadCoach,onChange:x=>r(d=>({...d,teamAHeadCoach:x.target.value})),fullWidth:!0,margin:"dense",disabled:g}),e.jsx(oe,{label:"チームAコーチ",value:n.teamACoach,onChange:x=>r(d=>({...d,teamACoach:x.target.value})),fullWidth:!0,margin:"dense",disabled:g}),e.jsx(oe,{label:"チームAマネージャー",value:n.teamAManager,onChange:x=>r(d=>({...d,teamAManager:x.target.value})),fullWidth:!0,margin:"dense",disabled:g}),e.jsx(oe,{label:"チームAキャプテン",value:n.teamACaptain,onChange:x=>r(d=>({...d,teamACaptain:x.target.value})),fullWidth:!0,margin:"dense",disabled:g}),e.jsxs(ye,{fullWidth:!0,margin:"normal",disabled:g,children:[e.jsx(Ce,{id:"teamB-label",children:"チームB"}),e.jsx(Se,{labelId:"teamB-label",value:n.teamB,label:"チームB",onChange:x=>r(d=>({...d,teamB:x.target.value,teamBMembers:[]})),disabled:g,children:f.map(x=>e.jsx(X,{value:x.id,children:x.name},x.id))})]}),e.jsx(oe,{label:"チームB監督",value:n.teamBHeadCoach,onChange:x=>r(d=>({...d,teamBHeadCoach:x.target.value})),fullWidth:!0,margin:"dense",disabled:g}),e.jsx(oe,{label:"チームBコーチ",value:n.teamBCoach,onChange:x=>r(d=>({...d,teamBCoach:x.target.value})),fullWidth:!0,margin:"dense",disabled:g}),e.jsx(oe,{label:"チームBマネージャー",value:n.teamBManager,onChange:x=>r(d=>({...d,teamBManager:x.target.value})),fullWidth:!0,margin:"dense",disabled:g}),e.jsx(oe,{label:"チームBキャプテン",value:n.teamBCaptain,onChange:x=>r(d=>({...d,teamBCaptain:x.target.value})),fullWidth:!0,margin:"dense",disabled:g})]})}const ga=on.create(u),ba=()=>typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():Math.random().toString(36).slice(2)+Date.now().toString(36);function Ia({match:n,onSave:r,teams:f,teamMembers:g,playDetails:x,playCategories:d,statsSettings:a,rallyCategoryTags:M,rallyDetailTags:S,themeSetting:H,scoreInputSetting:y,onAddMember:$,setAppBarAction:L,setAppBarLeftAction:I,onDirtyChange:U,tags:K,onAddTag:ce}){const se=sn(),ie=nn(),[D,ne]=o.useState("info"),re=!1;o.useEffect(()=>{const l=ie.pathname.split("/").filter(Boolean);if(l[0]!=="matches"||l[1]!==n.id)return;const C=l[2]??"info";C==="setinfo"?(ne("info"),se(`/matches/${n.id}/info`,{replace:!0})):(ne(C),l[2]||se(`/matches/${n.id}/info`,{replace:!0}))},[ie.pathname,se,n.id,re]);const ee=o.useCallback(l=>{const C=l.teamA,B=l.teamB,O=(le,Y)=>!!Y&&(g[le]||[]).some(V=>V.id===Y&&V.visible!==!1),te=(le,Y)=>Y.filter(V=>O(le,V.id)).map(V=>{const ve=(g[le]||[]).find(Ne=>Ne.id===V.id);return ve?{...V,no:ve.no,name:ve.name,positions:ve.positions}:V});return{...l,teamAMembers:te(C,l.teamAMembers),teamBMembers:te(B,l.teamBMembers),sets:l.sets.map(le=>({...le,rallies:le.rallies.map(Y=>({...Y,server:O(Y.serverTeam==="teamA"?C:B,Y.server)?Y.server:void 0,teamAMember:O(C,Y.teamAMember)?Y.teamAMember:void 0,teamBMember:O(B,Y.teamBMember)?Y.teamBMember:void 0}))}))}},[g]),[m,_]=o.useState(()=>ee({...n,tags:n.tags||[],matchStatsSettings:n.matchStatsSettings||[],teamAMembers:n.teamAMembers.map(l=>({...l,statuses:l.statuses??Array(n.sets.length).fill("")})),teamBMembers:n.teamBMembers.map(l=>({...l,statuses:l.statuses??Array(n.sets.length).fill("")}))})),b=5,T=[Ls,Es,Ws,Us,Vs],w=!!n.locked,R=Xt(),P=Qs(R.breakpoints.up("sm")),[E,me]=o.useState(!1),[q,ge]=o.useState(!1),Oe=200,Re=56,[Ke,ze]=o.useState(!1),be=R.palette.text.secondary,Be=o.useCallback(()=>{E?(ge(!1),me(!1)):(me(!0),P||ge(!0))},[E,P]),Ie=o.useCallback(l=>{l.propertyName==="width"&&P&&E&&ge(!0)},[P,E]);o.useEffect(()=>{P||(me(!1),ge(!1))},[P]),o.useEffect(()=>(I(e.jsx(at,{open:Ke,onClose:()=>ze(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:it,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${be}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${be}`}}}},title:e.jsxs(u,{sx:{p:1,maxWidth:260},children:[e.jsxs($e,{variant:"body2",children:[e.jsx(ks,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),"からメニューを開き、各セットのメニューをロングタップし上下にスライドすることでセット順の変更が可能です"]}),e.jsx(u,{sx:{textAlign:"right",mt:1},children:e.jsx(rt,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem("tutorial-set-reorder","1"),ze(!1)},children:"了解した"})})]}),children:e.jsx(st,{color:"inherit",onClick:Be,children:e.jsx(ks,{})})})),()=>I(null)),[I,Be,Ke,be]);const[Je,i]=o.useState(!1),[v,p]=o.useState(!1),[k,W]=o.useState(null),[c,j]=o.useState(!1),[z,Z]=o.useState({open:!1,message:"",severity:"success"}),G=`matchDraft-${n.id}`,ae=o.useRef(!1),[ue,he]=o.useState(!1),[we,xe]=o.useState(!1),[fe,De]=o.useState({}),Ge=o.useCallback((l,C,B=!0)=>{_(O=>{const te=[...O.sets],le=te.findIndex(V=>V.id===l);if(le===-1)return O;const Y=te[le];return B&&De(V=>{const ve=V[l]||{undo:[]};return{...V,[l]:{undo:[...ve.undo,Y],redo:[]}}}),te[le]=C,{...O,sets:te}})},[]),Tt=o.useCallback(()=>{if(!/^[0-9]+$/.test(D))return;const l=Number(D)-1,C=m.sets[l],B=fe[C.id];if(!B||B.undo.length===0)return;const O=B.undo[B.undo.length-1];De(te=>({...te,[C.id]:{undo:B.undo.slice(0,-1),redo:[...B.redo,C]}})),Ge(C.id,O,!1)},[D,m.sets,fe,Ge]),gt=o.useCallback(()=>{if(!/^[0-9]+$/.test(D))return;const l=Number(D)-1,C=m.sets[l],B=fe[C.id];if(!B||B.redo.length===0)return;const O=B.redo[B.redo.length-1];De(te=>({...te,[C.id]:{undo:[...B.undo,C],redo:B.redo.slice(0,-1)}})),Ge(C.id,O,!1)},[D,m.sets,fe,Ge]),ct=l=>{if(!l.destination||w)return;const C=l.source.index,B=l.destination.index;if(C===B)return;const O=Array.from(m.sets),[te]=O.splice(C,1);O.splice(B,0,te);const le=ve=>ve.map(Ne=>{const de=Array.from(Ne.statuses||[]),[Xe]=de.splice(C,1);return de.splice(B,0,Xe),{...Ne,statuses:de}}),Y=le(m.teamAMembers),V=le(m.teamBMembers);_(ve=>({...ve,sets:O,teamAMembers:Y,teamBMembers:V}))};o.useEffect(()=>{De(l=>{const C={...l};return Object.keys(C).forEach(B=>{m.sets.some(O=>O.id===B)||delete C[B]}),C})},[m.sets]),o.useEffect(()=>{_(l=>ee(l))},[ee]);const tt=l=>{var C;return((C=f.find(B=>B.id===l))==null?void 0:C.name)||""},Me=o.useMemo(()=>m.date!==n.date||m.matchName!==n.matchName||m.location!==n.location||m.mainReferee!==n.mainReferee||m.subReferee!==n.subReferee||m.videoUrl!==n.videoUrl||m.memo!==n.memo||m.teamA!==n.teamA||m.teamAHeadCoach!==n.teamAHeadCoach||m.teamACoach!==n.teamACoach||m.teamAManager!==n.teamAManager||m.teamACaptain!==n.teamACaptain||m.teamB!==n.teamB||m.teamBHeadCoach!==n.teamBHeadCoach||m.teamBCoach!==n.teamBCoach||m.teamBManager!==n.teamBManager||m.teamBCaptain!==n.teamBCaptain||JSON.stringify(m.tags)!==JSON.stringify(n.tags)||JSON.stringify(m.teamAMembers)!==JSON.stringify(n.teamAMembers)||JSON.stringify(m.teamBMembers)!==JSON.stringify(n.teamBMembers)||JSON.stringify(m.matchStatsSettings||[])!==JSON.stringify(n.matchStatsSettings||[])||JSON.stringify(m.sets)!==JSON.stringify(n.sets),[m,n]);o.useEffect(()=>{localStorage.getItem(G)&&j(!0)},[G]),o.useEffect(()=>{if(!ae.current){ae.current=!0;return}Me?localStorage.setItem(G,JSON.stringify(m)):localStorage.removeItem(G)},[m,Me,G]);const Rt=()=>{if(w||m.sets.length>=b)return;m.sets.length===1&&!localStorage.getItem("tutorial-set-reorder")&&ze(!0);const l={id:ba(),my:0,opponent:0,rallies:[]},C=m.sets.length+1;_(B=>({...B,sets:[...B.sets,l],teamAMembers:B.teamAMembers.map(O=>({...O,statuses:[...O.statuses||[],""]})),teamBMembers:B.teamBMembers.map(O=>({...O,statuses:[...O.statuses||[],""]}))})),ne(String(C)),se(`/matches/${n.id}/${C}`)},zt=l=>{w||(W(l),p(!0))},At=()=>{if(k===null)return;const l=k,C=m.sets.length;let B=[],O=[],te=[];const le=D;let Y=D;if(D!=="info"&&D!=="members"&&D!=="stats"&&D!=="setinfo"){const V=Number(D)-1;V===l?l>0?(Y=String(l),se(`/matches/${n.id}/${l}`)):C>1?(Y="1",se(`/matches/${n.id}/1`)):(Y="info",se(`/matches/${n.id}/info`)):V>l&&(Y=String(V),se(`/matches/${n.id}/${V}`))}ne(Y),_(V=>{B=V.sets.map(de=>({...de})),O=V.teamAMembers.map(de=>({...de,statuses:de.statuses?[...de.statuses]:[]})),te=V.teamBMembers.map(de=>({...de,statuses:de.statuses?[...de.statuses]:[]}));const ve=V.sets.filter((de,Xe)=>Xe!==l),Ne=de=>de.map(Xe=>({...Xe,statuses:(Xe.statuses||[]).filter((Wt,Mt)=>Mt!==l)}));return{...V,sets:ve,teamAMembers:Ne(V.teamAMembers),teamBMembers:Ne(V.teamBMembers)}}),W(null),p(!1),Z({open:!0,message:"セットを削除しました",severity:"success",actionLabel:"元に戻す",onAction:()=>{_(V=>({...V,sets:B,teamAMembers:O,teamBMembers:te})),le!=="info"&&le!=="members"&&le!=="stats"&&le!=="setinfo"&&se(`/matches/${n.id}/${le}`)},autoHideDuration:5e3})},bt=()=>{W(null),p(!1)},vt=o.useCallback(()=>{i(!0)},[]),wt=async()=>{const l=ee(m);_(l);try{await Promise.resolve(r(l)),localStorage.removeItem(G),Z({open:!0,message:"保存しました",severity:"success"})}catch{Z({open:!0,message:"保存に失敗しました",severity:"error"})}i(!1)},Fe=()=>{i(!1)},Bt=()=>{Z(l=>({...l,open:!1}))},Ft=()=>{const l=localStorage.getItem(G);if(!l){j(!1);return}try{const C=JSON.parse(l),B={...C,tags:C.tags||[],matchStatsSettings:C.matchStatsSettings||[],teamAMembers:C.teamAMembers.map(te=>({...te,statuses:te.statuses??Array(C.sets.length).fill("")})),teamBMembers:C.teamBMembers.map(te=>({...te,statuses:te.statuses??Array(C.sets.length).fill("")}))},O=ee(B);_(O),r(O)}catch{}localStorage.removeItem(G),j(!1)},It=()=>{localStorage.removeItem(G),j(!1)},Ve=o.useMemo(()=>/^[0-9]+$/.test(D),[D]),Ye=o.useMemo(()=>Ve?m.sets[Number(D)-1]:null,[Ve,D,m.sets]),ot=o.useMemo(()=>{var l;return!Ve||w||!Ye||!((l=fe[Ye.id])!=null&&l.undo.length)},[Ve,w,Ye,fe]),ut=o.useMemo(()=>{var l;return!Ve||w||!Ye||!((l=fe[Ye.id])!=null&&l.redo.length)},[Ve,w,Ye,fe]);o.useEffect(()=>{ot?he(!1):localStorage.getItem("tutorial-undo")||he(!0)},[ot]),o.useEffect(()=>{ut?xe(!1):localStorage.getItem("tutorial-redo")||xe(!0)},[ut]),o.useEffect(()=>(L(e.jsxs(u,{sx:{display:"flex",alignItems:"center"},children:[Ve&&e.jsxs(e.Fragment,{children:[e.jsx(at,{open:ue,onClose:()=>he(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:it,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${be}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${be}`}}}},title:e.jsxs(u,{sx:{p:1,maxWidth:260},children:[e.jsxs($e,{variant:"body2",children:["各セットタブで独立し、ラリー結果の操作履歴を保持しています。",e.jsx("br",{}),e.jsx(Jt,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),"を選択することで1つ前の操作を取り消すことができます。",e.jsx("br",{}),"操作履歴は試合画面を離れると消去されます。"]}),e.jsx(u,{sx:{textAlign:"right",mt:1},children:e.jsx(rt,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem("tutorial-undo","1"),he(!1)},children:"了解した"})})]}),children:e.jsx(st,{onClick:Tt,disabled:ot,color:"inherit",sx:{ml:1},children:e.jsx(Jt,{})})}),e.jsx(at,{open:we,onClose:()=>xe(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:it,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${be}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${be}`}}}},title:e.jsxs(u,{sx:{p:1,maxWidth:260},children:[e.jsxs($e,{variant:"body2",children:[e.jsx(Gt,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),"を選択することで1つ前に取り消した操作を復活することができます。"]}),e.jsx(u,{sx:{textAlign:"right",mt:1},children:e.jsx(rt,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem("tutorial-redo","1"),xe(!1)},children:"了解した"})})]}),children:e.jsx(st,{onClick:gt,disabled:ut,color:"inherit",sx:{ml:1},children:e.jsx(Gt,{})})})]}),e.jsx(Q,{onClick:vt,variant:"contained",disabled:!Me||w,startIcon:e.jsx(Ns,{}),sx:{ml:1},children:"保存"})]})),()=>L(null)),[L,Ve,Tt,gt,vt,Me,w,ot,ut,ue,we,be]),o.useEffect(()=>(U==null||U(Me),()=>U==null?void 0:U(!1)),[Me,U]);const Dt=[{key:"info",label:"試合概要",icon:e.jsx(ln,{})},{key:"team",label:"チーム",icon:e.jsx(Hs,{})},{key:"members",label:"メンバー登録",icon:e.jsx(zs,{})},{key:"sep1",divider:!0},{key:"stats",label:"スタッツ",icon:e.jsx(rn,{})},{key:"sep2",divider:!0},{key:"setinfo",label:"セット情報",icon:e.jsx(Fs,{})}].filter(l=>l.key!=="setinfo"),Ht=m.sets.map((l,C)=>{const B=T[C];return{key:`${C+1}`,icon:e.jsx(B,{}),label:`${l.my}-${l.opponent}`}}),Lt=!w&&m.sets.length<b?[{key:"add",label:"セット追加",icon:e.jsx(Ot,{})}]:[],yt=l=>{l==="add"?Rt():(ne(l),se(`/matches/${n.id}/${l}`)),P||(ge(!1),me(!1))},Et=e.jsxs(ga,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},sx:{flexGrow:1,overflowY:"auto",display:"flex",flexDirection:"column"},children:[D==="info"&&e.jsx(pa,{match:m,setMatch:_,tags:K,onAddTag:ce,locked:w}),D==="members"&&e.jsx(fa,{match:m,setMatch:_,teamAName:tt(m.teamA)||"チームA",teamBName:tt(m.teamB)||"チームB",teamMembers:g,onAddMember:$,locked:w}),D==="stats"&&e.jsx(ca,{sets:m.sets,playDetails:x,playCategories:d,statsSettings:a,matchStatsSettings:m.matchStatsSettings||[],onMatchStatsSettingsChange:l=>_(C=>({...C,matchStatsSettings:l})),rallyCategoryTags:M,rallyDetailTags:S,teamAName:tt(m.teamA),teamBName:tt(m.teamB),locked:w}),D==="team"&&e.jsx(u,{sx:{maxWidth:1024,mx:"auto"},children:e.jsx(ja,{match:m,setMatch:_,teams:f,locked:w})}),re,D!=="info"&&D!=="members"&&D!=="stats"&&D!=="setinfo"&&D!=="team"&&e.jsx(aa,{setScore:m.sets[Number(D)-1],playDetails:x,playCategories:d,teamAMembers:m.teamAMembers,teamBMembers:m.teamBMembers,teamAName:tt(m.teamA),teamBName:tt(m.teamB),locked:w,scoreInputSetting:y,themeSetting:H,onChange:l=>Ge(l.id,l)})]},D);return e.jsxs(u,{sx:{display:"flex",height:"100%"},children:[e.jsx(Zs,{variant:P?"permanent":"temporary",open:P?!0:E,onClose:()=>{ge(!1),me(!1)},PaperProps:{onTransitionEnd:Ie},ModalProps:{keepMounted:!0,BackdropProps:{sx:{backgroundColor:"rgba(0, 0, 0, 0.5)"}}},sx:{width:P?E?Oe:Re:Oe,flexShrink:0,transition:R.transitions.create("width",{easing:R.transitions.easing.sharp,duration:R.transitions.duration.standard}),...P?{zIndex:R.zIndex.appBar-1}:{},"& .MuiDrawer-paper":{width:P?E?Oe:Re:Oe,boxSizing:"border-box",overflowX:"hidden",transition:R.transitions.create("width",{easing:R.transitions.easing.sharp,duration:R.transitions.duration.standard}),...P?{top:R.mixins.toolbar.minHeight,height:`calc(100% - ${R.mixins.toolbar.minHeight}px)`,zIndex:R.zIndex.appBar-1}:{}}},children:e.jsxs(en,{children:[Dt.map(l=>l.divider?e.jsx(tn,{component:"li"},l.key):e.jsxs(Vt,{selected:D===l.key,onClick:()=>yt(l.key),sx:{minHeight:48,justifyContent:E?"initial":"center",px:2.5},children:[e.jsx(Nt,{sx:{minWidth:0,mr:E?3:0,justifyContent:"center"},children:l.icon}),e.jsx(qt,{primary:l.label??`セット${l.key}`,sx:{opacity:q?1:0,display:q?"block":"none",whiteSpace:"nowrap"}})]},l.key)),e.jsx(Qt,{onDragEnd:ct,children:e.jsx(kt,{droppableId:"drawer-sets",children:l=>e.jsxs(u,{ref:l.innerRef,...l.droppableProps,children:[Ht.map((C,B)=>e.jsx(_t,{draggableId:m.sets[B].id,index:B,children:O=>e.jsxs(Vt,{ref:O.innerRef,...O.draggableProps,...O.dragHandleProps,style:O.draggableProps.style,selected:D===C.key,onClick:()=>yt(C.key),sx:{minHeight:48,justifyContent:E?"initial":"center",px:2.5},children:[e.jsx(Nt,{sx:{minWidth:0,mr:E?3:0,justifyContent:"center"},children:C.icon}),e.jsx(qt,{primary:C.label??`セット${C.key}`,sx:{opacity:q?1:0,display:q?"block":"none",whiteSpace:"nowrap"}}),!w&&E&&e.jsx(st,{edge:"end",onClick:te=>{te.stopPropagation(),zt(B)},children:e.jsx(nt,{})})]})},m.sets[B].id)),l.placeholder]})})}),Lt.map(l=>e.jsxs(Vt,{selected:D===l.key,onClick:()=>yt(l.key),sx:{minHeight:48,justifyContent:E?"initial":"center",px:2.5},children:[e.jsx(Nt,{sx:{minWidth:0,mr:E?3:0,justifyContent:"center"},children:l.icon}),e.jsx(qt,{primary:l.label??`セット${l.key}`,sx:{opacity:q?1:0,display:q?"block":"none",whiteSpace:"nowrap"}})]},l.key))]})}),e.jsxs(u,{sx:{flexGrow:1,display:"flex",flexDirection:"column",width:P?`calc(100% - ${E?Oe:Re}px)`:"100%",transition:P?R.transitions.create("width",{duration:R.transitions.duration.standard}):void 0},children:[e.jsx(u,{sx:{mt:2,flexGrow:1,position:"relative",overflowY:"hidden",display:"flex",width:"100%"},children:e.jsx(dn,{mode:"wait",children:Et})}),e.jsxs(pt,{open:v,onClose:bt,children:[e.jsx(Le,{children:"削除確認"}),e.jsx(Ee,{sx:{mt:2},children:"このセットを削除しますか？"}),e.jsxs(We,{children:[e.jsx(Q,{onClick:bt,startIcon:e.jsx(Ue,{}),color:"inherit",children:"キャンセル"}),e.jsx(Q,{onClick:At,color:"error",startIcon:e.jsx(_e,{}),children:"OK"})]})]}),e.jsxs(pt,{open:c,onClose:It,children:[e.jsx(Le,{children:"復元確認"}),e.jsx(Ee,{sx:{mt:2},children:"入力途中のデータが存在します。復元しますか？"}),e.jsxs(We,{children:[e.jsx(Q,{onClick:It,startIcon:e.jsx(Ue,{}),color:"inherit",children:"いいえ"}),e.jsx(Q,{onClick:Ft,startIcon:e.jsx(_e,{}),children:"はい"})]})]}),e.jsxs(pt,{open:Je,onClose:Fe,children:[e.jsx(Le,{children:"保存確認"}),e.jsx(Ee,{sx:{mt:2},children:"入力内容を保存しますか？"}),e.jsxs(We,{children:[e.jsx(Q,{onClick:Fe,startIcon:e.jsx(Ue,{}),color:"inherit",children:"キャンセル"}),e.jsx(Q,{onClick:wt,disabled:!Me||w,startIcon:e.jsx(_e,{}),children:"OK"})]})]}),e.jsx(an,{open:z.open,message:z.message,severity:z.severity,onClose:Bt,actionLabel:z.actionLabel,onAction:z.onAction,autoHideDuration:z.autoHideDuration})]})]})}export{Ia as default};
