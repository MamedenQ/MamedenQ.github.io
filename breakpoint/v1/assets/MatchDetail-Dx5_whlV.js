import{i as xe,j as e,B as x,a as Rs,K as pt,Z as jt,f as Qe,g as lt,h as rt,k as ye,l as p,m as ot,C as ke,I as Xe,G as Ke,L as gt,N as Xs,r as Ut,O as Pt,n as _e,o as Oe,d as qe,e as Le,F as je,Q as ge,S as be,M as X,p as Re,q as Q,D as dt,R as Kt,U as re,A as zs,V as bt,W as Qs,b as Zs,X as en,Y as tn,_ as sn,$ as Vt,a0 as Nt,a1 as qt}from"./mui-vendor-CWczK8Oe.js";import{r as o,f as nn,u as an}from"./react-vendor-QLNaZ7XN.js";import{r as me,u as ks,S as ct,D as Be,d as ut,a as Ot,R as vt,b as ze,c as De,A as ln}from"./index-Y3gFGuf5.js";import{d as rn,a as on}from"./QueryStatsOutlined-Dqaesqz1.js";import{D as Qt,C as kt,P as _t,d as yt}from"./DragIndicator-DKM6fWF3.js";import{m as dn,A as cn}from"./motion-vendor-DXKcITea.js";import"./chart-vendor-DYaT3_Rb.js";var Zt={},un=xe;Object.defineProperty(Zt,"__esModule",{value:!0});var Hs=Zt.default=void 0,xn=un(me()),mn=e;Hs=Zt.default=(0,xn.default)((0,mn.jsx)("path",{d:"M12 5.9c1.16 0 2.1.94 2.1 2.1s-.94 2.1-2.1 2.1S9.9 9.16 9.9 8s.94-2.1 2.1-2.1m0 9c2.97 0 6.1 1.46 6.1 2.1v1.1H5.9V17c0-.64 3.13-2.1 6.1-2.1M12 4C9.79 4 8 5.79 8 8s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4m0 9c-2.67 0-8 1.34-8 4v3h16v-3c0-2.66-5.33-4-8-4"}),"PersonOutlineOutlined");var es={},hn=xe;Object.defineProperty(es,"__esModule",{value:!0});var Fs=es.default=void 0,fn=hn(me()),pn=e;Fs=es.default=(0,fn.default)((0,pn.jsx)("path",{d:"M2 17h2v.5H3v1h1v.5H2v1h3v-4H2zm1-9h1V4H2v1h1zm-1 3h1.8L2 13.1v.9h3v-1H3.2L5 10.9V10H2zm5-6v2h14V5zm0 14h14v-2H7zm0-6h14v-2H7z"}),"FormatListNumberedOutlined");var ts={},jn=xe;Object.defineProperty(ts,"__esModule",{value:!0});var Ls=ts.default=void 0,gn=jn(me()),bn=e;Ls=ts.default=(0,gn.default)((0,bn.jsx)("path",{d:"M9 13.75c-2.34 0-7 1.17-7 3.5V19h14v-1.75c0-2.33-4.66-3.5-7-3.5M4.34 17c.84-.58 2.87-1.25 4.66-1.25s3.82.67 4.66 1.25zM9 12c1.93 0 3.5-1.57 3.5-3.5S10.93 5 9 5 5.5 6.57 5.5 8.5 7.07 12 9 12m0-5c.83 0 1.5.67 1.5 1.5S9.83 10 9 10s-1.5-.67-1.5-1.5S8.17 7 9 7m7.04 6.81c1.16.84 1.96 1.96 1.96 3.44V19h4v-1.75c0-2.02-3.5-3.17-5.96-3.44M15 12c1.93 0 3.5-1.57 3.5-3.5S16.93 5 15 5c-.54 0-1.04.13-1.5.35.63.89 1 1.98 1 3.15s-.37 2.26-1 3.15c.46.22.96.35 1.5.35"}),"GroupOutlined");var ss={},vn=xe;Object.defineProperty(ss,"__esModule",{value:!0});var Es=ss.default=void 0,yn=vn(me()),Cn=e;Es=ss.default=(0,yn.default)((0,Cn.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V5h14zm-7-2h2V7h-4v2h2z"}),"LooksOneOutlined");var ns={},Sn=xe;Object.defineProperty(ns,"__esModule",{value:!0});var Ws=ns.default=void 0,Tn=Sn(me()),An=e;Ws=ns.default=(0,Tn.default)((0,An.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V5h14zm-4-4h-4v-2h2c1.1 0 2-.89 2-2V9c0-1.11-.9-2-2-2H9v2h4v2h-2c-1.1 0-2 .89-2 2v4h6z"}),"LooksTwoOutlined");var as={},wn=xe;Object.defineProperty(as,"__esModule",{value:!0});var Us=as.default=void 0,Bn=wn(me()),Dn=e;Us=as.default=(0,Bn.default)((0,Dn.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V5h14zm-4-4v-1.5c0-.83-.67-1.5-1.5-1.5.83 0 1.5-.67 1.5-1.5V9c0-1.11-.9-2-2-2H9v2h4v2h-2v2h2v2H9v2h4c1.1 0 2-.89 2-2"}),"Looks3Outlined");var is={},In=xe;Object.defineProperty(is,"__esModule",{value:!0});var Vs=is.default=void 0,Mn=In(me()),Pn=e;Vs=is.default=(0,Mn.default)((0,Pn.jsx)("path",{d:"M19.04 3h-14c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16h-14V5h14zm-6-2h2V7h-2v4h-2V7h-2v6h4z"}),"Looks4Outlined");var ls={},$n=xe;Object.defineProperty(ls,"__esModule",{value:!0});var Ns=ls.default=void 0,kn=$n(me()),_n=e;Ns=ls.default=(0,kn.default)((0,_n.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V5h14zm-4-4v-2c0-1.11-.9-2-2-2h-2V9h4V7H9v6h4v2H9v2h4c1.1 0 2-.89 2-2"}),"Looks5Outlined");var rs={},On=xe;Object.defineProperty(rs,"__esModule",{value:!0});var qs=rs.default=void 0,Rn=On(me()),zn=e;qs=rs.default=(0,Rn.default)((0,zn.jsx)("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"}),"Save");var os={},Hn=xe;Object.defineProperty(os,"__esModule",{value:!0});var Jt=os.default=void 0,Fn=Hn(me()),Ln=e;Jt=os.default=(0,Fn.default)((0,Ln.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2M5 19V5h6v14zm14 0h-6v-7h6zm0-9h-6V5h6z"}),"SpaceDashboardOutlined");var ds={},En=xe;Object.defineProperty(ds,"__esModule",{value:!0});var Gt=ds.default=void 0,Wn=En(me()),Un=e;Gt=ds.default=(0,Wn.default)((0,Un.jsx)("path",{d:"M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8"}),"UndoOutlined");var cs={},Vn=xe;Object.defineProperty(cs,"__esModule",{value:!0});var Yt=cs.default=void 0,Nn=Vn(me()),qn=e;Yt=cs.default=(0,Nn.default)((0,qn.jsx)("path",{d:"M18.4 10.6C16.55 8.99 14.15 8 11.5 8c-4.65 0-8.58 3.03-9.96 7.22L3.9 16c1.05-3.19 4.05-5.5 7.6-5.5 1.95 0 3.73.72 5.12 1.88L13 16h9V7z"}),"RedoOutlined");var us={},Kn=xe;Object.defineProperty(us,"__esModule",{value:!0});var Ks=us.default=void 0,Jn=Kn(me()),Gn=e;Ks=us.default=(0,Jn.default)((0,Gn.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8m.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"}),"AccessTimeOutlined");var xs={},Yn=xe;Object.defineProperty(xs,"__esModule",{value:!0});var Js=xs.default=void 0,Xn=Yn(me()),Qn=e;Js=xs.default=(0,Xn.default)((0,Qn.jsx)("path",{d:"M6.99 11 3 15l3.99 4v-3H14v-2H6.99zM21 9l-3.99-4v3H10v2h7.01v3z"}),"SwapHorizOutlined");var ms={},Zn=xe;Object.defineProperty(ms,"__esModule",{value:!0});var Gs=ms.default=void 0,ea=Zn(me()),ta=e;Gs=ms.default=(0,ea.default)((0,ta.jsx)("path",{d:"M16 17.01V10h-2v7.01h-3L15 21l4-3.99zM9 3 5 6.99h3V14h2V6.99h3zm7 14.01V10h-2v7.01h-3L15 21l4-3.99zM9 3 5 6.99h3V14h2V6.99h3z"}),"SwapVertOutlined");var hs={},sa=xe;Object.defineProperty(hs,"__esModule",{value:!0});var Ys=hs.default=void 0,na=sa(me()),aa=e;Ys=hs.default=(0,na.default)((0,aa.jsx)("path",{d:"M16.01 11H4v2h12.01v3L20 12l-3.99-4z"}),"ArrowRightAlt");function ia(n){if(typeof window>"u")return n;try{const j=new DOMParser().parseFromString(n,"image/svg+xml"),b=new Set(["svg","g","path","circle","rect","line","polygon","polyline","text","defs","use"]),c=d=>{[...d.children].forEach(i=>{if(b.has(i.tagName))[...i.attributes].forEach(_=>{_.name.startsWith("on")&&i.removeAttribute(_.name)}),c(i);else{const _=document.createTextNode(i.outerHTML);i.replaceWith(_)}})};return c(j.documentElement),j.documentElement.outerHTML}catch{return""}}function la({name:n}){const r=o.useRef(null),[j,b]=o.useState(1);return o.useEffect(()=>{const c=r.current;if(!c)return;const d=c.getBBox().width;b(d>64?64/d:1)},[n]),e.jsx("svg",{width:64,height:64,children:e.jsx("g",{transform:`scale(${j})`,children:e.jsx("text",{ref:r,x:32/j,y:32/j,textAnchor:"middle",dominantBaseline:"central",fontSize:8,children:n})})})}function $t({category:n,borderColor:r}){const j=r?{border:"1px solid",borderColor:r,boxSizing:"border-box"}:{};return n.iconType==="svg"&&n.svg?e.jsx(x,{sx:{width:64,height:64,...j},dangerouslySetInnerHTML:{__html:ia(n.svg)}}):n.iconType==="image"&&n.image?e.jsx(x,{component:"img",src:n.image,sx:{width:64,height:64,objectFit:"none",objectPosition:`-${n.cropX||0}px -${n.cropY||0}px`,...j}}):e.jsx(x,{sx:{width:64,height:64,display:"flex",...j},children:e.jsx(la,{name:n.name})})}function ra(n,r,j){const b=o.useCallback(i=>{let _=0,S=0;i.rallies.forEach(H=>{if(H.timeoutTeam||H.substitutionTeam)return;const C=r.find(E=>E.id===H.teamAPlayDetail),P=r.find(E=>E.id===H.teamBPlayDetail);(C==null?void 0:C.pointType)==="得点"||(P==null?void 0:P.pointType)==="失点"?_+=1:((P==null?void 0:P.pointType)==="得点"||(C==null?void 0:C.pointType)==="失点")&&(S+=1)}),i.my=_,i.opponent=S},[r]),c=o.useCallback(i=>{const _=[...n.rallies,i],S={...n,rallies:_};b(S),j(S)},[n,b,j]),d=o.useCallback(i=>{const _=n.rallies.filter((H,C)=>C!==i),S={...n,rallies:_};b(S),j(S)},[n,b,j]);return{addRally:c,deleteRally:d,calculateScores:b}}function oa({setScore:n,playDetails:r,playCategories:j,teamAMembers:b,teamBMembers:c,teamAName:d,teamBName:i,onChange:_,locked:S=!1,scoreInputSetting:H,themeSetting:C}){var ce,Ue,Wt,Mt,js,gs,bs,vs;const P=Rs(),[E,M]=o.useState(!1),[W,J]=o.useState(!1),[oe,G]=o.useState("teamA"),[ne,w]=o.useState(""),[te,ae]=o.useState(""),[Z,f]=o.useState(""),[F,g]=o.useState(""),[B,D]=o.useState(""),[O,$]=o.useState(""),[U,ue]=o.useState(""),[q,he]=o.useState(""),[Ie,Se]=o.useState(!1),[Je,Me]=o.useState(!1),[fe,Te]=o.useState(!1),[h,y]=o.useState(""),[a,m]=o.useState(""),[u,v]=o.useState(""),[R,L]=o.useState(null),[ie,le]=o.useState(null),[Ce,de]=o.useState(null),[Ct,Ge]=o.useState(!1),Ze="tutorial-settab-add-rally",[St,et]=o.useState(()=>!localStorage.getItem(Ze)),{addRally:Pe,deleteRally:st,calculateScores:Ee}=ra(n,r,_),Tt=ks("md"),xt=ks("sm"),nt=!xt&&H.showRallyIcons,Ye=!Tt&&H.showScoreProgressArea,Ae=j.find(t=>t.id==="init-serve"),Rt=n.rallies.filter(t=>t.timeoutTeam==="teamA").length,zt=n.rallies.filter(t=>t.timeoutTeam==="teamB").length,At=Rt>=2,mt=zt>=2,ht=()=>{var K,we;if(q)return!0;if(H.rallyMemberRequired&&!ne||te&&!F||Z&&!B||!!!(te&&F)&&!!!(Z&&B))return!1;const A=(K=r.find(ve=>ve.id===F))==null?void 0:K.pointUnitType;if(H.rallyMemberRequired&&F&&A==="メンバー"&&!O)return!1;const z=(we=r.find(ve=>ve.id===B))==null?void 0:we.pointUnitType;return!(H.rallyMemberRequired&&B&&z==="メンバー"&&!U)},wt=t=>{if(!t)return"";const s=r.find(z=>z.id===t),A=j.find(z=>z.id===(s==null?void 0:s.playCategoryId));return(A==null?void 0:A.name)||""},$e=t=>{if(!t)return;const s=r.find(A=>A.id===t);return j.find(A=>A.id===(s==null?void 0:s.playCategoryId))},Bt=(t,s)=>{if(!s)return"－";const z=(t==="teamA"?b:c).find(K=>K.id===s);return z?`${z.no}:${z.name}`:"－"},Ht=()=>{if(S)return;le(null);const t=[...n.rallies].reverse().find(A=>!A.timeoutTeam&&!A.substitutionTeam);let s="teamA";if(t){const A=r.find(K=>K.id===t.teamAPlayDetail),z=r.find(K=>K.id===t.teamBPlayDetail);(A==null?void 0:A.pointType)==="得点"||(z==null?void 0:z.pointType)==="失点"?s="teamA":((z==null?void 0:z.pointType)==="得点"||(A==null?void 0:A.pointType)==="失点")&&(s="teamB")}G(s),w(""),ae(""),f(""),g(""),D(""),$(""),ue(""),he(""),M(!0)},Dt=t=>{var A,z;if(S)return;const s=n.rallies[t];le(t),G(s.serverTeam||"teamA"),w(s.server&&(s.serverTeam==="teamA"?b.some(K=>K.id===s.server):c.some(K=>K.id===s.server))?s.server:""),ae(((A=r.find(K=>K.id===s.teamAPlayDetail))==null?void 0:A.playCategoryId)||""),g(s.teamAPlayDetail||""),$(b.some(K=>K.id===s.teamAMember)&&s.teamAMember||""),f(((z=r.find(K=>K.id===s.teamBPlayDetail))==null?void 0:z.playCategoryId)||""),D(s.teamBPlayDetail||""),ue(c.some(K=>K.id===s.teamBMember)&&s.teamBMember||""),he(s.timeoutTeam||""),M(!0)},He=()=>{if(S)return;const t=!localStorage.getItem("tutorial-rally-row"),s=q?{id:crypto.randomUUID(),timeoutTeam:q}:{id:crypto.randomUUID(),serverTeam:oe,server:ne||void 0,teamAPlayDetail:F||void 0,teamAMember:O||void 0,teamBPlayDetail:B||void 0,teamBMember:U||void 0};Pe(s),M(!1),t&&Ge(!0)},We=t=>{if(S||t==="teamA"&&At||t==="teamB"&&mt)return;const s=!localStorage.getItem("tutorial-rally-row");Pe({id:crypto.randomUUID(),timeoutTeam:t}),Se(!1),s&&Ge(!0)},tt=t=>{S||(y(t),m(""),v(""),L(null),Te(!0),Me(!1))},at=t=>{if(S)return;const s=n.rallies[t];s.substitutionTeam&&(y(s.substitutionTeam),m(s.outMember||""),v(s.inMember||""),L(t),Te(!0))},ps=()=>{if(S||!h||!a||!u)return;const t=!localStorage.getItem("tutorial-rally-row"),s=[...n.rallies];R!==null?s[R]={...s[R],substitutionTeam:h,outMember:a,inMember:u}:s.push({id:crypto.randomUUID(),substitutionTeam:h,outMember:a,inMember:u});const A={...n,rallies:s};Ee(A),_(A),t&&Ge(!0),Te(!1),L(null)},It=()=>{Te(!1),L(null)},Ft=()=>{if(S||ie===null)return;const t=[...n.rallies];t[ie]=q?{...t[ie],timeoutTeam:q,serverTeam:void 0,server:void 0,teamAPlayDetail:void 0,teamAMember:void 0,teamBPlayDetail:void 0,teamBMember:void 0}:{...t[ie],timeoutTeam:void 0,serverTeam:oe,server:ne||void 0,teamAPlayDetail:F||void 0,teamAMember:O||void 0,teamBPlayDetail:B||void 0,teamBMember:U||void 0};const s={...n,rallies:t};Ee(s),_(s),M(!1)},Lt=t=>{if(!t.destination||S)return;const s=Array.from(n.rallies),[A]=s.splice(t.source.index,1);s.splice(t.destination.index,0,A);const z={...n,rallies:s};Ee(z),_(z)},ft=t=>{S||(de(t),J(!0))},Et=()=>{Ce!==null&&(st(Ce),de(null),J(!1))},l=()=>{de(null),J(!1)},T=t=>{let s=0,A=0,z=null;n.rallies.slice(0,t+1).forEach(ve=>{if(ve.timeoutTeam||ve.substitutionTeam)return;const Ve=r.find(it=>it.id===ve.teamAPlayDetail),Ne=r.find(it=>it.id===ve.teamBPlayDetail);(Ve==null?void 0:Ve.pointType)==="得点"||(Ne==null?void 0:Ne.pointType)==="失点"?(s+=1,z="A"):(Ne==null?void 0:Ne.pointType)==="得点"||(Ve==null?void 0:Ve.pointType)==="失点"?(A+=1,z="B"):z=null});const K=P.palette.text.primary,we=P.palette.mode==="dark"?"#343A42":"#D3D3D3";return e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{color:z==="A"?K:we},children:String(s).padStart(2,"0")}),e.jsx("span",{style:{color:we},children:" - "}),e.jsx("span",{style:{color:z==="B"?K:we},children:String(A).padStart(2,"0")})]})},I=[],k=[];let ee=0,se=0;n.rallies.forEach(t=>{if(t.timeoutTeam||t.substitutionTeam)return;const s=r.find(z=>z.id===t.teamAPlayDetail),A=r.find(z=>z.id===t.teamBPlayDetail);(s==null?void 0:s.pointType)==="得点"||(A==null?void 0:A.pointType)==="失点"?(ee+=1,k.push("A")):(A==null?void 0:A.pointType)==="得点"||(s==null?void 0:s.pointType)==="失点"?(se+=1,k.push("B")):k.push(null),I.push({a:ee,b:se})});const Y=40,V=[];for(let t=0;t<k.length-1;t++){const s=k[t],A=k[t+1];s&&A&&s!==A&&V.push({from:s,index:t})}const pe=k.map((t,s)=>t&&s>0&&t===k[s-1]),Fe=I.length*Y;return e.jsxs(x,{sx:{position:"relative",display:"flex",flexDirection:"column",height:"100%"},children:[e.jsxs(x,{sx:{display:"flex",gap:2,flex:1,minHeight:0},children:[Ye&&e.jsxs(x,{sx:{flex:"0 0 20%",overflowY:"auto",height:"100%",position:"relative"},children:[I.map((t,s)=>{const A=s===0?{a:0,b:0}:I[s-1],z=t.a!==A.a&&t.a!==0,K=t.b!==A.b&&t.b!==0,we=z&&pe[s],ve=K&&pe[s];return e.jsxs(x,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr 1fr",alignItems:"center",py:.5,height:`${Y}px`,position:"relative",zIndex:1},children:[e.jsx(x,{}),e.jsxs(e.Fragment,{children:[e.jsx(x,{sx:{display:"flex",justifyContent:"center"},children:z?e.jsx(x,{sx:{width:32,height:32,border:"1px solid",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:24,borderColor:we?"red":"currentColor",backgroundColor:we?"#ffebee":"#fff",color:"black"},children:t.a}):null}),e.jsx(x,{}),e.jsx(x,{sx:{display:"flex",justifyContent:"center"},children:K?e.jsx(x,{sx:{width:32,height:32,border:"1px solid",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:24,borderColor:ve?"red":"currentColor",backgroundColor:ve?"#ffebee":"#fff",color:"black"},children:t.b}):null})]}),e.jsx(x,{})]},s)}),e.jsx("svg",{viewBox:`0 0 100 ${Fe}`,style:{position:"absolute",left:0,top:0,width:"100%",height:Fe,zIndex:0},preserveAspectRatio:"none",pointerEvents:"none",children:V.map(t=>{const s=t.index*Y+Y/2,A=(t.index+1)*Y+Y/2,z=t.from==="A"?30:70,K=t.from==="A"?70:30;return e.jsx("line",{x1:z,y1:s,x2:K,y2:A,stroke:"currentColor",strokeWidth:1},t.index)})})]}),e.jsx(x,{sx:{flex:1,overflowY:"auto",height:"100%",maxWidth:1024,width:"100%",mx:"auto",mb:2},children:e.jsx(pt,{open:Ct,onClose:()=>Ge(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:jt,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${P.palette.text.secondary}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${P.palette.text.secondary}`}}}},title:e.jsxs(x,{sx:{p:1,maxWidth:260},children:[e.jsxs(Ke,{variant:"body2",children:["行をタップすることでラリー結果を編集できます",e.jsx("br",{}),"左端の",e.jsx(yt,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),"をドラッグすることでラリー結果の順番を入れ替えることができます",e.jsx("br",{}),"右端の",e.jsx(ut,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),"をタップすることでラリー結果を削除することができます"]}),e.jsx(x,{sx:{textAlign:"right",mt:1},children:e.jsx(gt,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem("tutorial-rally-row","1"),Ge(!1)},children:"了解した"})})]}),children:e.jsx(x,{children:e.jsx(Qt,{onDragEnd:Lt,children:e.jsx(ct,{component:Qe,storageKey:"set-tab",children:e.jsxs(lt,{size:"small",sx:{tableLayout:"fixed","& th, & td":{textAlign:"center",verticalAlign:"middle"}},children:[e.jsx(rt,{children:e.jsxs(ye,{sx:{backgroundColor:t=>t.palette.mode==="dark"?"#343A42":"#f5f5f5"},children:[e.jsx(p,{sx:{width:"6%"}}),e.jsx(p,{sx:{width:"16%"},children:e.jsxs(x,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{children:d||"チームA"}),e.jsx("span",{children:"サーブ"})]})}),e.jsx(p,{sx:{width:"18%"},children:e.jsxs(x,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{children:d||"チームA"}),e.jsx("span",{children:"ラリー結果"})]})}),e.jsx(p,{sx:{width:"20%"},children:"得点"}),e.jsx(p,{sx:{width:"18%"},children:e.jsxs(x,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{children:i||"チームB"}),e.jsx("span",{children:"ラリー結果"})]})}),e.jsx(p,{sx:{width:"16%"},children:e.jsxs(x,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{children:i||"チームB"}),e.jsx("span",{children:"サーブ"})]})}),e.jsx(p,{sx:{width:"6%"}})]})}),e.jsx(kt,{droppableId:"rallies",children:t=>e.jsxs(ot,{ref:t.innerRef,...t.droppableProps,children:[n.rallies.map((s,A)=>e.jsx(_t,{draggableId:s.id,index:A,isDragDisabled:S,children:z=>{var K,we,ve,Ve,Ne,it,ys,Cs,Ss,Ts,As,ws,Bs,Ds,Is,Ms,Ps,$s;return e.jsxs(ye,{ref:z.innerRef,...z.draggableProps,"data-index":A,onClick:()=>{S||(s.substitutionTeam?at(A):s.timeoutTeam||Dt(A))},sx:{cursor:S||s.timeoutTeam?"default":"pointer",backgroundColor:N=>s.timeoutTeam||s.substitutionTeam?N.palette.mode==="dark"?"#343A42":"#f5f5f5":void 0},children:[e.jsx(p,{padding:"checkbox",sx:{width:"6%"},children:e.jsx(x,{onClick:N=>N.stopPropagation(),...z.dragHandleProps,sx:{cursor:S?"default":"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:e.jsx(yt,{fontSize:"small"})})}),s.timeoutTeam?e.jsx(p,{colSpan:5,sx:{width:"88%"},children:e.jsxs(x,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:[s.timeoutTeam==="teamA"?d||"チームA":i||"チームB","タイムアウト"]})}):s.substitutionTeam?e.jsx(p,{colSpan:5,sx:{width:"88%"},children:e.jsxs(x,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100%"},children:[e.jsxs("span",{children:[s.substitutionTeam==="teamA"?d||"チームA":i||"チームB","選手交代"]}),e.jsxs(x,{sx:{display:"flex",alignItems:"center",mt:.5},children:[e.jsx("span",{children:Bt(s.substitutionTeam,s.outMember)}),e.jsx(Ys,{fontSize:"small",sx:{mx:1}}),e.jsx("span",{children:Bt(s.substitutionTeam,s.inMember)})]})]})}):e.jsxs(e.Fragment,{children:[e.jsx(p,{sx:{width:"16%"},children:s.serverTeam==="teamA"?e.jsxs(x,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[nt&&(Ae?e.jsx($t,{category:Ae}):e.jsxs("svg",{width:64,height:64,children:[e.jsx("rect",{width:64,height:64,fill:"none",stroke:"currentColor"}),e.jsx("text",{x:"50%",y:"50%",textAnchor:"middle",dominantBaseline:"central",fontSize:"12",children:"サーブ"})]})),e.jsx("span",{style:{fontSize:12},children:((K=b.find(N=>N.id===s.server))==null?void 0:K.name)||"－"})]}):null}),e.jsx(p,{sx:{width:"18%"},children:e.jsxs(x,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[nt&&s.teamAPlayDetail&&$e(s.teamAPlayDetail)?e.jsx(x,{sx:{mb:"5px"},children:e.jsx($t,{category:$e(s.teamAPlayDetail),borderColor:((we=r.find(N=>N.id===s.teamAPlayDetail))==null?void 0:we.pointType)==="得点"?C.scoreColor:((ve=r.find(N=>N.id===s.teamAPlayDetail))==null?void 0:ve.pointType)==="失点"?C.lossColor:void 0})}):null,s.teamAPlayDetail?e.jsx(ke,{label:wt(s.teamAPlayDetail),size:"small",variant:"outlined",sx:{borderColor:((Ve=$e(s.teamAPlayDetail))==null?void 0:Ve.color)||Be,color:((Ne=$e(s.teamAPlayDetail))==null?void 0:Ne.color)||Be,mb:.5}}):null,s.teamAPlayDetail?e.jsx(ke,{label:((it=r.find(N=>N.id===s.teamAPlayDetail))==null?void 0:it.name)||"",size:"small",sx:{backgroundColor:((ys=r.find(N=>N.id===s.teamAPlayDetail))==null?void 0:ys.pointType)==="得点"?C.scoreColor:C.lossColor,color:"#fff",mb:.5}}):null,e.jsx("span",{style:{fontSize:12},children:s.teamAPlayDetail?((Cs=r.find(N=>N.id===s.teamAPlayDetail))==null?void 0:Cs.pointUnitType)==="メンバー"&&((Ss=b.find(N=>N.id===s.teamAMember))==null?void 0:Ss.name)||"－":""})]})}),e.jsx(p,{sx:{width:"20%",fontSize:"2em"},children:T(A)}),e.jsx(p,{sx:{width:"18%"},children:e.jsxs(x,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[nt&&s.teamBPlayDetail&&$e(s.teamBPlayDetail)?e.jsx(x,{sx:{mb:"5px"},children:e.jsx($t,{category:$e(s.teamBPlayDetail),borderColor:((Ts=r.find(N=>N.id===s.teamBPlayDetail))==null?void 0:Ts.pointType)==="得点"?C.scoreColor:((As=r.find(N=>N.id===s.teamBPlayDetail))==null?void 0:As.pointType)==="失点"?C.lossColor:void 0})}):null,s.teamBPlayDetail?e.jsx(ke,{label:wt(s.teamBPlayDetail),size:"small",variant:"outlined",sx:{borderColor:((ws=$e(s.teamBPlayDetail))==null?void 0:ws.color)||Be,color:((Bs=$e(s.teamBPlayDetail))==null?void 0:Bs.color)||Be,mb:.5}}):null,s.teamBPlayDetail?e.jsx(ke,{label:((Ds=r.find(N=>N.id===s.teamBPlayDetail))==null?void 0:Ds.name)||"",size:"small",sx:{backgroundColor:((Is=r.find(N=>N.id===s.teamBPlayDetail))==null?void 0:Is.pointType)==="得点"?C.scoreColor:C.lossColor,color:"#fff",mb:.5}}):null,e.jsx("span",{style:{fontSize:12},children:s.teamBPlayDetail?((Ms=r.find(N=>N.id===s.teamBPlayDetail))==null?void 0:Ms.pointUnitType)==="メンバー"&&((Ps=c.find(N=>N.id===s.teamBMember))==null?void 0:Ps.name)||"－":""})]})}),e.jsx(p,{sx:{width:"16%"},children:s.serverTeam==="teamB"?e.jsxs(x,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[nt&&(Ae?e.jsx($t,{category:Ae}):e.jsxs("svg",{width:64,height:64,children:[e.jsx("rect",{width:64,height:64,fill:"none",stroke:"currentColor"}),e.jsx("text",{x:"50%",y:"50%",textAnchor:"middle",dominantBaseline:"central",fontSize:"12",children:"サーブ"})]})),e.jsx("span",{style:{fontSize:12},children:(($s=c.find(N=>N.id===s.server))==null?void 0:$s.name)||"－"})]}):null})]}),e.jsx(p,{padding:"checkbox",sx:{width:"6%"},children:e.jsx(x,{onClick:N=>N.stopPropagation(),sx:{width:32,height:32,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Xe,{size:"small",onClick:S?void 0:()=>ft(A),disabled:S,sx:{width:24,height:24},children:e.jsx(ut,{fontSize:"small",color:S?"disabled":"error"})})})})]})}},s.id)),t.placeholder]})})]})})})})})})]}),!S&&e.jsxs(Xs,{children:[e.jsxs(Ut,{ariaLabel:"substitution actions",direction:"left",icon:e.jsx(Js,{}),onOpen:()=>Me(!0),onClose:()=>Me(!1),open:Je,FabProps:{size:"large"},sx:{position:"fixed",right:35,bottom:200},children:[e.jsx(Pt,{icon:e.jsx(e.Fragment,{children:i||"チームB"}),tooltipTitle:"",FabProps:{variant:"extended",size:"small"},onClick:()=>tt("teamB")}),e.jsx(Pt,{icon:e.jsx(e.Fragment,{children:d||"チームA"}),tooltipTitle:"",FabProps:{variant:"extended",size:"small"},onClick:()=>tt("teamA")})]}),e.jsxs(Ut,{ariaLabel:"timeout actions",direction:"left",icon:e.jsx(Ks,{}),onOpen:()=>Se(!0),onClose:()=>Se(!1),open:Ie,FabProps:{size:"large"},sx:{position:"fixed",right:35,bottom:140},children:[e.jsx(Pt,{icon:e.jsx(e.Fragment,{children:i||"チームB"}),tooltipTitle:"",FabProps:{variant:"extended",size:"small",disabled:mt},onClick:()=>We("teamB")}),e.jsx(Pt,{icon:e.jsx(e.Fragment,{children:d||"チームA"}),tooltipTitle:"",FabProps:{variant:"extended",size:"small",disabled:At},onClick:()=>We("teamA")})]}),e.jsx(pt,{open:St,onClose:()=>et(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"left",TransitionComponent:jt,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${P.palette.text.secondary}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${P.palette.text.secondary}`}}}},title:e.jsxs(x,{sx:{p:1,maxWidth:260},children:[e.jsx(Ke,{variant:"body2",children:"ラリー結果、タイムアウト、メンバー交代を追加できます"}),e.jsx(x,{sx:{textAlign:"right",mt:1},children:e.jsx(gt,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem(Ze,"1"),et(!1)},children:"了解した"})})]}),children:e.jsx(Ut,{ariaLabel:"rally actions",direction:"left",icon:e.jsx(Ot,{}),FabProps:{size:"large",onClick:Ht},sx:{position:"fixed",right:35,bottom:80}})})]}),e.jsxs(vt,{open:E,onClose:()=>M(!1),children:[e.jsx(_e,{children:ie===null?"ラリー追加":"ラリー編集"}),e.jsxs(Oe,{sx:{display:"flex",flexDirection:"column",gap:2,mt:2},children:[e.jsxs(qe,{exclusive:!0,value:oe,onChange:(t,s)=>s&&G(s),sx:{width:"100%"},disabled:!!q,children:[e.jsx(Le,{value:"teamA",sx:{flex:1},children:e.jsx(x,{sx:{whiteSpace:"pre-line",textAlign:"center"},children:`${d||"チームA"}
サーブ`})}),e.jsx(Le,{value:"teamB",sx:{flex:1},children:e.jsx(x,{sx:{whiteSpace:"pre-line",textAlign:"center"},children:`${i||"チームB"}
サーブ`})})]}),e.jsxs(je,{fullWidth:!0,required:H.rallyMemberRequired,disabled:!!q,children:[e.jsx(ge,{id:"server",children:"サーバー"}),e.jsx(be,{labelId:"server",value:ne,label:"サーバー",onChange:t=>w(t.target.value),children:(oe==="teamA"?b:c).map(t=>e.jsx(X,{value:t.id,children:t.name},t.id))})]}),xt?e.jsxs(x,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(x,{sx:{flex:1,display:"flex",flexDirection:"column",gap:1},children:[e.jsx(qe,{orientation:"vertical",exclusive:!0,value:te,onChange:(t,s)=>{te===s||s===null?(ae(""),g("")):(ae(s),g(""))},disabled:!!q,children:j.filter(t=>t.visible!==!1).map(t=>e.jsx(Le,{value:t.id,sx:{whiteSpace:"nowrap"},children:t.name},t.id))}),e.jsx(qe,{orientation:"vertical",exclusive:!0,value:F,onChange:(t,s)=>{g(F===s||s===null?"":s)},sx:{mt:1},disabled:!!q,children:r.filter(t=>t.playCategoryId===te&&t.visible!==!1).map(t=>{const s=t.pointType==="得点"?C.scoreColor:C.lossColor;return e.jsx(Le,{value:t.id,sx:{whiteSpace:"nowrap",color:s,"&.Mui-selected":{color:s}},children:t.name},t.id)})}),e.jsxs(je,{fullWidth:!0,sx:{mt:1},required:H.rallyMemberRequired&&((ce=r.find(t=>t.id===F))==null?void 0:ce.pointUnitType)==="メンバー",disabled:!!q,children:[e.jsx(ge,{id:"amem",children:`${d||"チームA"}メンバー`}),e.jsxs(be,{labelId:"amem",value:O,label:`${d||"チームA"}メンバー`,onChange:t=>$(t.target.value),disabled:((Ue=r.find(t=>t.id===F))==null?void 0:Ue.pointUnitType)!=="メンバー",children:[e.jsx(X,{value:"",children:e.jsx("em",{children:"なし"})}),b.map(t=>e.jsx(X,{value:t.id,children:t.name},t.id))]})]})]}),e.jsxs(x,{sx:{flex:1,display:"flex",flexDirection:"column",gap:1},children:[e.jsx(qe,{orientation:"vertical",exclusive:!0,value:Z,onChange:(t,s)=>{Z===s||s===null?(f(""),D("")):(f(s),D(""))},disabled:!!q,children:j.filter(t=>t.visible!==!1).map(t=>e.jsx(Le,{value:t.id,sx:{whiteSpace:"nowrap"},children:t.name},t.id))}),e.jsx(qe,{orientation:"vertical",exclusive:!0,value:B,onChange:(t,s)=>{D(B===s||s===null?"":s)},sx:{mt:1},disabled:!!q,children:r.filter(t=>t.playCategoryId===Z&&t.visible!==!1).map(t=>{const s=t.pointType==="得点"?C.scoreColor:C.lossColor;return e.jsx(Le,{value:t.id,sx:{whiteSpace:"nowrap",color:s,"&.Mui-selected":{color:s}},children:t.name},t.id)})}),e.jsxs(je,{fullWidth:!0,sx:{mt:1},required:H.rallyMemberRequired&&((Wt=r.find(t=>t.id===B))==null?void 0:Wt.pointUnitType)==="メンバー",disabled:!!q,children:[e.jsx(ge,{id:"bmem",children:`${i||"チームB"}メンバー`}),e.jsxs(be,{labelId:"bmem",value:U,label:`${i||"チームB"}メンバー`,onChange:t=>ue(t.target.value),disabled:((Mt=r.find(t=>t.id===B))==null?void 0:Mt.pointUnitType)!=="メンバー",children:[e.jsx(X,{value:"",children:e.jsx("em",{children:"なし"})}),c.map(t=>e.jsx(X,{value:t.id,children:t.name},t.id))]})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(x,{sx:{display:"flex",gap:2},children:[e.jsx(qe,{orientation:"vertical",exclusive:!0,value:te,onChange:(t,s)=>{te===s||s===null?(ae(""),g("")):(ae(s),g(""))},disabled:!!q,sx:{flex:"1 1 25%"},children:j.filter(t=>t.visible!==!1).map(t=>e.jsx(Le,{value:t.id,sx:{whiteSpace:"nowrap"},children:t.name},t.id))}),e.jsx(qe,{orientation:"vertical",exclusive:!0,value:F,onChange:(t,s)=>{g(F===s||s===null?"":s)},disabled:!!q,sx:{flex:"1 1 25%"},children:r.filter(t=>t.playCategoryId===te&&t.visible!==!1).map(t=>{const s=t.pointType==="得点"?C.scoreColor:C.lossColor;return e.jsx(Le,{value:t.id,sx:{whiteSpace:"nowrap",color:s,"&.Mui-selected":{color:s}},children:t.name},t.id)})}),e.jsx(qe,{orientation:"vertical",exclusive:!0,value:Z,onChange:(t,s)=>{Z===s||s===null?(f(""),D("")):(f(s),D(""))},disabled:!!q,sx:{flex:"1 1 25%"},children:j.filter(t=>t.visible!==!1).map(t=>e.jsx(Le,{value:t.id,sx:{whiteSpace:"nowrap"},children:t.name},t.id))}),e.jsx(qe,{orientation:"vertical",exclusive:!0,value:B,onChange:(t,s)=>{D(B===s||s===null?"":s)},disabled:!!q,sx:{flex:"1 1 25%"},children:r.filter(t=>t.playCategoryId===Z&&t.visible!==!1).map(t=>{const s=t.pointType==="得点"?C.scoreColor:C.lossColor;return e.jsx(Le,{value:t.id,sx:{whiteSpace:"nowrap",color:s,"&.Mui-selected":{color:s}},children:t.name},t.id)})})]}),e.jsxs(x,{sx:{display:"flex",gap:2,mt:1},children:[e.jsxs(je,{fullWidth:!0,required:H.rallyMemberRequired&&((js=r.find(t=>t.id===F))==null?void 0:js.pointUnitType)==="メンバー",disabled:!!q,sx:{flex:1},children:[e.jsx(ge,{id:"amem",children:`${d||"チームA"}メンバー`}),e.jsxs(be,{labelId:"amem",value:O,label:`${d||"チームA"}メンバー`,onChange:t=>$(t.target.value),disabled:((gs=r.find(t=>t.id===F))==null?void 0:gs.pointUnitType)!=="メンバー",children:[e.jsx(X,{value:"",children:e.jsx("em",{children:"なし"})}),b.map(t=>e.jsx(X,{value:t.id,children:t.name},t.id))]})]}),e.jsxs(je,{fullWidth:!0,required:H.rallyMemberRequired&&((bs=r.find(t=>t.id===B))==null?void 0:bs.pointUnitType)==="メンバー",disabled:!!q,sx:{flex:1},children:[e.jsx(ge,{id:"bmem",children:`${i||"チームB"}メンバー`}),e.jsxs(be,{labelId:"bmem",value:U,label:`${i||"チームB"}メンバー`,onChange:t=>ue(t.target.value),disabled:((vs=r.find(t=>t.id===B))==null?void 0:vs.pointUnitType)!=="メンバー",children:[e.jsx(X,{value:"",children:e.jsx("em",{children:"なし"})}),c.map(t=>e.jsx(X,{value:t.id,children:t.name},t.id))]})]})]})]})]}),e.jsxs(Re,{children:[e.jsx(Q,{onClick:()=>M(!1),color:"inherit",startIcon:e.jsx(ze,{}),children:"キャンセル"}),ie===null?e.jsx(Q,{onClick:He,disabled:!ht(),startIcon:e.jsx(De,{}),children:"OK"}):e.jsx(Q,{onClick:Ft,disabled:!ht(),startIcon:e.jsx(De,{}),children:"OK"})]})]}),e.jsxs(vt,{open:fe,onClose:It,children:[e.jsx(_e,{children:"選手交代"}),e.jsx(Oe,{children:e.jsxs(x,{component:"form",sx:{mt:2},children:[e.jsxs(je,{fullWidth:!0,sx:{mb:2},children:[e.jsx(ge,{id:"out-member",children:"OUT"}),e.jsx(be,{labelId:"out-member",value:a,label:"OUT",onChange:t=>m(t.target.value),children:(h==="teamA"?b:c).map(t=>e.jsx(X,{value:t.id,children:`${t.no}:${t.name}`},t.id))})]}),e.jsx(x,{sx:{display:"flex",justifyContent:"center",mb:2},children:e.jsx(Gs,{sx:{width:32,height:32}})}),e.jsxs(je,{fullWidth:!0,children:[e.jsx(ge,{id:"in-member",children:"IN"}),e.jsx(be,{labelId:"in-member",value:u,label:"IN",onChange:t=>v(t.target.value),children:(h==="teamA"?b:c).map(t=>e.jsx(X,{value:t.id,children:`${t.no}:${t.name}`},t.id))})]})]})}),e.jsxs(Re,{children:[e.jsx(Q,{onClick:It,color:"inherit",startIcon:e.jsx(ze,{}),children:"キャンセル"}),e.jsx(Q,{onClick:ps,disabled:!a||!u,startIcon:e.jsx(De,{}),children:"OK"})]})]}),e.jsxs(dt,{open:W,onClose:l,children:[e.jsx(_e,{children:"削除確認"}),e.jsx(Oe,{sx:{mt:2},children:"このラリーを削除しますか？"}),e.jsxs(Re,{children:[e.jsx(Q,{onClick:l,color:"inherit",startIcon:e.jsx(ze,{}),children:"キャンセル"}),e.jsx(Q,{onClick:Et,color:"error",startIcon:e.jsx(De,{}),children:"OK"})]})]})]})}function da(n,r){const[j,b]=o.useState(null),c=o.useRef(n);c.current=n;const d=o.useRef(),i=o.useCallback(C=>{if(j===null)return;const P=document.elementFromPoint(C.clientX,C.clientY),E=P==null?void 0:P.closest("[data-index]");if(!E)return;const M=Number(E.dataset.index);if(isNaN(M)||M===j)return;const W=[...c.current],[J]=W.splice(j,1);W.splice(M,0,J),b(M),r(W)},[j,r]),_=o.useCallback(()=>{window.removeEventListener("pointermove",i),d.current&&(window.removeEventListener("pointerup",d.current),window.removeEventListener("pointercancel",d.current))},[i]),S=o.useCallback(C=>{var P,E;C&&"currentTarget"in C&&((E=(P=C.currentTarget).releasePointerCapture)==null||E.call(P,C.pointerId)),_(),b(null)},[_]);function H(C,P){var E,M;P.preventDefault(),(M=(E=P.currentTarget).setPointerCapture)==null||M.call(E,P.pointerId),b(C),d.current=S,window.addEventListener("pointermove",i),window.addEventListener("pointerup",d.current),window.addEventListener("pointercancel",d.current)}return o.useEffect(()=>()=>_(),[_]),{start:H,move:i,end:S,dragging:j!==null}}const ca=()=>typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():Math.random().toString(36).slice(2)+Date.now().toString(36);function ua({statsSettings:n,onChange:r,playCategories:j,playDetails:b,rallyCategoryTags:c,rallyDetailTags:d,disabled:i}){const{start:_,move:S,end:H}=da(n,r),C=a=>{var m;return((m=j.find(u=>u.id===a))==null?void 0:m.name)||""},P=a=>{var m;return((m=b.find(u=>u.id===a))==null?void 0:m.name)||""},[E,M]=o.useState(!1),[W,J]=o.useState(null),[oe,G]=o.useState(""),[ne,w]=o.useState(""),[te,ae]=o.useState([]),[Z,f]=o.useState([]),[F,g]=o.useState(""),[B,D]=o.useState(""),[O,$]=o.useState("合算"),[U,ue]=o.useState(null),[q,he]=o.useState(!1),Ie=()=>{i||(J(-1),G(""),w(""),ae([]),f([]),g(""),D(""),$("合算"),M(!0))},Se=a=>{if(i)return;const m=n[a];J(a),G(m.playCategoryId||""),w(m.playDetailId||""),ae(m.playCategoryTags||[]),f(m.playDetailTags||[]),g(m.pointType||""),D(m.pointUnitType||""),$(m.aggregateType||"合算"),M(!0)},Je=()=>{const a=oe!=="",m=ne!=="",u=te.length>0,v=Z.length>0,R=F!=="",L=B!=="";return a&&!m&&!u&&!v&&!R&&!L||a&&m&&!u&&!v&&!R&&!L||a&&!m&&!u&&!v&&R&&!L||a&&!m&&!u&&!v&&!R&&L||a&&!m&&!u&&!v&&R&&L||!a&&!m&&!u&&!v&&R&&!L||!a&&!m&&!u&&!v&&R&&L||!a&&!m&&!u&&!v&&!R&&L||u&&!a&&!m&&!v&&!R&&!L||u&&v&&!a&&!m&&!R&&!L||u&&v&&!a&&!m&&R&&!L||u&&v&&!a&&!m&&!R&&L||u&&v&&!a&&!m&&R&&L||u&&!a&&!m&&R&&!L||u&&!a&&!m&&!R&&L||u&&!a&&!m&&R&&L||v&&!a&&!m&&!u&&!R&&!L||v&&!a&&!m&&!u&&R&&!L||v&&!a&&!m&&!u&&!R&&L||v&&!a&&!m&&!u&&R&&L},Me=()=>{const a={id:W===-1?ca():n[W].id,playCategoryId:oe||void 0,playDetailId:ne||void 0,playCategoryTags:oe===""&&te.length>0?te:void 0,playDetailTags:ne===""&&Z.length>0?Z:void 0,pointType:ne?void 0:F||void 0,pointUnitType:ne?void 0:B||void 0,aggregateType:O};W===-1?r([...n,a]):W!==null&&r(n.map((m,u)=>u===W?a:m)),M(!1)},fe=()=>{M(!1)},Te=a=>{i||(ue(a),he(!0))},h=()=>{U!==null&&r(n.filter((a,m)=>m!==U)),he(!1)},y=()=>{he(!1)};return e.jsxs(x,{children:[e.jsxs(x,{sx:{maxWidth:1024,mx:"auto",display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(x,{sx:{fontWeight:"bold"},children:"スタッツ設定"}),e.jsx(Q,{onClick:Ie,variant:"contained",size:"small",startIcon:e.jsx(Ot,{}),disabled:i,children:"追加"})]}),e.jsx(ct,{component:Qe,storageKey:"match-stats-grid",sx:{maxWidth:1024,mx:"auto"},children:e.jsxs(lt,{size:"small",children:[e.jsx(rt,{children:e.jsxs(ye,{sx:{backgroundColor:a=>a.palette.mode==="dark"?"#343A42":"#f5f5f5",height:50},children:[e.jsx(p,{}),e.jsx(p,{children:"プレー区分"}),e.jsx(p,{children:"プレー詳細"}),e.jsx(p,{children:"得点区分"}),e.jsx(p,{children:"得失点単位区分"}),e.jsx(p,{children:"集計方法"}),e.jsx(p,{})]})}),e.jsx(ot,{children:n.map((a,m)=>e.jsxs(ye,{"data-index":m,onClick:()=>Se(m),sx:{cursor:i?"default":"pointer",height:50},children:[e.jsx(p,{padding:"checkbox",children:e.jsx(x,{onClick:u=>u.stopPropagation(),onPointerDown:u=>{i||(u.stopPropagation(),_(m,u))},onPointerMove:u=>S(u),onPointerUp:u=>H(u),onPointerCancel:u=>H(u),sx:{cursor:i?"default":"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:e.jsx(yt,{})})}),e.jsx(p,{children:a.playCategoryId?C(a.playCategoryId):a.playCategoryTags&&a.playCategoryTags.length>0?e.jsx(x,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:a.playCategoryTags.map(u=>{const v=c.find(R=>R.id===u);return e.jsx(ke,{label:(v==null?void 0:v.name)||u,size:"small",sx:{backgroundColor:(v==null?void 0:v.color)||Be,color:"#fff"}},u)})}):""}),e.jsx(p,{children:a.playDetailId?P(a.playDetailId):a.playDetailTags&&a.playDetailTags.length>0?e.jsx(x,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:a.playDetailTags.map(u=>{const v=d.find(R=>R.id===u);return e.jsx(ke,{label:(v==null?void 0:v.name)||u,size:"small",sx:{backgroundColor:(v==null?void 0:v.color)||Be,color:"#fff"}},u)})}):""}),e.jsx(p,{children:a.pointType||""}),e.jsx(p,{children:a.pointUnitType||""}),e.jsx(p,{children:a.aggregateType||"合算"}),e.jsx(p,{padding:"checkbox",children:e.jsx(x,{onClick:u=>u.stopPropagation(),sx:{width:32,height:32,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Xe,{size:"small",onClick:()=>Te(m),sx:{width:24,height:24},disabled:i,children:e.jsx(ut,{fontSize:"small",color:i?"disabled":"error"})})})})]},a.id))})]})}),e.jsxs(vt,{open:E,onClose:fe,children:[e.jsxs(_e,{children:["スタッツ設定",W===-1?"追加":"編集"]}),e.jsx(Oe,{sx:{display:"flex",flexDirection:"column",gap:2},children:e.jsxs(e.Fragment,{children:[e.jsxs(je,{fullWidth:!0,sx:{mt:3},children:[e.jsx(ge,{id:"stat-category-label",children:"プレー区分"}),e.jsxs(be,{labelId:"stat-category-label",value:oe,label:"プレー区分",onChange:a=>{G(a.target.value),w(""),ae([]),f([])},disabled:te.length>0||Z.length>0,children:[e.jsx(X,{value:"",children:"なし"}),j.map(a=>e.jsx(X,{value:a.id,children:a.name},a.id))]})]}),e.jsxs(je,{fullWidth:!0,sx:{mt:1},children:[e.jsx(ge,{id:"stat-detail-label",children:"プレー詳細"}),e.jsxs(be,{labelId:"stat-detail-label",value:ne,label:"プレー詳細",onChange:a=>{w(a.target.value),g(""),D(""),ae([]),f([])},disabled:F!==""||B!==""||te.length>0||Z.length>0,children:[e.jsx(X,{value:"",children:"なし"}),b.filter(a=>a.playCategoryId===oe).map(a=>e.jsx(X,{value:a.id,children:a.name},a.id))]})]}),e.jsx(Kt,{multiple:!0,options:c,getOptionLabel:a=>a.name,value:c.filter(a=>te.includes(a.id)),onChange:(a,m)=>{ae(m.map(u=>u.id)),m.length>0&&(G(""),w(""))},disabled:oe!==""||ne!=="",renderTags:(a,m)=>a.map((u,v)=>e.jsx(ke,{...m({index:v}),label:u.name,size:"small",sx:{backgroundColor:u.color||Be,color:"#fff"}})),renderInput:a=>e.jsx(re,{...a,label:"プレー区分タグ",margin:"dense"}),fullWidth:!0}),e.jsx(Kt,{multiple:!0,options:d,getOptionLabel:a=>a.name,value:d.filter(a=>Z.includes(a.id)),onChange:(a,m)=>{f(m.map(u=>u.id)),m.length>0&&(G(""),w(""))},disabled:oe!==""||ne!=="",renderTags:(a,m)=>a.map((u,v)=>e.jsx(ke,{...m({index:v}),label:u.name,size:"small",sx:{backgroundColor:u.color||Be,color:"#fff"}})),renderInput:a=>e.jsx(re,{...a,label:"プレー詳細タグ",margin:"dense"}),fullWidth:!0}),e.jsxs(x,{sx:{display:"flex",gap:2},children:[e.jsxs(je,{fullWidth:!0,children:[e.jsx(ge,{id:"stat-point-label",children:"得点区分"}),e.jsxs(be,{labelId:"stat-point-label",value:F,label:"得点区分",onChange:a=>{g(a.target.value),a.target.value!==""&&w("")},disabled:ne!=="",children:[e.jsx(X,{value:"",children:"なし"}),e.jsx(X,{value:"得点",children:"得点"}),e.jsx(X,{value:"失点",children:"失点"})]})]}),e.jsxs(je,{fullWidth:!0,children:[e.jsx(ge,{id:"stat-unit-label",children:"得失点単位区分"}),e.jsxs(be,{labelId:"stat-unit-label",value:B,label:"得失点単位区分",onChange:a=>{D(a.target.value),a.target.value!==""&&w("")},disabled:ne!=="",children:[e.jsx(X,{value:"",children:"なし"}),e.jsx(X,{value:"メンバー",children:"メンバー"}),e.jsx(X,{value:"チーム",children:"チーム"})]})]})]}),e.jsxs(je,{fullWidth:!0,children:[e.jsx(ge,{id:"stat-aggregate-label",children:"集計方法"}),e.jsxs(be,{labelId:"stat-aggregate-label",value:O,label:"集計方法",onChange:a=>$(a.target.value),children:[e.jsx(X,{value:"合算",children:"合算"}),e.jsx(X,{value:"セット平均",children:"セット平均"})]})]})]})}),e.jsxs(Re,{children:[e.jsx(Q,{onClick:fe,color:"inherit",startIcon:e.jsx(ze,{}),children:"キャンセル"}),e.jsx(Q,{onClick:Me,disabled:!Je(),startIcon:e.jsx(De,{}),children:"OK"})]})]}),e.jsxs(dt,{open:q,onClose:y,children:[e.jsx(_e,{children:"削除確認"}),e.jsx(Oe,{sx:{mt:2},children:"このスタッツ設定を削除しますか？"}),e.jsxs(Re,{children:[e.jsx(Q,{onClick:y,color:"inherit",startIcon:e.jsx(ze,{}),children:"キャンセル"}),e.jsx(Q,{onClick:h,color:"error",startIcon:e.jsx(De,{}),children:"OK"})]})]})]})}function _s(n,r,j){var c,d;if(!n)return!1;const b=r.get(n.playCategoryId);return!(j.playDetailId&&n.id!==j.playDetailId||j.playCategoryId&&n.playCategoryId!==j.playCategoryId||j.playCategoryTags&&j.playCategoryTags.length>0&&!((c=b==null?void 0:b.tags)!=null&&c.some(i=>j.playCategoryTags.includes(i)))||j.playDetailTags&&j.playDetailTags.length>0&&!((d=n.tags)!=null&&d.some(i=>j.playDetailTags.includes(i)))||j.pointType&&n.pointType!==j.pointType||j.pointUnitType&&n.pointUnitType!==j.pointUnitType)}function Os(n,r,j,b){const c=b.map(()=>({teamA:0,teamB:0}));return n.forEach(d=>{d.rallies.forEach(i=>{b.forEach((_,S)=>{const H=i.teamAPlayDetail?r.get(i.teamAPlayDetail):void 0;_s(H,j,_)&&(c[S].teamA+=1);const C=i.teamBPlayDetail?r.get(i.teamBPlayDetail):void 0;_s(C,j,_)&&(c[S].teamB+=1)})})}),c}function xa(n,r){const j=[];let b=0,c=0,d=0,i=0;return n.forEach(S=>{let H=0,C=0,P=0,E=0;S.rallies.forEach(M=>{if(M.timeoutTeam||M.substitutionTeam||!M.serverTeam)return;const W=M.teamAPlayDetail?r.get(M.teamAPlayDetail):void 0,J=M.teamBPlayDetail?r.get(M.teamBPlayDetail):void 0;M.serverTeam==="teamA"?(C+=1,(W&&W.pointType==="得点"||J&&J.pointType==="失点")&&(H+=1)):(E+=1,(J&&J.pointType==="得点"||W&&W.pointType==="失点")&&(P+=1))}),b+=H,c+=C,d+=P,i+=E,j.push({teamA:C?`${Math.round(H/C*100)}%`:"-",teamB:E?`${Math.round(P/E*100)}%`:"-"})}),{overall:{teamA:c?`${Math.round(b/c*100)}%`:"-",teamB:i?`${Math.round(d/i*100)}%`:"-"},perSet:j}}function ma(n,r){const j=[];let b=0,c=0,d=0,i=0;return n.forEach(S=>{let H=0,C=0,P=0,E=0;S.rallies.forEach(M=>{if(M.timeoutTeam||M.substitutionTeam||!M.serverTeam)return;const W=M.teamAPlayDetail?r.get(M.teamAPlayDetail):void 0,J=M.teamBPlayDetail?r.get(M.teamBPlayDetail):void 0;M.serverTeam==="teamB"?(C+=1,(W&&W.pointType==="得点"||J&&J.pointType==="失点")&&(H+=1)):(E+=1,(J&&J.pointType==="得点"||W&&W.pointType==="失点")&&(P+=1))}),b+=H,c+=C,d+=P,i+=E,j.push({teamA:C?`${Math.round(H/C*100)}%`:"-",teamB:E?`${Math.round(P/E*100)}%`:"-"})}),{overall:{teamA:c?`${Math.round(b/c*100)}%`:"-",teamB:i?`${Math.round(d/i*100)}%`:"-"},perSet:j}}function ha({sets:n,playDetails:r,playCategories:j,statsSettings:b,matchStatsSettings:c,onMatchStatsSettingsChange:d,rallyCategoryTags:i,rallyDetailTags:_,teamAName:S,teamBName:H,locked:C}){const P=new Map(r.map(g=>[g.id,g])),E=new Map(j.map(g=>[g.id,g])),M=g=>{var B;return((B=j.find(D=>D.id===g))==null?void 0:B.name)||""},W=g=>{var B;return((B=r.find(D=>D.id===g))==null?void 0:B.name)||""},J=[...b,...c],oe=Os(n,P,E,J),G=n.map(g=>Os([g],P,E,J)),ne=oe.map((g,B)=>{if(J[B].aggregateType==="セット平均"){const O=n.length||1;return{teamA:(g.teamA/O).toFixed(1),teamB:(g.teamB/O).toFixed(1)}}return g}),w=G.map(g=>J.reduce((B,D,O)=>(D.aggregateType!=="セット平均"&&B.push(g[O]),B),[])),te=J.filter(g=>g.aggregateType!=="セット平均"),ae=xa(n,P),Z=ma(n,P),f=g=>{const B=[];g.playCategoryId?B.push(e.jsx("span",{children:M(g.playCategoryId)},"cat")):g.playCategoryTags&&g.playCategoryTags.length>0&&B.push(e.jsx(x,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center",mt:.5},children:g.playCategoryTags.map(O=>{const $=i.find(U=>U.id===O);return e.jsx(ke,{label:($==null?void 0:$.name)||O,size:"small",sx:{mr:.5,mb:.5,backgroundColor:($==null?void 0:$.color)||Be,color:"#fff"}},O)})},"catTags")),g.playDetailId?B.push(e.jsx("span",{children:W(g.playDetailId)},"detail")):g.playDetailTags&&g.playDetailTags.length>0&&B.push(e.jsx(x,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center",mt:.5},children:g.playDetailTags.map(O=>{const $=_.find(U=>U.id===O);return e.jsx(ke,{label:($==null?void 0:$.name)||O,size:"small",sx:{mr:.5,mb:.5,backgroundColor:($==null?void 0:$.color)||Be,color:"#fff"}},O)})},"detailTags"));const D=[];return g.pointType&&D.push(g.pointType),g.pointUnitType&&D.push(g.pointUnitType),D.length>0&&B.push(e.jsx("span",{children:D.join(",")},"point")),B.push(e.jsxs("span",{children:["(",g.aggregateType||"合算",")"]},"agg")),e.jsx(x,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:B.map((O,$)=>e.jsx(x,{sx:{display:"flex",justifyContent:"center"},children:O},$))})},F=(g,B,D,O,$)=>e.jsx(ct,{component:Qe,storageKey:$,sx:{mb:2},children:e.jsxs(lt,{size:"small",sx:{"& th, & td":{textAlign:"center",verticalAlign:"middle"}},children:[e.jsx(rt,{children:e.jsxs(ye,{sx:{backgroundColor:U=>U.palette.mode==="dark"?"#343A42":"#f5f5f5",height:50},children:[e.jsx(p,{children:S||"チームA"}),e.jsx(p,{children:"項目"}),e.jsx(p,{children:H||"チームB"})]})}),e.jsxs(ot,{children:[e.jsxs(ye,{sx:{height:50},children:[e.jsx(p,{children:B.teamA}),e.jsx(p,{children:"ブレイク率"}),e.jsx(p,{children:B.teamB})]},"break-rate"),e.jsxs(ye,{sx:{height:50},children:[e.jsx(p,{children:D.teamA}),e.jsx(p,{children:"サイドアウト率"}),e.jsx(p,{children:D.teamB})]},"sideout-rate"),O.map((U,ue)=>e.jsxs(ye,{sx:{height:50},children:[e.jsx(p,{children:g[ue].teamA}),e.jsx(p,{children:f(U)}),e.jsx(p,{children:g[ue].teamB})]},U.id))]})]})});return e.jsxs(x,{sx:{display:"grid",gap:2,gridTemplateColumns:{xs:"1fr",md:"repeat(2, 1fr)"},maxWidth:1024,width:"100%",mx:"auto"},children:[e.jsxs(x,{children:[e.jsx(Ke,{variant:"h6",sx:{mb:1},children:"試合全体のスタッツ"}),F(ne,ae.overall,Z.overall,J,"stats-overall")]}),n.map((g,B)=>e.jsxs(x,{children:[e.jsx(Ke,{variant:"h6",sx:{mb:1},children:`${B+1}セット目(${g.my}-${g.opponent})のスタッツ`}),F(w[B],ae.perSet[B],Z.perSet[B],te,`stats-set-${B}`)]},g.id)),e.jsxs(x,{sx:{gridColumn:"1 / -1"},children:[e.jsx(ua,{statsSettings:c,onChange:d,playCategories:j,playDetails:r,rallyCategoryTags:i,rallyDetailTags:_,disabled:C}),e.jsxs(zs,{severity:"info",sx:{mt:1},children:["本設定は試合内のみでの設定となります",e.jsx("br",{}),"各試合共通でのスタッツ項目の設定は設定＞スタッツメニューから設定してください"]})]})]})}var fs={},fa=xe;Object.defineProperty(fs,"__esModule",{value:!0});var Xt=fs.default=void 0,pa=fa(me()),ja=e;Xt=fs.default=(0,pa.default)((0,ja.jsx)("path",{d:"M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m-9-2V7H4v3H1v2h3v3h2v-3h3v-2zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"PersonAdd");const ga=()=>typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():Math.random().toString(36).slice(2)+Date.now().toString(36);function ba({match:n,setMatch:r,teamAName:j,teamBName:b,teamMembers:c,onAddMember:d,locked:i}){const[_,S]=o.useState(!1),[H,C]=o.useState(!1),[P,E]=o.useState(""),[M,W]=o.useState(""),[J,oe]=o.useState([]),[G,ne]=o.useState("teamA"),[w,te]=o.useState([]),[ae,Z]=o.useState(!1),[f,F]=o.useState(null),[g,B]=o.useState(null),D=h=>{if(!h.destination||h.source.droppableId!==h.destination.droppableId||i)return;const y=h.source.droppableId==="teamA"?"teamAMembers":"teamBMembers",a=Array.from(n[y]),[m]=a.splice(h.source.index,1);a.splice(h.destination.index,0,m),r(u=>({...u,[y]:a}))},O=o.useMemo(()=>{const h=G==="teamA"?n.teamA:n.teamB,y=c[h]||[],a=G==="teamA"?n.teamAMembers:n.teamBMembers;return y.filter(m=>m.visible!==!1&&!a.some(u=>u.id===m.id))},[G,n,c]),$=h=>{ne(h),te([]),S(!0)},U=h=>{te(y=>y.some(m=>m.id===h.id)?y.filter(m=>m.id!==h.id):[...y,h])},ue=()=>{r(G==="teamA"?h=>({...h,teamAMembers:[...h.teamAMembers,...w.map(y=>({...y,statuses:Array(h.sets.length).fill("")}))]}):h=>({...h,teamBMembers:[...h.teamBMembers,...w.map(y=>({...y,statuses:Array(h.sets.length).fill("")}))]})),S(!1)},q=()=>{S(!1)},he=(h,y)=>{i||(F(h),B(y),Z(!0))},Ie=()=>{f&&g!==null&&r(f==="teamA"?h=>({...h,teamAMembers:h.teamAMembers.filter((y,a)=>a!==g)}):h=>({...h,teamBMembers:h.teamBMembers.filter((y,a)=>a!==g)})),Z(!1)},Se=()=>{Z(!1)},Je=()=>{i||(E(""),W(""),oe([]),C(!0))},Me=()=>{const h=G==="teamA"?n.teamA:n.teamB;h&&d(h,{id:ga(),no:Number(P),name:M,positions:J}),C(!1)},fe=()=>{C(!1)},Te=(h,y,a)=>{i||r(m=>{const u=h==="teamA"?"teamAMembers":"teamBMembers",v=[...m[u]],R={...v[y]},L=[...R.statuses||Array(m.sets.length).fill("")],ie=L[a]||"";let le="";return ie===""?le="starter":ie==="starter"?le="libero":le="",L[a]=le,R.statuses=L,v[y]=R,{...m,[u]:v}})};return e.jsxs(Qt,{onDragEnd:D,children:[e.jsxs(bt,{container:!0,spacing:2,children:[e.jsxs(bt,{item:!0,xs:12,children:[e.jsxs(x,{sx:{maxWidth:1024,mx:"auto"},children:[e.jsx(Ke,{variant:"h6",sx:{mb:1},children:j}),e.jsx(Q,{variant:"contained",size:"small",sx:{mb:1},onClick:()=>$("teamA"),disabled:i,startIcon:e.jsx(Xt,{}),children:"メンバー登録"})]}),e.jsx(ct,{component:Qe,storageKey:"members-teamA",sx:{maxWidth:1024,mx:"auto"},children:e.jsxs(lt,{size:"small",children:[e.jsx(rt,{children:e.jsxs(ye,{sx:{backgroundColor:h=>h.palette.mode==="dark"?"#343A42":"#f5f5f5",height:50},children:[e.jsx(p,{}),e.jsx(p,{children:"番号"}),e.jsx(p,{children:"名前"}),e.jsx(p,{children:"ポジション"}),n.sets.map((h,y)=>e.jsx(p,{align:"center",children:y+1},y)),e.jsx(p,{})]})}),e.jsx(kt,{droppableId:"teamA",children:h=>e.jsxs(ot,{ref:h.innerRef,...h.droppableProps,children:[n.teamAMembers.map((y,a)=>e.jsx(_t,{draggableId:`teamA-${y.id}`,index:a,isDragDisabled:i,children:m=>e.jsxs(ye,{ref:m.innerRef,...m.draggableProps,"data-index":a,sx:{cursor:i?"default":"pointer",height:50},children:[e.jsx(p,{padding:"checkbox",children:e.jsx(x,{onClick:u=>u.stopPropagation(),...m.dragHandleProps,sx:{cursor:i?"default":"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:e.jsx(yt,{})})}),e.jsx(p,{children:y.no}),e.jsx(p,{children:y.name}),e.jsx(p,{children:(y.positions||[]).join(", ")}),n.sets.map((u,v)=>{var R,L,ie,le,Ce,de;return e.jsx(p,{padding:"checkbox",align:"center",children:e.jsx(Q,{size:"small",variant:(R=y.statuses)!=null&&R[v]?"contained":"outlined",color:((L=y.statuses)==null?void 0:L[v])==="starter"?"primary":void 0,sx:{minWidth:32,width:32,p:0,...((ie=y.statuses)==null?void 0:ie[v])==="starter"?{backgroundColor:"primary.main",color:"#fff","&:hover":{backgroundColor:"primary.main"}}:((le=y.statuses)==null?void 0:le[v])==="libero"?{backgroundColor:"#FF9933",color:"#fff","&:hover":{backgroundColor:"#FF9933"},"&.Mui-focusVisible":{outline:"2px solid #FF9933"}}:{}},onClick:()=>Te("teamA",a,v),disabled:i,children:((Ce=y.statuses)==null?void 0:Ce[v])==="starter"?"出":((de=y.statuses)==null?void 0:de[v])==="libero"?"リ":"不"})},v)}),e.jsx(p,{padding:"checkbox",children:e.jsx(x,{onClick:u=>u.stopPropagation(),sx:{width:32,height:32,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Xe,{size:"small",onClick:i?void 0:()=>he("teamA",a),disabled:i,sx:{width:24,height:24},children:e.jsx(ut,{fontSize:"small",color:i?"disabled":"error"})})})})]})},y.id)),h.placeholder]})})]})})]}),e.jsxs(bt,{item:!0,xs:12,children:[e.jsxs(x,{sx:{maxWidth:1024,mx:"auto"},children:[e.jsx(Ke,{variant:"h6",sx:{mb:1},children:b}),e.jsx(Q,{variant:"contained",size:"small",sx:{mb:1},onClick:()=>$("teamB"),disabled:i,startIcon:e.jsx(Xt,{}),children:"メンバー登録"})]}),e.jsx(ct,{component:Qe,storageKey:"members-teamB",sx:{maxWidth:1024,mx:"auto"},children:e.jsxs(lt,{size:"small",children:[e.jsx(rt,{children:e.jsxs(ye,{sx:{backgroundColor:h=>h.palette.mode==="dark"?"#343A42":"#f5f5f5",height:50},children:[e.jsx(p,{}),e.jsx(p,{children:"番号"}),e.jsx(p,{children:"名前"}),e.jsx(p,{children:"ポジション"}),n.sets.map((h,y)=>e.jsx(p,{align:"center",children:y+1},y)),e.jsx(p,{})]})}),e.jsx(kt,{droppableId:"teamB",children:h=>e.jsxs(ot,{ref:h.innerRef,...h.droppableProps,children:[n.teamBMembers.map((y,a)=>e.jsx(_t,{draggableId:`teamB-${y.id}`,index:a,isDragDisabled:i,children:m=>e.jsxs(ye,{ref:m.innerRef,...m.draggableProps,"data-index":a,sx:{cursor:i?"default":"pointer",height:50},children:[e.jsx(p,{padding:"checkbox",children:e.jsx(x,{onClick:u=>u.stopPropagation(),...m.dragHandleProps,sx:{cursor:i?"default":"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:e.jsx(yt,{})})}),e.jsx(p,{children:y.no}),e.jsx(p,{children:y.name}),e.jsx(p,{children:(y.positions||[]).join(", ")}),n.sets.map((u,v)=>{var R,L,ie,le,Ce,de;return e.jsx(p,{padding:"checkbox",align:"center",children:e.jsx(Q,{size:"small",variant:(R=y.statuses)!=null&&R[v]?"contained":"outlined",color:((L=y.statuses)==null?void 0:L[v])==="starter"?"primary":void 0,sx:{minWidth:32,width:32,p:0,...((ie=y.statuses)==null?void 0:ie[v])==="starter"?{backgroundColor:"primary.main",color:"#fff","&:hover":{backgroundColor:"primary.main"}}:((le=y.statuses)==null?void 0:le[v])==="libero"?{backgroundColor:"#FF9933",color:"#fff","&:hover":{backgroundColor:"#FF9933"},"&.Mui-focusVisible":{outline:"2px solid #FF9933"}}:{}},onClick:()=>Te("teamB",a,v),disabled:i,children:((Ce=y.statuses)==null?void 0:Ce[v])==="starter"?"出":((de=y.statuses)==null?void 0:de[v])==="libero"?"リ":"不"})},v)}),e.jsx(p,{padding:"checkbox",children:e.jsx(x,{onClick:u=>u.stopPropagation(),sx:{width:32,height:32,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Xe,{size:"small",onClick:i?void 0:()=>he("teamB",a),disabled:i,sx:{width:24,height:24},children:e.jsx(ut,{fontSize:"small",color:i?"disabled":"error"})})})})]})},y.id)),h.placeholder]})})]})})]})]}),e.jsxs(vt,{open:_,onClose:q,children:[e.jsx(_e,{children:"メンバー選択"}),e.jsxs(Oe,{sx:{mt:2},children:[e.jsx(x,{sx:{display:"flex",justifyContent:"flex-end",mb:1},children:e.jsx(Q,{onClick:Je,variant:"contained",size:"small",startIcon:e.jsx(Ot,{}),disabled:i||!(G==="teamA"?n.teamA:n.teamB),children:"追加"})}),e.jsx(ct,{component:Qe,storageKey:`members-select-${G}`,children:e.jsxs(lt,{size:"small",children:[e.jsx(rt,{children:e.jsxs(ye,{sx:{backgroundColor:h=>h.palette.mode==="dark"?"#343A42":"#f5f5f5",height:50},children:[e.jsx(p,{padding:"checkbox"}),e.jsx(p,{children:"番号"}),e.jsx(p,{children:"名前"}),e.jsx(p,{children:"ポジション"})]})}),e.jsx(ot,{children:O.map(h=>{const y=w.some(a=>a.id===h.id);return e.jsxs(ye,{sx:{cursor:"pointer",height:50},children:[e.jsx(p,{padding:"checkbox",onClick:a=>a.stopPropagation(),children:e.jsx(Qs,{checked:y,onChange:()=>U(h)})}),e.jsx(p,{children:h.no}),e.jsx(p,{children:h.name}),e.jsx(p,{children:(h.positions||[]).join(", ")})]},h.id)})})]})})]}),e.jsxs(Re,{children:[e.jsx(Q,{onClick:q,startIcon:e.jsx(ze,{}),color:"inherit",children:"キャンセル"}),e.jsx(Q,{onClick:ue,disabled:w.length===0,startIcon:e.jsx(De,{}),children:"OK"})]})]}),e.jsxs(vt,{open:H,onClose:fe,children:[e.jsx(_e,{children:"メンバー追加"}),e.jsxs(Oe,{sx:{display:"flex",flexDirection:"column",gap:2,mt:2},children:[e.jsx(re,{label:"番号",type:"number",value:P,onChange:h=>E(h.target.value),margin:"dense"}),e.jsx(re,{label:"名前",value:M,onChange:h=>W(h.target.value),margin:"dense"}),e.jsxs(je,{children:[e.jsx(ge,{id:"md-positions-label",children:"ポジション"}),e.jsxs(be,{labelId:"md-positions-label",multiple:!0,value:J,label:"ポジション",onChange:h=>oe(typeof h.target.value=="string"?h.target.value.split(","):h.target.value),renderValue:h=>h.join(", "),children:[e.jsx(X,{value:"レフト",children:"レフト"}),e.jsx(X,{value:"センター",children:"センター"}),e.jsx(X,{value:"ライト",children:"ライト"}),e.jsx(X,{value:"セッター",children:"セッター"}),e.jsx(X,{value:"リベロ",children:"リベロ"})]})]})]}),e.jsxs(Re,{children:[e.jsx(Q,{onClick:fe,startIcon:e.jsx(ze,{}),color:"inherit",children:"キャンセル"}),e.jsx(Q,{onClick:Me,disabled:P==="",startIcon:e.jsx(De,{}),children:"OK"})]})]}),e.jsxs(dt,{open:ae,onClose:Se,children:[e.jsx(_e,{children:"削除確認"}),e.jsx(Oe,{sx:{mt:2},children:"このメンバーを削除しますか？"}),e.jsxs(Re,{children:[e.jsx(Q,{onClick:Se,startIcon:e.jsx(ze,{}),color:"inherit",children:"キャンセル"}),e.jsx(Q,{onClick:Ie,color:"error",startIcon:e.jsx(De,{}),children:"OK"})]})]})]})}function va({match:n,setMatch:r,tags:j,onAddTag:b,locked:c}){return e.jsx(x,{sx:{maxWidth:1024,mx:"auto"},children:e.jsx(bt,{container:!0,spacing:2,children:e.jsx(bt,{item:!0,xs:12,children:e.jsxs(Qe,{elevation:0,sx:{p:2},children:[e.jsx(re,{label:"試合日付",type:"date",InputLabelProps:{shrink:!0},value:n.date,onChange:d=>r(i=>({...i,date:d.target.value})),fullWidth:!0,margin:"dense",disabled:c,sx:{"& .MuiOutlinedInput-root":{height:56},"& .MuiOutlinedInput-input":{padding:"0 14px",height:"100%",lineHeight:"56px",fontSize:"1rem",textAlign:"left"},'& input[type="date"]':{WebkitAppearance:"none"}}}),e.jsx(re,{label:"試合名",value:n.matchName,onChange:d=>r(i=>({...i,matchName:d.target.value})),fullWidth:!0,margin:"dense",disabled:c}),e.jsx(Kt,{multiple:!0,freeSolo:!0,options:j,getOptionLabel:d=>typeof d=="string"?d:d.name,value:n.tags.map(d=>j.find(i=>i.id===d)).filter(Boolean),onChange:(d,i)=>{const _=[];i.forEach(S=>{if(typeof S=="string"){const H={id:crypto.randomUUID(),name:S,color:Be};b(H),_.push(H.id)}else _.push(S.id)}),r(S=>({...S,tags:_}))},renderTags:(d,i)=>d.map((_,S)=>e.jsx(ke,{...i({index:S}),label:_.name,sx:{backgroundColor:_.color||Be,color:"#fff",mr:.5,mb:.5}})),renderInput:d=>e.jsx(re,{...d,label:"タグ",margin:"dense"}),fullWidth:!0,disabled:c}),e.jsxs(zs,{severity:"info",sx:{mt:1},children:["試合タグは上記項目にて直接入力するか、設定＞タグメニューにて追加できます",e.jsx("br",{}),"試合にタグを設定することにより、試合を横串で集計することが可能となります"]}),e.jsx(re,{label:"場所",value:n.location,onChange:d=>r(i=>({...i,location:d.target.value})),fullWidth:!0,margin:"dense",disabled:c}),e.jsx(re,{label:"主審",value:n.mainReferee,onChange:d=>r(i=>({...i,mainReferee:d.target.value})),fullWidth:!0,margin:"dense",disabled:c}),e.jsx(re,{label:"副審",value:n.subReferee,onChange:d=>r(i=>({...i,subReferee:d.target.value})),fullWidth:!0,margin:"dense",disabled:c}),e.jsx(re,{label:"動画URL",value:n.videoUrl,onChange:d=>r(i=>({...i,videoUrl:d.target.value})),multiline:!0,rows:3,fullWidth:!0,margin:"dense",disabled:c}),e.jsx(re,{label:"メモ",value:n.memo,onChange:d=>r(i=>({...i,memo:d.target.value})),multiline:!0,rows:3,fullWidth:!0,margin:"dense",disabled:c})]})})})})}function ya({match:n,setMatch:r,teams:j,locked:b}){return e.jsxs(Qe,{elevation:0,sx:{p:2},children:[e.jsxs(je,{fullWidth:!0,margin:"normal",disabled:b,children:[e.jsx(ge,{id:"teamA-label",children:"チームA"}),e.jsx(be,{labelId:"teamA-label",value:n.teamA,label:"チームA",onChange:c=>r(d=>({...d,teamA:c.target.value,teamAMembers:[]})),disabled:b,children:j.map(c=>e.jsx(X,{value:c.id,children:c.name},c.id))})]}),e.jsx(re,{label:"チームA監督",value:n.teamAHeadCoach,onChange:c=>r(d=>({...d,teamAHeadCoach:c.target.value})),fullWidth:!0,margin:"dense",disabled:b}),e.jsx(re,{label:"チームAコーチ",value:n.teamACoach,onChange:c=>r(d=>({...d,teamACoach:c.target.value})),fullWidth:!0,margin:"dense",disabled:b}),e.jsx(re,{label:"チームAマネージャー",value:n.teamAManager,onChange:c=>r(d=>({...d,teamAManager:c.target.value})),fullWidth:!0,margin:"dense",disabled:b}),e.jsx(re,{label:"チームAキャプテン",value:n.teamACaptain,onChange:c=>r(d=>({...d,teamACaptain:c.target.value})),fullWidth:!0,margin:"dense",disabled:b}),e.jsxs(je,{fullWidth:!0,margin:"normal",disabled:b,children:[e.jsx(ge,{id:"teamB-label",children:"チームB"}),e.jsx(be,{labelId:"teamB-label",value:n.teamB,label:"チームB",onChange:c=>r(d=>({...d,teamB:c.target.value,teamBMembers:[]})),disabled:b,children:j.map(c=>e.jsx(X,{value:c.id,children:c.name},c.id))})]}),e.jsx(re,{label:"チームB監督",value:n.teamBHeadCoach,onChange:c=>r(d=>({...d,teamBHeadCoach:c.target.value})),fullWidth:!0,margin:"dense",disabled:b}),e.jsx(re,{label:"チームBコーチ",value:n.teamBCoach,onChange:c=>r(d=>({...d,teamBCoach:c.target.value})),fullWidth:!0,margin:"dense",disabled:b}),e.jsx(re,{label:"チームBマネージャー",value:n.teamBManager,onChange:c=>r(d=>({...d,teamBManager:c.target.value})),fullWidth:!0,margin:"dense",disabled:b}),e.jsx(re,{label:"チームBキャプテン",value:n.teamBCaptain,onChange:c=>r(d=>({...d,teamBCaptain:c.target.value})),fullWidth:!0,margin:"dense",disabled:b})]})}const Ca=dn.create(x),Sa=()=>typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():Math.random().toString(36).slice(2)+Date.now().toString(36);function Pa({match:n,onSave:r,teams:j,teamMembers:b,playDetails:c,playCategories:d,statsSettings:i,rallyCategoryTags:_,rallyDetailTags:S,themeSetting:H,scoreInputSetting:C,onAddMember:P,setAppBarAction:E,setAppBarLeftAction:M,onDirtyChange:W,tags:J,onAddTag:oe}){const G=nn(),ne=an(),[w,te]=o.useState("info"),ae=!1;o.useEffect(()=>{const l=ne.pathname.split("/").filter(Boolean);if(l[0]!=="matches"||l[1]!==n.id)return;const T=l[2]??"info";T==="setinfo"?(te("info"),G(`/matches/${n.id}/info`,{replace:!0})):(te(T),l[2]||G(`/matches/${n.id}/info`,{replace:!0}))},[ne.pathname,G,n.id,ae]);const Z=o.useCallback(l=>{const T=l.teamA,I=l.teamB,k=(se,Y)=>!!Y&&(b[se]||[]).some(V=>V.id===Y&&V.visible!==!1),ee=(se,Y)=>Y.filter(V=>k(se,V.id)).map(V=>{const pe=(b[se]||[]).find(Fe=>Fe.id===V.id);return pe?{...V,no:pe.no,name:pe.name,positions:pe.positions}:V});return{...l,teamAMembers:ee(T,l.teamAMembers),teamBMembers:ee(I,l.teamBMembers),sets:l.sets.map(se=>({...se,rallies:se.rallies.map(Y=>({...Y,server:k(Y.serverTeam==="teamA"?T:I,Y.server)?Y.server:void 0,teamAMember:k(T,Y.teamAMember)?Y.teamAMember:void 0,teamBMember:k(I,Y.teamBMember)?Y.teamBMember:void 0}))}))}},[b]),[f,F]=o.useState(()=>Z({...n,tags:n.tags||[],matchStatsSettings:n.matchStatsSettings||[],teamAMembers:n.teamAMembers.map(l=>({...l,statuses:l.statuses??Array(n.sets.length).fill("")})),teamBMembers:n.teamBMembers.map(l=>({...l,statuses:l.statuses??Array(n.sets.length).fill("")}))})),g=5,B=[Es,Ws,Us,Vs,Ns],D=!!n.locked,O=Rs(),$=Zs(O.breakpoints.up("sm")),[U,ue]=o.useState(!1),[q,he]=o.useState(!1),Ie=200,Se=56,[Je,Me]=o.useState(!1),fe=O.palette.text.secondary,Te=o.useCallback(()=>{U?(he(!1),ue(!1)):(ue(!0),$||he(!0))},[U,$]),h=o.useCallback(l=>{l.propertyName==="width"&&$&&U&&he(!0)},[$,U]);o.useEffect(()=>{$||(ue(!1),he(!1))},[$]),o.useEffect(()=>(M(e.jsx(pt,{open:Je,onClose:()=>Me(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:jt,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${fe}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${fe}`}}}},title:e.jsxs(x,{sx:{p:1,maxWidth:260},children:[e.jsxs(Ke,{variant:"body2",children:[e.jsx(Jt,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),"からメニューを開き、各セットのメニューをロングタップし上下にスライドすることでセット順の変更が可能です"]}),e.jsx(x,{sx:{textAlign:"right",mt:1},children:e.jsx(gt,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem("tutorial-set-reorder","1"),Me(!1)},children:"了解した"})})]}),children:e.jsx(Xe,{color:"inherit",onClick:Te,children:e.jsx(Jt,{})})})),()=>M(null)),[M,Te,Je,fe]);const[y,a]=o.useState(!1),[m,u]=o.useState(!1),[v,R]=o.useState(null),[L,ie]=o.useState(!1),[le,Ce]=o.useState({open:!1,message:"",severity:"success"}),de=`matchDraft-${n.id}`,Ct=o.useRef(!1),[Ge,Ze]=o.useState(!1),[St,et]=o.useState(!1),[Pe,st]=o.useState({}),Ee=o.useCallback((l,T,I=!0)=>{F(k=>{const ee=[...k.sets],se=ee.findIndex(V=>V.id===l);if(se===-1)return k;const Y=ee[se];return I&&st(V=>{const pe=V[l]||{undo:[]};return{...V,[l]:{undo:[...pe.undo,Y],redo:[]}}}),ee[se]=T,{...k,sets:ee}})},[]),Tt=o.useCallback(()=>{if(!/^[0-9]+$/.test(w))return;const l=Number(w)-1,T=f.sets[l],I=Pe[T.id];if(!I||I.undo.length===0)return;const k=I.undo[I.undo.length-1];st(ee=>({...ee,[T.id]:{undo:I.undo.slice(0,-1),redo:[...I.redo,T]}})),Ee(T.id,k,!1)},[w,f.sets,Pe,Ee]),xt=o.useCallback(()=>{if(!/^[0-9]+$/.test(w))return;const l=Number(w)-1,T=f.sets[l],I=Pe[T.id];if(!I||I.redo.length===0)return;const k=I.redo[I.redo.length-1];st(ee=>({...ee,[T.id]:{undo:[...I.undo,T],redo:I.redo.slice(0,-1)}})),Ee(T.id,k,!1)},[w,f.sets,Pe,Ee]),nt=l=>{if(!l.destination||D)return;const T=l.source.index,I=l.destination.index;if(T===I)return;const k=Array.from(f.sets),[ee]=k.splice(T,1);k.splice(I,0,ee);const se=pe=>pe.map(Fe=>{const ce=Array.from(Fe.statuses||[]),[Ue]=ce.splice(T,1);return ce.splice(I,0,Ue),{...Fe,statuses:ce}}),Y=se(f.teamAMembers),V=se(f.teamBMembers);F(pe=>({...pe,sets:k,teamAMembers:Y,teamBMembers:V}))};o.useEffect(()=>{st(l=>{const T={...l};return Object.keys(T).forEach(I=>{f.sets.some(k=>k.id===I)||delete T[I]}),T})},[f.sets]),o.useEffect(()=>{F(l=>Z(l))},[Z]);const Ye=l=>{var T;return((T=j.find(I=>I.id===l))==null?void 0:T.name)||""},Ae=o.useMemo(()=>f.date!==n.date||f.matchName!==n.matchName||f.location!==n.location||f.mainReferee!==n.mainReferee||f.subReferee!==n.subReferee||f.videoUrl!==n.videoUrl||f.memo!==n.memo||f.teamA!==n.teamA||f.teamAHeadCoach!==n.teamAHeadCoach||f.teamACoach!==n.teamACoach||f.teamAManager!==n.teamAManager||f.teamACaptain!==n.teamACaptain||f.teamB!==n.teamB||f.teamBHeadCoach!==n.teamBHeadCoach||f.teamBCoach!==n.teamBCoach||f.teamBManager!==n.teamBManager||f.teamBCaptain!==n.teamBCaptain||JSON.stringify(f.tags)!==JSON.stringify(n.tags)||JSON.stringify(f.teamAMembers)!==JSON.stringify(n.teamAMembers)||JSON.stringify(f.teamBMembers)!==JSON.stringify(n.teamBMembers)||JSON.stringify(f.matchStatsSettings||[])!==JSON.stringify(n.matchStatsSettings||[])||JSON.stringify(f.sets)!==JSON.stringify(n.sets),[f,n]);o.useEffect(()=>{localStorage.getItem(de)&&ie(!0)},[de]),o.useEffect(()=>{if(!Ct.current){Ct.current=!0;return}Ae?localStorage.setItem(de,JSON.stringify(f)):localStorage.removeItem(de)},[f,Ae,de]);const Rt=()=>{if(D||f.sets.length>=g)return;f.sets.length===1&&!localStorage.getItem("tutorial-set-reorder")&&Me(!0);const l={id:Sa(),my:0,opponent:0,rallies:[]},T=f.sets.length+1;F(I=>({...I,sets:[...I.sets,l],teamAMembers:I.teamAMembers.map(k=>({...k,statuses:[...k.statuses||[],""]})),teamBMembers:I.teamBMembers.map(k=>({...k,statuses:[...k.statuses||[],""]}))})),te(String(T)),G(`/matches/${n.id}/${T}`)},zt=l=>{D||(R(l),u(!0))},At=()=>{if(v===null)return;const l=v,T=f.sets.length;let I=[],k=[],ee=[];const se=w;let Y=w;if(w!=="info"&&w!=="members"&&w!=="stats"&&w!=="setinfo"){const V=Number(w)-1;V===l?l>0?(Y=String(l),G(`/matches/${n.id}/${l}`)):T>1?(Y="1",G(`/matches/${n.id}/1`)):(Y="info",G(`/matches/${n.id}/info`)):V>l&&(Y=String(V),G(`/matches/${n.id}/${V}`))}te(Y),F(V=>{I=V.sets.map(ce=>({...ce})),k=V.teamAMembers.map(ce=>({...ce,statuses:ce.statuses?[...ce.statuses]:[]})),ee=V.teamBMembers.map(ce=>({...ce,statuses:ce.statuses?[...ce.statuses]:[]}));const pe=V.sets.filter((ce,Ue)=>Ue!==l),Fe=ce=>ce.map(Ue=>({...Ue,statuses:(Ue.statuses||[]).filter((Wt,Mt)=>Mt!==l)}));return{...V,sets:pe,teamAMembers:Fe(V.teamAMembers),teamBMembers:Fe(V.teamBMembers)}}),R(null),u(!1),Ce({open:!0,message:"セットを削除しました",severity:"success",actionLabel:"元に戻す",onAction:()=>{F(V=>({...V,sets:I,teamAMembers:k,teamBMembers:ee})),se!=="info"&&se!=="members"&&se!=="stats"&&se!=="setinfo"&&G(`/matches/${n.id}/${se}`)},autoHideDuration:5e3})},mt=()=>{R(null),u(!1)},ht=o.useCallback(()=>{a(!0)},[]),wt=async()=>{const l=Z(f);F(l);try{await Promise.resolve(r(l)),localStorage.removeItem(de),Ce({open:!0,message:"保存しました",severity:"success"})}catch{Ce({open:!0,message:"保存に失敗しました",severity:"error"})}a(!1)},$e=()=>{a(!1)},Bt=()=>{Ce(l=>({...l,open:!1}))},Ht=()=>{const l=localStorage.getItem(de);if(!l){ie(!1);return}try{const T=JSON.parse(l),I={...T,tags:T.tags||[],matchStatsSettings:T.matchStatsSettings||[],teamAMembers:T.teamAMembers.map(ee=>({...ee,statuses:ee.statuses??Array(T.sets.length).fill("")})),teamBMembers:T.teamBMembers.map(ee=>({...ee,statuses:ee.statuses??Array(T.sets.length).fill("")}))},k=Z(I);F(k),r(k)}catch{}localStorage.removeItem(de),ie(!1)},Dt=()=>{localStorage.removeItem(de),ie(!1)},He=o.useMemo(()=>/^[0-9]+$/.test(w),[w]),We=o.useMemo(()=>He?f.sets[Number(w)-1]:null,[He,w,f.sets]),tt=o.useMemo(()=>{var l;return!He||D||!We||!((l=Pe[We.id])!=null&&l.undo.length)},[He,D,We,Pe]),at=o.useMemo(()=>{var l;return!He||D||!We||!((l=Pe[We.id])!=null&&l.redo.length)},[He,D,We,Pe]);o.useEffect(()=>{tt?Ze(!1):localStorage.getItem("tutorial-undo")||Ze(!0)},[tt]),o.useEffect(()=>{at?et(!1):localStorage.getItem("tutorial-redo")||et(!0)},[at]),o.useEffect(()=>(E(e.jsxs(x,{sx:{display:"flex",alignItems:"center"},children:[He&&e.jsxs(e.Fragment,{children:[e.jsx(pt,{open:Ge,onClose:()=>Ze(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:jt,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${fe}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${fe}`}}}},title:e.jsxs(x,{sx:{p:1,maxWidth:260},children:[e.jsxs(Ke,{variant:"body2",children:["各セットタブで独立し、ラリー結果の操作履歴を保持しています。",e.jsx("br",{}),e.jsx(Gt,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),"を選択することで1つ前の操作を取り消すことができます。",e.jsx("br",{}),"操作履歴は試合画面を離れると消去されます。"]}),e.jsx(x,{sx:{textAlign:"right",mt:1},children:e.jsx(gt,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem("tutorial-undo","1"),Ze(!1)},children:"了解した"})})]}),children:e.jsx(Xe,{onClick:Tt,disabled:tt,color:"inherit",sx:{ml:1},children:e.jsx(Gt,{})})}),e.jsx(pt,{open:St,onClose:()=>et(!1),disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,arrow:!0,placement:"bottom",TransitionComponent:jt,slotProps:{tooltip:{sx:{backgroundColor:"#F5F5F9",color:"rgba(0, 0, 0, 0.87)",border:`1px solid ${fe}`,pointerEvents:"auto"}},arrow:{sx:{color:"#F5F5F9","&::before":{border:`1px solid ${fe}`}}}},title:e.jsxs(x,{sx:{p:1,maxWidth:260},children:[e.jsxs(Ke,{variant:"body2",children:[e.jsx(Yt,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),"を選択することで1つ前に取り消した操作を復活することができます。"]}),e.jsx(x,{sx:{textAlign:"right",mt:1},children:e.jsx(gt,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem("tutorial-redo","1"),et(!1)},children:"了解した"})})]}),children:e.jsx(Xe,{onClick:xt,disabled:at,color:"inherit",sx:{ml:1},children:e.jsx(Yt,{})})})]}),e.jsx(Q,{onClick:ht,variant:"contained",disabled:!Ae||D,startIcon:e.jsx(qs,{}),sx:{ml:1},children:"保存"})]})),()=>E(null)),[E,He,Tt,xt,ht,Ae,D,tt,at,Ge,St,fe]),o.useEffect(()=>(W==null||W(Ae),()=>W==null?void 0:W(!1)),[Ae,W]);const It=[{key:"info",label:"試合概要",icon:e.jsx(rn,{})},{key:"team",label:"チーム",icon:e.jsx(Ls,{})},{key:"members",label:"メンバー登録",icon:e.jsx(Hs,{})},{key:"sep1",divider:!0},{key:"stats",label:"スタッツ",icon:e.jsx(on,{})},{key:"sep2",divider:!0},{key:"setinfo",label:"セット情報",icon:e.jsx(Fs,{})}].filter(l=>l.key!=="setinfo"),Ft=f.sets.map((l,T)=>{const I=B[T];return{key:`${T+1}`,icon:e.jsx(I,{}),label:`${l.my}-${l.opponent}`}}),Lt=!D&&f.sets.length<g?[{key:"add",label:"セット追加",icon:e.jsx(Ot,{})}]:[],ft=l=>{l==="add"?Rt():(te(l),G(`/matches/${n.id}/${l}`)),$||(he(!1),ue(!1))},Et=e.jsxs(Ca,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},sx:{flexGrow:1,overflowY:"auto",display:"flex",flexDirection:"column"},children:[w==="info"&&e.jsx(va,{match:f,setMatch:F,tags:J,onAddTag:oe,locked:D}),w==="members"&&e.jsx(ba,{match:f,setMatch:F,teamAName:Ye(f.teamA)||"チームA",teamBName:Ye(f.teamB)||"チームB",teamMembers:b,onAddMember:P,locked:D}),w==="stats"&&e.jsx(ha,{sets:f.sets,playDetails:c,playCategories:d,statsSettings:i,matchStatsSettings:f.matchStatsSettings||[],onMatchStatsSettingsChange:l=>F(T=>({...T,matchStatsSettings:l})),rallyCategoryTags:_,rallyDetailTags:S,teamAName:Ye(f.teamA),teamBName:Ye(f.teamB),locked:D}),w==="team"&&e.jsx(x,{sx:{maxWidth:1024,mx:"auto"},children:e.jsx(ya,{match:f,setMatch:F,teams:j,locked:D})}),ae,w!=="info"&&w!=="members"&&w!=="stats"&&w!=="setinfo"&&w!=="team"&&e.jsx(oa,{setScore:f.sets[Number(w)-1],playDetails:c,playCategories:d,teamAMembers:f.teamAMembers,teamBMembers:f.teamBMembers,teamAName:Ye(f.teamA),teamBName:Ye(f.teamB),locked:D,scoreInputSetting:C,themeSetting:H,onChange:l=>Ee(l.id,l)})]},w);return e.jsxs(x,{sx:{display:"flex",height:"100%"},children:[e.jsx(en,{variant:$?"permanent":"temporary",open:$?!0:U,onClose:()=>{he(!1),ue(!1)},PaperProps:{onTransitionEnd:h},ModalProps:{keepMounted:!0,BackdropProps:{sx:{backgroundColor:"rgba(0, 0, 0, 0.5)"}}},sx:{width:$?U?Ie:Se:Ie,flexShrink:0,transition:O.transitions.create("width",{easing:O.transitions.easing.sharp,duration:O.transitions.duration.standard}),...$?{zIndex:O.zIndex.appBar-1}:{},"& .MuiDrawer-paper":{width:$?U?Ie:Se:Ie,boxSizing:"border-box",overflowX:"hidden",transition:O.transitions.create("width",{easing:O.transitions.easing.sharp,duration:O.transitions.duration.standard}),...$?{top:O.mixins.toolbar.minHeight,height:`calc(100% - ${O.mixins.toolbar.minHeight}px)`,zIndex:O.zIndex.appBar-1}:{}}},children:e.jsxs(tn,{children:[It.map(l=>l.divider?e.jsx(sn,{component:"li"},l.key):e.jsxs(Vt,{selected:w===l.key,onClick:()=>ft(l.key),sx:{minHeight:48,justifyContent:U?"initial":"center",px:2.5},children:[e.jsx(Nt,{sx:{minWidth:0,mr:U?3:0,justifyContent:"center"},children:l.icon}),e.jsx(qt,{primary:l.label??`セット${l.key}`,sx:{opacity:q?1:0,display:q?"block":"none",whiteSpace:"nowrap"}})]},l.key)),e.jsx(Qt,{onDragEnd:nt,children:e.jsx(kt,{droppableId:"drawer-sets",children:l=>e.jsxs(x,{ref:l.innerRef,...l.droppableProps,children:[Ft.map((T,I)=>e.jsx(_t,{draggableId:f.sets[I].id,index:I,children:k=>e.jsxs(Vt,{ref:k.innerRef,...k.draggableProps,...k.dragHandleProps,style:k.draggableProps.style,selected:w===T.key,onClick:()=>ft(T.key),sx:{minHeight:48,justifyContent:U?"initial":"center",px:2.5},children:[e.jsx(Nt,{sx:{minWidth:0,mr:U?3:0,justifyContent:"center"},children:T.icon}),e.jsx(qt,{primary:T.label??`セット${T.key}`,sx:{opacity:q?1:0,display:q?"block":"none",whiteSpace:"nowrap"}}),!D&&U&&e.jsx(Xe,{edge:"end",onClick:ee=>{ee.stopPropagation(),zt(I)},children:e.jsx(ut,{})})]})},f.sets[I].id)),l.placeholder]})})}),Lt.map(l=>e.jsxs(Vt,{selected:w===l.key,onClick:()=>ft(l.key),sx:{minHeight:48,justifyContent:U?"initial":"center",px:2.5},children:[e.jsx(Nt,{sx:{minWidth:0,mr:U?3:0,justifyContent:"center"},children:l.icon}),e.jsx(qt,{primary:l.label??`セット${l.key}`,sx:{opacity:q?1:0,display:q?"block":"none",whiteSpace:"nowrap"}})]},l.key))]})}),e.jsxs(x,{sx:{flexGrow:1,display:"flex",flexDirection:"column",width:$?`calc(100% - ${U?Ie:Se}px)`:"100%",transition:$?O.transitions.create("width",{duration:O.transitions.duration.standard}):void 0},children:[e.jsx(x,{sx:{mt:2,flexGrow:1,position:"relative",overflowY:"hidden",display:"flex",width:"100%"},children:e.jsx(cn,{mode:"wait",children:Et})}),e.jsxs(dt,{open:m,onClose:mt,children:[e.jsx(_e,{children:"削除確認"}),e.jsx(Oe,{sx:{mt:2},children:"このセットを削除しますか？"}),e.jsxs(Re,{children:[e.jsx(Q,{onClick:mt,startIcon:e.jsx(ze,{}),color:"inherit",children:"キャンセル"}),e.jsx(Q,{onClick:At,color:"error",startIcon:e.jsx(De,{}),children:"OK"})]})]}),e.jsxs(dt,{open:L,onClose:Dt,children:[e.jsx(_e,{children:"復元確認"}),e.jsx(Oe,{sx:{mt:2},children:"入力途中のデータが存在します。復元しますか？"}),e.jsxs(Re,{children:[e.jsx(Q,{onClick:Dt,startIcon:e.jsx(ze,{}),color:"inherit",children:"いいえ"}),e.jsx(Q,{onClick:Ht,startIcon:e.jsx(De,{}),children:"はい"})]})]}),e.jsxs(dt,{open:y,onClose:$e,children:[e.jsx(_e,{children:"保存確認"}),e.jsx(Oe,{sx:{mt:2},children:"入力内容を保存しますか？"}),e.jsxs(Re,{children:[e.jsx(Q,{onClick:$e,startIcon:e.jsx(ze,{}),color:"inherit",children:"キャンセル"}),e.jsx(Q,{onClick:wt,disabled:!Ae||D,startIcon:e.jsx(De,{}),children:"OK"})]})]}),e.jsx(ln,{open:le.open,message:le.message,severity:le.severity,onClose:Bt,actionLabel:le.actionLabel,onAction:le.onAction,autoHideDuration:le.autoHideDuration})]})]})}export{Pa as default};
