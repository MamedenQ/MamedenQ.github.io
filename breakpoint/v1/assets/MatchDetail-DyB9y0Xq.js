import{i as ce,j as e,B as h,f as Ge,g as st,h as nt,k as Te,l as f,m as at,C as we,I as Je,r as zt,K as Bt,n as Me,o as Pe,d as Ve,e as We,F as ge,L as be,S as ve,M as Y,p as _e,q as X,D as it,N as Ft,O as re,G as Xe,A as Ls,Q as mt,R as Fs,a as Vs,b as Ns,U as Ht,V as Et,W as qs,X as Ks,Y as Js,Z as Ut,_ as Wt,$ as Lt}from"./mui-vendor-Bb0AjAZd.js";import{r as o,f as Gs,u as Ys}from"./react-vendor-QLNaZ7XN.js";import{r as ue,u as Bs,S as lt,D as De,d as ht,a as Pt,R as ft,b as $e,c as Ie,A as Xs}from"./index-DJuO3_vR.js";import{d as Qs,a as Zs}from"./QueryStatsOutlined-Bn6zPNu3.js";import{D as Jt,C as It,P as wt,d as Mt}from"./DragIndicator-7S8wAhk2.js";import{m as en,A as tn}from"./motion-vendor-Bslre2pU.js";import"./chart-vendor-CuPFlH9t.js";var Gt={},sn=ce;Object.defineProperty(Gt,"__esModule",{value:!0});var ws=Gt.default=void 0,nn=sn(ue()),an=e;ws=Gt.default=(0,nn.default)((0,an.jsx)("path",{d:"M12 5.9c1.16 0 2.1.94 2.1 2.1s-.94 2.1-2.1 2.1S9.9 9.16 9.9 8s.94-2.1 2.1-2.1m0 9c2.97 0 6.1 1.46 6.1 2.1v1.1H5.9V17c0-.64 3.13-2.1 6.1-2.1M12 4C9.79 4 8 5.79 8 8s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4m0 9c-2.67 0-8 1.34-8 4v3h16v-3c0-2.66-5.33-4-8-4"}),"PersonOutlineOutlined");var Yt={},ln=ce;Object.defineProperty(Yt,"__esModule",{value:!0});var Ms=Yt.default=void 0,rn=ln(ue()),on=e;Ms=Yt.default=(0,rn.default)((0,on.jsx)("path",{d:"M2 17h2v.5H3v1h1v.5H2v1h3v-4H2zm1-9h1V4H2v1h1zm-1 3h1.8L2 13.1v.9h3v-1H3.2L5 10.9V10H2zm5-6v2h14V5zm0 14h14v-2H7zm0-6h14v-2H7z"}),"FormatListNumberedOutlined");var Xt={},dn=ce;Object.defineProperty(Xt,"__esModule",{value:!0});var Ps=Xt.default=void 0,cn=dn(ue()),un=e;Ps=Xt.default=(0,cn.default)((0,un.jsx)("path",{d:"M9 13.75c-2.34 0-7 1.17-7 3.5V19h14v-1.75c0-2.33-4.66-3.5-7-3.5M4.34 17c.84-.58 2.87-1.25 4.66-1.25s3.82.67 4.66 1.25zM9 12c1.93 0 3.5-1.57 3.5-3.5S10.93 5 9 5 5.5 6.57 5.5 8.5 7.07 12 9 12m0-5c.83 0 1.5.67 1.5 1.5S9.83 10 9 10s-1.5-.67-1.5-1.5S8.17 7 9 7m7.04 6.81c1.16.84 1.96 1.96 1.96 3.44V19h4v-1.75c0-2.02-3.5-3.17-5.96-3.44M15 12c1.93 0 3.5-1.57 3.5-3.5S16.93 5 15 5c-.54 0-1.04.13-1.5.35.63.89 1 1.98 1 3.15s-.37 2.26-1 3.15c.46.22.96.35 1.5.35"}),"GroupOutlined");var Qt={},xn=ce;Object.defineProperty(Qt,"__esModule",{value:!0});var _s=Qt.default=void 0,mn=xn(ue()),hn=e;_s=Qt.default=(0,mn.default)((0,hn.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V5h14zm-7-2h2V7h-4v2h2z"}),"LooksOneOutlined");var Zt={},fn=ce;Object.defineProperty(Zt,"__esModule",{value:!0});var $s=Zt.default=void 0,pn=fn(ue()),jn=e;$s=Zt.default=(0,pn.default)((0,jn.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V5h14zm-4-4h-4v-2h2c1.1 0 2-.89 2-2V9c0-1.11-.9-2-2-2H9v2h4v2h-2c-1.1 0-2 .89-2 2v4h6z"}),"LooksTwoOutlined");var es={},gn=ce;Object.defineProperty(es,"__esModule",{value:!0});var ks=es.default=void 0,bn=gn(ue()),vn=e;ks=es.default=(0,bn.default)((0,vn.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V5h14zm-4-4v-1.5c0-.83-.67-1.5-1.5-1.5.83 0 1.5-.67 1.5-1.5V9c0-1.11-.9-2-2-2H9v2h4v2h-2v2h2v2H9v2h4c1.1 0 2-.89 2-2"}),"Looks3Outlined");var ts={},yn=ce;Object.defineProperty(ts,"__esModule",{value:!0});var Os=ts.default=void 0,Cn=yn(ue()),Sn=e;Os=ts.default=(0,Cn.default)((0,Sn.jsx)("path",{d:"M19.04 3h-14c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16h-14V5h14zm-6-2h2V7h-2v4h-2V7h-2v6h4z"}),"Looks4Outlined");var ss={},Tn=ce;Object.defineProperty(ss,"__esModule",{value:!0});var Rs=ss.default=void 0,An=Tn(ue()),Bn=e;Rs=ss.default=(0,An.default)((0,Bn.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V5h14zm-4-4v-2c0-1.11-.9-2-2-2h-2V9h4V7H9v6h4v2H9v2h4c1.1 0 2-.89 2-2"}),"Looks5Outlined");var ns={},Dn=ce;Object.defineProperty(ns,"__esModule",{value:!0});var zs=ns.default=void 0,In=Dn(ue()),wn=e;zs=ns.default=(0,In.default)((0,wn.jsx)("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"}),"Save");var as={},Mn=ce;Object.defineProperty(as,"__esModule",{value:!0});var Vt=as.default=void 0,Pn=Mn(ue()),_n=e;Vt=as.default=(0,Pn.default)((0,_n.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2M5 19V5h6v14zm14 0h-6v-7h6zm0-9h-6V5h6z"}),"SpaceDashboardOutlined");var is={},$n=ce;Object.defineProperty(is,"__esModule",{value:!0});var Nt=is.default=void 0,kn=$n(ue()),On=e;Nt=is.default=(0,kn.default)((0,On.jsx)("path",{d:"M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8"}),"UndoOutlined");var ls={},Rn=ce;Object.defineProperty(ls,"__esModule",{value:!0});var qt=ls.default=void 0,zn=Rn(ue()),Hn=e;qt=ls.default=(0,zn.default)((0,Hn.jsx)("path",{d:"M18.4 10.6C16.55 8.99 14.15 8 11.5 8c-4.65 0-8.58 3.03-9.96 7.22L3.9 16c1.05-3.19 4.05-5.5 7.6-5.5 1.95 0 3.73.72 5.12 1.88L13 16h9V7z"}),"RedoOutlined");var rs={},En=ce;Object.defineProperty(rs,"__esModule",{value:!0});var Hs=rs.default=void 0,Un=En(ue()),Wn=e;Hs=rs.default=(0,Un.default)((0,Wn.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8m.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"}),"AccessTimeOutlined");var os={},Ln=ce;Object.defineProperty(os,"__esModule",{value:!0});var Es=os.default=void 0,Fn=Ln(ue()),Vn=e;Es=os.default=(0,Fn.default)((0,Vn.jsx)("path",{d:"M6.99 11 3 15l3.99 4v-3H14v-2H6.99zM21 9l-3.99-4v3H10v2h7.01v3z"}),"SwapHorizOutlined");var ds={},Nn=ce;Object.defineProperty(ds,"__esModule",{value:!0});var Us=ds.default=void 0,qn=Nn(ue()),Kn=e;Us=ds.default=(0,qn.default)((0,Kn.jsx)("path",{d:"M16 17.01V10h-2v7.01h-3L15 21l4-3.99zM9 3 5 6.99h3V14h2V6.99h3zm7 14.01V10h-2v7.01h-3L15 21l4-3.99zM9 3 5 6.99h3V14h2V6.99h3z"}),"SwapVertOutlined");var cs={},Jn=ce;Object.defineProperty(cs,"__esModule",{value:!0});var Ws=cs.default=void 0,Gn=Jn(ue()),Yn=e;Ws=cs.default=(0,Gn.default)((0,Yn.jsx)("path",{d:"M16.01 11H4v2h12.01v3L20 12l-3.99-4z"}),"ArrowRightAlt");function Xn(n){if(typeof window>"u")return n;try{const p=new DOMParser().parseFromString(n,"image/svg+xml"),b=new Set(["svg","g","path","circle","rect","line","polygon","polyline","text","defs","use"]),c=d=>{[...d.children].forEach(i=>{if(b.has(i.tagName))[...i.attributes].forEach(_=>{_.name.startsWith("on")&&i.removeAttribute(_.name)}),c(i);else{const _=document.createTextNode(i.outerHTML);i.replaceWith(_)}})};return c(p.documentElement),p.documentElement.outerHTML}catch{return""}}function Qn({name:n}){const l=o.useRef(null),[p,b]=o.useState(1);return o.useEffect(()=>{const c=l.current;if(!c)return;const d=c.getBBox().width;b(d>64?64/d:1)},[n]),e.jsx("svg",{width:64,height:64,children:e.jsx("g",{transform:`scale(${p})`,children:e.jsx("text",{ref:l,x:32/p,y:32/p,textAnchor:"middle",dominantBaseline:"central",fontSize:8,children:n})})})}function Dt({category:n,borderColor:l}){const p=l?{border:"1px solid",borderColor:l,boxSizing:"border-box"}:{};return n.iconType==="svg"&&n.svg?e.jsx(h,{sx:{width:64,height:64,...p},dangerouslySetInnerHTML:{__html:Xn(n.svg)}}):n.iconType==="image"&&n.image?e.jsx(h,{component:"img",src:n.image,sx:{width:64,height:64,objectFit:"none",objectPosition:`-${n.cropX||0}px -${n.cropY||0}px`,...p}}):e.jsx(h,{sx:{width:64,height:64,display:"flex",...p},children:e.jsx(Qn,{name:n.name})})}function Zn(n,l,p){const b=o.useCallback(i=>{let _=0,A=0;i.rallies.forEach(R=>{if(R.timeoutTeam||R.substitutionTeam)return;const S=l.find($=>$.id===R.teamAPlayDetail),z=l.find($=>$.id===R.teamBPlayDetail);(S==null?void 0:S.pointType)==="得点"||(z==null?void 0:z.pointType)==="失点"?_+=1:((z==null?void 0:z.pointType)==="得点"||(S==null?void 0:S.pointType)==="失点")&&(A+=1)}),i.my=_,i.opponent=A},[l]),c=o.useCallback(i=>{const _=[...n.rallies,i],A={...n,rallies:_};b(A),p(A)},[n,b,p]),d=o.useCallback(i=>{const _=n.rallies.filter((R,S)=>S!==i),A={...n,rallies:_};b(A),p(A)},[n,b,p]);return{addRally:c,deleteRally:d,calculateScores:b}}function ea({setScore:n,playDetails:l,playCategories:p,teamAMembers:b,teamBMembers:c,teamAName:d,teamBName:i,onChange:_,locked:A=!1,scoreInputSetting:R,themeSetting:S}){var D,q,G,ne,W,ie,me,le;const[z,$]=o.useState(!1),[k,U]=o.useState(!1),[K,oe]=o.useState("teamA"),[Q,se]=o.useState(""),[T,ee]=o.useState(""),[te,Z]=o.useState(""),[u,L]=o.useState(""),[j,I]=o.useState(""),[M,H]=o.useState(""),[w,V]=o.useState(""),[N,ye]=o.useState(""),[fe,Ae]=o.useState(!1),[ke,Oe]=o.useState(!1),[Ne,Ce]=o.useState(!1),[Be,g]=o.useState(""),[y,a]=o.useState(""),[x,m]=o.useState(""),[v,P]=o.useState(null),[E,xe]=o.useState(null),[ae,Se]=o.useState(null),{addRally:de,deleteRally:pt,calculateScores:Qe}=Zn(n,l,_),jt=Bs("md"),rt=Bs("sm"),Le=!rt&&R.showRallyIcons,gt=!jt&&R.showScoreProgressArea,Fe=p.find(t=>t.id==="init-serve"),Re=n.rallies.filter(t=>t.timeoutTeam==="teamA").length,Ze=n.rallies.filter(t=>t.timeoutTeam==="teamB").length,qe=Re>=2,ot=Ze>=2,dt=()=>{var F,je;if(N)return!0;if(R.rallyMemberRequired&&!Q||T&&!u||te&&!j||!!!(T&&u)&&!!!(te&&j))return!1;const B=(F=l.find(he=>he.id===u))==null?void 0:F.pointUnitType;if(R.rallyMemberRequired&&u&&B==="メンバー"&&!M)return!1;const O=(je=l.find(he=>he.id===j))==null?void 0:je.pointUnitType;return!(R.rallyMemberRequired&&j&&O==="メンバー"&&!w)},bt=t=>{if(!t)return"";const s=l.find(O=>O.id===t),B=p.find(O=>O.id===(s==null?void 0:s.playCategoryId));return(B==null?void 0:B.name)||""},pe=t=>{if(!t)return;const s=l.find(B=>B.id===t);return p.find(B=>B.id===(s==null?void 0:s.playCategoryId))},ze=(t,s)=>{if(!s)return"－";const O=(t==="teamA"?b:c).find(F=>F.id===s);return O?`${O.no}:${O.name}`:"－"},_t=()=>{if(A)return;xe(null);const t=[...n.rallies].reverse().find(B=>!B.timeoutTeam&&!B.substitutionTeam);let s="teamA";if(t){const B=l.find(F=>F.id===t.teamAPlayDetail),O=l.find(F=>F.id===t.teamBPlayDetail);(B==null?void 0:B.pointType)==="得点"||(O==null?void 0:O.pointType)==="失点"?s="teamA":((O==null?void 0:O.pointType)==="得点"||(B==null?void 0:B.pointType)==="失点")&&(s="teamB")}oe(s),se(""),ee(""),Z(""),L(""),I(""),H(""),V(""),ye(""),$(!0)},$t=t=>{var B,O;if(A)return;const s=n.rallies[t];xe(t),oe(s.serverTeam||"teamA"),se(s.server&&(s.serverTeam==="teamA"?b.some(F=>F.id===s.server):c.some(F=>F.id===s.server))?s.server:""),ee(((B=l.find(F=>F.id===s.teamAPlayDetail))==null?void 0:B.playCategoryId)||""),L(s.teamAPlayDetail||""),H(b.some(F=>F.id===s.teamAMember)&&s.teamAMember||""),Z(((O=l.find(F=>F.id===s.teamBPlayDetail))==null?void 0:O.playCategoryId)||""),I(s.teamBPlayDetail||""),V(c.some(F=>F.id===s.teamBMember)&&s.teamBMember||""),ye(s.timeoutTeam||""),$(!0)},kt=()=>{if(A)return;const t=N?{id:crypto.randomUUID(),timeoutTeam:N}:{id:crypto.randomUUID(),serverTeam:K,server:Q||void 0,teamAPlayDetail:u||void 0,teamAMember:M||void 0,teamBPlayDetail:j||void 0,teamBMember:w||void 0};de(t),$(!1)},ct=t=>{A||t==="teamA"&&qe||t==="teamB"&&ot||(de({id:crypto.randomUUID(),timeoutTeam:t}),Ae(!1))},ut=t=>{A||(g(t),a(""),m(""),P(null),Ce(!0),Oe(!1))},Ot=t=>{if(A)return;const s=n.rallies[t];s.substitutionTeam&&(g(s.substitutionTeam),a(s.outMember||""),m(s.inMember||""),P(t),Ce(!0))},vt=()=>{if(A||!Be||!y||!x)return;const t=[...n.rallies];v!==null?t[v]={...t[v],substitutionTeam:Be,outMember:y,inMember:x}:t.push({id:crypto.randomUUID(),substitutionTeam:Be,outMember:y,inMember:x});const s={...n,rallies:t};Qe(s),_(s),Ce(!1),P(null)},yt=()=>{Ce(!1),P(null)},Rt=()=>{if(A||E===null)return;const t=[...n.rallies];t[E]=N?{...t[E],timeoutTeam:N,serverTeam:void 0,server:void 0,teamAPlayDetail:void 0,teamAMember:void 0,teamBPlayDetail:void 0,teamBMember:void 0}:{...t[E],timeoutTeam:void 0,serverTeam:K,server:Q||void 0,teamAPlayDetail:u||void 0,teamAMember:M||void 0,teamBPlayDetail:j||void 0,teamBMember:w||void 0};const s={...n,rallies:t};Qe(s),_(s),$(!1)},Ct=t=>{if(!t.destination||A)return;const s=Array.from(n.rallies),[B]=s.splice(t.source.index,1);s.splice(t.destination.index,0,B);const O={...n,rallies:s};Qe(O),_(O)},He=t=>{A||(Se(t),U(!0))},Ke=()=>{ae!==null&&(pt(ae),Se(null),U(!1))},Ye=()=>{Se(null),U(!1)},et=t=>{let s=0,B=0,O=null;return n.rallies.slice(0,t+1).forEach(F=>{if(F.timeoutTeam||F.substitutionTeam)return;const je=l.find(tt=>tt.id===F.teamAPlayDetail),he=l.find(tt=>tt.id===F.teamBPlayDetail);(je==null?void 0:je.pointType)==="得点"||(he==null?void 0:he.pointType)==="失点"?(s+=1,O="A"):(he==null?void 0:he.pointType)==="得点"||(je==null?void 0:je.pointType)==="失点"?(B+=1,O="B"):O=null}),e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{color:O==="A"?"black":"#D3D3D3"},children:String(s).padStart(2,"0")})," - ",e.jsx("span",{style:{color:O==="B"?"black":"#D3D3D3"},children:String(B).padStart(2,"0")})]})},xt=[],Ee=[];let St=0,Tt=0;n.rallies.forEach(t=>{if(t.timeoutTeam||t.substitutionTeam)return;const s=l.find(O=>O.id===t.teamAPlayDetail),B=l.find(O=>O.id===t.teamBPlayDetail);(s==null?void 0:s.pointType)==="得点"||(B==null?void 0:B.pointType)==="失点"?(St+=1,Ee.push("A")):(B==null?void 0:B.pointType)==="得点"||(s==null?void 0:s.pointType)==="失点"?(Tt+=1,Ee.push("B")):Ee.push(null),xt.push({a:St,b:Tt})});const Ue=40,At=[];for(let t=0;t<Ee.length-1;t++){const s=Ee[t],B=Ee[t+1];s&&B&&s!==B&&At.push({from:s,index:t})}const r=Ee.map((t,s)=>t&&s>0&&t===Ee[s-1]),C=xt.length*Ue;return e.jsxs(h,{sx:{position:"relative",display:"flex",flexDirection:"column",height:"100%"},children:[e.jsxs(h,{sx:{display:"flex",gap:2,flex:1,minHeight:0},children:[gt&&e.jsxs(h,{sx:{flex:"0 0 20%",overflowY:"auto",height:"100%",position:"relative"},children:[xt.map((t,s)=>{const B=s===0?{a:0,b:0}:xt[s-1],O=t.a!==B.a&&t.a!==0,F=t.b!==B.b&&t.b!==0,je=O&&r[s],he=F&&r[s];return e.jsxs(h,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr 1fr",alignItems:"center",py:.5,height:`${Ue}px`,position:"relative",zIndex:1},children:[e.jsx(h,{}),e.jsxs(e.Fragment,{children:[e.jsx(h,{sx:{display:"flex",justifyContent:"center"},children:O?e.jsx(h,{sx:{width:32,height:32,border:"1px solid",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:24,borderColor:je?"red":"currentColor",backgroundColor:je?"#ffebee":"#fff",color:"black"},children:t.a}):null}),e.jsx(h,{}),e.jsx(h,{sx:{display:"flex",justifyContent:"center"},children:F?e.jsx(h,{sx:{width:32,height:32,border:"1px solid",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:24,borderColor:he?"red":"currentColor",backgroundColor:he?"#ffebee":"#fff",color:"black"},children:t.b}):null})]}),e.jsx(h,{})]},s)}),e.jsx("svg",{viewBox:`0 0 100 ${C}`,style:{position:"absolute",left:0,top:0,width:"100%",height:C,zIndex:0},preserveAspectRatio:"none",pointerEvents:"none",children:At.map(t=>{const s=t.index*Ue+Ue/2,B=(t.index+1)*Ue+Ue/2,O=t.from==="A"?30:70,F=t.from==="A"?70:30;return e.jsx("line",{x1:O,y1:s,x2:F,y2:B,stroke:"currentColor",strokeWidth:1},t.index)})})]}),e.jsx(h,{sx:{flex:1,overflowY:"auto",height:"100%",maxWidth:1024,width:"100%",mx:"auto",mb:2},children:e.jsx(Jt,{onDragEnd:Ct,children:e.jsx(lt,{component:Ge,storageKey:"set-tab",children:e.jsxs(st,{size:"small",sx:{tableLayout:"fixed","& th, & td":{textAlign:"center",verticalAlign:"middle"}},children:[e.jsx(nt,{children:e.jsxs(Te,{sx:{backgroundColor:"#f5f5f5"},children:[e.jsx(f,{sx:{width:"6%"}}),e.jsx(f,{sx:{width:"16%"},children:e.jsxs(h,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{children:d||"チームA"}),e.jsx("span",{children:"サーブ"})]})}),e.jsx(f,{sx:{width:"18%"},children:e.jsxs(h,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{children:d||"チームA"}),e.jsx("span",{children:"ラリー結果"})]})}),e.jsx(f,{sx:{width:"20%"},children:"得点"}),e.jsx(f,{sx:{width:"18%"},children:e.jsxs(h,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{children:i||"チームB"}),e.jsx("span",{children:"ラリー結果"})]})}),e.jsx(f,{sx:{width:"16%"},children:e.jsxs(h,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{children:i||"チームB"}),e.jsx("span",{children:"サーブ"})]})}),e.jsx(f,{sx:{width:"6%"}})]})}),e.jsx(It,{droppableId:"rallies",children:t=>e.jsxs(at,{ref:t.innerRef,...t.droppableProps,children:[n.rallies.map((s,B)=>e.jsx(wt,{draggableId:s.id,index:B,isDragDisabled:A,children:O=>{var F,je,he,tt,xs,ms,hs,fs,ps,js,gs,bs,vs,ys,Cs,Ss,Ts,As;return e.jsxs(Te,{ref:O.innerRef,...O.draggableProps,"data-index":B,onClick:()=>{A||(s.substitutionTeam?Ot(B):s.timeoutTeam||$t(B))},sx:{cursor:A||s.timeoutTeam?"default":"pointer",backgroundColor:s.timeoutTeam||s.substitutionTeam?"#f5f5f5":void 0},children:[e.jsx(f,{padding:"checkbox",sx:{width:"6%"},children:e.jsx(h,{onClick:J=>J.stopPropagation(),...O.dragHandleProps,sx:{cursor:A?"default":"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:e.jsx(Mt,{fontSize:"small"})})}),s.timeoutTeam?e.jsx(f,{colSpan:5,sx:{width:"88%"},children:e.jsxs(h,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:[s.timeoutTeam==="teamA"?d||"チームA":i||"チームB","タイムアウト"]})}):s.substitutionTeam?e.jsx(f,{colSpan:5,sx:{width:"88%"},children:e.jsxs(h,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100%"},children:[e.jsxs("span",{children:[s.substitutionTeam==="teamA"?d||"チームA":i||"チームB","選手交代"]}),e.jsxs(h,{sx:{display:"flex",alignItems:"center",mt:.5},children:[e.jsx("span",{children:ze(s.substitutionTeam,s.outMember)}),e.jsx(Ws,{fontSize:"small",sx:{mx:1}}),e.jsx("span",{children:ze(s.substitutionTeam,s.inMember)})]})]})}):e.jsxs(e.Fragment,{children:[e.jsx(f,{sx:{width:"16%"},children:s.serverTeam==="teamA"?e.jsxs(h,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[Le&&(Fe?e.jsx(Dt,{category:Fe}):e.jsxs("svg",{width:64,height:64,children:[e.jsx("rect",{width:64,height:64,fill:"none",stroke:"currentColor"}),e.jsx("text",{x:"50%",y:"50%",textAnchor:"middle",dominantBaseline:"central",fontSize:"12",children:"サーブ"})]})),e.jsx("span",{style:{fontSize:12},children:((F=b.find(J=>J.id===s.server))==null?void 0:F.name)||"－"})]}):null}),e.jsx(f,{sx:{width:"18%"},children:e.jsxs(h,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[Le&&s.teamAPlayDetail&&pe(s.teamAPlayDetail)?e.jsx(h,{sx:{mb:"5px"},children:e.jsx(Dt,{category:pe(s.teamAPlayDetail),borderColor:((je=l.find(J=>J.id===s.teamAPlayDetail))==null?void 0:je.pointType)==="得点"?S.scoreColor:((he=l.find(J=>J.id===s.teamAPlayDetail))==null?void 0:he.pointType)==="失点"?S.lossColor:void 0})}):null,s.teamAPlayDetail?e.jsx(we,{label:bt(s.teamAPlayDetail),size:"small",variant:"outlined",sx:{borderColor:((tt=pe(s.teamAPlayDetail))==null?void 0:tt.color)||De,color:((xs=pe(s.teamAPlayDetail))==null?void 0:xs.color)||De,mb:.5}}):null,s.teamAPlayDetail?e.jsx(we,{label:((ms=l.find(J=>J.id===s.teamAPlayDetail))==null?void 0:ms.name)||"",size:"small",sx:{backgroundColor:((hs=l.find(J=>J.id===s.teamAPlayDetail))==null?void 0:hs.pointType)==="得点"?S.scoreColor:S.lossColor,color:"#fff",mb:.5}}):null,e.jsx("span",{style:{fontSize:12},children:s.teamAPlayDetail?((fs=l.find(J=>J.id===s.teamAPlayDetail))==null?void 0:fs.pointUnitType)==="メンバー"&&((ps=b.find(J=>J.id===s.teamAMember))==null?void 0:ps.name)||"－":""})]})}),e.jsx(f,{sx:{width:"20%",fontSize:"2em"},children:et(B)}),e.jsx(f,{sx:{width:"18%"},children:e.jsxs(h,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[Le&&s.teamBPlayDetail&&pe(s.teamBPlayDetail)?e.jsx(h,{sx:{mb:"5px"},children:e.jsx(Dt,{category:pe(s.teamBPlayDetail),borderColor:((js=l.find(J=>J.id===s.teamBPlayDetail))==null?void 0:js.pointType)==="得点"?S.scoreColor:((gs=l.find(J=>J.id===s.teamBPlayDetail))==null?void 0:gs.pointType)==="失点"?S.lossColor:void 0})}):null,s.teamBPlayDetail?e.jsx(we,{label:bt(s.teamBPlayDetail),size:"small",variant:"outlined",sx:{borderColor:((bs=pe(s.teamBPlayDetail))==null?void 0:bs.color)||De,color:((vs=pe(s.teamBPlayDetail))==null?void 0:vs.color)||De,mb:.5}}):null,s.teamBPlayDetail?e.jsx(we,{label:((ys=l.find(J=>J.id===s.teamBPlayDetail))==null?void 0:ys.name)||"",size:"small",sx:{backgroundColor:((Cs=l.find(J=>J.id===s.teamBPlayDetail))==null?void 0:Cs.pointType)==="得点"?S.scoreColor:S.lossColor,color:"#fff",mb:.5}}):null,e.jsx("span",{style:{fontSize:12},children:s.teamBPlayDetail?((Ss=l.find(J=>J.id===s.teamBPlayDetail))==null?void 0:Ss.pointUnitType)==="メンバー"&&((Ts=c.find(J=>J.id===s.teamBMember))==null?void 0:Ts.name)||"－":""})]})}),e.jsx(f,{sx:{width:"16%"},children:s.serverTeam==="teamB"?e.jsxs(h,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[Le&&(Fe?e.jsx(Dt,{category:Fe}):e.jsxs("svg",{width:64,height:64,children:[e.jsx("rect",{width:64,height:64,fill:"none",stroke:"currentColor"}),e.jsx("text",{x:"50%",y:"50%",textAnchor:"middle",dominantBaseline:"central",fontSize:"12",children:"サーブ"})]})),e.jsx("span",{style:{fontSize:12},children:((As=c.find(J=>J.id===s.server))==null?void 0:As.name)||"－"})]}):null})]}),e.jsx(f,{padding:"checkbox",sx:{width:"6%"},children:e.jsx(h,{onClick:J=>J.stopPropagation(),sx:{width:32,height:32,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Je,{size:"small",onClick:A?void 0:()=>He(B),disabled:A,sx:{width:24,height:24},children:e.jsx(ht,{fontSize:"small",color:A?"disabled":"error"})})})})]})}},s.id)),t.placeholder]})})]})})})})]}),!A&&e.jsxs(e.Fragment,{children:[e.jsx(h,{sx:{position:"fixed",right:"35px",bottom:200},children:e.jsxs(zt,{ariaLabel:"substitution actions",direction:"left",icon:e.jsx(Es,{}),onOpen:()=>Oe(!0),onClose:()=>Oe(!1),open:ke,FabProps:{size:"large"},children:[e.jsx(Bt,{icon:e.jsx(e.Fragment,{children:i||"チームB"}),tooltipTitle:"",FabProps:{variant:"extended",size:"small"},onClick:()=>ut("teamB")}),e.jsx(Bt,{icon:e.jsx(e.Fragment,{children:d||"チームA"}),tooltipTitle:"",FabProps:{variant:"extended",size:"small"},onClick:()=>ut("teamA")})]})}),e.jsx(h,{sx:{position:"fixed",right:"35px",bottom:140},children:e.jsxs(zt,{ariaLabel:"timeout actions",direction:"left",icon:e.jsx(Hs,{}),onOpen:()=>Ae(!0),onClose:()=>Ae(!1),open:fe,FabProps:{size:"large"},children:[e.jsx(Bt,{icon:e.jsx(e.Fragment,{children:i||"チームB"}),tooltipTitle:"",FabProps:{variant:"extended",size:"small",disabled:ot},onClick:()=>ct("teamB")}),e.jsx(Bt,{icon:e.jsx(e.Fragment,{children:d||"チームA"}),tooltipTitle:"",FabProps:{variant:"extended",size:"small",disabled:qe},onClick:()=>ct("teamA")})]})}),e.jsx(h,{sx:{position:"fixed",right:"35px",bottom:80},children:e.jsx(zt,{ariaLabel:"rally actions",direction:"left",icon:e.jsx(Pt,{}),FabProps:{size:"large",onClick:_t}})})]}),e.jsxs(ft,{open:z,onClose:()=>$(!1),children:[e.jsx(Me,{children:E===null?"ラリー追加":"ラリー編集"}),e.jsxs(Pe,{sx:{display:"flex",flexDirection:"column",gap:2,mt:2},children:[e.jsxs(Ve,{exclusive:!0,value:K,onChange:(t,s)=>s&&oe(s),sx:{width:"100%"},disabled:!!N,children:[e.jsx(We,{value:"teamA",sx:{flex:1},children:e.jsx(h,{sx:{whiteSpace:"pre-line",textAlign:"center"},children:`${d||"チームA"}
サーブ`})}),e.jsx(We,{value:"teamB",sx:{flex:1},children:e.jsx(h,{sx:{whiteSpace:"pre-line",textAlign:"center"},children:`${i||"チームB"}
サーブ`})})]}),e.jsxs(ge,{fullWidth:!0,required:R.rallyMemberRequired,disabled:!!N,children:[e.jsx(be,{id:"server",children:"サーバー"}),e.jsx(ve,{labelId:"server",value:Q,label:"サーバー",onChange:t=>se(t.target.value),children:(K==="teamA"?b:c).map(t=>e.jsx(Y,{value:t.id,children:t.name},t.id))})]}),rt?e.jsxs(h,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(h,{sx:{flex:1,display:"flex",flexDirection:"column",gap:1},children:[e.jsx(Ve,{orientation:"vertical",exclusive:!0,value:T,onChange:(t,s)=>{T===s||s===null?(ee(""),L("")):(ee(s),L(""))},disabled:!!N,children:p.filter(t=>t.visible!==!1).map(t=>e.jsx(We,{value:t.id,sx:{whiteSpace:"nowrap"},children:t.name},t.id))}),e.jsx(Ve,{orientation:"vertical",exclusive:!0,value:u,onChange:(t,s)=>{L(u===s||s===null?"":s)},sx:{mt:1},disabled:!!N,children:l.filter(t=>t.playCategoryId===T&&t.visible!==!1).map(t=>{const s=t.pointType==="得点"?S.scoreColor:S.lossColor;return e.jsx(We,{value:t.id,sx:{whiteSpace:"nowrap",color:s,"&.Mui-selected":{color:s}},children:t.name},t.id)})}),e.jsxs(ge,{fullWidth:!0,sx:{mt:1},required:R.rallyMemberRequired&&((D=l.find(t=>t.id===u))==null?void 0:D.pointUnitType)==="メンバー",disabled:!!N,children:[e.jsx(be,{id:"amem",children:`${d||"チームA"}メンバー`}),e.jsxs(ve,{labelId:"amem",value:M,label:`${d||"チームA"}メンバー`,onChange:t=>H(t.target.value),disabled:((q=l.find(t=>t.id===u))==null?void 0:q.pointUnitType)!=="メンバー",children:[e.jsx(Y,{value:"",children:e.jsx("em",{children:"なし"})}),b.map(t=>e.jsx(Y,{value:t.id,children:t.name},t.id))]})]})]}),e.jsxs(h,{sx:{flex:1,display:"flex",flexDirection:"column",gap:1},children:[e.jsx(Ve,{orientation:"vertical",exclusive:!0,value:te,onChange:(t,s)=>{te===s||s===null?(Z(""),I("")):(Z(s),I(""))},disabled:!!N,children:p.filter(t=>t.visible!==!1).map(t=>e.jsx(We,{value:t.id,sx:{whiteSpace:"nowrap"},children:t.name},t.id))}),e.jsx(Ve,{orientation:"vertical",exclusive:!0,value:j,onChange:(t,s)=>{I(j===s||s===null?"":s)},sx:{mt:1},disabled:!!N,children:l.filter(t=>t.playCategoryId===te&&t.visible!==!1).map(t=>{const s=t.pointType==="得点"?S.scoreColor:S.lossColor;return e.jsx(We,{value:t.id,sx:{whiteSpace:"nowrap",color:s,"&.Mui-selected":{color:s}},children:t.name},t.id)})}),e.jsxs(ge,{fullWidth:!0,sx:{mt:1},required:R.rallyMemberRequired&&((G=l.find(t=>t.id===j))==null?void 0:G.pointUnitType)==="メンバー",disabled:!!N,children:[e.jsx(be,{id:"bmem",children:`${i||"チームB"}メンバー`}),e.jsxs(ve,{labelId:"bmem",value:w,label:`${i||"チームB"}メンバー`,onChange:t=>V(t.target.value),disabled:((ne=l.find(t=>t.id===j))==null?void 0:ne.pointUnitType)!=="メンバー",children:[e.jsx(Y,{value:"",children:e.jsx("em",{children:"なし"})}),c.map(t=>e.jsx(Y,{value:t.id,children:t.name},t.id))]})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(h,{sx:{display:"flex",gap:2},children:[e.jsx(Ve,{orientation:"vertical",exclusive:!0,value:T,onChange:(t,s)=>{T===s||s===null?(ee(""),L("")):(ee(s),L(""))},disabled:!!N,sx:{flex:"1 1 25%"},children:p.filter(t=>t.visible!==!1).map(t=>e.jsx(We,{value:t.id,sx:{whiteSpace:"nowrap"},children:t.name},t.id))}),e.jsx(Ve,{orientation:"vertical",exclusive:!0,value:u,onChange:(t,s)=>{L(u===s||s===null?"":s)},disabled:!!N,sx:{flex:"1 1 25%"},children:l.filter(t=>t.playCategoryId===T&&t.visible!==!1).map(t=>{const s=t.pointType==="得点"?S.scoreColor:S.lossColor;return e.jsx(We,{value:t.id,sx:{whiteSpace:"nowrap",color:s,"&.Mui-selected":{color:s}},children:t.name},t.id)})}),e.jsx(Ve,{orientation:"vertical",exclusive:!0,value:te,onChange:(t,s)=>{te===s||s===null?(Z(""),I("")):(Z(s),I(""))},disabled:!!N,sx:{flex:"1 1 25%"},children:p.filter(t=>t.visible!==!1).map(t=>e.jsx(We,{value:t.id,sx:{whiteSpace:"nowrap"},children:t.name},t.id))}),e.jsx(Ve,{orientation:"vertical",exclusive:!0,value:j,onChange:(t,s)=>{I(j===s||s===null?"":s)},disabled:!!N,sx:{flex:"1 1 25%"},children:l.filter(t=>t.playCategoryId===te&&t.visible!==!1).map(t=>{const s=t.pointType==="得点"?S.scoreColor:S.lossColor;return e.jsx(We,{value:t.id,sx:{whiteSpace:"nowrap",color:s,"&.Mui-selected":{color:s}},children:t.name},t.id)})})]}),e.jsxs(h,{sx:{display:"flex",gap:2,mt:1},children:[e.jsxs(ge,{fullWidth:!0,required:R.rallyMemberRequired&&((W=l.find(t=>t.id===u))==null?void 0:W.pointUnitType)==="メンバー",disabled:!!N,sx:{flex:1},children:[e.jsx(be,{id:"amem",children:`${d||"チームA"}メンバー`}),e.jsxs(ve,{labelId:"amem",value:M,label:`${d||"チームA"}メンバー`,onChange:t=>H(t.target.value),disabled:((ie=l.find(t=>t.id===u))==null?void 0:ie.pointUnitType)!=="メンバー",children:[e.jsx(Y,{value:"",children:e.jsx("em",{children:"なし"})}),b.map(t=>e.jsx(Y,{value:t.id,children:t.name},t.id))]})]}),e.jsxs(ge,{fullWidth:!0,required:R.rallyMemberRequired&&((me=l.find(t=>t.id===j))==null?void 0:me.pointUnitType)==="メンバー",disabled:!!N,sx:{flex:1},children:[e.jsx(be,{id:"bmem",children:`${i||"チームB"}メンバー`}),e.jsxs(ve,{labelId:"bmem",value:w,label:`${i||"チームB"}メンバー`,onChange:t=>V(t.target.value),disabled:((le=l.find(t=>t.id===j))==null?void 0:le.pointUnitType)!=="メンバー",children:[e.jsx(Y,{value:"",children:e.jsx("em",{children:"なし"})}),c.map(t=>e.jsx(Y,{value:t.id,children:t.name},t.id))]})]})]})]})]}),e.jsxs(_e,{children:[e.jsx(X,{onClick:()=>$(!1),color:"inherit",startIcon:e.jsx($e,{}),children:"キャンセル"}),E===null?e.jsx(X,{onClick:kt,disabled:!dt(),startIcon:e.jsx(Ie,{}),children:"OK"}):e.jsx(X,{onClick:Rt,disabled:!dt(),startIcon:e.jsx(Ie,{}),children:"OK"})]})]}),e.jsxs(ft,{open:Ne,onClose:yt,children:[e.jsx(Me,{children:"選手交代"}),e.jsx(Pe,{children:e.jsxs(h,{component:"form",sx:{mt:2},children:[e.jsxs(ge,{fullWidth:!0,sx:{mb:2},children:[e.jsx(be,{id:"out-member",children:"OUT"}),e.jsx(ve,{labelId:"out-member",value:y,label:"OUT",onChange:t=>a(t.target.value),children:(Be==="teamA"?b:c).map(t=>e.jsx(Y,{value:t.id,children:`${t.no}:${t.name}`},t.id))})]}),e.jsx(h,{sx:{display:"flex",justifyContent:"center",mb:2},children:e.jsx(Us,{sx:{width:32,height:32}})}),e.jsxs(ge,{fullWidth:!0,children:[e.jsx(be,{id:"in-member",children:"IN"}),e.jsx(ve,{labelId:"in-member",value:x,label:"IN",onChange:t=>m(t.target.value),children:(Be==="teamA"?b:c).map(t=>e.jsx(Y,{value:t.id,children:`${t.no}:${t.name}`},t.id))})]})]})}),e.jsxs(_e,{children:[e.jsx(X,{onClick:yt,color:"inherit",startIcon:e.jsx($e,{}),children:"キャンセル"}),e.jsx(X,{onClick:vt,disabled:!y||!x,startIcon:e.jsx(Ie,{}),children:"OK"})]})]}),e.jsxs(it,{open:k,onClose:Ye,children:[e.jsx(Me,{children:"削除確認"}),e.jsx(Pe,{sx:{mt:2},children:"このラリーを削除しますか？"}),e.jsxs(_e,{children:[e.jsx(X,{onClick:Ye,color:"inherit",startIcon:e.jsx($e,{}),children:"キャンセル"}),e.jsx(X,{onClick:Ke,color:"error",startIcon:e.jsx(Ie,{}),children:"OK"})]})]})]})}function ta(n,l){const[p,b]=o.useState(null),c=o.useRef(n);c.current=n;const d=o.useRef(),i=o.useCallback(S=>{if(p===null)return;const z=document.elementFromPoint(S.clientX,S.clientY),$=z==null?void 0:z.closest("[data-index]");if(!$)return;const k=Number($.dataset.index);if(isNaN(k)||k===p)return;const U=[...c.current],[K]=U.splice(p,1);U.splice(k,0,K),b(k),l(U)},[p,l]),_=o.useCallback(()=>{window.removeEventListener("pointermove",i),d.current&&(window.removeEventListener("pointerup",d.current),window.removeEventListener("pointercancel",d.current))},[i]),A=o.useCallback(S=>{var z,$;S&&"currentTarget"in S&&(($=(z=S.currentTarget).releasePointerCapture)==null||$.call(z,S.pointerId)),_(),b(null)},[_]);function R(S,z){var $,k;z.preventDefault(),(k=($=z.currentTarget).setPointerCapture)==null||k.call($,z.pointerId),b(S),d.current=A,window.addEventListener("pointermove",i),window.addEventListener("pointerup",d.current),window.addEventListener("pointercancel",d.current)}return o.useEffect(()=>()=>_(),[_]),{start:R,move:i,end:A,dragging:p!==null}}const sa=()=>typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():Math.random().toString(36).slice(2)+Date.now().toString(36);function na({statsSettings:n,onChange:l,playCategories:p,playDetails:b,rallyCategoryTags:c,rallyDetailTags:d,disabled:i}){const{start:_,move:A,end:R}=ta(n,l),S=a=>{var x;return((x=p.find(m=>m.id===a))==null?void 0:x.name)||""},z=a=>{var x;return((x=b.find(m=>m.id===a))==null?void 0:x.name)||""},[$,k]=o.useState(!1),[U,K]=o.useState(null),[oe,Q]=o.useState(""),[se,T]=o.useState(""),[ee,te]=o.useState([]),[Z,u]=o.useState([]),[L,j]=o.useState(""),[I,M]=o.useState(""),[H,w]=o.useState("合算"),[V,N]=o.useState(null),[ye,fe]=o.useState(!1),Ae=()=>{i||(K(-1),Q(""),T(""),te([]),u([]),j(""),M(""),w("合算"),k(!0))},ke=a=>{if(i)return;const x=n[a];K(a),Q(x.playCategoryId||""),T(x.playDetailId||""),te(x.playCategoryTags||[]),u(x.playDetailTags||[]),j(x.pointType||""),M(x.pointUnitType||""),w(x.aggregateType||"合算"),k(!0)},Oe=()=>{const a=oe!=="",x=se!=="",m=ee.length>0,v=Z.length>0,P=L!=="",E=I!=="";return a&&!x&&!m&&!v&&!P&&!E||a&&x&&!m&&!v&&!P&&!E||a&&!x&&!m&&!v&&P&&!E||a&&!x&&!m&&!v&&!P&&E||a&&!x&&!m&&!v&&P&&E||!a&&!x&&!m&&!v&&P&&!E||!a&&!x&&!m&&!v&&P&&E||!a&&!x&&!m&&!v&&!P&&E||m&&!a&&!x&&!v&&!P&&!E||m&&v&&!a&&!x&&!P&&!E||m&&v&&!a&&!x&&P&&!E||m&&v&&!a&&!x&&!P&&E||m&&v&&!a&&!x&&P&&E||m&&!a&&!x&&P&&!E||m&&!a&&!x&&!P&&E||m&&!a&&!x&&P&&E||v&&!a&&!x&&!m&&!P&&!E||v&&!a&&!x&&!m&&P&&!E||v&&!a&&!x&&!m&&!P&&E||v&&!a&&!x&&!m&&P&&E},Ne=()=>{const a={id:U===-1?sa():n[U].id,playCategoryId:oe||void 0,playDetailId:se||void 0,playCategoryTags:oe===""&&ee.length>0?ee:void 0,playDetailTags:se===""&&Z.length>0?Z:void 0,pointType:se?void 0:L||void 0,pointUnitType:se?void 0:I||void 0,aggregateType:H};U===-1?l([...n,a]):U!==null&&l(n.map((x,m)=>m===U?a:x)),k(!1)},Ce=()=>{k(!1)},Be=a=>{i||(N(a),fe(!0))},g=()=>{V!==null&&l(n.filter((a,x)=>x!==V)),fe(!1)},y=()=>{fe(!1)};return e.jsxs(h,{children:[e.jsxs(h,{sx:{maxWidth:1024,mx:"auto",display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(h,{sx:{fontWeight:"bold"},children:"スタッツ設定"}),e.jsx(X,{onClick:Ae,variant:"contained",size:"small",startIcon:e.jsx(Pt,{}),disabled:i,children:"追加"})]}),e.jsx(lt,{component:Ge,storageKey:"match-stats-grid",sx:{maxWidth:1024,mx:"auto"},children:e.jsxs(st,{size:"small",children:[e.jsx(nt,{children:e.jsxs(Te,{sx:{backgroundColor:"#f5f5f5",height:50},children:[e.jsx(f,{}),e.jsx(f,{children:"プレー区分"}),e.jsx(f,{children:"プレー詳細"}),e.jsx(f,{children:"得点区分"}),e.jsx(f,{children:"得失点単位区分"}),e.jsx(f,{children:"集計方法"}),e.jsx(f,{})]})}),e.jsx(at,{children:n.map((a,x)=>e.jsxs(Te,{"data-index":x,onClick:()=>ke(x),sx:{cursor:i?"default":"pointer",height:50},children:[e.jsx(f,{padding:"checkbox",children:e.jsx(h,{onClick:m=>m.stopPropagation(),onPointerDown:m=>{i||(m.stopPropagation(),_(x,m))},onPointerMove:m=>A(m),onPointerUp:m=>R(m),onPointerCancel:m=>R(m),sx:{cursor:i?"default":"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:e.jsx(Mt,{})})}),e.jsx(f,{children:a.playCategoryId?S(a.playCategoryId):a.playCategoryTags&&a.playCategoryTags.length>0?e.jsx(h,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:a.playCategoryTags.map(m=>{const v=c.find(P=>P.id===m);return e.jsx(we,{label:(v==null?void 0:v.name)||m,size:"small",sx:{backgroundColor:(v==null?void 0:v.color)||De,color:"#fff"}},m)})}):""}),e.jsx(f,{children:a.playDetailId?z(a.playDetailId):a.playDetailTags&&a.playDetailTags.length>0?e.jsx(h,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:a.playDetailTags.map(m=>{const v=d.find(P=>P.id===m);return e.jsx(we,{label:(v==null?void 0:v.name)||m,size:"small",sx:{backgroundColor:(v==null?void 0:v.color)||De,color:"#fff"}},m)})}):""}),e.jsx(f,{children:a.pointType||""}),e.jsx(f,{children:a.pointUnitType||""}),e.jsx(f,{children:a.aggregateType||"合算"}),e.jsx(f,{padding:"checkbox",children:e.jsx(h,{onClick:m=>m.stopPropagation(),sx:{width:32,height:32,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Je,{size:"small",onClick:()=>Be(x),sx:{width:24,height:24},disabled:i,children:e.jsx(ht,{fontSize:"small",color:i?"disabled":"error"})})})})]},a.id))})]})}),e.jsxs(ft,{open:$,onClose:Ce,children:[e.jsxs(Me,{children:["スタッツ設定",U===-1?"追加":"編集"]}),e.jsx(Pe,{sx:{display:"flex",flexDirection:"column",gap:2},children:e.jsxs(e.Fragment,{children:[e.jsxs(ge,{fullWidth:!0,sx:{mt:3},children:[e.jsx(be,{id:"stat-category-label",children:"プレー区分"}),e.jsxs(ve,{labelId:"stat-category-label",value:oe,label:"プレー区分",onChange:a=>{Q(a.target.value),T(""),te([]),u([])},disabled:ee.length>0||Z.length>0,children:[e.jsx(Y,{value:"",children:"なし"}),p.map(a=>e.jsx(Y,{value:a.id,children:a.name},a.id))]})]}),e.jsxs(ge,{fullWidth:!0,sx:{mt:1},children:[e.jsx(be,{id:"stat-detail-label",children:"プレー詳細"}),e.jsxs(ve,{labelId:"stat-detail-label",value:se,label:"プレー詳細",onChange:a=>{T(a.target.value),j(""),M(""),te([]),u([])},disabled:L!==""||I!==""||ee.length>0||Z.length>0,children:[e.jsx(Y,{value:"",children:"なし"}),b.filter(a=>a.playCategoryId===oe).map(a=>e.jsx(Y,{value:a.id,children:a.name},a.id))]})]}),e.jsx(Ft,{multiple:!0,options:c,getOptionLabel:a=>a.name,value:c.filter(a=>ee.includes(a.id)),onChange:(a,x)=>{te(x.map(m=>m.id)),x.length>0&&(Q(""),T(""))},disabled:oe!==""||se!=="",renderTags:(a,x)=>a.map((m,v)=>e.jsx(we,{...x({index:v}),label:m.name,size:"small",sx:{backgroundColor:m.color||De,color:"#fff"}})),renderInput:a=>e.jsx(re,{...a,label:"プレー区分タグ",margin:"dense"}),fullWidth:!0}),e.jsx(Ft,{multiple:!0,options:d,getOptionLabel:a=>a.name,value:d.filter(a=>Z.includes(a.id)),onChange:(a,x)=>{u(x.map(m=>m.id)),x.length>0&&(Q(""),T(""))},disabled:oe!==""||se!=="",renderTags:(a,x)=>a.map((m,v)=>e.jsx(we,{...x({index:v}),label:m.name,size:"small",sx:{backgroundColor:m.color||De,color:"#fff"}})),renderInput:a=>e.jsx(re,{...a,label:"プレー詳細タグ",margin:"dense"}),fullWidth:!0}),e.jsxs(h,{sx:{display:"flex",gap:2},children:[e.jsxs(ge,{fullWidth:!0,children:[e.jsx(be,{id:"stat-point-label",children:"得点区分"}),e.jsxs(ve,{labelId:"stat-point-label",value:L,label:"得点区分",onChange:a=>{j(a.target.value),a.target.value!==""&&T("")},disabled:se!=="",children:[e.jsx(Y,{value:"",children:"なし"}),e.jsx(Y,{value:"得点",children:"得点"}),e.jsx(Y,{value:"失点",children:"失点"})]})]}),e.jsxs(ge,{fullWidth:!0,children:[e.jsx(be,{id:"stat-unit-label",children:"得失点単位区分"}),e.jsxs(ve,{labelId:"stat-unit-label",value:I,label:"得失点単位区分",onChange:a=>{M(a.target.value),a.target.value!==""&&T("")},disabled:se!=="",children:[e.jsx(Y,{value:"",children:"なし"}),e.jsx(Y,{value:"メンバー",children:"メンバー"}),e.jsx(Y,{value:"チーム",children:"チーム"})]})]})]}),e.jsxs(ge,{fullWidth:!0,children:[e.jsx(be,{id:"stat-aggregate-label",children:"集計方法"}),e.jsxs(ve,{labelId:"stat-aggregate-label",value:H,label:"集計方法",onChange:a=>w(a.target.value),children:[e.jsx(Y,{value:"合算",children:"合算"}),e.jsx(Y,{value:"セット平均",children:"セット平均"})]})]})]})}),e.jsxs(_e,{children:[e.jsx(X,{onClick:Ce,color:"inherit",startIcon:e.jsx($e,{}),children:"キャンセル"}),e.jsx(X,{onClick:Ne,disabled:!Oe(),startIcon:e.jsx(Ie,{}),children:"OK"})]})]}),e.jsxs(it,{open:ye,onClose:y,children:[e.jsx(Me,{children:"削除確認"}),e.jsx(Pe,{sx:{mt:2},children:"このスタッツ設定を削除しますか？"}),e.jsxs(_e,{children:[e.jsx(X,{onClick:y,color:"inherit",startIcon:e.jsx($e,{}),children:"キャンセル"}),e.jsx(X,{onClick:g,color:"error",startIcon:e.jsx(Ie,{}),children:"OK"})]})]})]})}function Ds(n,l,p){var c,d;if(!n)return!1;const b=l.get(n.playCategoryId);return!(p.playDetailId&&n.id!==p.playDetailId||p.playCategoryId&&n.playCategoryId!==p.playCategoryId||p.playCategoryTags&&p.playCategoryTags.length>0&&!((c=b==null?void 0:b.tags)!=null&&c.some(i=>p.playCategoryTags.includes(i)))||p.playDetailTags&&p.playDetailTags.length>0&&!((d=n.tags)!=null&&d.some(i=>p.playDetailTags.includes(i)))||p.pointType&&n.pointType!==p.pointType||p.pointUnitType&&n.pointUnitType!==p.pointUnitType)}function Is(n,l,p,b){const c=b.map(()=>({teamA:0,teamB:0}));return n.forEach(d=>{d.rallies.forEach(i=>{b.forEach((_,A)=>{const R=i.teamAPlayDetail?l.get(i.teamAPlayDetail):void 0;Ds(R,p,_)&&(c[A].teamA+=1);const S=i.teamBPlayDetail?l.get(i.teamBPlayDetail):void 0;Ds(S,p,_)&&(c[A].teamB+=1)})})}),c}function aa(n,l){const p=[];let b=0,c=0,d=0,i=0;return n.forEach(A=>{let R=0,S=0,z=0,$=0;A.rallies.forEach(k=>{if(k.timeoutTeam||k.substitutionTeam||!k.serverTeam)return;const U=k.teamAPlayDetail?l.get(k.teamAPlayDetail):void 0,K=k.teamBPlayDetail?l.get(k.teamBPlayDetail):void 0;k.serverTeam==="teamA"?(S+=1,(U&&U.pointType==="得点"||K&&K.pointType==="失点")&&(R+=1)):($+=1,(K&&K.pointType==="得点"||U&&U.pointType==="失点")&&(z+=1))}),b+=R,c+=S,d+=z,i+=$,p.push({teamA:S?`${Math.round(R/S*100)}%`:"-",teamB:$?`${Math.round(z/$*100)}%`:"-"})}),{overall:{teamA:c?`${Math.round(b/c*100)}%`:"-",teamB:i?`${Math.round(d/i*100)}%`:"-"},perSet:p}}function ia(n,l){const p=[];let b=0,c=0,d=0,i=0;return n.forEach(A=>{let R=0,S=0,z=0,$=0;A.rallies.forEach(k=>{if(k.timeoutTeam||k.substitutionTeam||!k.serverTeam)return;const U=k.teamAPlayDetail?l.get(k.teamAPlayDetail):void 0,K=k.teamBPlayDetail?l.get(k.teamBPlayDetail):void 0;k.serverTeam==="teamB"?(S+=1,(U&&U.pointType==="得点"||K&&K.pointType==="失点")&&(R+=1)):($+=1,(K&&K.pointType==="得点"||U&&U.pointType==="失点")&&(z+=1))}),b+=R,c+=S,d+=z,i+=$,p.push({teamA:S?`${Math.round(R/S*100)}%`:"-",teamB:$?`${Math.round(z/$*100)}%`:"-"})}),{overall:{teamA:c?`${Math.round(b/c*100)}%`:"-",teamB:i?`${Math.round(d/i*100)}%`:"-"},perSet:p}}function la({sets:n,playDetails:l,playCategories:p,statsSettings:b,matchStatsSettings:c,onMatchStatsSettingsChange:d,rallyCategoryTags:i,rallyDetailTags:_,teamAName:A,teamBName:R,locked:S}){const z=new Map(l.map(j=>[j.id,j])),$=new Map(p.map(j=>[j.id,j])),k=j=>{var I;return((I=p.find(M=>M.id===j))==null?void 0:I.name)||""},U=j=>{var I;return((I=l.find(M=>M.id===j))==null?void 0:I.name)||""},K=[...b,...c],oe=Is(n,z,$,K),Q=n.map(j=>Is([j],z,$,K)),se=oe.map((j,I)=>{if(K[I].aggregateType==="セット平均"){const H=n.length||1;return{teamA:(j.teamA/H).toFixed(1),teamB:(j.teamB/H).toFixed(1)}}return j}),T=Q.map(j=>K.reduce((I,M,H)=>(M.aggregateType!=="セット平均"&&I.push(j[H]),I),[])),ee=K.filter(j=>j.aggregateType!=="セット平均"),te=aa(n,z),Z=ia(n,z),u=j=>{const I=[];j.playCategoryId?I.push(e.jsx("span",{children:k(j.playCategoryId)},"cat")):j.playCategoryTags&&j.playCategoryTags.length>0&&I.push(e.jsx(h,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center",mt:.5},children:j.playCategoryTags.map(H=>{const w=i.find(V=>V.id===H);return e.jsx(we,{label:(w==null?void 0:w.name)||H,size:"small",sx:{mr:.5,mb:.5,backgroundColor:(w==null?void 0:w.color)||De,color:"#fff"}},H)})},"catTags")),j.playDetailId?I.push(e.jsx("span",{children:U(j.playDetailId)},"detail")):j.playDetailTags&&j.playDetailTags.length>0&&I.push(e.jsx(h,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center",mt:.5},children:j.playDetailTags.map(H=>{const w=_.find(V=>V.id===H);return e.jsx(we,{label:(w==null?void 0:w.name)||H,size:"small",sx:{mr:.5,mb:.5,backgroundColor:(w==null?void 0:w.color)||De,color:"#fff"}},H)})},"detailTags"));const M=[];return j.pointType&&M.push(j.pointType),j.pointUnitType&&M.push(j.pointUnitType),M.length>0&&I.push(e.jsx("span",{children:M.join(",")},"point")),I.push(e.jsxs("span",{children:["(",j.aggregateType||"合算",")"]},"agg")),e.jsx(h,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:I.map((H,w)=>e.jsx(h,{sx:{display:"flex",justifyContent:"center"},children:H},w))})},L=(j,I,M,H,w)=>e.jsx(lt,{component:Ge,storageKey:w,sx:{mb:2},children:e.jsxs(st,{size:"small",sx:{"& th, & td":{textAlign:"center",verticalAlign:"middle"}},children:[e.jsx(nt,{children:e.jsxs(Te,{sx:{backgroundColor:"#f5f5f5",height:50},children:[e.jsx(f,{children:A||"チームA"}),e.jsx(f,{children:"項目"}),e.jsx(f,{children:R||"チームB"})]})}),e.jsxs(at,{children:[e.jsxs(Te,{sx:{height:50},children:[e.jsx(f,{children:I.teamA}),e.jsx(f,{children:"ブレイク率"}),e.jsx(f,{children:I.teamB})]},"break-rate"),e.jsxs(Te,{sx:{height:50},children:[e.jsx(f,{children:M.teamA}),e.jsx(f,{children:"サイドアウト率"}),e.jsx(f,{children:M.teamB})]},"sideout-rate"),H.map((V,N)=>e.jsxs(Te,{sx:{height:50},children:[e.jsx(f,{children:j[N].teamA}),e.jsx(f,{children:u(V)}),e.jsx(f,{children:j[N].teamB})]},V.id))]})]})});return e.jsxs(h,{sx:{display:"grid",gap:2,gridTemplateColumns:{xs:"1fr",md:"repeat(2, 1fr)"},maxWidth:1024,width:"100%",mx:"auto"},children:[e.jsxs(h,{children:[e.jsx(Xe,{variant:"h6",sx:{mb:1},children:"試合全体のスタッツ"}),L(se,te.overall,Z.overall,K,"stats-overall")]}),n.map((j,I)=>e.jsxs(h,{children:[e.jsx(Xe,{variant:"h6",sx:{mb:1},children:`${I+1}セット目(${j.my}-${j.opponent})のスタッツ`}),L(T[I],te.perSet[I],Z.perSet[I],ee,`stats-set-${I}`)]},j.id)),e.jsxs(h,{sx:{gridColumn:"1 / -1"},children:[e.jsx(na,{statsSettings:c,onChange:d,playCategories:p,playDetails:l,rallyCategoryTags:i,rallyDetailTags:_,disabled:S}),e.jsxs(Ls,{severity:"info",sx:{mt:1},children:["本設定は試合内のみでの設定となります",e.jsx("br",{}),"各試合共通でのスタッツ項目の設定は設定＞スタッツメニューから設定してください"]})]})]})}var us={},ra=ce;Object.defineProperty(us,"__esModule",{value:!0});var Kt=us.default=void 0,oa=ra(ue()),da=e;Kt=us.default=(0,oa.default)((0,da.jsx)("path",{d:"M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m-9-2V7H4v3H1v2h3v3h2v-3h3v-2zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"PersonAdd");const ca=()=>typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():Math.random().toString(36).slice(2)+Date.now().toString(36);function ua({match:n,setMatch:l,teamAName:p,teamBName:b,teamMembers:c,onAddMember:d,locked:i}){const[_,A]=o.useState(!1),[R,S]=o.useState(!1),[z,$]=o.useState(""),[k,U]=o.useState(""),[K,oe]=o.useState([]),[Q,se]=o.useState("teamA"),[T,ee]=o.useState([]),[te,Z]=o.useState(!1),[u,L]=o.useState(null),[j,I]=o.useState(null),M=g=>{if(!g.destination||g.source.droppableId!==g.destination.droppableId||i)return;const y=g.source.droppableId==="teamA"?"teamAMembers":"teamBMembers",a=Array.from(n[y]),[x]=a.splice(g.source.index,1);a.splice(g.destination.index,0,x),l(m=>({...m,[y]:a}))},H=o.useMemo(()=>{const g=Q==="teamA"?n.teamA:n.teamB,y=c[g]||[],a=Q==="teamA"?n.teamAMembers:n.teamBMembers;return y.filter(x=>x.visible!==!1&&!a.some(m=>m.id===x.id))},[Q,n,c]),w=g=>{se(g),ee([]),A(!0)},V=g=>{ee(y=>y.some(x=>x.id===g.id)?y.filter(x=>x.id!==g.id):[...y,g])},N=()=>{l(Q==="teamA"?g=>({...g,teamAMembers:[...g.teamAMembers,...T.map(y=>({...y,statuses:Array(g.sets.length).fill("")}))]}):g=>({...g,teamBMembers:[...g.teamBMembers,...T.map(y=>({...y,statuses:Array(g.sets.length).fill("")}))]})),A(!1)},ye=()=>{A(!1)},fe=(g,y)=>{i||(L(g),I(y),Z(!0))},Ae=()=>{u&&j!==null&&l(u==="teamA"?g=>({...g,teamAMembers:g.teamAMembers.filter((y,a)=>a!==j)}):g=>({...g,teamBMembers:g.teamBMembers.filter((y,a)=>a!==j)})),Z(!1)},ke=()=>{Z(!1)},Oe=()=>{i||($(""),U(""),oe([]),S(!0))},Ne=()=>{const g=Q==="teamA"?n.teamA:n.teamB;g&&d(g,{id:ca(),no:Number(z),name:k,positions:K}),S(!1)},Ce=()=>{S(!1)},Be=(g,y,a)=>{i||l(x=>{const m=g==="teamA"?"teamAMembers":"teamBMembers",v=[...x[m]],P={...v[y]},E=[...P.statuses||Array(x.sets.length).fill("")],xe=E[a]||"";let ae="";return xe===""?ae="starter":xe==="starter"?ae="libero":ae="",E[a]=ae,P.statuses=E,v[y]=P,{...x,[m]:v}})};return e.jsxs(Jt,{onDragEnd:M,children:[e.jsxs(mt,{container:!0,spacing:2,children:[e.jsxs(mt,{item:!0,xs:12,children:[e.jsxs(h,{sx:{maxWidth:1024,mx:"auto"},children:[e.jsx(Xe,{variant:"h6",sx:{mb:1},children:p}),e.jsx(X,{variant:"contained",size:"small",sx:{mb:1},onClick:()=>w("teamA"),disabled:i,startIcon:e.jsx(Kt,{}),children:"メンバー登録"})]}),e.jsx(lt,{component:Ge,storageKey:"members-teamA",sx:{maxWidth:1024,mx:"auto"},children:e.jsxs(st,{size:"small",children:[e.jsx(nt,{children:e.jsxs(Te,{sx:{backgroundColor:"#f5f5f5",height:50},children:[e.jsx(f,{}),e.jsx(f,{children:"番号"}),e.jsx(f,{children:"名前"}),e.jsx(f,{children:"ポジション"}),n.sets.map((g,y)=>e.jsx(f,{align:"center",children:y+1},y)),e.jsx(f,{})]})}),e.jsx(It,{droppableId:"teamA",children:g=>e.jsxs(at,{ref:g.innerRef,...g.droppableProps,children:[n.teamAMembers.map((y,a)=>e.jsx(wt,{draggableId:`teamA-${y.id}`,index:a,isDragDisabled:i,children:x=>e.jsxs(Te,{ref:x.innerRef,...x.draggableProps,"data-index":a,sx:{cursor:i?"default":"pointer",height:50},children:[e.jsx(f,{padding:"checkbox",children:e.jsx(h,{onClick:m=>m.stopPropagation(),...x.dragHandleProps,sx:{cursor:i?"default":"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:e.jsx(Mt,{})})}),e.jsx(f,{children:y.no}),e.jsx(f,{children:y.name}),e.jsx(f,{children:(y.positions||[]).join(", ")}),n.sets.map((m,v)=>{var P,E,xe,ae,Se,de;return e.jsx(f,{padding:"checkbox",align:"center",children:e.jsx(X,{size:"small",variant:(P=y.statuses)!=null&&P[v]?"contained":"outlined",color:((E=y.statuses)==null?void 0:E[v])==="starter"?"primary":void 0,sx:{minWidth:32,width:32,p:0,...((xe=y.statuses)==null?void 0:xe[v])==="starter"?{backgroundColor:"primary.main",color:"#fff","&:hover":{backgroundColor:"primary.main"}}:((ae=y.statuses)==null?void 0:ae[v])==="libero"?{backgroundColor:"#FF9933",color:"#fff","&:hover":{backgroundColor:"#FF9933"},"&.Mui-focusVisible":{outline:"2px solid #FF9933"}}:{}},onClick:()=>Be("teamA",a,v),disabled:i,children:((Se=y.statuses)==null?void 0:Se[v])==="starter"?"出":((de=y.statuses)==null?void 0:de[v])==="libero"?"リ":"不"})},v)}),e.jsx(f,{padding:"checkbox",children:e.jsx(h,{onClick:m=>m.stopPropagation(),sx:{width:32,height:32,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Je,{size:"small",onClick:i?void 0:()=>fe("teamA",a),disabled:i,sx:{width:24,height:24},children:e.jsx(ht,{fontSize:"small",color:i?"disabled":"error"})})})})]})},y.id)),g.placeholder]})})]})})]}),e.jsxs(mt,{item:!0,xs:12,children:[e.jsxs(h,{sx:{maxWidth:1024,mx:"auto"},children:[e.jsx(Xe,{variant:"h6",sx:{mb:1},children:b}),e.jsx(X,{variant:"contained",size:"small",sx:{mb:1},onClick:()=>w("teamB"),disabled:i,startIcon:e.jsx(Kt,{}),children:"メンバー登録"})]}),e.jsx(lt,{component:Ge,storageKey:"members-teamB",sx:{maxWidth:1024,mx:"auto"},children:e.jsxs(st,{size:"small",children:[e.jsx(nt,{children:e.jsxs(Te,{sx:{backgroundColor:"#f5f5f5",height:50},children:[e.jsx(f,{}),e.jsx(f,{children:"番号"}),e.jsx(f,{children:"名前"}),e.jsx(f,{children:"ポジション"}),n.sets.map((g,y)=>e.jsx(f,{align:"center",children:y+1},y)),e.jsx(f,{})]})}),e.jsx(It,{droppableId:"teamB",children:g=>e.jsxs(at,{ref:g.innerRef,...g.droppableProps,children:[n.teamBMembers.map((y,a)=>e.jsx(wt,{draggableId:`teamB-${y.id}`,index:a,isDragDisabled:i,children:x=>e.jsxs(Te,{ref:x.innerRef,...x.draggableProps,"data-index":a,sx:{cursor:i?"default":"pointer",height:50},children:[e.jsx(f,{padding:"checkbox",children:e.jsx(h,{onClick:m=>m.stopPropagation(),...x.dragHandleProps,sx:{cursor:i?"default":"grab",display:"inline-flex",touchAction:"none",width:32,height:32,alignItems:"center",justifyContent:"center"},children:e.jsx(Mt,{})})}),e.jsx(f,{children:y.no}),e.jsx(f,{children:y.name}),e.jsx(f,{children:(y.positions||[]).join(", ")}),n.sets.map((m,v)=>{var P,E,xe,ae,Se,de;return e.jsx(f,{padding:"checkbox",align:"center",children:e.jsx(X,{size:"small",variant:(P=y.statuses)!=null&&P[v]?"contained":"outlined",color:((E=y.statuses)==null?void 0:E[v])==="starter"?"primary":void 0,sx:{minWidth:32,width:32,p:0,...((xe=y.statuses)==null?void 0:xe[v])==="starter"?{backgroundColor:"primary.main",color:"#fff","&:hover":{backgroundColor:"primary.main"}}:((ae=y.statuses)==null?void 0:ae[v])==="libero"?{backgroundColor:"#FF9933",color:"#fff","&:hover":{backgroundColor:"#FF9933"},"&.Mui-focusVisible":{outline:"2px solid #FF9933"}}:{}},onClick:()=>Be("teamB",a,v),disabled:i,children:((Se=y.statuses)==null?void 0:Se[v])==="starter"?"出":((de=y.statuses)==null?void 0:de[v])==="libero"?"リ":"不"})},v)}),e.jsx(f,{padding:"checkbox",children:e.jsx(h,{onClick:m=>m.stopPropagation(),sx:{width:32,height:32,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Je,{size:"small",onClick:i?void 0:()=>fe("teamB",a),disabled:i,sx:{width:24,height:24},children:e.jsx(ht,{fontSize:"small",color:i?"disabled":"error"})})})})]})},y.id)),g.placeholder]})})]})})]})]}),e.jsxs(ft,{open:_,onClose:ye,children:[e.jsx(Me,{children:"メンバー選択"}),e.jsxs(Pe,{sx:{mt:2},children:[e.jsx(h,{sx:{display:"flex",justifyContent:"flex-end",mb:1},children:e.jsx(X,{onClick:Oe,variant:"contained",size:"small",startIcon:e.jsx(Pt,{}),disabled:i||!(Q==="teamA"?n.teamA:n.teamB),children:"追加"})}),e.jsx(lt,{component:Ge,storageKey:`members-select-${Q}`,children:e.jsxs(st,{size:"small",children:[e.jsx(nt,{children:e.jsxs(Te,{sx:{backgroundColor:"#f5f5f5",height:50},children:[e.jsx(f,{padding:"checkbox"}),e.jsx(f,{children:"番号"}),e.jsx(f,{children:"名前"}),e.jsx(f,{children:"ポジション"})]})}),e.jsx(at,{children:H.map(g=>{const y=T.some(a=>a.id===g.id);return e.jsxs(Te,{sx:{cursor:"pointer",height:50},children:[e.jsx(f,{padding:"checkbox",onClick:a=>a.stopPropagation(),children:e.jsx(Fs,{checked:y,onChange:()=>V(g)})}),e.jsx(f,{children:g.no}),e.jsx(f,{children:g.name}),e.jsx(f,{children:(g.positions||[]).join(", ")})]},g.id)})})]})})]}),e.jsxs(_e,{children:[e.jsx(X,{onClick:ye,startIcon:e.jsx($e,{}),color:"inherit",children:"キャンセル"}),e.jsx(X,{onClick:N,disabled:T.length===0,startIcon:e.jsx(Ie,{}),children:"OK"})]})]}),e.jsxs(ft,{open:R,onClose:Ce,children:[e.jsx(Me,{children:"メンバー追加"}),e.jsxs(Pe,{sx:{display:"flex",flexDirection:"column",gap:2,mt:2},children:[e.jsx(re,{label:"番号",type:"number",value:z,onChange:g=>$(g.target.value),margin:"dense"}),e.jsx(re,{label:"名前",value:k,onChange:g=>U(g.target.value),margin:"dense"}),e.jsxs(ge,{children:[e.jsx(be,{id:"md-positions-label",children:"ポジション"}),e.jsxs(ve,{labelId:"md-positions-label",multiple:!0,value:K,label:"ポジション",onChange:g=>oe(typeof g.target.value=="string"?g.target.value.split(","):g.target.value),renderValue:g=>g.join(", "),children:[e.jsx(Y,{value:"レフト",children:"レフト"}),e.jsx(Y,{value:"センター",children:"センター"}),e.jsx(Y,{value:"ライト",children:"ライト"}),e.jsx(Y,{value:"セッター",children:"セッター"}),e.jsx(Y,{value:"リベロ",children:"リベロ"})]})]})]}),e.jsxs(_e,{children:[e.jsx(X,{onClick:Ce,startIcon:e.jsx($e,{}),color:"inherit",children:"キャンセル"}),e.jsx(X,{onClick:Ne,disabled:z==="",startIcon:e.jsx(Ie,{}),children:"OK"})]})]}),e.jsxs(it,{open:te,onClose:ke,children:[e.jsx(Me,{children:"削除確認"}),e.jsx(Pe,{sx:{mt:2},children:"このメンバーを削除しますか？"}),e.jsxs(_e,{children:[e.jsx(X,{onClick:ke,startIcon:e.jsx($e,{}),color:"inherit",children:"キャンセル"}),e.jsx(X,{onClick:Ae,color:"error",startIcon:e.jsx(Ie,{}),children:"OK"})]})]})]})}function xa({match:n,setMatch:l,tags:p,onAddTag:b,locked:c}){return e.jsx(h,{sx:{maxWidth:1024,mx:"auto"},children:e.jsx(mt,{container:!0,spacing:2,children:e.jsx(mt,{item:!0,xs:12,children:e.jsxs(Ge,{elevation:0,sx:{p:2},children:[e.jsx(re,{label:"試合日付",type:"date",InputLabelProps:{shrink:!0},value:n.date,onChange:d=>l(i=>({...i,date:d.target.value})),fullWidth:!0,margin:"dense",disabled:c,sx:{"& .MuiOutlinedInput-root":{height:56},"& .MuiOutlinedInput-input":{padding:"0 14px",height:"100%",lineHeight:"56px",fontSize:"1rem",textAlign:"left"},'& input[type="date"]':{WebkitAppearance:"none"}}}),e.jsx(re,{label:"試合名",value:n.matchName,onChange:d=>l(i=>({...i,matchName:d.target.value})),fullWidth:!0,margin:"dense",disabled:c}),e.jsx(Ft,{multiple:!0,freeSolo:!0,options:p,getOptionLabel:d=>typeof d=="string"?d:d.name,value:n.tags.map(d=>p.find(i=>i.id===d)).filter(Boolean),onChange:(d,i)=>{const _=[];i.forEach(A=>{if(typeof A=="string"){const R={id:crypto.randomUUID(),name:A,color:De};b(R),_.push(R.id)}else _.push(A.id)}),l(A=>({...A,tags:_}))},renderTags:(d,i)=>d.map((_,A)=>e.jsx(we,{...i({index:A}),label:_.name,sx:{backgroundColor:_.color||De,color:"#fff",mr:.5,mb:.5}})),renderInput:d=>e.jsx(re,{...d,label:"タグ",margin:"dense"}),fullWidth:!0,disabled:c}),e.jsx(re,{label:"場所",value:n.location,onChange:d=>l(i=>({...i,location:d.target.value})),fullWidth:!0,margin:"dense",disabled:c}),e.jsx(re,{label:"主審",value:n.mainReferee,onChange:d=>l(i=>({...i,mainReferee:d.target.value})),fullWidth:!0,margin:"dense",disabled:c}),e.jsx(re,{label:"副審",value:n.subReferee,onChange:d=>l(i=>({...i,subReferee:d.target.value})),fullWidth:!0,margin:"dense",disabled:c}),e.jsx(re,{label:"動画URL",value:n.videoUrl,onChange:d=>l(i=>({...i,videoUrl:d.target.value})),multiline:!0,rows:3,fullWidth:!0,margin:"dense",disabled:c}),e.jsx(re,{label:"メモ",value:n.memo,onChange:d=>l(i=>({...i,memo:d.target.value})),multiline:!0,rows:3,fullWidth:!0,margin:"dense",disabled:c})]})})})})}function ma({match:n,setMatch:l,teams:p,locked:b}){return e.jsxs(Ge,{elevation:0,sx:{p:2},children:[e.jsxs(ge,{fullWidth:!0,margin:"normal",disabled:b,children:[e.jsx(be,{id:"teamA-label",children:"チームA"}),e.jsx(ve,{labelId:"teamA-label",value:n.teamA,label:"チームA",onChange:c=>l(d=>({...d,teamA:c.target.value,teamAMembers:[]})),disabled:b,children:p.map(c=>e.jsx(Y,{value:c.id,children:c.name},c.id))})]}),e.jsx(re,{label:"チームA監督",value:n.teamAHeadCoach,onChange:c=>l(d=>({...d,teamAHeadCoach:c.target.value})),fullWidth:!0,margin:"dense",disabled:b}),e.jsx(re,{label:"チームAコーチ",value:n.teamACoach,onChange:c=>l(d=>({...d,teamACoach:c.target.value})),fullWidth:!0,margin:"dense",disabled:b}),e.jsx(re,{label:"チームAマネージャー",value:n.teamAManager,onChange:c=>l(d=>({...d,teamAManager:c.target.value})),fullWidth:!0,margin:"dense",disabled:b}),e.jsx(re,{label:"チームAキャプテン",value:n.teamACaptain,onChange:c=>l(d=>({...d,teamACaptain:c.target.value})),fullWidth:!0,margin:"dense",disabled:b}),e.jsxs(ge,{fullWidth:!0,margin:"normal",disabled:b,children:[e.jsx(be,{id:"teamB-label",children:"チームB"}),e.jsx(ve,{labelId:"teamB-label",value:n.teamB,label:"チームB",onChange:c=>l(d=>({...d,teamB:c.target.value,teamBMembers:[]})),disabled:b,children:p.map(c=>e.jsx(Y,{value:c.id,children:c.name},c.id))})]}),e.jsx(re,{label:"チームB監督",value:n.teamBHeadCoach,onChange:c=>l(d=>({...d,teamBHeadCoach:c.target.value})),fullWidth:!0,margin:"dense",disabled:b}),e.jsx(re,{label:"チームBコーチ",value:n.teamBCoach,onChange:c=>l(d=>({...d,teamBCoach:c.target.value})),fullWidth:!0,margin:"dense",disabled:b}),e.jsx(re,{label:"チームBマネージャー",value:n.teamBManager,onChange:c=>l(d=>({...d,teamBManager:c.target.value})),fullWidth:!0,margin:"dense",disabled:b}),e.jsx(re,{label:"チームBキャプテン",value:n.teamBCaptain,onChange:c=>l(d=>({...d,teamBCaptain:c.target.value})),fullWidth:!0,margin:"dense",disabled:b})]})}const ha=en.create(h),fa=()=>typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():Math.random().toString(36).slice(2)+Date.now().toString(36);function Sa({match:n,onSave:l,teams:p,teamMembers:b,playDetails:c,playCategories:d,statsSettings:i,rallyCategoryTags:_,rallyDetailTags:A,themeSetting:R,scoreInputSetting:S,onAddMember:z,setAppBarAction:$,setAppBarLeftAction:k,onDirtyChange:U,tags:K,onAddTag:oe}){const Q=Gs(),se=Ys(),[T,ee]=o.useState("info"),te=!1;o.useEffect(()=>{const r=se.pathname.split("/").filter(Boolean);if(r[0]!=="matches"||r[1]!==n.id)return;const C=r[2]??"info";C==="setinfo"?(ee("info"),Q(`/matches/${n.id}/info`,{replace:!0})):(ee(C),r[2]||Q(`/matches/${n.id}/info`,{replace:!0}))},[se.pathname,Q,n.id,te]);const Z=o.useCallback(r=>{const C=r.teamA,D=r.teamB,q=(ne,W)=>!!W&&(b[ne]||[]).some(ie=>ie.id===W&&ie.visible!==!1),G=(ne,W)=>W.filter(ie=>q(ne,ie.id)).map(ie=>{const me=(b[ne]||[]).find(le=>le.id===ie.id);return me?{...ie,no:me.no,name:me.name,positions:me.positions}:ie});return{...r,teamAMembers:G(C,r.teamAMembers),teamBMembers:G(D,r.teamBMembers),sets:r.sets.map(ne=>({...ne,rallies:ne.rallies.map(W=>({...W,server:q(W.serverTeam==="teamA"?C:D,W.server)?W.server:void 0,teamAMember:q(C,W.teamAMember)?W.teamAMember:void 0,teamBMember:q(D,W.teamBMember)?W.teamBMember:void 0}))}))}},[b]),[u,L]=o.useState(()=>Z({...n,tags:n.tags||[],matchStatsSettings:n.matchStatsSettings||[],teamAMembers:n.teamAMembers.map(r=>({...r,statuses:r.statuses??Array(n.sets.length).fill("")})),teamBMembers:n.teamBMembers.map(r=>({...r,statuses:r.statuses??Array(n.sets.length).fill("")}))})),j=5,I=[_s,$s,ks,Os,Rs],M=!!n.locked,H=Vs(),w=Ns(H.breakpoints.up("sm")),[V,N]=o.useState(!1),[ye,fe]=o.useState(!1),Ae=200,ke=56,Oe=o.useRef(null),[Ne,Ce]=o.useState(!1),Be=o.useCallback(()=>{V?(fe(!1),N(!1)):(N(!0),w||fe(!0))},[V,w]),g=o.useCallback(r=>{r.propertyName==="width"&&w&&V&&fe(!0)},[w,V]);o.useEffect(()=>{w||(N(!1),fe(!1))},[w]),o.useEffect(()=>(k(e.jsxs(e.Fragment,{children:[e.jsx(Je,{color:"inherit",onClick:Be,ref:Oe,children:e.jsx(Vt,{})}),e.jsx(Ht,{open:Ne,anchorEl:Oe.current,onClose:()=>Ce(!1),anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},slotProps:{paper:{sx:{mt:.25}}},children:e.jsxs(h,{sx:{p:1,maxWidth:260},children:[e.jsxs(Xe,{variant:"body2",children:[e.jsx(Vt,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),"からメニューを開き、各セットのメニューをロングタップし上下にスライドすることでセット順の変更が可能です"]}),e.jsx(h,{sx:{textAlign:"right",mt:1},children:e.jsx(Et,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem("tutorial-set-reorder","1"),Ce(!1)},children:"了解した"})})]})})]})),()=>k(null)),[k,Be,Ne]);const[y,a]=o.useState(!1),[x,m]=o.useState(!1),[v,P]=o.useState(null),[E,xe]=o.useState(!1),[ae,Se]=o.useState({open:!1,message:"",severity:"success"}),de=`matchDraft-${n.id}`,pt=o.useRef(!1),Qe=o.useRef(null),jt=o.useRef(null),[rt,Le]=o.useState(!1),[gt,Fe]=o.useState(!1),[Re,Ze]=o.useState({}),qe=o.useCallback((r,C,D=!0)=>{L(q=>{const G=[...q.sets],ne=G.findIndex(ie=>ie.id===r);if(ne===-1)return q;const W=G[ne];return D&&Ze(ie=>{const me=ie[r]||{undo:[]};return{...ie,[r]:{undo:[...me.undo,W],redo:[]}}}),G[ne]=C,{...q,sets:G}})},[]),ot=o.useCallback(()=>{if(!/^[0-9]+$/.test(T))return;const r=Number(T)-1,C=u.sets[r],D=Re[C.id];if(!D||D.undo.length===0)return;const q=D.undo[D.undo.length-1];Ze(G=>({...G,[C.id]:{undo:D.undo.slice(0,-1),redo:[...D.redo,C]}})),qe(C.id,q,!1)},[T,u.sets,Re,qe]),dt=o.useCallback(()=>{if(!/^[0-9]+$/.test(T))return;const r=Number(T)-1,C=u.sets[r],D=Re[C.id];if(!D||D.redo.length===0)return;const q=D.redo[D.redo.length-1];Ze(G=>({...G,[C.id]:{undo:[...D.undo,C],redo:D.redo.slice(0,-1)}})),qe(C.id,q,!1)},[T,u.sets,Re,qe]),bt=r=>{if(!r.destination||M)return;const C=r.source.index,D=r.destination.index;if(C===D)return;const q=Array.from(u.sets),[G]=q.splice(C,1);q.splice(D,0,G);const ne=me=>me.map(le=>{const t=Array.from(le.statuses||[]),[s]=t.splice(C,1);return t.splice(D,0,s),{...le,statuses:t}}),W=ne(u.teamAMembers),ie=ne(u.teamBMembers);L(me=>({...me,sets:q,teamAMembers:W,teamBMembers:ie}))};o.useEffect(()=>{Ze(r=>{const C={...r};return Object.keys(C).forEach(D=>{u.sets.some(q=>q.id===D)||delete C[D]}),C})},[u.sets]),o.useEffect(()=>{L(r=>Z(r))},[Z]);const pe=r=>{var C;return((C=p.find(D=>D.id===r))==null?void 0:C.name)||""},ze=o.useMemo(()=>u.date!==n.date||u.matchName!==n.matchName||u.location!==n.location||u.mainReferee!==n.mainReferee||u.subReferee!==n.subReferee||u.videoUrl!==n.videoUrl||u.memo!==n.memo||u.teamA!==n.teamA||u.teamAHeadCoach!==n.teamAHeadCoach||u.teamACoach!==n.teamACoach||u.teamAManager!==n.teamAManager||u.teamACaptain!==n.teamACaptain||u.teamB!==n.teamB||u.teamBHeadCoach!==n.teamBHeadCoach||u.teamBCoach!==n.teamBCoach||u.teamBManager!==n.teamBManager||u.teamBCaptain!==n.teamBCaptain||JSON.stringify(u.tags)!==JSON.stringify(n.tags)||JSON.stringify(u.teamAMembers)!==JSON.stringify(n.teamAMembers)||JSON.stringify(u.teamBMembers)!==JSON.stringify(n.teamBMembers)||JSON.stringify(u.matchStatsSettings||[])!==JSON.stringify(n.matchStatsSettings||[])||JSON.stringify(u.sets)!==JSON.stringify(n.sets),[u,n]);o.useEffect(()=>{localStorage.getItem(de)&&xe(!0)},[de]),o.useEffect(()=>{if(!pt.current){pt.current=!0;return}ze?localStorage.setItem(de,JSON.stringify(u)):localStorage.removeItem(de)},[u,ze,de]);const _t=()=>{if(M||u.sets.length>=j)return;u.sets.length===1&&!localStorage.getItem("tutorial-set-reorder")&&Ce(!0);const r={id:fa(),my:0,opponent:0,rallies:[]};L(C=>({...C,sets:[...C.sets,r],teamAMembers:C.teamAMembers.map(D=>({...D,statuses:[...D.statuses||[],""]})),teamBMembers:C.teamBMembers.map(D=>({...D,statuses:[...D.statuses||[],""]}))})),Q(`/matches/${n.id}/${u.sets.length+1}`)},$t=r=>{M||(P(r),m(!0))},kt=()=>{if(v===null)return;const r=v;let C=[],D=[],q=[];const G=T;let ne=T;if(T!=="info"&&T!=="members"&&T!=="stats"&&T!=="setinfo"){const W=Number(T)-1;W===r?(ne="info",Q(`/matches/${n.id}/info`)):W>r&&(ne=String(W),Q(`/matches/${n.id}/${W}`))}ee(ne),L(W=>{C=W.sets.map(le=>({...le})),D=W.teamAMembers.map(le=>({...le,statuses:le.statuses?[...le.statuses]:[]})),q=W.teamBMembers.map(le=>({...le,statuses:le.statuses?[...le.statuses]:[]}));const ie=W.sets.filter((le,t)=>t!==r),me=le=>le.map(t=>({...t,statuses:(t.statuses||[]).filter((s,B)=>B!==r)}));return{...W,sets:ie,teamAMembers:me(W.teamAMembers),teamBMembers:me(W.teamBMembers)}}),P(null),m(!1),Se({open:!0,message:"セットを削除しました",severity:"success",actionLabel:"元に戻す",onAction:()=>{L(W=>({...W,sets:C,teamAMembers:D,teamBMembers:q})),G!=="info"&&G!=="members"&&G!=="stats"&&G!=="setinfo"&&Q(`/matches/${n.id}/${G}`)},autoHideDuration:5e3})},ct=()=>{P(null),m(!1)},ut=o.useCallback(()=>{a(!0)},[]),Ot=async()=>{const r=Z(u);L(r);try{await Promise.resolve(l(r)),localStorage.removeItem(de),Se({open:!0,message:"保存しました",severity:"success"})}catch{Se({open:!0,message:"保存に失敗しました",severity:"error"})}a(!1)},vt=()=>{a(!1)},yt=()=>{Se(r=>({...r,open:!1}))},Rt=()=>{const r=localStorage.getItem(de);if(!r){xe(!1);return}try{const C=JSON.parse(r),D={...C,tags:C.tags||[],matchStatsSettings:C.matchStatsSettings||[],teamAMembers:C.teamAMembers.map(G=>({...G,statuses:G.statuses??Array(C.sets.length).fill("")})),teamBMembers:C.teamBMembers.map(G=>({...G,statuses:G.statuses??Array(C.sets.length).fill("")}))},q=Z(D);L(q),l(q)}catch{}localStorage.removeItem(de),xe(!1)},Ct=()=>{localStorage.removeItem(de),xe(!1)},He=o.useMemo(()=>/^[0-9]+$/.test(T),[T]),Ke=o.useMemo(()=>He?u.sets[Number(T)-1]:null,[He,T,u.sets]),Ye=o.useMemo(()=>{var r;return!He||M||!Ke||!((r=Re[Ke.id])!=null&&r.undo.length)},[He,M,Ke,Re]),et=o.useMemo(()=>{var r;return!He||M||!Ke||!((r=Re[Ke.id])!=null&&r.redo.length)},[He,M,Ke,Re]);o.useEffect(()=>{Ye?Le(!1):localStorage.getItem("tutorial-undo")||Le(!0)},[Ye]),o.useEffect(()=>{et?Fe(!1):localStorage.getItem("tutorial-redo")||Fe(!0)},[et]),o.useEffect(()=>($(e.jsxs(h,{sx:{display:"flex",alignItems:"center"},children:[He&&e.jsxs(e.Fragment,{children:[e.jsx(Je,{ref:Qe,onClick:ot,disabled:Ye,color:"inherit",sx:{ml:1},children:e.jsx(Nt,{})}),e.jsx(Ht,{open:rt,anchorEl:Qe.current,onClose:()=>Le(!1),anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},slotProps:{paper:{sx:{mt:.25}}},children:e.jsxs(h,{sx:{p:1,maxWidth:260},children:[e.jsxs(Xe,{variant:"body2",children:["各セットタブで独立し、ラリー結果の操作履歴を保持しています。",e.jsx("br",{}),e.jsx(Nt,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),"を選択することで1つ前の操作を取り消すことができます。",e.jsx("br",{}),"操作履歴は試合画面を離れると消去されます。"]}),e.jsx(h,{sx:{textAlign:"right",mt:1},children:e.jsx(Et,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem("tutorial-undo","1"),Le(!1)},children:"了解した"})})]})}),e.jsx(Je,{ref:jt,onClick:dt,disabled:et,color:"inherit",sx:{ml:1},children:e.jsx(qt,{})}),e.jsx(Ht,{open:gt,anchorEl:jt.current,onClose:()=>Fe(!1),anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},slotProps:{paper:{sx:{mt:.25}}},children:e.jsxs(h,{sx:{p:1,maxWidth:260},children:[e.jsxs(Xe,{variant:"body2",children:[e.jsx(qt,{fontSize:"inherit",sx:{verticalAlign:"middle",mr:.5}}),"を選択することで1つ前に取り消した操作を復活することができます。"]}),e.jsx(h,{sx:{textAlign:"right",mt:1},children:e.jsx(Et,{component:"button",variant:"body2",onClick:()=>{localStorage.setItem("tutorial-redo","1"),Fe(!1)},children:"了解した"})})]})})]}),e.jsx(X,{onClick:ut,variant:"contained",disabled:!ze||M,startIcon:e.jsx(zs,{}),sx:{ml:1},children:"保存"})]})),()=>$(null)),[$,He,ot,dt,ut,ze,M,Ye,et,rt,gt]),o.useEffect(()=>(U==null||U(ze),()=>U==null?void 0:U(!1)),[ze,U]);const Ee=[{key:"info",label:"試合概要",icon:e.jsx(Qs,{})},{key:"team",label:"チーム",icon:e.jsx(Ps,{})},{key:"members",label:"メンバー登録",icon:e.jsx(ws,{})},{key:"sep1",divider:!0},{key:"stats",label:"スタッツ",icon:e.jsx(Zs,{})},{key:"sep2",divider:!0},{key:"setinfo",label:"セット情報",icon:e.jsx(Ms,{})}].filter(r=>r.key!=="setinfo"),St=u.sets.map((r,C)=>{const D=I[C];return{key:`${C+1}`,icon:e.jsx(D,{}),label:`${r.my}-${r.opponent}`}}),Tt=!M&&u.sets.length<j?[{key:"add",label:"セット追加",icon:e.jsx(Pt,{})}]:[],Ue=r=>{r==="add"?_t():(ee(r),Q(`/matches/${n.id}/${r}`)),w||(fe(!1),N(!1))},At=e.jsxs(ha,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},sx:{flexGrow:1,overflowY:"auto",display:"flex",flexDirection:"column"},children:[T==="info"&&e.jsx(xa,{match:u,setMatch:L,tags:K,onAddTag:oe,locked:M}),T==="members"&&e.jsx(ua,{match:u,setMatch:L,teamAName:pe(u.teamA)||"チームA",teamBName:pe(u.teamB)||"チームB",teamMembers:b,onAddMember:z,locked:M}),T==="stats"&&e.jsx(la,{sets:u.sets,playDetails:c,playCategories:d,statsSettings:i,matchStatsSettings:u.matchStatsSettings||[],onMatchStatsSettingsChange:r=>L(C=>({...C,matchStatsSettings:r})),rallyCategoryTags:_,rallyDetailTags:A,teamAName:pe(u.teamA),teamBName:pe(u.teamB),locked:M}),T==="team"&&e.jsx(h,{sx:{maxWidth:1024,mx:"auto"},children:e.jsx(ma,{match:u,setMatch:L,teams:p,locked:M})}),te,T!=="info"&&T!=="members"&&T!=="stats"&&T!=="setinfo"&&T!=="team"&&e.jsx(ea,{setScore:u.sets[Number(T)-1],playDetails:c,playCategories:d,teamAMembers:u.teamAMembers,teamBMembers:u.teamBMembers,teamAName:pe(u.teamA),teamBName:pe(u.teamB),locked:M,scoreInputSetting:S,themeSetting:R,onChange:r=>qe(r.id,r)})]},T);return e.jsxs(h,{sx:{display:"flex",height:"100%"},children:[e.jsx(qs,{variant:w?"permanent":"temporary",open:w?!0:V,onClose:()=>{fe(!1),N(!1)},PaperProps:{onTransitionEnd:g},ModalProps:{keepMounted:!0,BackdropProps:{sx:{backgroundColor:"rgba(0, 0, 0, 0.5)"}}},sx:{width:w?V?Ae:ke:Ae,flexShrink:0,transition:H.transitions.create("width",{easing:H.transitions.easing.sharp,duration:H.transitions.duration.standard}),...w?{zIndex:H.zIndex.appBar-1}:{},"& .MuiDrawer-paper":{width:w?V?Ae:ke:Ae,boxSizing:"border-box",overflowX:"hidden",transition:H.transitions.create("width",{easing:H.transitions.easing.sharp,duration:H.transitions.duration.standard}),...w?{top:H.mixins.toolbar.minHeight,height:`calc(100% - ${H.mixins.toolbar.minHeight}px)`,zIndex:H.zIndex.appBar-1}:{}}},children:e.jsxs(Ks,{children:[Ee.map(r=>r.divider?e.jsx(Js,{component:"li"},r.key):e.jsxs(Ut,{selected:T===r.key,onClick:()=>Ue(r.key),sx:{minHeight:48,justifyContent:V?"initial":"center",px:2.5},children:[e.jsx(Wt,{sx:{minWidth:0,mr:V?3:0,justifyContent:"center"},children:r.icon}),e.jsx(Lt,{primary:r.label??`セット${r.key}`,sx:{opacity:ye?1:0,display:ye?"block":"none",whiteSpace:"nowrap"}})]},r.key)),e.jsx(Jt,{onDragEnd:bt,children:e.jsx(It,{droppableId:"drawer-sets",children:r=>e.jsxs(h,{ref:r.innerRef,...r.droppableProps,children:[St.map((C,D)=>e.jsx(wt,{draggableId:u.sets[D].id,index:D,children:q=>e.jsxs(Ut,{ref:q.innerRef,...q.draggableProps,...q.dragHandleProps,style:q.draggableProps.style,selected:T===C.key,onClick:()=>Ue(C.key),sx:{minHeight:48,justifyContent:V?"initial":"center",px:2.5},children:[e.jsx(Wt,{sx:{minWidth:0,mr:V?3:0,justifyContent:"center"},children:C.icon}),e.jsx(Lt,{primary:C.label??`セット${C.key}`,sx:{opacity:ye?1:0,display:ye?"block":"none",whiteSpace:"nowrap"}}),!M&&V&&e.jsx(Je,{edge:"end",onClick:G=>{G.stopPropagation(),$t(D)},children:e.jsx(ht,{})})]})},u.sets[D].id)),r.placeholder]})})}),Tt.map(r=>e.jsxs(Ut,{selected:T===r.key,onClick:()=>Ue(r.key),sx:{minHeight:48,justifyContent:V?"initial":"center",px:2.5},children:[e.jsx(Wt,{sx:{minWidth:0,mr:V?3:0,justifyContent:"center"},children:r.icon}),e.jsx(Lt,{primary:r.label??`セット${r.key}`,sx:{opacity:ye?1:0,display:ye?"block":"none",whiteSpace:"nowrap"}})]},r.key))]})}),e.jsxs(h,{sx:{flexGrow:1,display:"flex",flexDirection:"column",width:w?`calc(100% - ${V?Ae:ke}px)`:"100%",transition:w?H.transitions.create("width",{duration:H.transitions.duration.standard}):void 0},children:[e.jsx(h,{sx:{mt:2,flexGrow:1,position:"relative",overflowY:"hidden",display:"flex",width:"100%"},children:e.jsx(tn,{mode:"wait",children:At})}),e.jsxs(it,{open:x,onClose:ct,children:[e.jsx(Me,{children:"削除確認"}),e.jsx(Pe,{sx:{mt:2},children:"このセットを削除しますか？"}),e.jsxs(_e,{children:[e.jsx(X,{onClick:ct,startIcon:e.jsx($e,{}),color:"inherit",children:"キャンセル"}),e.jsx(X,{onClick:kt,color:"error",startIcon:e.jsx(Ie,{}),children:"OK"})]})]}),e.jsxs(it,{open:E,onClose:Ct,children:[e.jsx(Me,{children:"復元確認"}),e.jsx(Pe,{sx:{mt:2},children:"入力途中のデータが存在します。復元しますか？"}),e.jsxs(_e,{children:[e.jsx(X,{onClick:Ct,startIcon:e.jsx($e,{}),color:"inherit",children:"いいえ"}),e.jsx(X,{onClick:Rt,startIcon:e.jsx(Ie,{}),children:"はい"})]})]}),e.jsxs(it,{open:y,onClose:vt,children:[e.jsx(Me,{children:"保存確認"}),e.jsx(Pe,{sx:{mt:2},children:"入力内容を保存しますか？"}),e.jsxs(_e,{children:[e.jsx(X,{onClick:vt,startIcon:e.jsx($e,{}),color:"inherit",children:"キャンセル"}),e.jsx(X,{onClick:Ot,disabled:!ze||M,startIcon:e.jsx(Ie,{}),children:"OK"})]})]}),e.jsx(Xs,{open:ae.open,message:ae.message,severity:ae.severity,onClose:yt,actionLabel:ae.actionLabel,onAction:ae.onAction,autoHideDuration:ae.autoHideDuration})]})]})}export{Sa as default};
