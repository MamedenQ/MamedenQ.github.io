const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MatchDetail-BOI1uEWf.js","assets/mui-vendor-B7aVoM1I.js","assets/react-vendor-QLNaZ7XN.js","assets/QueryStatsOutlined-BEPVsPCj.js","assets/ResponsiveDialog-C42t3OaQ.js","assets/chart-vendor-CPAiRuUQ.js","assets/motion-vendor-BTNqdYSb.js","assets/Settings-EXppjTyB.js","assets/Analysis-BOcYVfuR.js","assets/Dashboard-BdsxNCv3.js"])))=>i.map(i=>d[i]);
import{u as ns,i as Z,j as e,a as os,b as as,B as W,T as is,F as ls,S as cs,M as De,d as us,e as Te,f as wt,g as ds,h as hs,k as _e,l as B,m as fs,D as Ct,n as Dt,o as Tt,p as _t,q as he,r as ms,C as ps,I as gs,s as xs,t as Ue,v as ys,A as bs,w as vs,x as Ss,y as js,z as ws,E as Cs,G as Ds,H as Ts}from"./mui-vendor-B7aVoM1I.js";import{d as _s,a as Us,r as u,b as As,u as Is,f as Rs,B as Es,h as Ms,i as de,N as Os}from"./react-vendor-QLNaZ7XN.js";import{m as Ps,A as Bs}from"./motion-vendor-BTNqdYSb.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function a(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(r){if(r.ep)return;r.ep=!0;const l=a(r);fetch(r.href,l)}})();var Ut,ot=_s;Ut=ot.createRoot,ot.hydrateRoot;const Ls="modulepreload",ks=function(n){return"/breakpoint/v1/"+n},at={},fe=function(o,a,s){let r=Promise.resolve();if(a&&a.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),h=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));r=Promise.allSettled(a.map(d=>{if(d=ks(d),d in at)return;at[d]=!0;const C=d.endsWith(".css"),m=C?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${m}`))return;const p=document.createElement("link");if(p.rel=C?"stylesheet":Ls,C||(p.as="script"),p.crossOrigin="",p.href=d,h&&p.setAttribute("nonce",h),document.head.appendChild(p),C)return new Promise((v,H)=>{p.addEventListener("load",v),p.addEventListener("error",()=>H(new Error(`Unable to preload CSS for ${d}`)))})}))}function l(i){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=i,window.dispatchEvent(h),!h.defaultPrevented)throw i}return r.then(i=>{for(const h of i||[])h.status==="rejected"&&l(h.reason);return o().catch(l)})};var Oe={},Ae={};const $s=Us(ns);var it;function ee(){return it||(it=1,function(n){"use client";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"default",{enumerable:!0,get:function(){return o.createSvgIcon}});var o=$s}(Ae)),Ae}var zs=Z;Object.defineProperty(Oe,"__esModule",{value:!0});var At=Oe.default=void 0,Hs=zs(ee()),Ns=e;At=Oe.default=(0,Hs.default)((0,Ns.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add");var Pe={},Vs=Z;Object.defineProperty(Pe,"__esModule",{value:!0});var It=Pe.default=void 0,qs=Vs(ee()),Ws=e;It=Pe.default=(0,qs.default)((0,Ws.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete");var Be={},Fs=Z;Object.defineProperty(Be,"__esModule",{value:!0});var Rt=Be.default=void 0,Gs=Fs(ee()),Xs=e;Rt=Be.default=(0,Gs.default)((0,Xs.jsx)("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2M9 6c0-1.66 1.34-3 3-3s3 1.34 3 3v2H9zm9 14H6V10h12zm-6-3c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2"}),"LockOutlined");var Le={},Js=Z;Object.defineProperty(Le,"__esModule",{value:!0});var ke=Le.default=void 0,Ks=Js(ee()),Ys=e;ke=Le.default=(0,Ks.default)((0,Ys.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close");var $e={},Qs=Z;Object.defineProperty($e,"__esModule",{value:!0});var ze=$e.default=void 0,Zs=Qs(ee()),er=e;ze=$e.default=(0,Zs.default)((0,er.jsx)("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}),"Check");const tr=(n,o)=>[n,o].sort().join(":"),sr=(n,o,a)=>[n,o].sort().map(s=>{var r;return((r=a.find(l=>l.id===s))==null?void 0:r.name)||""}).join(" - ");function rr(n,o){return n.reduce((a,s)=>{let r="";return o==="dateName"?r=`${s.date} ${s.matchName}`:o==="card"?r=tr(s.teamA,s.teamB):r="all",a[r]||(a[r]=[]),a[r].push(s),a},{})}function Et(n){const o=os();return as(o.breakpoints.down(n))}function nr(){return e.jsxs("svg",{width:"160",height:"40",viewBox:"0 0 160 40",role:"img","aria-label":"横スクロール可能",children:[e.jsx("rect",{width:"160",height:"40",rx:"4",fill:"rgba(0,0,0,0.6)"}),e.jsx("text",{x:"80",y:"26",fill:"#fff",fontSize:"14",textAnchor:"middle",children:"横スクロール可能"})]})}const Mt=u.createContext({rallyMemberRequired:!1,showRallyIcons:!1,showScoreProgressArea:!1,showGridScrollHint:!1});function or({storageKey:n,children:o,...a}){const s=u.useRef(null),[r,l]=u.useState(!1),i=Et("md"),{showGridScrollHint:h}=u.useContext(Mt);u.useEffect(()=>{if(!i||!h){l(!1);return}const m=s.current;m&&(typeof window<"u"&&localStorage.getItem(`scrollHint-${n}`)||m.scrollWidth>m.clientWidth&&l(!0))},[i,n,h]);const d=u.useCallback(()=>{l(!1),typeof window<"u"&&localStorage.setItem(`scrollHint-${n}`,"1")},[n]);u.useEffect(()=>{const m=s.current;if(!r||!m)return;const p={once:!0,passive:!0};return m.addEventListener("scroll",d,p),m.addEventListener("pointerdown",d,p),m.addEventListener("touchstart",d,p),()=>{m.removeEventListener("scroll",d),m.removeEventListener("pointerdown",d),m.removeEventListener("touchstart",d)}},[r,d]);const C=u.isValidElement(o)?u.cloneElement(o,{sx:{minWidth:"100%",...o.props.sx||{}}}):o;return e.jsxs(W,{sx:{position:"relative",my:1,width:"100%"},children:[e.jsx(is,{...a,ref:s,sx:{overflowX:"auto",WebkitOverflowScrolling:"touch","& th, & td":{whiteSpace:"nowrap"},...a.sx||{},width:"100%"},onClick:d,children:C}),r&&e.jsx(W,{onClick:d,sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:10,cursor:"pointer"},children:e.jsx(nr,{})})]})}const Ie="#1C8139",Re="#D21972",ye="#1C8139",Ee="#F5F5F5",Me="#000000",A=ye;function ar({matches:n,teams:o,tags:a,onSelect:s,onAdd:r,onDelete:l,hideFab:i=!1}){const[h,d]=u.useState(!1),[C,m]=u.useState([]),[p,v]=u.useState("none"),[H,N]=u.useState(!1),te=Et("md"),V=U=>{var y;return((y=o.find($=>$.id===U))==null?void 0:y.name)||""};u.useEffect(()=>{const U=setTimeout(()=>N(!0),300);return()=>clearTimeout(U)},[]),u.useEffect(()=>{i&&N(!1)},[i]);const ae=U=>{m([U]),d(!0)},I=()=>{l(C),m([]),d(!1)},se=()=>{m([]),d(!1)},k=p,re=rr(n,k),ne=U=>U.map(y=>{const $=y.sets.filter(T=>T.my>T.opponent).length,L=y.sets.filter(T=>T.my<T.opponent).length,ce=y.sets.map((T,z)=>{const ie=z<y.sets.length-1?", ":"";return`${T.my}-${T.opponent}${ie}`}).join("");return e.jsxs(_e,{sx:{backgroundColor:"white",cursor:"pointer",height:50},hover:!0,onClick:()=>s(y),children:[e.jsx(B,{children:y.date}),e.jsx(B,{children:y.matchName}),e.jsx(B,{children:`${V(y.teamA)} - ${V(y.teamB)}`}),e.jsx(B,{children:y.tags.map(T=>{const z=a.find(q=>q.id===T),ie=(z==null?void 0:z.color)||A;return e.jsx(ps,{label:(z==null?void 0:z.name)||T,size:"small",sx:{mr:.5,mb:.5,backgroundColor:ie,color:"#fff"}},T)})}),e.jsxs(B,{children:[$,"-",L," (",ce,")"]}),e.jsx(B,{padding:"checkbox",children:e.jsx(W,{onClick:T=>T.stopPropagation(),sx:{width:32,height:32,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:e.jsx(gs,{size:"small",onClick:y.locked?void 0:()=>ae(y.id),disabled:y.locked,sx:{width:24,height:24},children:y.locked?e.jsx(Rt,{fontSize:"small",sx:{color:"#D21972"}}):e.jsx(It,{fontSize:"small",color:"error"})})})})]},y.id)});return e.jsxs(W,{sx:{pb:te?10:7},children:[e.jsx(W,{sx:{maxWidth:1024,mx:"auto",display:"flex",justifyContent:"flex-end",alignItems:"center",mb:1},children:te?e.jsx(ls,{size:"small",children:e.jsxs(cs,{value:p,onChange:U=>v(U.target.value),children:[e.jsx(De,{value:"none",children:"グルーピングなし"}),e.jsx(De,{value:"dateName",children:"試合日付＋試合名"}),e.jsx(De,{value:"card",children:"対戦カード"})]})}):e.jsxs(us,{exclusive:!0,value:p,onChange:(U,y)=>{y!==null&&v(y)},children:[e.jsx(Te,{value:"none",children:"グルーピングなし"}),e.jsx(Te,{value:"dateName",children:"試合日付＋試合名"}),e.jsx(Te,{value:"card",children:"対戦カード"})]})}),e.jsx(or,{component:wt,storageKey:"match-list",sx:{maxWidth:1024,mx:"auto"},children:e.jsxs(ds,{size:"small",children:[e.jsx(hs,{children:e.jsxs(_e,{sx:{backgroundColor:"#f5f5f5",height:50},children:[e.jsx(B,{children:"日付"}),e.jsx(B,{children:"試合名"}),e.jsx(B,{children:"対戦カード"}),e.jsx(B,{children:"タグ"}),e.jsx(B,{children:"セット"}),e.jsx(B,{})]})}),e.jsx(fs,{children:k==="none"?ne(re.all||[]):Object.entries(re).map(([U,y])=>{const $=k==="card"?sr(y[0].teamA,y[0].teamB,o):U;return e.jsxs(As.Fragment,{children:[e.jsx(_e,{sx:{height:50},children:e.jsx(B,{colSpan:6,sx:{backgroundColor:"#f5f5f5",fontWeight:"bold"},children:$})}),ne(y)]},U)})})]})}),e.jsxs(Ct,{open:h,onClose:se,children:[e.jsx(Dt,{children:"削除確認"}),e.jsx(Tt,{sx:{mt:2},children:"この試合を削除しますか？"}),e.jsxs(_t,{children:[e.jsx(he,{onClick:se,startIcon:e.jsx(ke,{}),color:"inherit",children:"キャンセル"}),e.jsx(he,{onClick:I,color:"error",startIcon:e.jsx(ze,{}),children:"OK"})]})]}),H&&e.jsx(ms,{ariaLabel:"add match",icon:e.jsx(At,{}),FabProps:{color:"primary",onClick:r},sx:{position:"fixed",right:20,bottom:80}})]})}var He={},ir=Z;Object.defineProperty(He,"__esModule",{value:!0});var Ot=He.default=void 0,lr=ir(ee()),cr=e;Ot=He.default=(0,lr.default)((0,cr.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 2.07c3.07.38 5.57 2.52 6.54 5.36L13 5.65zM8 5.08c1.18-.69 3.33-1.06 3-1.02v7.35l-3 1.73zM4.63 15.1c-.4-.96-.63-2-.63-3.1 0-2.02.76-3.86 2-5.27v7.58zm1.01 1.73L12 13.15l3 1.73-6.98 4.03c-.93-.53-1.74-1.23-2.38-2.08M12 20c-.54 0-1.07-.06-1.58-.16l6.58-3.8 1.36.78C16.9 18.75 14.6 20 12 20m1-8.58V7.96l7 4.05c0 1.1-.23 2.14-.63 3.09z"}),"SportsVolleyballOutlined");var Ne={},ur=Z;Object.defineProperty(Ne,"__esModule",{value:!0});var Pt=Ne.default=void 0,dr=ur(ee()),hr=e;Pt=Ne.default=(0,dr.default)((0,hr.jsx)("path",{d:"M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6"}),"Settings");var Ve={},fr=Z;Object.defineProperty(Ve,"__esModule",{value:!0});var Bt=Ve.default=void 0,mr=fr(ee()),pr=e;Bt=Ve.default=(0,mr.default)((0,pr.jsx)("path",{d:"M4 9h4v11H4zm12 4h4v7h-4zm-6-9h4v16h-4z"}),"BarChart");function gr({value:n,onChange:o}){return e.jsx(wt,{sx:{position:"fixed",left:0,right:0,bottom:0,zIndex:a=>a.zIndex.drawer+1},elevation:3,children:e.jsxs(xs,{showLabels:!0,value:n,onChange:(a,s)=>o(s),children:[e.jsx(Ue,{label:"試合",value:"matches",icon:e.jsx(Ot,{})}),e.jsx(Ue,{label:"分析",value:"analysis",icon:e.jsx(Bt,{})}),e.jsx(Ue,{label:"設定",value:"settings",icon:e.jsx(Pt,{})})]})})}function xr({open:n,message:o,severity:a="success",onClose:s,actionLabel:r,onAction:l,autoHideDuration:i=3e3}){return e.jsx(ys,{open:n,autoHideDuration:i,onClose:s,anchorOrigin:{vertical:"top",horizontal:"center"},sx:{top:{xs:72,sm:80}},children:e.jsx(bs,{onClose:s,severity:a,sx:{width:"100%"},action:r&&l?e.jsx(he,{color:"inherit",size:"small",onClick:()=>{l(),s()},children:r}):void 0,children:o})})}const yr="breakpoint-db",K="state",Y="widgets",Q="dashboards",br=3;function vr(){return new Promise((n,o)=>{const a=indexedDB.open(yr,br);a.onupgradeneeded=()=>{const s=a.result;s.objectStoreNames.contains(K)||s.createObjectStore(K),s.objectStoreNames.contains(Y)||s.createObjectStore(Y,{keyPath:"id"}),s.objectStoreNames.contains(Q)||s.createObjectStore(Q,{keyPath:"id"})},a.onerror=()=>o(a.error),a.onsuccess=()=>n(a.result)})}const F=vr();async function Sr(){const n=await F;return new Promise((o,a)=>{const r=n.transaction(K,"readonly").objectStore(K).get("state");r.onsuccess=()=>o(r.result),r.onerror=()=>a(r.error)})}async function jr(n){const o=await F;return new Promise((a,s)=>{const r=o.transaction(K,"readwrite");r.objectStore(K).put(n,"state"),r.oncomplete=()=>a(),r.onerror=()=>s(r.error)})}async function lt(){const n=await F;return new Promise((o,a)=>{const s=n.transaction(K,"readwrite");s.objectStore(K).clear(),s.oncomplete=()=>o(),s.onerror=()=>a(s.error)})}async function wr(){const n=await F;return new Promise((o,a)=>{const r=n.transaction(Q,"readonly").objectStore(Q).getAll();r.onsuccess=()=>{const l=r.result;l.sort((i,h)=>i.order-h.order),o(l)},r.onerror=()=>a(r.error)})}async function Cr(n){const o=await F;return new Promise((a,s)=>{const r=o.transaction(Q,"readwrite"),l=r.objectStore(Q);l.clear();for(const i of n)l.put(i);r.oncomplete=()=>a(),r.onerror=()=>s(r.error)})}async function Dr(){const n=await F;return new Promise((o,a)=>{const s=n.transaction(Q,"readwrite");s.objectStore(Q).clear(),s.oncomplete=()=>o(),s.onerror=()=>a(s.error)})}async function Tr(n){const o=await F;return new Promise((a,s)=>{const l=o.transaction(Y,"readonly").objectStore(Y).getAll();l.onsuccess=()=>{const i=l.result;a(i.filter(h=>h.dashboardId===n))},l.onerror=()=>s(l.error)})}async function _r(n,o){const a=await F;return new Promise((s,r)=>{const l=a.transaction(Y,"readwrite"),i=l.objectStore(Y),h=i.getAll();h.onsuccess=()=>{const d=h.result;for(const C of d)C.dashboardId===n&&i.delete(C.id);for(const C of o)i.put({...C,dashboardId:n})},h.onerror=()=>r(h.error),l.oncomplete=()=>s(),l.onerror=()=>r(l.error)})}async function ct(){const n=await F;return new Promise((o,a)=>{const s=n.transaction(Y,"readwrite");s.objectStore(Y).clear(),s.oncomplete=()=>o(),s.onerror=()=>a(s.error)})}function Ur(n,o){const s=new TextEncoder().encode(o),r=Ir(s),l=new Uint8Array(30+n.length),i=new DataView(l.buffer);i.setUint32(0,67324752,!0),i.setUint16(4,20,!0),i.setUint16(6,0,!0),i.setUint16(8,0,!0),i.setUint16(10,0,!0),i.setUint16(12,0,!0),i.setUint32(14,r,!0),i.setUint32(18,s.length,!0),i.setUint32(22,s.length,!0),i.setUint16(26,n.length,!0),i.setUint16(28,0,!0);for(let p=0;p<n.length;p++)l[30+p]=n.charCodeAt(p);const h=new Uint8Array(46+n.length),d=new DataView(h.buffer);d.setUint32(0,33639248,!0),d.setUint16(4,20,!0),d.setUint16(6,20,!0),d.setUint16(8,0,!0),d.setUint16(10,0,!0),d.setUint16(12,0,!0),d.setUint16(14,0,!0),d.setUint32(16,r,!0),d.setUint32(20,s.length,!0),d.setUint32(24,s.length,!0),d.setUint16(28,n.length,!0),d.setUint16(30,0,!0),d.setUint16(32,0,!0),d.setUint16(34,0,!0),d.setUint16(36,0,!0),d.setUint32(38,0,!0),d.setUint32(42,0,!0);for(let p=0;p<n.length;p++)h[46+p]=n.charCodeAt(p);const C=new Uint8Array(22),m=new DataView(C.buffer);return m.setUint32(0,101010256,!0),m.setUint16(4,0,!0),m.setUint16(6,0,!0),m.setUint16(8,1,!0),m.setUint16(10,1,!0),m.setUint32(12,h.length,!0),m.setUint32(16,l.length+s.length,!0),m.setUint16(20,0,!0),new Blob([l,s,h,C],{type:"application/zip"})}async function Ar(n){const o=await n.arrayBuffer(),a=new DataView(o);if(a.getUint32(0,!0)!==67324752)throw new Error("invalid zip");const s=a.getUint16(26,!0),r=a.getUint16(28,!0),l=a.getUint32(22,!0),i=30+s+r,h=o.slice(i,i+l);return new TextDecoder().decode(h)}function Ir(n){let o=-1;for(let a=0;a<n.length;a++)o=o>>>8^Rr[(o^n[a])&255];return(o^-1)>>>0}const Rr=(()=>{const n=new Uint32Array(256);for(let o=0;o<256;o++){let a=o;for(let s=0;s<8;s++)a=a&1?3988292384^a>>>1:a>>>1;n[o]=a>>>0}return n})(),ut="1.0.0",Er=u.lazy(()=>fe(()=>import("./MatchDetail-BOI1uEWf.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),Mr=u.lazy(()=>fe(()=>import("./Settings-EXppjTyB.js"),__vite__mapDeps([7,1,2,3,4,5,6]))),Or=u.lazy(()=>fe(()=>import("./Analysis-BOcYVfuR.js"),__vite__mapDeps([8,1,2,4,5,6]))),Pr=u.lazy(()=>fe(()=>import("./Dashboard-BdsxNCv3.js"),__vite__mapDeps([9,1,2,6]))),dt=[],ht={},ft=[{id:"init-serve",name:"サーブ",color:A,iconType:"none",tags:[],visible:!0}],mt=[{id:"init-ace",playCategoryId:"init-serve",name:"エース",pointType:"得点",pointUnitType:"メンバー",tags:[],visible:!0},{id:"init-out",playCategoryId:"init-serve",name:"アウト",pointType:"失点",pointUnitType:"メンバー",tags:[],visible:!0},{id:"init-net",playCategoryId:"init-serve",name:"ネット",pointType:"失点",pointUnitType:"メンバー",tags:[],visible:!0}],pt=[],gt={rallyMemberRequired:!1,showRallyIcons:!1,showScoreProgressArea:!1,showGridScrollHint:!1},xt={scoreColor:Ie,lossColor:Re,buttonColor:ye,appBarColor:Ee,appBarTextColor:Me},yt=[],bt=[],vt=[],St=[],jt=[],ge=[],Br=Ps.create(W);function xe(){const[n,o]=u.useState(jt),[a,s]=u.useState(dt),[r,l]=u.useState(ht),[i,h]=u.useState(ft),[d,C]=u.useState(mt),[m,p]=u.useState(pt),[v,H]=u.useState(bt),[N,te]=u.useState(vt),[V,ae]=u.useState(St),[I,se]=u.useState(xt),[k,re]=u.useState(gt),[ne,U]=u.useState(yt),[y,$]=u.useState(ge),L=u.useRef(ge),[ce,T]=u.useState(null),[z,ie]=u.useState(null),[q,me]=u.useState(!1);u.useEffect(()=>{L.current=y},[y]);const[oe,G]=u.useState(null),ue=Is(),be=Rs(),qe=t=>t.startsWith("/matches")?"matches":t.startsWith("/analysis")?"analysis":t.startsWith("/settings")?"settings":"dashboard",[P,We]=u.useState(qe(ue.pathname)),X=t=>{We(t),be(t==="dashboard"?"/":`/${t}`)};u.useEffect(()=>{We(qe(ue.pathname))},[ue.pathname]),u.useEffect(()=>{const t=ue.pathname.split("/").filter(Boolean);if(t[0]==="matches"&&t[1]){const g=n.find(c=>c.id===t[1])||null;G(g)}else G(null)},[ue.pathname,n]);const[Lt,kt]=u.useState(null),[$t,Fe]=u.useState(null),[zt,Ht]=u.useState(!1),[Nt,Vt]=u.useState(!1),[ve,Se]=u.useState(null),[qt,je]=u.useState(!1),[Wt,Ge]=u.useState(!1),[le,Xe]=u.useState({open:!1,message:"",severity:"success"}),we=(t,g,c)=>{Xe({open:!0,message:t,severity:g,...c})},Ft=u.useMemo(()=>vs({palette:{primary:{main:I.buttonColor}},components:{MuiButtonBase:{styleOverrides:{root:{"&:focus":{outline:"none"},"&.Mui-focusVisible":{outline:"none"}}}},MuiDialogTitle:{styleOverrides:{root:{backgroundColor:I.appBarColor,color:I.appBarTextColor}}}}}),[I.buttonColor,I.appBarColor,I.appBarTextColor]);u.useEffect(()=>{window.scrollTo(0,0)},[P,oe]),u.useEffect(()=>{!q&&P==="dashboard"&&X("matches")},[q,P]),u.useEffect(()=>{Sr().then(t=>{if(!t)return;const g=f=>typeof f=="string"?{id:crypto.randomUUID(),name:f,color:A}:{id:f.id||crypto.randomUUID(),name:f.name,color:f.color||A},c=t.tags?t.tags.map(g):[],_=t.rallyCategoryTags?t.rallyCategoryTags.map(g):t.rallyTags?t.rallyTags.map(g):[],R=t.rallyDetailTags?t.rallyDetailTags.map(g):t.rallyTags?t.rallyTags.map(g):[];t.matches&&o(t.matches.map(f=>({...f,tags:(f.tags||[]).map(x=>{const S=c.find(J=>J.id===x);if(S)return S.id;const b=c.find(J=>J.name===x);if(b)return b.id;const D={id:crypto.randomUUID(),name:x,color:A};return c.push(D),D.id}),matchStatsSettings:f.matchStatsSettings||[]}))),t.teams&&s(t.teams),t.teamMembers&&l(t.teamMembers),t.playCategories&&h(t.playCategories.map(f=>({...f,tags:(f.tags||[]).map(x=>{const S=_.find(D=>D.id===x||D.name===x);if(S)return S.id;const b={id:crypto.randomUUID(),name:x,color:A};return _.push(b),b.id}),color:f.color||A,visible:f.visible!==!1}))),t.playDetails&&C(t.playDetails.map(f=>({...f,tags:(f.tags||[]).map(x=>{const S=R.find(D=>D.id===x||D.name===x);if(S)return S.id;const b={id:crypto.randomUUID(),name:x,color:A};return R.push(b),b.id}),visible:f.visible!==!1}))),t.statsSettings&&p(t.statsSettings.map(f=>({...f,playCategoryTags:(f.playCategoryTags||[]).map(x=>{const S=_.find(D=>D.id===x||D.name===x);if(S)return S.id;const b={id:crypto.randomUUID(),name:x,color:A};return _.push(b),b.id}),playDetailTags:(f.playDetailTags||[]).map(x=>{const S=R.find(D=>D.id===x||D.name===x);if(S)return S.id;const b={id:crypto.randomUUID(),name:x,color:A};return R.push(b),b.id})}))),H(c),te(_),ae(R),t.themeSetting&&se({scoreColor:t.themeSetting.scoreColor??Ie,lossColor:t.themeSetting.lossColor??Re,buttonColor:t.themeSetting.buttonColor??ye,appBarColor:t.themeSetting.appBarColor??Ee,appBarTextColor:t.themeSetting.appBarTextColor??Me}),t.scoreInputSetting&&re({rallyMemberRequired:t.scoreInputSetting.rallyMemberRequired??!0,showRallyIcons:t.scoreInputSetting.showRallyIcons??!0,showScoreProgressArea:t.scoreInputSetting.showScoreProgressArea??!0,showGridScrollHint:t.scoreInputSetting.showGridScrollHint??!1}),t.customAnalyses&&U(t.customAnalyses),t.dashboardVisible!==void 0?(me(t.dashboardVisible),t.dashboardVisible||X("matches")):t.dashboardDisabled!==void 0&&(me(!t.dashboardDisabled),t.dashboardDisabled&&X("matches"))})},[]),u.useEffect(()=>{wr().then(t=>{if(t.length===0)$([]),L.current=[],T(null),X("matches");else{const g=t.sort((c,_)=>c.order-_.order);$(g),L.current=g,T(g[0].id)}})},[]),u.useEffect(()=>{jr({matches:n,teams:a,teamMembers:r,playCategories:i,playDetails:d,statsSettings:m,tags:v,rallyCategoryTags:N,rallyDetailTags:V,themeSetting:I,scoreInputSetting:k,customAnalyses:ne,dashboardVisible:q})},[n,a,r,i,d,m,v,N,V,I,k,ne,q]);const Gt=(t,g)=>{l(c=>({...c,[t]:[...c[t]||[],g]}))},Xt=()=>{const t={id:crypto.randomUUID(),date:new Date().toISOString().slice(0,10),matchName:"",location:"",mainReferee:"",subReferee:"",videoUrl:"",memo:"",teamA:"",teamAHeadCoach:"",teamACoach:"",teamAManager:"",teamACaptain:"",teamB:"",teamBHeadCoach:"",teamBCoach:"",teamBManager:"",teamBCaptain:"",tags:[],sets:[],teamAMembers:[],teamBMembers:[],matchStatsSettings:[],locked:!1};o(g=>[...g,t]),be(`/matches/${t.id}/info`),G(t)},Jt=t=>{let g=[];o(c=>(g=c.map(_=>({..._})),c.filter(_=>!t.includes(_.id)))),we("試合を削除しました","success",{actionLabel:"元に戻す",onAction:()=>o(g),autoHideDuration:5e3})},Kt=async()=>{await lt(),await Dr(),await ct(),o(jt),s(dt),l(ht),h(ft),C(mt),p(pt),H(bt),te(vt),ae(St),se(xt),re(gt),U(yt),$(ge),L.current=ge,T(null),G(null),me(!1),X("matches")},Yt=async()=>{const t=[];for(const b of L.current){const D=await Tr(b.id);t.push(...D)}const g={schemaVersion:ut,matches:n,teams:a,teamMembers:r,playCategories:i,playDetails:d,statsSettings:m,tags:v,rallyCategoryTags:N,rallyDetailTags:V,themeSetting:I,scoreInputSetting:k,customAnalyses:ne,dashboards:L.current,widgets:t},c=Ur("data.json",JSON.stringify(g)),_=URL.createObjectURL(c),R=document.createElement("a");R.href=_;const f=new Date,x=b=>b.toString().padStart(2,"0"),S=f.getFullYear().toString()+x(f.getMonth()+1)+x(f.getDate())+x(f.getHours())+x(f.getMinutes())+x(f.getSeconds());R.download=`breakpoint-data-${S}.zip`,R.click(),URL.revokeObjectURL(_)},Qt=async t=>{var D,J,pe,Ke,Ye,Qe,Ze,et,tt,st,rt,nt;const g=await Ar(t),c=JSON.parse(g),_=c.schemaVersion??"1.0.0";_!==ut&&console.warn(`unexpected schema version: ${_}`),await lt();const R=c.dashboards||[];if($(R),L.current=R,await Cr(R),T(((D=R[0])==null?void 0:D.id)??null),await ct(),Array.isArray(c.widgets)){const j={};for(const w of c.widgets)(j[J=w.dashboardId]||(j[J]=[])).push(w);await Promise.all(Object.entries(j).map(([w,E])=>_r(w,E)))}const f=j=>typeof j=="string"?{id:crypto.randomUUID(),name:j,color:A}:{id:j.id||crypto.randomUUID(),name:j.name,color:j.color||A},x=((pe=c.tags)==null?void 0:pe.map(f))||[],S=(c.rallyCategoryTags?c.rallyCategoryTags:c.rallyTags||[]).map(f),b=(c.rallyDetailTags?c.rallyDetailTags:c.rallyTags||[]).map(f);o((c.matches||[]).map(j=>({...j,tags:(j.tags||[]).map(w=>{const E=x.find(Ce=>Ce.id===w);if(E)return E.id;const M=x.find(Ce=>Ce.name===w);if(M)return M.id;const O={id:crypto.randomUUID(),name:w,color:A};return x.push(O),O.id})}))),s(c.teams||[]),l(c.teamMembers||{}),h((c.playCategories||[]).map(j=>({...j,tags:(j.tags||[]).map(w=>{const E=S.find(O=>O.id===w||O.name===w);if(E)return E.id;const M={id:crypto.randomUUID(),name:w,color:A};return S.push(M),M.id}),color:j.color||A}))),C((c.playDetails||[]).map(j=>({...j,tags:(j.tags||[]).map(w=>{const E=b.find(O=>O.id===w||O.name===w);if(E)return E.id;const M={id:crypto.randomUUID(),name:w,color:A};return b.push(M),M.id})}))),p((c.statsSettings||[]).map(j=>({...j,playCategoryTags:(j.playCategoryTags||[]).map(w=>{const E=S.find(O=>O.id===w||O.name===w);if(E)return E.id;const M={id:crypto.randomUUID(),name:w,color:A};return S.push(M),M.id}),playDetailTags:(j.playDetailTags||[]).map(w=>{const E=b.find(O=>O.id===w||O.name===w);if(E)return E.id;const M={id:crypto.randomUUID(),name:w,color:A};return b.push(M),M.id})}))),H(x),te(S),ae(b),se({scoreColor:((Ke=c.themeSetting)==null?void 0:Ke.scoreColor)??Ie,lossColor:((Ye=c.themeSetting)==null?void 0:Ye.lossColor)??Re,buttonColor:((Qe=c.themeSetting)==null?void 0:Qe.buttonColor)??ye,appBarColor:((Ze=c.themeSetting)==null?void 0:Ze.appBarColor)??Ee,appBarTextColor:((et=c.themeSetting)==null?void 0:et.appBarTextColor)??Me}),re({rallyMemberRequired:((tt=c.scoreInputSetting)==null?void 0:tt.rallyMemberRequired)??!0,showRallyIcons:((st=c.scoreInputSetting)==null?void 0:st.showRallyIcons)??!0,showScoreProgressArea:((rt=c.scoreInputSetting)==null?void 0:rt.showScoreProgressArea)??!0,showGridScrollHint:((nt=c.scoreInputSetting)==null?void 0:nt.showGridScrollHint)??!1}),U(c.customAnalyses||[]),G(null),X(q&&L.current.length>0?"dashboard":"matches")},Zt=t=>{o(g=>g.map(c=>c.id===t.id?{...c,...t}:c)),G(t)},es=(t,g,c,_,R,f,x,S,b,D,J,pe=!1)=>{s(t),l(g),h(c),C(_),p(R),H(f),te(x),ae(S),se(b),re(D),o(J),pe||X(q&&L.current.length>0?"dashboard":"matches")},ts=t=>{const g=oe?zt:P==="settings"?Nt:!1,c=()=>{oe&&localStorage.removeItem(`matchDraft-${oe.id}`),t()};g?(Se(()=>c),je(!0)):c()},ss=()=>{je(!1),ve==null||ve(),Se(null)},Je=()=>{je(!1),Se(null)},rs=P==="dashboard"?ce&&e.jsx(Pr,{dashboardId:ce,editing:z===ce,onExitEdit:()=>ie(null),teams:a}):P==="settings"?e.jsx(Mr,{matches:n,teams:a,teamMembers:r,playCategories:i,playDetails:d,statsSettings:m,tags:v,rallyCategoryTags:N,rallyDetailTags:V,themeSetting:I,scoreInputSetting:k,onSave:es,onDeleteData:Kt,onImportData:Qt,onExportData:Yt,showSnackbar:we,dashboardVisible:q,onDashboardVisibleChange:me,setAppBarLeftAction:Fe,onDirtyChange:Vt}):P==="analysis"?e.jsx(Or,{matches:n,teams:a,teamMembers:r,playCategories:i,playDetails:d,customAnalyses:ne,onCustomAnalysesChange:U,tags:v,rallyCategoryTags:N,rallyDetailTags:V,themeSetting:I,showSnackbar:we}):oe?e.jsx(Er,{match:oe,onSave:Zt,setAppBarAction:kt,setAppBarLeftAction:Fe,teams:a,teamMembers:r,playDetails:d,playCategories:i,statsSettings:m,rallyCategoryTags:N,rallyDetailTags:V,themeSetting:I,scoreInputSetting:k,onAddMember:Gt,tags:v,onAddTag:t=>H(g=>g.some(c=>c.id===t.id)?g:[...g,t]),onDirtyChange:Ht}):e.jsx(ar,{matches:n,teams:a,tags:v,onSelect:t=>{be(`/matches/${t.id}/info`),G(t)},onAdd:Xt,onDelete:Jt,hideFab:Wt});return e.jsx(Mt.Provider,{value:k,children:e.jsx(Ss,{theme:Ft,children:e.jsxs(W,{sx:{height:"100%",display:"flex",flexDirection:"column",boxSizing:"border-box"},children:[e.jsx(js,{}),e.jsx(ws,{position:"fixed",sx:{bgcolor:I.appBarColor,color:I.appBarTextColor},children:e.jsxs(Cs,{sx:{position:"relative"},children:[$t,e.jsx(Ds,{variant:"h6",component:"div",sx:{position:"absolute",left:"50%",transform:"translateX(-50%)"},color:"inherit",children:"BreakPoint"}),e.jsx(W,{sx:{flexGrow:1}}),Lt]})}),e.jsx(W,{sx:{flex:1,position:"relative",display:"flex",overflowY:"auto"},children:e.jsx(Bs,{initial:!1,mode:"wait",children:e.jsx(Br,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},sx:{position:"absolute",width:"100%",display:"flex"},children:e.jsx(Ts,{maxWidth:!1,disableGutters:!0,sx:{flex:1,pt:2,pb:2,display:"flex",flexDirection:"column"},children:e.jsx(u.Suspense,{fallback:e.jsx("div",{children:"Loading..."}),children:rs})})},P)})}),e.jsx(gr,{value:P==="matches"||P==="analysis"||P==="settings"?P:void 0,onChange:t=>{t===P&&oe===null||ts(()=>{Ge(!0),setTimeout(()=>{G(null),X(t),ie(null),Ge(!1)},0)})}}),e.jsxs(Ct,{open:qt,onClose:Je,children:[e.jsx(Dt,{children:"確認"}),e.jsx(Tt,{sx:{mt:2},children:"未保存のデータがあります。保存せずに移動しますか？"}),e.jsxs(_t,{children:[e.jsx(he,{onClick:Je,startIcon:e.jsx(ke,{}),children:"キャンセル"}),e.jsx(he,{onClick:ss,color:"error",startIcon:e.jsx(ze,{}),children:"OK"})]})]}),e.jsx(xr,{open:le.open,message:le.message,severity:le.severity,actionLabel:le.actionLabel,onAction:le.onAction,autoHideDuration:le.autoHideDuration,onClose:()=>Xe(t=>({...t,open:!1}))})]})})})}const Lr=()=>e.jsx(Es,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:e.jsxs(Ms,{children:[e.jsx(de,{path:"/",element:e.jsx(xe,{})}),e.jsx(de,{path:"/matches/*",element:e.jsx(xe,{})}),e.jsx(de,{path:"/analysis/*",element:e.jsx(xe,{})}),e.jsx(de,{path:"/settings/*",element:e.jsx(xe,{})}),e.jsx(de,{path:"*",element:e.jsx(Os,{to:"/",replace:!0})})]})});function kr(n={}){const{immediate:o=!1,onNeedRefresh:a,onOfflineReady:s,onRegistered:r,onRegisteredSW:l,onRegisterError:i}=n;let h,d;const C=async(p=!0)=>{await d};async function m(){if("serviceWorker"in navigator){const{Workbox:p}=await fe(async()=>{const{Workbox:v}=await import("./workbox-window.prod.es5-B9K5rw8f.js");return{Workbox:v}},[]);h=new p("/breakpoint/v1/sw.js",{scope:"/breakpoint/v1/",type:"classic"}),h.addEventListener("activated",v=>{(v.isUpdate||v.isExternal)&&window.location.reload()}),h.addEventListener("installed",v=>{v.isUpdate||s==null||s()}),h.register({immediate:o}).then(v=>{l?l("/breakpoint/v1/sw.js",v):r==null||r(v)}).catch(v=>{i==null||i(v)})}}return d=m(),C}Ut(document.getElementById("root")).render(e.jsx(u.StrictMode,{children:e.jsx(Lr,{})}));kr({immediate:!0});export{xr as A,A as D,or as S,fe as _,At as a,ke as b,ze as c,It as d,sr as e,Rt as f,rr as g,Ot as h,Tr as l,ee as r,_r as s,Et as u};
